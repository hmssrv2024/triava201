<!DOCTYPE html>
<html lang="es">
<head>
  <script src="repair.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>REMEEX - Tarjeta Virtual</title>
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="apple-touch-icon" href="visabluapple.png">
  <meta name="description" content="Gestiona tu tarjeta virtual Remeex VISA para pagos seguros y rápidos."/>
  <meta name="keywords" content="tarjeta virtual, pagos en línea, Remeex VISA"/>
  <meta name="author" content="Remeex VISA"/>
  <meta name="robots" content="noindex, nofollow"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="theme.css">
  <style>
    :root {
      --primary: #1a1f71;
      --primary-dark: #0c1045;
      --primary-light: #3244b6;
      --secondary: #00579f;
      --accent: #f7b600;
      --success: #1f7f5b;
      --danger: #d12d20;
      --neutral-100: #ffffff;
      --neutral-200: #f5f7fa;
      --neutral-300: #eaecf0;
      --neutral-500: #9da4b4;
      --neutral-600: #6e7891;
      --neutral-800: #293249;
      --neutral-900: #1a1f37;
      --shadow-sm: 0 1px 3px rgba(16, 24, 40, 0.1);
      --shadow-md: 0 4px 8px -2px rgba(16, 24, 40, 0.1), 0 2px 4px -2px rgba(16, 24, 40, 0.06);
      --shadow-lg: 0 12px 16px -4px rgba(16, 24, 40, 0.08), 0 4px 6px -2px rgba(16, 24, 40, 0.03);
      --radius-sm: 6px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --radius-full: 9999px;
      --transition-base: all 0.3s ease;
      --animation-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    html {
      scroll-behavior: smooth;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #eef2ff 0%, #f8fbff 100%);
      color: var(--neutral-900);
      min-height: 100vh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: clamp(1.5rem, 3vw, 3rem);
      line-height: 1.55;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body.nfc-overlay-open {
      overflow: hidden;
    }

    .account-activation-overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: clamp(1.5rem, 5vw, 3rem);
      background: rgba(17, 24, 39, 0.82);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      z-index: 4000;
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
      transition: opacity 0.35s ease, visibility 0.35s ease;
    }

    body.account-activation-dismissed .account-activation-overlay {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }

    .account-activation-dialog {
      width: min(420px, 100%);
      padding: clamp(1.75rem, 4vw, 2.5rem);
      border-radius: var(--radius-lg);
      background: var(--neutral-100);
      box-shadow: 0 20px 60px rgba(15, 23, 42, 0.35), var(--shadow-lg);
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
      color: var(--neutral-900);
    }

    .account-activation-dialog h2 {
      font-size: clamp(1.25rem, 3vw, 1.5rem);
      font-weight: 700;
      color: var(--primary-dark);
    }

    .account-activation-dialog p {
      font-size: clamp(0.95rem, 2.5vw, 1.05rem);
      line-height: 1.6;
      color: var(--neutral-800);
    }

    .activation-home-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.85rem 1.5rem;
      border-radius: var(--radius-full);
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: var(--neutral-100);
      font-weight: 600;
      text-decoration: none;
      transition: transform 0.25s var(--animation-bounce), box-shadow 0.25s ease;
      box-shadow: 0 12px 30px rgba(26, 31, 113, 0.28);
    }

    .activation-home-button:hover,
    .activation-home-button:focus-visible {
      transform: translateY(-2px);
      box-shadow: 0 18px 40px rgba(26, 31, 113, 0.32);
      outline: none;
    }

    body:not(.account-activation-dismissed) .cards-page {
      filter: blur(3px);
      pointer-events: none;
      user-select: none;
    }

    .icon {
      display: inline-block;
      width: 1em;
      height: 1em;
      flex-shrink: 0;
      vertical-align: middle;
    }

    .icon use {
      pointer-events: none;
    }

    .icon-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-full);
      flex-shrink: 0;
      color: inherit;
    }

    .icon-badge .icon {
      width: 1.1rem;
      height: 1.1rem;
    }

    main.cards-page {
      width: min(100%, 1200px);
      display: flex;
      justify-content: center;
      margin: 0 auto;
    }

    .card-panel {
      width: 100%;
      background: var(--neutral-100);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      padding: clamp(1.75rem, 3vw, 2.75rem);
      display: grid;
      grid-template-columns: minmax(280px, 360px) minmax(0, 1fr);
      gap: clamp(1.75rem, 3vw, 2.75rem);
      position: relative;
      overflow: visible;
    }

    .card-panel > * {
      grid-column: 1 / -1;
    }

    .panel-loader {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      background: rgba(26, 31, 55, 0.55);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition: opacity 0.35s ease, visibility 0.35s ease;
      z-index: 30;
    }

    .panel-loader.is-visible {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }

    .panel-loader-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
      padding: 1.5rem 2rem;
      border-radius: var(--radius-lg);
      background: rgba(17, 23, 60, 0.68);
      box-shadow: var(--shadow-lg);
      transform: translateY(12px) scale(0.96);
      transition: transform 0.45s var(--animation-bounce), opacity 0.45s ease;
      opacity: 0;
    }

    .panel-loader.is-visible .panel-loader-content {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .panel-spinner {
      width: 2.75rem;
      height: 2.75rem;
      border-radius: 50%;
      border: 3px solid rgba(255, 255, 255, 0.38);
      border-top-color: var(--accent);
      animation: panelSpinner 0.9s linear infinite;
    }

    .panel-loader-label {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--neutral-100);
      letter-spacing: 0.02em;
      text-align: center;
      text-shadow: 0 2px 12px rgba(0, 0, 0, 0.45);
    }

    @keyframes panelSpinner {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .panel-loader {
        transition: none;
      }

      .panel-loader-content {
        transition: none;
      }

      .panel-spinner {
        animation: none;
      }
    }

    .quick-access-nav {
      grid-column: 2 / 3;
      width: 100%;
      margin: 0;
    }

    .quick-access-viewport {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: clamp(0.65rem, 1.5vw, 0.85rem);
      padding: clamp(0.75rem, 2vw, 1rem);
      border-radius: var(--radius-lg);
      background: var(--neutral-100);
      border: 1px solid rgba(26, 31, 55, 0.08);
      box-shadow: none;
    }

    .quick-access-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: clamp(0.65rem, 1.5vw, 0.85rem);
      width: 100%;
    }

    .quick-access-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: clamp(0.4rem, 1.5vw, 0.65rem);
      padding: clamp(0.65rem, 1.6vw, 0.9rem);
      width: 100%;
      min-height: clamp(90px, 18vw, 110px);
      background: var(--neutral-100);
      border-radius: var(--radius-md);
      border: 1px solid transparent;
      color: var(--neutral-800);
      font: inherit;
      font-weight: 600;
      font-size: clamp(0.8rem, 1.8vw, 0.95rem);
      transition: var(--transition-base);
      text-align: center;
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
    }

    .quick-access-control {
      display: none;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      border-radius: var(--radius-full);
      border: 1px solid transparent;
      background: rgba(26, 31, 55, 0.06);
      color: var(--primary-dark);
      transition: var(--transition-base);
      cursor: pointer;
      padding: 0;
    }

    .quick-access-control .icon {
      width: 1.25rem;
      height: 1.25rem;
    }

    .quick-access-control:not(:disabled):hover,
    .quick-access-control:not(:disabled):focus-visible {
      background: rgba(26, 31, 113, 0.12);
      border-color: rgba(26, 31, 113, 0.2);
      color: var(--primary-dark);
      outline: none;
    }

    .quick-access-control:disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }

    .quick-access-mobile-status {
      display: none;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--neutral-900);
    }

    .quick-access-mobile-status-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: rgba(26, 31, 113, 0.08);
      color: var(--primary);
    }

    .quick-access-mobile-status-icon .icon {
      width: 1.1rem;
      height: 1.1rem;
    }

    .quick-access-mobile-status-label {
      display: inline-block;
    }

    .quick-access-icon {
      --quick-access-icon-size: clamp(1.1rem, 3vw, 1.4rem);
      color: var(--primary);
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .quick-access-icon .icon {
      width: var(--quick-access-icon-size);
      height: var(--quick-access-icon-size);
    }

    .quick-access-label {
      text-align: center;
      line-height: 1.3;
    }

    .quick-access-item:hover,
    .quick-access-item:focus-visible {
      border-color: rgba(26, 31, 113, 0.35);
      color: var(--primary-dark);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.12);
      transform: translateY(-2px);
      outline: none;
    }

    .quick-access-item:hover .quick-access-icon,
    .quick-access-item:focus-visible .quick-access-icon {
      color: var(--primary-dark);
    }

    .quick-access-item.is-active,
    .quick-access-item[aria-selected='true'] {
      border-color: var(--primary);
      background: rgba(26, 31, 113, 0.08);
      color: var(--primary-dark);
      box-shadow: var(--shadow-sm);
    }

    .quick-access-item.is-active .quick-access-icon,
    .quick-access-item[aria-selected='true'] .quick-access-icon {
      color: var(--primary-dark);
    }

    .quick-access-panels {
      grid-column: 2 / 3;
      display: flex;
      flex-direction: column;
      gap: clamp(1.5rem, 2.6vw, 2.5rem);
      width: 100%;
    }

    .quick-access-panel {
      background: var(--neutral-100);
      border: 1px solid rgba(26, 31, 55, 0.08);
      border-radius: var(--radius-lg);
      padding: clamp(1.25rem, 2vw, 1.75rem);
      box-shadow: none;
    }

    .quick-access-panel[hidden] {
      display: none !important;
    }

    .scroll-target {
      scroll-margin-top: 2rem;
    }

    .scroll-target:focus-visible {
      outline: 3px solid rgba(26, 31, 113, 0.35);
      outline-offset: 4px;
    }

    @media (max-width: 1024px) {
      body {
        padding: clamp(1.25rem, 4vw, 2rem);
      }

      .card-panel {
        grid-template-columns: 1fr;
        gap: clamp(1.5rem, 3vw, 2rem);
      }

      .card-panel > * {
        grid-column: 1;
      }

      .card-visual-container {
        position: static;
        align-items: center;
        text-align: center;
        margin: 0 auto;
        max-width: 340px;
      }

      .card-status {
        align-self: center;
      }

      .quick-access-nav,
      .style-preview,
      .quick-access-panels {
        grid-column: 1;
      }
    }

    @media (max-width: 768px) {
      body {
        align-items: flex-start;
        padding: 1rem;
      }

      .card-panel {
        border-radius: var(--radius-lg);
        padding: clamp(1rem, 5vw, 1.5rem);
      }

      .card-visual-container {
        width: 100%;
      }

      .virtual-card {
        max-width: 260px;
        margin: 0 auto;
      }

      .quick-access-viewport {
        padding: 0.75rem;
        gap: 0.75rem;
        display: grid;
        grid-template-columns: auto minmax(0, 1fr) auto;
        grid-auto-rows: auto;
        align-items: center;
      }

      .quick-access-control {
        display: inline-flex;
        grid-row: 1;
      }

      .quick-access-prev {
        grid-column: 1;
      }

      .quick-access-next {
        grid-column: 3;
      }

      .quick-access-list {
        grid-column: 2;
        grid-row: 1;
        display: flex;
        align-items: stretch;
        gap: 0.5rem;
        overflow-x: auto;
        overflow-y: hidden;
        padding: 0.25rem 0;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }

      .quick-access-list::-webkit-scrollbar {
        display: none;
      }

      .quick-access-item {
        flex: 0 0 auto;
        min-width: 64px;
        padding: 0.5rem;
        gap: 0.4rem;
        border-radius: var(--radius-full);
        font-size: 0.8rem;
        scroll-snap-align: center;
        flex-direction: column;
        justify-content: center;
      }

      .quick-access-item .quick-access-label {
        display: none;
      }

      .quick-access-item.is-active .quick-access-label,
      .quick-access-item[aria-selected='true'] .quick-access-label {
        display: block;
      }

      .quick-access-mobile-status {
        grid-column: 1 / -1;
        grid-row: 2;
        display: none;
      }

      .quick-access-mobile-status.is-visible {
        display: flex;
      }
    }

    @media (max-width: 600px) {
      body {
        height: 100vh;
        overflow: hidden;
        padding: 0;
        align-items: stretch;
      }

      main.cards-page {
        display: block;
        width: 100%;
        height: 100%;
      }

      .card-panel {
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
        height: 100%;
        padding: 1rem 1rem 1.5rem;
        border-radius: 0;
        box-shadow: none;
        overflow-y: auto;
      }

      .card-panel > * {
        flex-shrink: 0;
      }

      .card-visual-container {
        margin: 0;
      }

      .mobile-step {
        display: none;
      }

      .mobile-step.mobile-step-active {
        display: flex;
        flex-direction: column;
        gap: clamp(1rem, 4vw, 1.5rem);
        min-height: calc(100vh - 2.5rem);
      }

      .mobile-step.mobile-step-active .physical-card-grid,
      .mobile-step.mobile-step-active .physical-card-field,
      .mobile-step.mobile-step-active .card-actions,
      .mobile-step.mobile-step-active .style-preview-body {
        width: 100%;
      }

      .mobile-stepper-controls {
        display: flex;
        position: sticky;
        bottom: 0;
        padding: 0.75rem 0;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0) 0%, var(--neutral-100) 32%, var(--neutral-100) 100%);
        z-index: 5;
      }

      .mobile-stepper-controls[aria-hidden='true'] {
        display: none;
      }

      .mobile-stepper-controls .btn {
        flex: 1 1 auto;
      }

      .mobile-stepper-status {
        flex: 1 1 auto;
      }
    }

    @media (max-width: 480px) {
      .virtual-card {
        max-width: 100%;
      }

      .card-panel {
        padding: 0.9rem;
      }

      .quick-access-item {
        min-width: 56px;
      }

      .quick-access-control {
        width: 40px;
        height: 40px;
      }
    }

    .section-title {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: clamp(0.75rem, 2vw, 1rem);
    }

    .section-heading {
      display: inline-flex;
      align-items: center;
      gap: clamp(0.65rem, 1.6vw, 0.9rem);
      font-size: clamp(1.05rem, 2vw, 1.3rem);
      font-weight: 600;
      color: var(--neutral-900);
    }

    .section-heading .icon {
      color: var(--primary);
      width: clamp(1.2rem, 2.4vw, 1.4rem);
      height: clamp(1.2rem, 2.4vw, 1.4rem);
    }

    .settings-link {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      color: var(--neutral-800);
      text-decoration: none;
      transition: var(--transition-base);
    }

    .settings-link:hover,
    .settings-link:focus-visible {
      background: var(--neutral-300);
      color: var(--primary);
    }

    .virtual-card {
      background: var(--primary);
      border-radius: var(--radius-lg);
      width: 100%;
      max-width: 100%;
      aspect-ratio: 1.6 / 1;
      padding: clamp(1.2rem, 2vw, 1.75rem);
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
      color: #ffffff;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      margin: 0;
      transition: var(--transition-base);
      text-align: left;
    }

    .card-visual-container {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: clamp(1rem, 2vw, 1.5rem);
      width: 100%;
      max-width: clamp(280px, 30vw, 360px);
      margin: 0;
      text-align: left;
      grid-column: 1 / 2;
      position: sticky;
      top: clamp(1rem, 4vw, 2.5rem);
      align-self: flex-start;
    }

    .style-preview {
      grid-column: 2 / 3;
      display: flex;
      flex-direction: column;
      gap: clamp(0.65rem, 1.6vw, 0.9rem);
      padding: clamp(0.9rem, 2vw, 1.25rem);
      border-radius: var(--radius-lg);
      background: var(--neutral-100);
      border: 1px solid rgba(26, 31, 55, 0.08);
      box-shadow: none;
      transition: var(--transition-base);
    }

    .style-preview.has-style {
      border-color: rgba(26, 31, 113, 0.35);
      box-shadow: 0 8px 12px -4px rgba(26, 31, 113, 0.2);
    }

    .style-preview-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
    }

    .style-preview-title {
      font-weight: 600;
      color: var(--neutral-900);
      font-size: 0.95rem;
    }

    .style-preview-status {
      font-size: 0.8rem;
      color: var(--neutral-600);
    }

    .style-preview.has-style .style-preview-status {
      color: var(--primary);
      font-weight: 600;
    }

    .style-preview-body {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .style-preview-card {
      width: 120px;
      height: 70px;
      border-radius: var(--radius-md);
      background: var(--neutral-300);
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.6), var(--shadow-sm);
      flex-shrink: 0;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease;
    }

    .style-preview.has-style .style-preview-card {
      transform: translateY(-2px);
    }

    .style-preview-card::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .style-preview.has-style .style-preview-card::after {
      opacity: 1;
    }

    .style-preview-message {
      margin: 0;
      font-size: 0.8rem;
      color: var(--neutral-600);
      line-height: 1.4;
    }

    .card-financial-overview {
      display: flex;
      flex-direction: column;
      gap: clamp(1rem, 2vw, 1.5rem);
      transition: var(--transition-base);
    }

    .financial-overview-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .financial-overview-title {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      color: var(--neutral-900);
    }

    .financial-overview-title .icon {
      color: var(--primary);
      width: 1.1rem;
      height: 1.1rem;
    }

    .financial-overview-main {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: clamp(0.75rem, 2vw, 1.25rem);
      flex-wrap: wrap;
    }

    .financial-label {
      font-size: clamp(0.75rem, 1.6vw, 0.85rem);
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--neutral-600);
    }

    .financial-value {
      font-size: clamp(1.25rem, 2.4vw, 1.6rem);
      font-weight: 700;
      color: var(--neutral-900);
    }

    .financial-overview-limits {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: clamp(0.75rem, 1.8vw, 1rem);
    }

    .financial-limit-card {
      background: var(--neutral-100);
      border: 1px solid rgba(26, 31, 55, 0.08);
      border-radius: var(--radius-md);
      padding: clamp(0.75rem, 1.6vw, 1rem);
      box-shadow: none;
      display: flex;
      flex-direction: column;
      gap: clamp(0.3rem, 1.2vw, 0.5rem);
      transition: var(--transition-base);
    }

    .financial-limit-card:hover,
    .financial-limit-card:focus-within {
      transform: translateY(-1px);
      box-shadow: 0 8px 14px -12px rgba(26, 31, 55, 0.35);
    }

    .financial-limit-card .financial-value {
      font-size: clamp(1.05rem, 1.8vw, 1.3rem);
    }

    .financial-limit-card .limit-status {
      font-size: clamp(0.75rem, 1.3vw, 0.85rem);
      font-weight: 500;
      color: var(--neutral-600);
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    .financial-limit-card .limit-status::before {
      content: '';
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--neutral-500);
      box-shadow: 0 0 0 1px rgba(17, 24, 39, 0.08);
    }

    .financial-limit-card.is-reached {
      border-color: rgba(209, 45, 32, 0.35);
      background: rgba(209, 45, 32, 0.06);
      box-shadow: 0 0 0 1px rgba(209, 45, 32, 0.08), var(--shadow-sm);
    }

    .financial-limit-card.is-reached .financial-value {
      color: var(--danger);
    }

    .financial-limit-card.is-reached .limit-status {
      color: var(--danger);
    }

    .financial-limit-card.is-reached .limit-status::before {
      background: var(--danger);
    }

    .limit-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: clamp(0.85rem, 2vw, 1.25rem);
      padding-top: clamp(0.85rem, 2vw, 1.25rem);
      margin-top: clamp(0.85rem, 2vw, 1.25rem);
      border-top: 1px solid rgba(26, 31, 55, 0.08);
    }

    .limit-control {
      display: flex;
      flex-direction: column;
      gap: clamp(0.35rem, 1.2vw, 0.6rem);
    }

    .limit-control-label {
      font-size: clamp(0.85rem, 1.6vw, 0.95rem);
      font-weight: 600;
      color: var(--neutral-700);
    }

    .limit-control-input {
      width: 100%;
      padding: clamp(0.55rem, 1.4vw, 0.7rem) clamp(0.7rem, 1.6vw, 0.85rem);
      border-radius: var(--radius-sm);
      border: 1px solid rgba(26, 31, 55, 0.12);
      background: var(--neutral-100);
      font-size: clamp(0.95rem, 1.8vw, 1.05rem);
      color: var(--neutral-900);
      transition: var(--transition-base);
    }

    .limit-control-input[type='number'] {
      -moz-appearance: textfield;
    }

    .limit-control-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.15);
      outline: none;
    }

    .limit-control-input::-webkit-outer-spin-button,
    .limit-control-input::-webkit-inner-spin-button {
      margin: 0;
      -webkit-appearance: none;
    }

    .limit-control-helper {
      font-size: clamp(0.75rem, 1.4vw, 0.85rem);
      color: var(--neutral-600);
      line-height: 1.4;
    }

    .virtual-card::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.18), transparent);
      transform: translateX(-100%);
      animation: shine 3s infinite;
    }

    .card-logo {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 0.5rem;
      position: relative;
      z-index: 1;
    }

    .card-chip {
      width: 36px;
      height: auto;
      flex-shrink: 0;
      filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.2));
    }

    .card-brand {
      width: 52px;
      height: auto;
      flex-shrink: 0;
    }

    .card-number {
      font-size: clamp(1.05rem, 3.8vw, 1.2rem);
      letter-spacing: 0.12em;
      font-family: 'Source Code Pro', 'Courier New', Courier, monospace;
      margin: 0.15rem 0 0.35rem;
      position: relative;
      z-index: 1;
      white-space: nowrap;
    }

    .card-info-line {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      position: relative;
      z-index: 1;
      flex-wrap: nowrap;
    }

    .card-info-line.card-number-line {
      margin: 0.25rem 0 0.5rem;
    }

    .card-info-line.is-end-aligned {
      justify-content: flex-end;
    }

    .card-info-line .card-number {
      flex: 1;
      margin: 0;
      min-width: 0;
    }

    .copy-icon-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border-radius: var(--radius-full);
      border: 1px solid rgba(255, 255, 255, 0.45);
      background: rgba(255, 255, 255, 0.2);
      color: #ffffff;
      cursor: pointer;
      transition: var(--transition-base);
      box-shadow: 0 2px 6px rgba(17, 24, 39, 0.18);
    }

    .copy-icon-button:hover,
    .copy-icon-button:focus-visible {
      background: rgba(255, 255, 255, 0.35);
      color: var(--primary);
      transform: translateY(-1px);
    }

    .copy-icon-button:focus-visible {
      outline: 2px solid rgba(255, 255, 255, 0.6);
      outline-offset: 2px;
    }

    .copy-icon-button .icon {
      width: 0.75rem;
      height: 0.75rem;
    }

    .copy-icon-button-light {
      background: rgba(255, 255, 255, 0.85);
      color: var(--primary);
      border: 1px solid rgba(26, 31, 113, 0.25);
      box-shadow: 0 1px 3px rgba(26, 31, 113, 0.25);
    }

    .copy-icon-button-light:hover,
    .copy-icon-button-light:focus-visible {
      background: rgba(26, 31, 113, 0.12);
      color: var(--primary-dark);
      border-color: rgba(26, 31, 113, 0.4);
    }

    .copy-icon-button-light:focus-visible {
      outline: 2px solid rgba(26, 31, 113, 0.35);
    }

    .copy-icon-button.is-copied {
      transform: scale(0.95);
    }

    .cardholder-name {
      font-size: clamp(0.8rem, 2.8vw, 0.95rem);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      opacity: 0.85;
      position: relative;
      z-index: 1;
    }

    .card-details {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      font-size: clamp(0.75rem, 2.4vw, 0.85rem);
      letter-spacing: 0.12em;
      opacity: 0.85;
      position: relative;
      z-index: 1;
    }

    .card-back {
      position: relative;
      z-index: 1;
    }

    .my-visa-card .card-back {
      margin-top: 1rem;
      padding: 0;
      background: transparent;
      box-shadow: none;
    }

    .card-back .cvv {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      height: 36px;
      border-radius: 4px;
      padding: 0 0.75rem;
      background: rgba(255, 255, 255, 0.9);
      color: #1a1f37;
      font-family: 'Source Code Pro', 'Courier New', Courier, monospace;
      font-size: 0.95rem;
    }

    .card-status {
      align-self: flex-start;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.4rem 0.9rem;
      border-radius: var(--radius-full);
      font-size: clamp(0.7rem, 1.4vw, 0.75rem);
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      background: rgba(26, 31, 113, 0.08);
      color: var(--neutral-800);
      transition: var(--transition-base);
    }

    .card-status::before {
      content: '';
      width: 0.5rem;
      height: 0.5rem;
      border-radius: 50%;
      background: currentColor;
      box-shadow: 0 0 0 1px rgba(17, 24, 39, 0.1);
    }

    .card-status.active {
      background: rgba(0, 211, 77, 0.15);
      color: var(--success);
    }

    .card-status.frozen {
      background: rgba(0, 149, 255, 0.15);
      color: var(--info);
    }

    .my-visa-card.frozen {
      filter: grayscale(1) brightness(0.85);
    }

    .card-actions {
      display: flex;
      flex-wrap: wrap;
      gap: clamp(0.65rem, 1.8vw, 1rem);
    }

    .mobile-step {
      display: contents;
    }

    .mobile-stepper-controls {
      display: none;
      align-items: center;
      justify-content: space-between;
      gap: clamp(0.65rem, 2vw, 1.2rem);
      margin-top: clamp(1rem, 2.6vw, 1.5rem);
    }

    .mobile-stepper-controls .btn {
      min-width: 120px;
      white-space: nowrap;
    }

    .mobile-stepper-status {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      text-align: center;
      font-size: 0.8rem;
      color: var(--neutral-600);
    }

    .mobile-stepper-count {
      font-weight: 600;
      color: var(--neutral-800);
    }

    .mobile-stepper-title {
      font-weight: 600;
      color: var(--neutral-900);
      font-size: 0.85rem;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: clamp(0.5rem, 1.5vw, 0.7rem) clamp(1rem, 2.6vw, 1.4rem);
      border-radius: var(--radius-md);
      font-size: clamp(0.85rem, 1.6vw, 0.95rem);
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: var(--transition-base);
      text-decoration: none;
    }

    .btn.is-copied {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn.is-processing {
      cursor: progress;
      opacity: 0.75;
      box-shadow: none;
      transform: translateY(0);
    }

    .btn .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 1.5rem;
      height: 1.5rem;
      padding: 0 0.4rem;
      margin-left: 0.5rem;
      border-radius: var(--radius-full);
      background: var(--primary);
      color: var(--neutral-100);
      font-size: 0.7rem;
      font-weight: 700;
      line-height: 1;
    }

    .btn .badge[hidden] {
      display: none;
    }

    .btn-small {
      height: 40px;
    }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--neutral-300);
      color: var(--neutral-800);
    }

    .btn-outline.is-active {
      border-color: var(--primary);
      color: var(--primary);
      background: rgba(26, 31, 113, 0.08);
    }

    .btn-outline:hover,
    .btn-outline:focus-visible {
      border-color: var(--primary);
      color: var(--primary);
      transform: translateY(-2px);
    }

    .btn-primary {
      background: var(--primary);
      color: #ffffff;
      box-shadow: var(--shadow-md);
      align-self: center;
      padding: 0.75rem 2.5rem;
      font-size: 0.9rem;
    }

    .btn-primary.btn-small {
      padding: 0.5rem 1.5rem;
      font-size: 0.85rem;
    }

    .btn-primary:hover,
    .btn-primary:focus-visible {
      background: var(--primary-light);
      transform: translateY(-2px);
    }

    .btn-success {
      background: var(--success);
      color: var(--neutral-100);
      box-shadow: var(--shadow-md);
    }

    .btn-success:hover,
    .btn-success:focus-visible {
      background: #1a6b4c;
      transform: translateY(-2px);
    }

    .btn-danger {
      background: var(--danger);
      color: var(--neutral-100);
      box-shadow: var(--shadow-md);
    }

    .btn-danger:hover,
    .btn-danger:focus-visible {
      background: #b7241a;
      transform: translateY(-2px);
    }

    .travel-notice-indicator {
      display: flex;
      align-items: center;
      gap: clamp(0.65rem, 1.6vw, 0.9rem);
      padding: clamp(0.75rem, 1.8vw, 1rem);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(26, 31, 55, 0.08);
      background: var(--neutral-100);
      transition: var(--transition-base);
    }

    .travel-notice-indicator.is-active {
      background: rgba(31, 127, 91, 0.1);
      border-color: rgba(31, 127, 91, 0.25);
      box-shadow: none;
    }

    .travel-notice-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      background: rgba(26, 31, 113, 0.12);
      flex-shrink: 0;
    }

    .travel-notice-icon .icon {
      width: 1.05rem;
      height: 1.05rem;
    }

    .travel-notice-indicator.is-active .travel-notice-icon {
      background: rgba(31, 127, 91, 0.18);
      color: var(--success);
    }

    .travel-notice-text {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .travel-notice-title {
      font-size: clamp(0.9rem, 1.8vw, 1.05rem);
      font-weight: 600;
      color: var(--neutral-900);
    }

    .travel-notice-indicator.is-active .travel-notice-title {
      color: var(--success);
    }

    .travel-notice-subtitle {
      font-size: clamp(0.8rem, 1.4vw, 0.9rem);
      color: var(--neutral-600);
      line-height: 1.4;
    }

    .travel-notice-indicator.is-active .travel-notice-subtitle {
      color: var(--neutral-800);
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(17, 24, 39, 0.55);
      z-index: 80;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .modal-backdrop.is-visible {
      opacity: 1;
      pointer-events: auto;
    }

    .travel-notice-modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      z-index: 90;
      opacity: 0;
      pointer-events: none;
      transform: translateY(16px);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .travel-notice-modal.is-visible {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    .travel-notice-modal__content {
      width: min(480px, 100%);
      background: var(--neutral-100);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    .travel-notice-modal__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .travel-notice-modal__title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--neutral-900);
    }

    .travel-notice-modal__close {
      border: none;
      background: transparent;
      color: var(--neutral-600);
      font-size: 1.5rem;
      cursor: pointer;
      line-height: 1;
      padding: 0.25rem;
      transition: var(--transition-base);
    }

    .travel-notice-modal__close:hover,
    .travel-notice-modal__close:focus-visible {
      color: var(--neutral-900);
      transform: scale(1.05);
    }

    .travel-notice-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .travel-notice-form .form-field {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .travel-notice-form label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--neutral-800);
    }

    .travel-notice-form input {
      border: 1px solid var(--neutral-300);
      border-radius: var(--radius-md);
      padding: 0.6rem 0.75rem;
      font-size: 0.9rem;
      background: var(--neutral-100);
      color: var(--neutral-900);
      transition: var(--transition-base);
    }

    .travel-notice-form input:focus,
    .travel-notice-form input:focus-visible {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.15);
    }

    .travel-notice-dates {
      display: grid;
      gap: 0.75rem;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    }

    .travel-notice-helper {
      font-size: 0.8rem;
      color: var(--neutral-600);
      line-height: 1.4;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
    }

    .nfc-settings-group {
      display: flex;
      flex-direction: column;
      gap: clamp(0.6rem, 1.4vw, 0.85rem);
      align-items: stretch;
    }

    .nfc-settings {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: clamp(0.75rem, 2vw, 1.25rem);
      padding: clamp(0.9rem, 1.8vw, 1.2rem);
      border-radius: var(--radius-lg);
      background: var(--neutral-100);
      border: 1px solid rgba(26, 31, 55, 0.08);
      box-shadow: none;
      transition: var(--transition-base);
    }

    .nfc-settings:focus-within {
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.12);
    }

    .nfc-settings-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex: 1 1 auto;
    }

    .nfc-settings-info .icon-badge {
      width: 40px;
      height: 40px;
      background: rgba(26, 31, 113, 0.1);
      color: var(--primary);
    }

    .nfc-settings-info .icon-badge .icon {
      width: 1rem;
      height: 1rem;
    }

    .nfc-settings-info .toggle-title {
      font-weight: 600;
      color: var(--neutral-900);
      font-size: 0.95rem;
      display: block;
    }

    .nfc-settings-info .toggle-description {
      display: block;
      font-size: 0.8rem;
      color: var(--neutral-600);
      margin-top: 0.2rem;
    }

    .switch {
      position: relative;
      display: inline-flex;
      width: 50px;
      height: 28px;
      flex-shrink: 0;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      inset: 0;
      cursor: pointer;
      background: var(--neutral-500);
      border-radius: var(--radius-full);
      transition: var(--transition-base);
    }

    .slider::before {
      content: '';
      position: absolute;
      height: 22px;
      width: 22px;
      left: 4px;
      top: 3px;
      background: var(--neutral-100);
      border-radius: 50%;
      transition: var(--transition-base);
      box-shadow: var(--shadow-sm);
    }

    .switch input:checked + .slider {
      background: var(--primary);
    }

    .switch input:checked + .slider::before {
      transform: translateX(22px);
    }

    .switch input:disabled + .slider {
      cursor: progress;
      opacity: 0.6;
    }

    .switch input[aria-busy='true'] + .slider::before {
      animation: pulse 1s ease-in-out infinite;
    }

    .nfc-status-text {
      margin: 0;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
      color: var(--neutral-600);
      line-height: 1.4;
      min-height: 1.5rem;
      transition: var(--transition-base);
      align-self: flex-start;
    }

    .nfc-status-text::before {
      content: '';
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--neutral-500);
      transition: var(--transition-base);
      animation: none;
    }

    .nfc-status-text.is-active {
      color: #00c057;
      font-weight: 600;
    }

    .nfc-status-text.is-active::before {
      background: #00c057;
    }

    .nfc-status-text.is-busy {
      color: var(--neutral-600);
      opacity: 0.9;
    }

    .nfc-status-text.is-busy::before {
      background: var(--accent);
      animation: pulse 1s infinite ease-in-out;
    }

    .nfc-indicator {
      position: absolute;
      top: 1rem;
      left: 1rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.35rem 0.75rem;
      border-radius: var(--radius-full);
      background: rgba(255, 255, 255, 0.2);
      color: #ffffff;
      font-size: 0.75rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      opacity: 0;
      transform: translateY(-6px);
      transition: var(--transition-base);
      pointer-events: none;
      backdrop-filter: blur(10px);
      z-index: 2;
    }

    .nfc-indicator .icon {
      width: 0.85rem;
      height: 0.85rem;
    }

    .nfc-indicator.active {
      opacity: 1;
      transform: translateY(0);
    }

    .my-visa-card::before {
      content: '';
      position: absolute;
      inset: -45%;
      background: radial-gradient(circle, rgba(0, 192, 135, 0.28), rgba(0, 0, 0, 0));
      opacity: 0;
      pointer-events: none;
      filter: blur(32px);
      transition: opacity 0.4s ease;
    }

    .my-visa-card.nfc-preview-active {
      transform: translateY(-3px);
      box-shadow: 0 24px 60px rgba(0, 192, 135, 0.28), var(--shadow-lg);
    }

    .my-visa-card.nfc-preview-active::before {
      opacity: 1;
      animation: nfcAmbient 3.2s infinite ease-in-out;
    }

    .my-visa-card.nfc-preview-active + .card-status {
      background: rgba(0, 211, 77, 0.28);
      color: #00c057;
    }

    .my-visa-card.nfc-preview-active .card-number {
      text-shadow: 0 0 12px rgba(102, 255, 215, 0.4);
    }

    .nfc-payment-overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: clamp(1.5rem, 5vw, 3rem);
      background: radial-gradient(circle at 20% 20%, rgba(70, 90, 200, 0.35), rgba(7, 12, 40, 0.95));
      backdrop-filter: blur(14px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
      z-index: 3000;
    }

    .nfc-payment-overlay.is-visible {
      opacity: 1;
      pointer-events: auto;
    }

    .nfc-payment-content {
      position: relative;
      width: min(480px, 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.75rem;
      text-align: center;
      color: #f4f8ff;
    }

    .nfc-payment-close {
      position: absolute;
      top: -0.75rem;
      right: -0.75rem;
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      border: none;
      background: rgba(16, 24, 64, 0.85);
      color: #ffffff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.35);
      transition: var(--transition-base);
    }

    .nfc-payment-close:hover,
    .nfc-payment-close:focus-visible {
      background: rgba(50, 70, 200, 0.95);
      transform: translateY(-2px);
      outline: none;
    }

    .nfc-payment-visual {
      position: relative;
      width: 100%;
      aspect-ratio: 1 / 1.2;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .nfc-pulse {
      position: absolute;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(0, 255, 195, 0.3), rgba(0, 0, 0, 0));
      opacity: 0;
      animation: nfcPulse 4.2s infinite;
    }

    .nfc-pulse-one {
      width: 100%;
      height: 100%;
      animation-delay: 0s;
    }

    .nfc-pulse-two {
      width: 120%;
      height: 120%;
      animation-delay: 1.4s;
    }

    .nfc-pulse-three {
      width: 140%;
      height: 140%;
      animation-delay: 2.8s;
    }

    .nfc-payment-overlay.is-visible .nfc-pulse {
      opacity: 1;
    }

    .nfc-payment-card {
      position: relative;
      width: 72%;
      aspect-ratio: 320 / 200;
      border-radius: var(--radius-xl);
      background: linear-gradient(135deg, rgba(26, 31, 113, 0.95), rgba(50, 68, 182, 0.95));
      overflow: hidden;
      padding: 1.5rem 1.8rem;
      box-shadow: 0 28px 60px rgba(6, 10, 40, 0.6);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transform: translateY(12px) scale(0.94);
      opacity: 0;
      transition: transform 0.5s var(--animation-bounce), opacity 0.5s ease;
    }

    .nfc-payment-overlay.is-visible .nfc-payment-card {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .nfc-payment-card::before {
      content: '';
      position: absolute;
      inset: -30%;
      background: conic-gradient(
        from 0deg,
        rgba(0, 255, 195, 0.15),
        rgba(0, 255, 195, 0.45),
        rgba(0, 255, 195, 0.15)
      );
      filter: blur(24px);
      opacity: 0.8;
      animation: nfcAmbient 3s infinite alternate;
    }

    .nfc-payment-card::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(120deg, rgba(255, 255, 255, 0.18) 0%, rgba(255, 255, 255, 0) 60%);
      mix-blend-mode: screen;
      opacity: 0.7;
    }

    .nfc-payment-card.is-disabled {
      filter: grayscale(0.35);
      opacity: 0.8;
    }

    .nfc-ready-label {
      position: absolute;
      top: 1rem;
      left: 1rem;
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      padding: 0.4rem 0.85rem;
      border-radius: var(--radius-full);
      background: rgba(0, 0, 0, 0.3);
      color: rgba(255, 255, 255, 0.85);
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      backdrop-filter: blur(10px);
      z-index: 2;
    }

    .nfc-ready-label .icon {
      width: 0.85rem;
      height: 0.85rem;
    }

    .nfc-card-branding {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      position: relative;
      z-index: 1;
    }

    .nfc-card-chip {
      width: 48px;
      height: auto;
      filter: drop-shadow(0 6px 10px rgba(0, 0, 0, 0.35));
    }

    .nfc-card-brand {
      width: 64px;
      height: auto;
    }

    .nfc-card-number {
      margin-top: 3.25rem;
      font-family: 'Source Code Pro', 'Courier New', Courier, monospace;
      font-size: 1.4rem;
      letter-spacing: 0.16em;
      color: #ffffff;
      position: relative;
      z-index: 1;
      text-shadow: 0 0 18px rgba(0, 0, 0, 0.35);
    }

    .nfc-card-meta {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      gap: 1rem;
      position: relative;
      z-index: 1;
    }

    .nfc-card-field {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
      text-align: left;
    }

    .nfc-card-field .field-label {
      font-size: 0.65rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, 0.6);
    }

    .nfc-card-field .field-value {
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      color: #ffffff;
    }

    .nfc-card-signal {
      display: flex;
      align-items: flex-end;
      justify-content: flex-end;
      gap: 0.3rem;
      margin-top: 0.75rem;
      position: relative;
      z-index: 1;
    }

    .nfc-signal-bar {
      width: 6px;
      height: 16px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.65);
      animation: nfcSignal 1.2s infinite ease-in-out;
      transform-origin: center bottom;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.25);
    }

    .nfc-signal-bar:nth-child(2) {
      height: 20px;
      animation-delay: 0.15s;
    }

    .nfc-signal-bar:nth-child(3) {
      height: 24px;
      animation-delay: 0.3s;
    }

    .nfc-payment-info {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.65rem;
      max-width: 420px;
    }

    .nfc-payment-title {
      font-size: 1.35rem;
      font-weight: 700;
      color: #ffffff;
    }

    .nfc-payment-meta {
      font-size: 0.85rem;
      color: rgba(240, 244, 255, 0.75);
    }

    .nfc-payment-description {
      font-size: 0.9rem;
      line-height: 1.6;
      color: rgba(235, 240, 255, 0.78);
    }

    .nfc-payment-status-line {
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.5rem 0.85rem;
      border-radius: var(--radius-full);
      background: rgba(6, 12, 45, 0.55);
      box-shadow: inset 0 0 0 1px rgba(0, 255, 195, 0.08);
    }

    .nfc-status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #00c057;
      box-shadow: 0 0 12px rgba(0, 192, 87, 0.75);
      animation: nfcStatusGlow 1.4s infinite ease-in-out;
    }

    .nfc-payment-status-text {
      font-size: 0.9rem;
      color: rgba(235, 241, 255, 0.85);
      transition: color 0.3s ease, text-shadow 0.3s ease;
    }

    .nfc-payment-status-text.is-ready {
      color: #66ffd7;
      text-shadow: 0 0 18px rgba(102, 255, 215, 0.65);
    }

    .nfc-payment-overlay[data-nfc-enabled='false'] .nfc-status-dot {
      background: var(--accent);
      box-shadow: 0 0 12px rgba(247, 182, 0, 0.6);
    }

    .nfc-payment-overlay[data-card-status='frozen'] .nfc-ready-label {
      background: rgba(247, 182, 0, 0.24);
      color: rgba(255, 238, 186, 0.95);
    }

    .nfc-payment-overlay[data-card-status='frozen'] .nfc-status-dot {
      background: rgba(247, 182, 0, 0.9);
      box-shadow: 0 0 12px rgba(247, 182, 0, 0.6);
    }

    .nfc-payment-overlay[data-card-status='frozen'] .nfc-payment-status-text {
      color: rgba(255, 238, 186, 0.9);
    }

    .app-connections {
      display: flex;
      flex-direction: column;
      gap: clamp(1.25rem, 2vw, 1.75rem);
    }

    .security-center {
      display: flex;
      flex-direction: column;
      gap: clamp(1.25rem, 2vw, 1.75rem);
    }

    .security-center-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: clamp(0.85rem, 2vw, 1.25rem);
      flex-wrap: wrap;
    }

    .security-heading {
      display: flex;
      align-items: flex-start;
      gap: clamp(0.65rem, 1.6vw, 0.9rem);
    }

    .security-heading .icon-badge {
      width: 42px;
      height: 42px;
      background: rgba(26, 31, 113, 0.1);
      color: var(--primary);
    }

    .security-heading .icon-badge .icon {
      width: 1.1rem;
      height: 1.1rem;
    }

    .security-heading-title {
      font-size: clamp(1rem, 2vw, 1.2rem);
      font-weight: 600;
      color: var(--neutral-900);
    }

    .security-heading-description {
      font-size: clamp(0.85rem, 1.6vw, 0.95rem);
      color: var(--neutral-600);
      margin-top: 0.25rem;
      line-height: 1.5;
    }

    .security-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: clamp(1rem, 2.2vw, 1.5rem);
    }

    .security-card {
      background: var(--neutral-100);
      border-radius: var(--radius-md);
      border: 1px solid rgba(26, 31, 55, 0.08);
      box-shadow: none;
      padding: clamp(1rem, 2vw, 1.35rem);
      display: flex;
      flex-direction: column;
      gap: clamp(0.65rem, 1.5vw, 0.9rem);
    }

    .security-card header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
    }

    .security-card-title {
      font-size: clamp(0.95rem, 1.8vw, 1.1rem);
      font-weight: 600;
      color: var(--neutral-900);
    }

    .security-card-description {
      font-size: clamp(0.85rem, 1.6vw, 0.95rem);
      color: var(--neutral-600);
      line-height: 1.5;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      border-radius: var(--radius-full);
      padding: 0.25rem 0.65rem;
      font-size: clamp(0.7rem, 1.2vw, 0.75rem);
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      background: var(--neutral-200);
      color: var(--neutral-600);
    }

    .status-pill.review {
      background: rgba(26, 31, 113, 0.12);
      color: var(--primary);
    }

    .status-pill.alert {
      background: rgba(209, 45, 32, 0.12);
      color: var(--danger);
    }

    .status-pill.success {
      background: rgba(31, 127, 91, 0.18);
      color: var(--success);
    }

    .security-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: clamp(0.6rem, 1.4vw, 0.85rem);
      margin: 0;
      padding: 0;
    }

    .security-list-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: clamp(0.65rem, 1.6vw, 0.9rem);
    }

    .security-list-text {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .security-meta {
      font-size: clamp(0.75rem, 1.3vw, 0.85rem);
      color: var(--neutral-600);
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      border-radius: var(--radius-full);
      padding: 0.2rem 0.6rem;
      font-size: clamp(0.7rem, 1.2vw, 0.75rem);
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      background: var(--neutral-200);
      color: var(--neutral-600);
    }

    .status-badge.review {
      background: rgba(247, 182, 0, 0.18);
      color: var(--accent);
    }

    .status-badge.approved {
      background: rgba(31, 127, 91, 0.18);
      color: var(--success);
    }

    .status-badge.rejected {
      background: rgba(209, 45, 32, 0.18);
      color: var(--danger);
    }

    .transaction-alert {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      padding: 0.85rem 1rem;
      border-radius: var(--radius-md);
      border: 1px dashed var(--neutral-300);
      background: rgba(26, 31, 113, 0.05);
    }

    .transaction-alert-details {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .transaction-alert-title {
      font-weight: 600;
      color: var(--neutral-900);
    }

    .transaction-alert-amount {
      font-weight: 700;
      color: var(--neutral-900);
      font-size: 1rem;
    }

    .security-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .security-actions .btn {
      flex: 1 1 150px;
    }

    .security-notifications {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .security-subtitle {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--neutral-900);
    }

    .notification-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      margin: 0;
      padding: 0;
    }

    .notification-item {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 0.75rem;
      padding: 0.85rem 1rem;
      border-radius: var(--radius-md);
      border: 1px solid var(--neutral-300);
      background: var(--neutral-100);
      box-shadow: var(--shadow-sm);
    }

    .notification-text {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
    }

    .notification-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--neutral-900);
    }

    .notification-meta {
      font-size: 0.75rem;
      color: var(--neutral-600);
      line-height: 1.4;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      border-radius: var(--radius-full);
      padding: 0.25rem 0.6rem;
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      background: var(--neutral-200);
      color: var(--neutral-600);
    }

    .tag.alert {
      background: rgba(209, 45, 32, 0.12);
      color: var(--danger);
    }

    .tag.info {
      background: rgba(26, 31, 113, 0.12);
      color: var(--primary);
    }

    .transaction-history {
      background: var(--neutral-100);
      border: 1px solid var(--neutral-300);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
    }

    .transaction-history-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      padding: 1rem 1.25rem;
      background: var(--neutral-200);
      border-bottom: 1px solid var(--neutral-300);
    }

    .transaction-history-title {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--neutral-900);
    }

    .history-link {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--primary);
      text-decoration: none;
      letter-spacing: 0.04em;
    }

    .history-link:hover,
    .history-link:focus-visible {
      text-decoration: underline;
    }

    .transaction-history table {
      width: 100%;
      border-collapse: collapse;
    }

    .transaction-history th,
    .transaction-history td {
      padding: 0.75rem 1.25rem;
      font-size: 0.8rem;
      text-align: left;
      color: var(--neutral-700);
      border-bottom: 1px solid var(--neutral-300);
    }

    .transaction-history tbody tr:last-child td {
      border-bottom: none;
    }

    .transaction-history .amount {
      font-weight: 600;
      color: var(--neutral-900);
    }

    .app-connections-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 1rem;
    }

    .app-connections-heading {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .app-connections-heading .icon-badge {
      width: 42px;
      height: 42px;
      background: rgba(26, 31, 113, 0.1);
      color: var(--primary);
    }

    .app-connections-heading .icon-badge .icon {
      width: 1.1rem;
      height: 1.1rem;
    }

    .app-connections-title {
      font-size: clamp(1rem, 2vw, 1.2rem);
      font-weight: 600;
      color: var(--neutral-900);
    }

    .app-connections-description {
      margin-top: 0.35rem;
      font-size: clamp(0.85rem, 1.6vw, 0.95rem);
      color: var(--neutral-600);
      line-height: 1.5;
    }

    .integration-grid {
      display: grid;
      gap: clamp(1rem, 2.2vw, 1.5rem);
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    .integration-card {
      display: flex;
      flex-direction: column;
      gap: clamp(0.75rem, 1.8vw, 1.1rem);
      padding: clamp(0.95rem, 1.8vw, 1.25rem);
      border-radius: var(--radius-md);
      background: var(--neutral-100);
      border: 1px solid rgba(26, 31, 55, 0.08);
      box-shadow: none;
      transition: var(--transition-base);
    }

    .integration-card:hover,
    .integration-card:focus-within {
      transform: translateY(-1px);
      box-shadow: 0 8px 16px -12px rgba(26, 31, 55, 0.35);
    }

    .integration-card.is-connected {
      border-color: rgba(31, 127, 91, 0.35);
      box-shadow: 0 10px 18px -14px rgba(31, 127, 91, 0.45);
    }

    .integration-header {
      display: flex;
      align-items: center;
      gap: clamp(0.65rem, 1.6vw, 0.9rem);
    }

    .integration-icon {
      width: 44px;
      height: 44px;
      border-radius: var(--radius-lg);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: var(--neutral-100);
      box-shadow: var(--shadow-sm);
      flex-shrink: 0;
    }

    .integration-icon .icon {
      width: 1.45rem;
      height: 1.45rem;
    }

    .integration-icon.paypal {
      background: #003087;
    }

    .integration-icon.zinli {
      background: #00b8a9;
    }

    .integration-icon.wise {
      background: #1c64f2;
    }

    .integration-icon.westernunion {
      background: #ffcf01;
      color: #1a1f37;
    }

    .integration-icon.patreon {
      background: #ff424d;
    }

    .integration-icon.onlyfans {
      background: #00b2ff;
    }

    .integration-name {
      font-size: clamp(0.95rem, 1.8vw, 1.1rem);
      font-weight: 600;
      color: var(--neutral-900);
    }

    .integration-description {
      font-size: clamp(0.8rem, 1.5vw, 0.95rem);
      color: var(--neutral-600);
      line-height: 1.4;
      margin-top: 0.2rem;
    }

    .integration-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: clamp(0.45rem, 1.4vw, 0.75rem);
    }

    .integration-status {
      font-size: clamp(0.75rem, 1.3vw, 0.85rem);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-radius: var(--radius-full);
      padding: 0.25rem 0.65rem;
      background: var(--neutral-200);
      color: var(--neutral-600);
      transition: var(--transition-base);
    }

    .integration-status.connected {
      background: rgba(31, 127, 91, 0.16);
      color: var(--success);
    }

    .integration-action {
      white-space: nowrap;
    }

    .integration-action.is-connected {
      border-color: rgba(31, 127, 91, 0.45);
      color: var(--success);
      background: rgba(31, 127, 91, 0.1);
    }

    .my-visa-card.nfc-active .card-chip {
      filter: drop-shadow(0 0 12px rgba(0, 192, 87, 0.6));
    }

    .card-text {
      font-size: 0.9rem;
      color: var(--neutral-600);
      line-height: 1.6;
    }

    .toast-container {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      z-index: 2000;
    }

    .toast {
      min-width: 240px;
      max-width: 320px;
      background: var(--neutral-100);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-md);
      padding: 0.75rem 1rem;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      border-left: 4px solid var(--primary);
    }

    .toast.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .toast.success {
      border-color: #00c057;
    }

    .toast.info {
      border-color: var(--primary);
    }

    .toast-title {
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: var(--neutral-900);
    }

    .toast-message {
      font-size: 0.85rem;
      color: var(--neutral-600);
      line-height: 1.4;
    }

    .multi-currency-section {
      display: flex;
      flex-direction: column;
      gap: clamp(1.25rem, 2vw, 1.75rem);
    }

    .multi-currency-header {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .multi-currency-heading {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .multi-currency-heading .icon-badge {
      width: 40px;
      height: 40px;
      background: rgba(26, 31, 113, 0.12);
      color: var(--primary);
    }

    .multi-currency-heading .icon-badge .icon {
      width: 1.1rem;
      height: 1.1rem;
    }

    .multi-currency-title {
      font-size: 1.05rem;
      font-weight: 600;
      color: var(--neutral-900);
    }

    .multi-currency-description {
      font-size: 0.9rem;
      color: var(--neutral-600);
      line-height: 1.4;
    }

    .multi-currency-summary {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .multi-currency-total {
      font-weight: 600;
      color: var(--neutral-900);
    }

    .multi-currency-breakdown {
      font-size: 0.85rem;
      color: var(--neutral-600);
    }

    .multi-currency-grid {
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }

    .currency-card {
      display: flex;
      flex-direction: column;
      gap: clamp(0.75rem, 1.8vw, 1rem);
      padding: clamp(0.9rem, 1.8vw, 1.2rem);
      border-radius: var(--radius-md);
      background: var(--neutral-100);
      border: 1px solid rgba(26, 31, 55, 0.08);
      box-shadow: none;
      transition: var(--transition-base);
    }

    .currency-card.is-disabled {
      opacity: 0.6;
    }

    .currency-card.is-inactive {
      border-style: dashed;
      background: var(--neutral-200);
    }

    .currency-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
    }

    .currency-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .currency-icon {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-full);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(26, 31, 113, 0.12);
      color: var(--primary);
    }

    .currency-icon .icon {
      width: 1rem;
      height: 1rem;
    }

    .currency-icon.eur {
      background: rgba(0, 87, 159, 0.12);
      color: var(--secondary);
    }

    .currency-icon.bs {
      background: rgba(247, 182, 0, 0.16);
      color: var(--accent);
    }

    .currency-icon.usdt {
      background: rgba(31, 127, 91, 0.16);
      color: var(--success);
    }

    .currency-name {
      font-weight: 600;
      color: var(--neutral-900);
      line-height: 1.2;
    }

    .currency-code {
      font-size: 0.8rem;
      color: var(--neutral-600);
      text-transform: uppercase;
    }

    .currency-available {
      font-size: 0.85rem;
      color: var(--neutral-600);
    }

    .currency-card-body {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .currency-input-label {
      font-size: 0.85rem;
      color: var(--neutral-600);
    }

    .currency-input-wrapper {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 0.35rem 0.75rem;
      border: 1px solid transparent;
      transition: var(--transition-base);
    }

    .currency-input-wrapper:focus-within {
      border-color: rgba(26, 31, 113, 0.35);
      background: var(--neutral-100);
      box-shadow: var(--shadow-sm);
    }

    .currency-prefix {
      font-weight: 600;
      color: var(--neutral-600);
    }

    .currency-input-wrapper input {
      flex: 1;
      border: none;
      background: transparent;
      font-size: 1rem;
      color: var(--neutral-900);
      outline: none;
    }

    .currency-input-wrapper input:disabled {
      color: var(--neutral-500);
    }

    .multi-currency-note {
      font-size: 0.8rem;
      color: var(--neutral-500);
    }

    .physical-card-request {
      display: flex;
      flex-direction: column;
      gap: clamp(1.25rem, 2vw, 1.75rem);
    }

    .physical-card-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: clamp(0.75rem, 2vw, 1.25rem);
      flex-wrap: wrap;
    }

    .physical-card-heading {
      display: flex;
      align-items: flex-start;
      gap: clamp(0.65rem, 1.6vw, 0.9rem);
    }

    .physical-card-icon {
      width: 42px;
      height: 42px;
      border-radius: var(--radius-full);
      background: rgba(26, 31, 113, 0.1);
      color: var(--primary);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .physical-card-icon .icon {
      width: 1.1rem;
      height: 1.1rem;
    }

    .physical-card-title {
      font-size: clamp(1rem, 2.1vw, 1.25rem);
      font-weight: 600;
      color: var(--neutral-900);
    }

    .physical-card-description {
      font-size: clamp(0.85rem, 1.6vw, 0.95rem);
      color: var(--neutral-600);
      margin-top: 0.25rem;
      line-height: 1.5;
    }

    .physical-card-status {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.4rem 0.85rem;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      color: var(--neutral-700);
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .physical-card-status.is-requested {
      background: rgba(31, 127, 91, 0.18);
      color: var(--success);
    }

    .physical-card-status.is-editing {
      background: rgba(247, 182, 0, 0.18);
      color: var(--accent);
    }

    .physical-card-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .physical-card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 0.75rem 1rem;
    }

    .physical-card-field {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .physical-card-field--span {
      grid-column: 1 / -1;
    }

    .physical-card-field label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--neutral-800);
    }

    .physical-card-field .optional {
      font-weight: 500;
      font-size: 0.75rem;
      color: var(--neutral-500);
      text-transform: none;
    }

    .physical-card-field input,
    .physical-card-field select,
    .physical-card-field textarea {
      border: 1px solid var(--neutral-300);
      border-radius: var(--radius-md);
      padding: 0.6rem 0.75rem;
      font-size: 0.9rem;
      background: var(--neutral-100);
      color: var(--neutral-900);
      transition: var(--transition-base);
    }

    .physical-card-field input:focus,
    .physical-card-field input:focus-visible,
    .physical-card-field select:focus,
    .physical-card-field select:focus-visible,
    .physical-card-field textarea:focus,
    .physical-card-field textarea:focus-visible {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.15);
    }

    .physical-card-field textarea {
      resize: vertical;
      min-height: 96px;
    }

    .physical-card-helper {
      font-size: 0.8rem;
      color: var(--neutral-600);
      line-height: 1.4;
    }

    .physical-card-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      justify-content: flex-end;
    }

    .physical-card-confirmation {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding: 1.25rem;
      border-radius: var(--radius-lg);
      background: var(--neutral-100);
      border: 1px solid rgba(31, 127, 91, 0.25);
      box-shadow: var(--shadow-sm);
    }

    .physical-card-confirmation[hidden] {
      display: none;
    }

    .physical-card-confirmation-header {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .physical-card-confirmation-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: rgba(31, 127, 91, 0.18);
      color: var(--success);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .physical-card-confirmation-icon .icon {
      width: 1.1rem;
      height: 1.1rem;
    }

    .physical-card-confirmation-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--neutral-900);
      margin: 0;
    }

    .physical-card-confirmation-message {
      font-size: 0.85rem;
      color: var(--neutral-700);
      margin: 0.3rem 0 0;
      line-height: 1.4;
    }

    .physical-card-confirmation-meta {
      font-size: 0.75rem;
      color: var(--neutral-500);
    }

    .physical-card-summary {
      display: grid;
      gap: 0.65rem;
    }

    .physical-card-summary-row {
      display: grid;
      grid-template-columns: minmax(140px, 180px) 1fr;
      gap: 0.5rem;
      align-items: start;
    }

    .physical-card-summary-row dt {
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: var(--neutral-600);
    }

    .physical-card-summary-row dd {
      margin: 0;
      font-size: 0.85rem;
      color: var(--neutral-800);
      line-height: 1.4;
      word-break: break-word;
    }

    .physical-card-summary-row dd.empty {
      color: var(--neutral-500);
      font-style: italic;
    }

    @keyframes nfcAmbient {
      0% {
        transform: rotate(0deg) scale(0.96);
        opacity: 0.65;
      }
      50% {
        transform: rotate(180deg) scale(1.02);
        opacity: 0.85;
      }
      100% {
        transform: rotate(360deg) scale(0.96);
        opacity: 0.65;
      }
    }

    @keyframes nfcPulse {
      0% {
        transform: scale(0.6);
        opacity: 0.8;
      }
      60% {
        transform: scale(1);
        opacity: 0;
      }
      100% {
        transform: scale(1.1);
        opacity: 0;
      }
    }

    @keyframes nfcSignal {
      0%,
      100% {
        transform: scaleY(0.7);
        opacity: 0.5;
      }
      50% {
        transform: scaleY(1.35);
        opacity: 1;
      }
    }

    @keyframes nfcStatusGlow {
      0% {
        transform: scale(0.9);
        opacity: 0.75;
        box-shadow: 0 0 6px rgba(0, 255, 195, 0.4);
      }
      100% {
        transform: scale(1.15);
        opacity: 1;
        box-shadow: 0 0 16px rgba(0, 255, 195, 0.75);
      }
    }

    @keyframes pulse {
      0% {
        transform: scale(0.9);
        opacity: 0.6;
      }
      50% {
        transform: scale(1);
        opacity: 1;
      }
      100% {
        transform: scale(0.9);
        opacity: 0.6;
      }
    }

    @keyframes shine {
      0% {
        transform: translateX(-100%);
      }
      50% {
        transform: translateX(0%);
      }
      100% {
        transform: translateX(100%);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .nfc-payment-overlay,
      .nfc-payment-card,
      .nfc-pulse,
      .nfc-signal-bar,
      .nfc-status-dot {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    @media (max-width: 600px) {
      body {
        padding: 1.5rem;
      }

      .card-panel {
        border-radius: var(--radius-lg);
        padding: 1.5rem;
      }

      .card-actions {
        flex-direction: column;
      }

      .btn-small {
        width: 100%;
      }

      .style-preview-body {
        flex-direction: column;
        align-items: stretch;
      }

      .style-preview-card {
        width: 100%;
        height: 120px;
      }

      .financial-overview-main {
        flex-direction: column;
        align-items: flex-start;
      }

      .financial-overview-limits {
        grid-template-columns: 1fr;
      }

      .limit-controls {
        grid-template-columns: 1fr;
      }

      .multi-currency-section {
        padding: 1.25rem;
      }

      .multi-currency-heading {
        align-items: flex-start;
      }

      .multi-currency-grid {
        grid-template-columns: 1fr;
      }

      .financial-value {
        font-size: 1.15rem;
      }

      .physical-card-request {
        padding: 1.25rem;
      }

      .physical-card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
      }

      .physical-card-status {
        align-self: flex-start;
      }

      .physical-card-grid {
        grid-template-columns: 1fr;
      }

      .physical-card-actions {
        flex-direction: column;
        align-items: stretch;
      }

      .physical-card-actions .btn {
        width: 100%;
      }

      .physical-card-summary-row {
        grid-template-columns: 1fr;
      }

      .physical-card-confirmation {
        padding: 1rem;
      }

      .nfc-settings {
        flex-direction: column;
        align-items: flex-start;
      }

      .nfc-settings .switch {
        align-self: flex-start;
      }

      .app-connections {
        padding: 1.25rem;
      }

      .app-connections-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .security-center {
        padding: 1.25rem;
        gap: 1rem;
      }

      .security-center-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .security-actions {
        flex-direction: column;
        align-items: stretch;
      }

      .security-actions .btn {
        width: 100%;
      }

      .transaction-alert {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .integration-grid {
        grid-template-columns: 1fr;
      }

      .integration-footer {
        flex-direction: column;
        align-items: stretch;
      }

      .integration-action {
        width: 100%;
      }

      .toast-container {
        left: 1rem;
        right: 1rem;
        bottom: 1rem;
      }

      .transaction-history-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .transaction-history th,
      .transaction-history td {
        padding: 0.65rem 1rem;
      }

      .nfc-payment-overlay {
        padding: 1.25rem;
      }

      .nfc-payment-content {
        width: 100%;
        gap: 1.5rem;
      }

      .nfc-payment-card {
        width: 88%;
        padding: 1.25rem 1.4rem;
      }

      .nfc-payment-title {
        font-size: 1.2rem;
      }

      .nfc-payment-description {
        font-size: 0.85rem;
      }

      .nfc-payment-close {
        top: -0.25rem;
        right: -0.25rem;
      }
    }
  </style>
</head>
<body>
  <div
    class="account-activation-overlay"
    role="alertdialog"
    aria-modal="true"
    aria-labelledby="account-activation-title"
    aria-describedby="account-activation-message"
    aria-hidden="false"
  >
    <div class="account-activation-dialog" role="document">
      <h2 id="account-activation-title">Activa tu cuenta</h2>
      <p id="account-activation-message">
        Activa tu cuenta para acceder a todas las funcionalidades del panel de control.
      </p>
      <a class="activation-home-button" href="homevisa.html">Ir a inicio</a>
    </div>
  </div>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    aria-hidden="true"
    focusable="false"
    style="position: absolute; width: 0; height: 0; overflow: hidden;"
  >
    <symbol id="icon-credit-card" viewBox="0 0 24 24">
      <rect x="3" y="5" width="18" height="14" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="1.5" />
      <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      <rect x="6" y="13" width="4" height="2.5" rx="1" fill="currentColor" />
    </symbol>
    <symbol id="icon-settings" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="3.25" fill="none" stroke="currentColor" stroke-width="1.5" />
      <path
        d="M12 3v2.2M12 18.8V21M4.2 12H3M21 12h-2.2M6.4 6.4l1.6 1.6M16 16l1.6 1.6M6.4 17.6l1.6-1.6M16 8l1.6-1.6"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
        stroke-linecap="round"
      />
    </symbol>
    <symbol id="icon-wifi" viewBox="0 0 24 24">
      <path d="M5 10.5a11 11 0 0 1 14 0" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      <path d="M7.7 13.2a7 7 0 0 1 8.6 0" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      <path d="M10.6 16.1a3 3 0 0 1 2.8 0" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      <circle cx="12" cy="18" r="1.25" fill="currentColor" />
    </symbol>
    <symbol id="icon-copy" viewBox="0 0 24 24">
      <rect x="8" y="8" width="11" height="13" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="1.5" />
      <rect x="5" y="5" width="11" height="13" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="1.5" stroke-dasharray="0" opacity="0.6" />
    </symbol>
    <symbol id="icon-wallet" viewBox="0 0 24 24">
      <path
        d="M4 7h13a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2z"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
        stroke-linejoin="round"
      />
      <path d="M20 10h-5a2 2 0 0 0 0 4h5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      <circle cx="17.5" cy="12" r="1" fill="currentColor" />
    </symbol>
    <symbol id="icon-coins" viewBox="0 0 24 24">
      <ellipse cx="12" cy="7" rx="6" ry="3" fill="none" stroke="currentColor" stroke-width="1.5" />
      <path d="M6 7v6c0 1.7 2.7 3 6 3s6-1.3 6-3V7" fill="none" stroke="currentColor" stroke-width="1.5" />
      <path d="M6 13c0 1.7 2.7 3 6 3s6-1.3 6-3" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.7" />
      <ellipse cx="8.5" cy="16" rx="2.5" ry="1.2" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.6" />
    </symbol>
    <symbol id="icon-id-card" viewBox="0 0 24 24">
      <rect x="3" y="6" width="18" height="12" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="1.5" />
      <circle cx="9" cy="12" r="2.2" fill="none" stroke="currentColor" stroke-width="1.5" />
      <path d="M5.8 16c.7-1.8 2-2.8 3.2-2.8s2.5 1 3.2 2.8" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      <path d="M13.5 10h4.5M13.5 13h3.5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
    </symbol>
    <symbol id="icon-plane" viewBox="0 0 24 24">
      <path d="M3 16.5h18" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      <path
        d="M4 13.6l6.6 1 5-5.2 3.4.8-4.1 4.1 4.9.9v1.6L4 18z"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
        stroke-linejoin="round"
      />
    </symbol>
    <symbol id="icon-toggle-on" viewBox="0 0 24 24">
      <rect x="3" y="8" width="18" height="8" rx="4" ry="4" fill="none" stroke="currentColor" stroke-width="1.5" />
      <circle cx="15" cy="12" r="3" fill="currentColor" />
    </symbol>
    <symbol id="icon-shield" viewBox="0 0 24 24">
      <path
        d="M12 4.5 19 7v4.5c0 4.1-2.5 7.9-7 9.5-4.5-1.6-7-5.4-7-9.5V7z"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
        stroke-linejoin="round"
      />
      <path d="M12 11.5v6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
    </symbol>
    <symbol id="icon-link" viewBox="0 0 24 24">
      <path
        d="M9.4 15.6 7.7 17.3a3.6 3.6 0 0 1-5.1-5.1l3.2-3.2a3.6 3.6 0 0 1 5.1 0"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
        stroke-linecap="round"
      />
      <path
        d="M14.6 8.4 16.3 6.7a3.6 3.6 0 0 1 5.1 5.1l-3.2 3.2a3.6 3.6 0 0 1-5.1 0"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
        stroke-linecap="round"
      />
      <path d="m9 15 6-6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
    </symbol>
    <symbol id="icon-dollar" viewBox="0 0 24 24">
      <path d="M12 4v16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      <path
        d="M8.5 8.5C9.3 7.2 10.5 6.5 12 6.5c2.1 0 3.8 1.2 3.8 3s-1.5 2.6-3.8 3.2-3.8 1.5-3.8 3.2S10 18 12 18c1.5 0 2.7-.7 3.5-1.8"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
        stroke-linecap="round"
      />
    </symbol>
    <symbol id="icon-euro" viewBox="0 0 24 24">
      <path d="M17.5 7.5A5.5 5.5 0 0 0 7.5 10v4a5.5 5.5 0 0 0 10 2.5" fill="none" stroke="currentColor" stroke-width="1.5" />
      <path d="M7 11h7.5M7 13h7.5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
    </symbol>
    <symbol id="icon-dollar-slot" viewBox="0 0 24 24">
      <rect x="3" y="5" width="18" height="4" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="1.5" />
      <circle cx="12" cy="15" r="5.5" fill="none" stroke="currentColor" stroke-width="1.5" />
      <path d="M12 10.5v9" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      <path
        d="M9.8 13.5c.5-.8 1.4-1.2 2.4-1.2 1.6 0 2.9.9 2.9 2.2s-1.1 1.9-2.9 2.3-2.9.9-2.9 2.2 1.3 2.2 2.9 2.2c1 0 1.9-.4 2.4-1.2"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
        stroke-linecap="round"
      />
    </symbol>
    <symbol id="icon-check" viewBox="0 0 24 24">
      <path d="M5 12.5 9.5 17 19 7.5" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
    </symbol>
    <symbol id="icon-snowflake" viewBox="0 0 24 24">
      <path d="M12 3v18" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      <path d="m5.5 6.5 13 11" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      <path d="m5.5 17.5 13-11" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      <path d="M9 4.5 12 6l3-1.5M9 19.5l3-1.5 3 1.5M4.5 9l1.5 3-1.5 3M19.5 9l-1.5 3 1.5 3" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
    </symbol>
    <symbol id="icon-cart" viewBox="0 0 24 24">
      <path d="M4 5h2l1.5 9h9l1.5-6H7" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
      <circle cx="9" cy="18" r="1.4" fill="none" stroke="currentColor" stroke-width="1.5" />
      <circle cx="16" cy="18" r="1.4" fill="none" stroke="currentColor" stroke-width="1.5" />
    </symbol>
    <symbol id="icon-close" viewBox="0 0 24 24">
      <path d="m6 6 12 12M18 6 6 18" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
    </symbol>
    <symbol id="icon-alert" viewBox="0 0 24 24">
      <path d="M12 4 21 20H3z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round" />
      <path d="M12 10v5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      <circle cx="12" cy="17" r="1" fill="currentColor" />
    </symbol>
    <symbol id="icon-info" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="1.5" />
      <circle cx="12" cy="8" r="1" fill="currentColor" />
      <path d="M11.5 11.5h1v6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
    </symbol>
    <symbol id="icon-file" viewBox="0 0 24 24">
      <path d="M7 4h7l5 5v11a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round" />
      <path d="M14 4v5h5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round" />
      <path d="M9 13h6M9 16h4" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
    </symbol>
    <symbol id="icon-paypal" viewBox="0 0 24 24">
      <path
        d="M8 5h5.5a3.5 3.5 0 0 1 0 7H11l-.8 5H6.5z"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
        stroke-linejoin="round"
      />
      <path d="M9.5 9h3a1.5 1.5 0 0 0 0-3H9z" fill="currentColor" />
    </symbol>
    <symbol id="icon-globe" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="1.5" />
      <path d="M3 12h18" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      <path d="M12 3c3 3 3 15 0 18-3-3-3-15 0-18z" fill="none" stroke="currentColor" stroke-width="1.5" />
    </symbol>
    <symbol id="icon-building" viewBox="0 0 24 24">
      <rect x="6.5" y="4" width="11" height="16" rx="1.5" ry="1.5" fill="none" stroke="currentColor" stroke-width="1.5" />
      <path d="M4 20h16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      <path d="M10 8h1.5M12.5 8H14M10 11h1.5M12.5 11H14M10 14h1.5M12.5 14H14" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
    </symbol>
    <symbol id="icon-patreon" viewBox="0 0 24 24">
      <rect x="6" y="6" width="2" height="12" rx="1" ry="1" fill="currentColor" />
      <circle cx="15" cy="12" r="5" fill="none" stroke="currentColor" stroke-width="1.5" />
    </symbol>
    <symbol id="icon-heart" viewBox="0 0 24 24">
      <path
        d="M12 20s-6-4.2-7.8-7a4.5 4.5 0 0 1 7-5.5L12 8l.8-.5a4.5 4.5 0 0 1 7 5.5C18 15.8 12 20 12 20z"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
        stroke-linejoin="round"
      />
    </symbol>
    <symbol id="icon-wave" viewBox="0 0 24 24">
      <path d="M3 15c1.5-4 3.5-4 5 0s3.5 4 5 0 3.5-4 5 0 3.5 4 5 0" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
    </symbol>
    <symbol id="icon-chevron-left" viewBox="0 0 24 24">
      <path d="M15 5 9 12l6 7" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
    </symbol>
    <symbol id="icon-chevron-right" viewBox="0 0 24 24">
      <path d="M9 5l6 7-6 7" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
    </symbol>
  </svg>
  <main class="cards-page">
    <section class="card-panel">
      <div class="panel-loader" id="panel-loader" role="status" aria-live="polite" aria-hidden="true">
        <div class="panel-loader-content">
          <div class="panel-spinner" aria-hidden="true"></div>
          <span class="panel-loader-label" data-loader-label>Procesando...</span>
        </div>
      </div>
      <header class="section-title">
        <div class="section-heading">
          <svg class="icon" aria-hidden="true">
            <use href="#icon-credit-card"></use>
          </svg>
          <span>Mi tarjeta virtual Visa</span>
        </div>
        <a href="tarjetaremeex.html" class="settings-link" aria-label="Ajustes de la tarjeta">
          <svg class="icon" aria-hidden="true">
            <use href="#icon-settings"></use>
          </svg>
        </a>
      </header>

      <div class="card-visual-container">
        <div class="virtual-card my-visa-card" id="card-display">
          <div class="nfc-indicator" id="nfc-indicator" aria-hidden="true">
            <svg class="icon" aria-hidden="true">
              <use href="#icon-wifi"></use>
            </svg>
            <span>NFC activo</span>
          </div>
          <div class="card-logo">
            <img src="https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/chip.png" class="card-chip" alt="Chip de la tarjeta">
            <img src="https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/visa.png" class="card-brand" alt="Logo de Visa">
          </div>
          <div class="card-info-line card-number-line">
            <div class="card-number" id="card-number">4165 9800 7015 6852</div>
            <button
              type="button"
              class="copy-icon-button"
              data-copy-target="number"
              data-copy-label="Número de tarjeta"
              data-copy-success-title="Número copiado"
              data-copy-success-message="El número de la tarjeta se copió al portapapeles."
              aria-label="Copiar número de tarjeta"
            >
              <svg class="icon" aria-hidden="true">
                <use href="#icon-copy"></use>
              </svg>
            </button>
          </div>
          <div class="cardholder-name" id="card-holder-name">USUARIO</div>
          <div class="card-details">
            <div class="card-expiration" id="card-expiry">04/28</div>
          </div>
          <div class="card-back">
            <div class="card-info-line is-end-aligned">
              <div class="cvv" id="card-cvv">740</div>
              <button
                type="button"
                class="copy-icon-button copy-icon-button-light"
                data-copy-target="cvv"
                data-copy-label="CVV"
                data-copy-success-title="CVV copiado"
                data-copy-success-message="El CVV se copió al portapapeles."
                aria-label="Copiar CVV"
              >
                <svg class="icon" aria-hidden="true">
                  <use href="#icon-copy"></use>
                </svg>
              </button>
            </div>
          </div>
        </div>
        <div class="card-status active" id="card-status" role="status" aria-live="polite" aria-atomic="true">Activa</div>
      </div>

      <nav class="quick-access-nav" aria-label="Accesos rápidos de la tarjeta">
        <div class="quick-access-viewport">
          <button
            type="button"
            class="quick-access-control quick-access-prev"
            aria-label="Acceso rápido anterior"
            data-direction="prev"
            disabled
          >
            <svg class="icon" aria-hidden="true">
              <use href="#icon-chevron-left"></use>
            </svg>
          </button>
          <div
            class="quick-access-list"
            role="tablist"
            aria-label="Accesos rápidos de la tarjeta"
            aria-orientation="horizontal"
          >
            <button
              type="button"
              class="quick-access-item is-active"
              id="quick-access-tab-card-financial-overview"
              data-panel-target="card-financial-overview"
              role="tab"
              aria-controls="card-financial-overview"
              aria-selected="true"
              aria-expanded="true"
            >
              <span class="quick-access-icon" aria-hidden="true">
                <svg class="icon">
                  <use href="#icon-wallet"></use>
                </svg>
              </span>
              <span class="quick-access-label">Resumen</span>
            </button>
            <button
              type="button"
              class="quick-access-item"
              id="quick-access-tab-multi-currency-section"
              data-panel-target="multi-currency-section"
              role="tab"
              aria-controls="multi-currency-section"
              aria-selected="false"
              aria-expanded="false"
            >
              <span class="quick-access-icon" aria-hidden="true">
                <svg class="icon">
                  <use href="#icon-coins"></use>
                </svg>
              </span>
              <span class="quick-access-label">Multidivisas</span>
            </button>
            <button
              type="button"
              class="quick-access-item"
              id="quick-access-tab-physical-card-request"
              data-panel-target="physical-card-request"
              role="tab"
              aria-controls="physical-card-request"
              aria-selected="false"
              aria-expanded="false"
            >
              <span class="quick-access-icon" aria-hidden="true">
                <svg class="icon">
                  <use href="#icon-id-card"></use>
                </svg>
              </span>
              <span class="quick-access-label">Tarjeta física</span>
            </button>
            <button
              type="button"
              class="quick-access-item"
              id="quick-access-tab-travel-notice-indicator"
              data-panel-target="travel-notice-indicator"
              role="tab"
              aria-controls="travel-notice-indicator"
              aria-selected="false"
              aria-expanded="false"
            >
              <span class="quick-access-icon" aria-hidden="true">
                <svg class="icon">
                  <use href="#icon-plane"></use>
                </svg>
              </span>
              <span class="quick-access-label">Avisos de viaje</span>
            </button>
            <button
              type="button"
              class="quick-access-item"
              id="quick-access-tab-card-controls"
              data-panel-target="card-controls"
              role="tab"
              aria-controls="card-controls"
              aria-selected="false"
              aria-expanded="false"
            >
              <span class="quick-access-icon" aria-hidden="true">
                <svg class="icon">
                  <use href="#icon-toggle-on"></use>
                </svg>
              </span>
              <span class="quick-access-label">Controles</span>
            </button>
            <button
              type="button"
              class="quick-access-item"
              id="quick-access-tab-security-center"
              data-panel-target="security-center"
              role="tab"
              aria-controls="security-center"
              aria-selected="false"
              aria-expanded="false"
            >
              <span class="quick-access-icon" aria-hidden="true">
                <svg class="icon">
                  <use href="#icon-shield"></use>
                </svg>
              </span>
              <span class="quick-access-label">Seguridad</span>
            </button>
            <button
              type="button"
              class="quick-access-item"
              id="quick-access-tab-app-connections"
              data-panel-target="app-connections"
              role="tab"
              aria-controls="app-connections"
              aria-selected="false"
              aria-expanded="false"
            >
              <span class="quick-access-icon" aria-hidden="true">
                <svg class="icon">
                  <use href="#icon-link"></use>
                </svg>
              </span>
              <span class="quick-access-label">Integraciones</span>
            </button>
          </div>
          <button
            type="button"
            class="quick-access-control quick-access-next"
            aria-label="Acceso rápido siguiente"
            data-direction="next"
          >
            <svg class="icon" aria-hidden="true">
              <use href="#icon-chevron-right"></use>
            </svg>
          </button>
          <div class="quick-access-mobile-status" role="status" aria-live="polite">
            <span class="quick-access-mobile-status-icon" aria-hidden="true"></span>
            <span class="quick-access-mobile-status-label"></span>
          </div>
        </div>
      </nav>

      <div
        class="style-preview mobile-step"
        id="style-preview"
        aria-live="polite"
        data-mobile-step-group="card-overview"
        data-mobile-step-index="1"
        data-mobile-step-title="Estilo"
      >
        <div class="style-preview-header">
          <span class="style-preview-title">Estilo seleccionado</span>
          <span class="style-preview-status" id="style-preview-status">Sin seleccionar</span>
        </div>
        <div class="style-preview-body">
          <div class="style-preview-card" id="style-preview-card" role="img" aria-label="Vista previa sin estilo seleccionado"></div>
          <p class="style-preview-message" id="style-preview-message">Selecciona un estilo para personalizar tu tarjeta.</p>
        </div>
      </div>

      <div class="quick-access-panels">
        <section
          class="card-financial-overview scroll-target quick-access-panel is-active"
          id="card-financial-overview"
          aria-live="polite"
          tabindex="-1"
          role="tabpanel"
          aria-labelledby="quick-access-tab-card-financial-overview"
        >
        <div
          class="card-financial-overview-body mobile-step"
          data-mobile-step-group="card-overview"
          data-mobile-step-index="2"
          data-mobile-step-title="Resumen"
          data-mobile-step-panel="card-financial-overview"
        >
          <div class="financial-overview-header">
            <span class="financial-overview-title">
              <svg class="icon" aria-hidden="true">
                <use href="#icon-wallet"></use>
              </svg>
              <span>Estado financiero</span>
            </span>
          </div>
          <div class="financial-overview-main">
            <span class="financial-label">Saldo disponible</span>
            <span class="financial-value" id="card-balance">$0.00</span>
          </div>
          <div class="financial-overview-limits">
            <div class="financial-limit-card" data-limit-type="daily">
              <span class="financial-label">Límite diario</span>
              <span class="financial-value" id="card-daily-limit">$2,000.00</span>
              <span class="limit-status" id="card-daily-limit-status" aria-live="polite">Límite disponible</span>
            </div>
            <div class="financial-limit-card" data-limit-type="monthly">
              <span class="financial-label">Límite mensual</span>
              <span class="financial-value" id="card-monthly-limit">$10,000.00</span>
              <span class="limit-status" id="card-monthly-limit-status" aria-live="polite">Límite disponible</span>
            </div>
          </div>
          <div class="limit-controls" aria-label="Configuración de límites">
            <div class="limit-control">
              <label class="limit-control-label" for="daily-limit-input">Configurar límite diario</label>
              <input
                type="number"
                inputmode="decimal"
                step="0.01"
                min="0"
                id="daily-limit-input"
                class="limit-control-input"
                aria-describedby="daily-limit-helper"
                placeholder="0.00"
                autocomplete="off"
                value="2000.00"
              >
              <p class="limit-control-helper" id="daily-limit-helper">Define el monto máximo disponible para tus operaciones diarias.</p>
            </div>
            <div class="limit-control">
              <label class="limit-control-label" for="monthly-limit-input">Configurar límite mensual</label>
              <input
                type="number"
                inputmode="decimal"
                step="0.01"
                min="0"
                id="monthly-limit-input"
                class="limit-control-input"
                aria-describedby="monthly-limit-helper"
                placeholder="0.00"
                autocomplete="off"
                value="10000.00"
              >
              <p class="limit-control-helper" id="monthly-limit-helper">Establece el monto máximo acumulado disponible cada mes.</p>
            </div>
          </div>
        </div>
        <div
          class="card-actions mobile-step"
          data-mobile-step-group="card-overview"
          data-mobile-step-index="3"
          data-mobile-step-title="Acciones"
          data-mobile-step-panel="card-financial-overview"
        >
          <button
            id="nfc-payment-btn"
            type="button"
            class="btn btn-primary btn-small"
            aria-haspopup="dialog"
            aria-controls="nfc-payment-overlay"
            aria-expanded="false"
          >
            <svg class="icon" aria-hidden="true">
              <use href="#icon-wifi"></use>
            </svg>
            <span>Modo pago NFC</span>
          </button>
          <a id="customize-card-btn" class="btn btn-outline btn-small" href="seleccionar-estilo.html" target="_blank" rel="noopener">
            <span>Personalizar tarjeta</span>
          </a>
          <button id="travel-notification-btn" type="button" class="btn btn-outline btn-small">
            <span>Notificar viaje</span>
            <span class="badge" id="travel-notice-badge" hidden>0</span>
          </button>
          <button id="toggle-data-btn" type="button" class="btn btn-outline btn-small"><span>Ocultar datos</span></button>
          <button id="replace-card-btn" type="button" class="btn btn-outline btn-small"><span>Reemplazar tarjeta</span></button>
          <button
            id="copy-card-data-btn"
            type="button"
            class="btn btn-outline btn-small"
            data-copy-target="all"
            data-copy-label="Datos de la tarjeta"
            data-copy-success-title="Datos copiados"
            data-copy-success-message="Los datos completos de tu tarjeta se copiaron al portapapeles."
          >
            <span>Copiar datos</span>
          </button>
        </div>
        <div class="mobile-stepper-controls" data-mobile-step-controls="card-overview" aria-hidden="true">
          <button type="button" class="mobile-stepper-button btn btn-outline btn-small" data-mobile-step-prev>Volver</button>
          <div class="mobile-stepper-status" aria-live="polite">
            <span class="mobile-stepper-count"><span data-mobile-step-current>1</span>/<span data-mobile-step-total>3</span></span>
            <span class="mobile-stepper-title" data-mobile-step-title>Estilo</span>
          </div>
          <button type="button" class="mobile-stepper-button btn btn-primary btn-small" data-mobile-step-next>Continuar</button>
        </div>
        </section>

        <section
          class="multi-currency-section scroll-target quick-access-panel"
          id="multi-currency-section"
          aria-labelledby="quick-access-tab-multi-currency-section multi-currency-title"
          tabindex="-1"
          role="tabpanel"
          hidden
        >
          <div class="multi-currency-header">
            <div class="multi-currency-heading">
              <span class="icon-badge" aria-hidden="true">
                <svg class="icon">
                  <use href="#icon-coins"></use>
                </svg>
              </span>
              <div>
                <h3 class="multi-currency-title" id="multi-currency-title">Multidivisas para tu tarjeta</h3>
                <p class="multi-currency-description">
                  Activa las divisas que deseas usar y asigna cuánto saldo quedará disponible en cada una.
                </p>
              </div>
            </div>
            <div class="multi-currency-summary">
              <span class="multi-currency-total" id="multi-currency-total">Total asignado: $0.00</span>
              <span class="multi-currency-breakdown" id="multi-currency-breakdown">Selecciona una divisa para comenzar.</span>
            </div>
          </div>
          <div class="multi-currency-grid" role="list">
            <article class="currency-card" data-currency="usd" role="listitem">
              <div class="currency-card-header">
                <div class="currency-info">
                  <span class="currency-icon usd" aria-hidden="true">
                    <svg class="icon">
                      <use href="#icon-dollar"></use>
                    </svg>
                  </span>
                  <div>
                    <span class="currency-name">Dólares estadounidenses</span>
                    <span class="currency-code">USD</span>
                  </div>
                </div>
                <label class="switch" for="currency-toggle-usd">
                  <input type="checkbox" id="currency-toggle-usd" data-currency-toggle="usd" aria-label="Activar uso de USD">
                  <span class="slider"></span>
                </label>
              </div>
              <div class="currency-card-body">
                <span class="currency-available" data-currency-available="usd">Disponible: $0.00</span>
                <label class="currency-input-label" for="currency-amount-usd">Monto a usar</label>
                <div class="currency-input-wrapper">
                  <span class="currency-prefix">$</span>
                  <input
                    type="number"
                    inputmode="decimal"
                    step="0.01"
                    min="0"
                    id="currency-amount-usd"
                    data-currency-input="usd"
                    placeholder="0.00"
                    autocomplete="off"
                  >
                </div>
              </div>
            </article>
            <article class="currency-card" data-currency="eur" role="listitem">
              <div class="currency-card-header">
                <div class="currency-info">
                  <span class="currency-icon eur" aria-hidden="true">
                    <svg class="icon">
                      <use href="#icon-euro"></use>
                    </svg>
                  </span>
                  <div>
                    <span class="currency-name">Euros</span>
                    <span class="currency-code">EUR</span>
                  </div>
                </div>
                <label class="switch" for="currency-toggle-eur">
                  <input type="checkbox" id="currency-toggle-eur" data-currency-toggle="eur" aria-label="Activar uso de EUR">
                  <span class="slider"></span>
                </label>
              </div>
              <div class="currency-card-body">
                <span class="currency-available" data-currency-available="eur">Disponible: €0.00</span>
                <label class="currency-input-label" for="currency-amount-eur">Monto a usar</label>
                <div class="currency-input-wrapper">
                  <span class="currency-prefix">€</span>
                  <input
                    type="number"
                    inputmode="decimal"
                    step="0.01"
                    min="0"
                    id="currency-amount-eur"
                    data-currency-input="eur"
                    placeholder="0.00"
                    autocomplete="off"
                  >
                </div>
              </div>
            </article>
            <article class="currency-card" data-currency="bs" role="listitem">
              <div class="currency-card-header">
                <div class="currency-info">
                  <span class="currency-icon bs" aria-hidden="true">
                    <svg class="icon">
                      <use href="#icon-coins"></use>
                    </svg>
                  </span>
                  <div>
                    <span class="currency-name">Bolívares digitales</span>
                    <span class="currency-code">VES</span>
                  </div>
                </div>
                <label class="switch" for="currency-toggle-bs">
                  <input type="checkbox" id="currency-toggle-bs" data-currency-toggle="bs" aria-label="Activar uso de bolívares">
                  <span class="slider"></span>
                </label>
              </div>
              <div class="currency-card-body">
                <span class="currency-available" data-currency-available="bs">Disponible: Bs 0.00</span>
                <label class="currency-input-label" for="currency-amount-bs">Monto a usar</label>
                <div class="currency-input-wrapper">
                  <span class="currency-prefix">Bs</span>
                  <input
                    type="number"
                    inputmode="decimal"
                    step="0.01"
                    min="0"
                    id="currency-amount-bs"
                    data-currency-input="bs"
                    placeholder="0.00"
                    autocomplete="off"
                  >
                </div>
              </div>
            </article>
            <article class="currency-card" data-currency="usdt" role="listitem">
              <div class="currency-card-header">
                <div class="currency-info">
                  <span class="currency-icon usdt" aria-hidden="true">
                    <svg class="icon">
                      <use href="#icon-dollar-slot"></use>
                    </svg>
                  </span>
                  <div>
                    <span class="currency-name">Tether (USDT)</span>
                    <span class="currency-code">USDT</span>
                  </div>
                </div>
                <label class="switch" for="currency-toggle-usdt">
                  <input type="checkbox" id="currency-toggle-usdt" data-currency-toggle="usdt" aria-label="Activar uso de USDT">
                  <span class="slider"></span>
                </label>
              </div>
              <div class="currency-card-body">
                <span class="currency-available" data-currency-available="usdt">Disponible: ₮0.00</span>
                <label class="currency-input-label" for="currency-amount-usdt">Monto a usar</label>
                <div class="currency-input-wrapper">
                  <span class="currency-prefix">₮</span>
                  <input
                    type="number"
                    inputmode="decimal"
                    step="0.01"
                    min="0"
                    id="currency-amount-usdt"
                    data-currency-input="usdt"
                    placeholder="0.00"
                    autocomplete="off"
                  >
                </div>
              </div>
            </article>
          </div>
          <p class="multi-currency-note">Los saldos disponibles se sincronizan con tus recargas y permanecen guardados localmente en este dispositivo.</p>
        </section>

        <section
          class="physical-card-request scroll-target quick-access-panel"
          id="physical-card-request"
          aria-labelledby="quick-access-tab-physical-card-request physical-card-request-title"
          tabindex="-1"
          role="tabpanel"
          hidden
        >
        <div class="physical-card-header">
          <div class="physical-card-heading">
            <span class="physical-card-icon" aria-hidden="true">
              <svg class="icon">
                <use href="#icon-id-card"></use>
              </svg>
            </span>
            <div>
              <h2 class="physical-card-title" id="physical-card-request-title">Solicita tu tarjeta física</h2>
              <p class="physical-card-description">
                Recíbela en tu domicilio con envío prioritario en un plazo aproximado de 6 días.
              </p>
            </div>
          </div>
          <span class="physical-card-status" id="physical-card-status" role="status" aria-live="polite">Tarjeta física pendiente</span>
        </div>
        <form class="physical-card-form" id="physical-card-form">
          <div class="physical-card-grid">
            <div
              class="physical-card-step mobile-step"
              data-mobile-step-group="physical-card"
              data-mobile-step-index="1"
              data-mobile-step-title="Datos del titular"
            >
              <div class="physical-card-field physical-card-field--span">
                <label for="physical-card-full-name">Nombre completo</label>
                <input
                  type="text"
                  id="physical-card-full-name"
                  name="physicalCardFullName"
                  placeholder="Nombre y apellido"
                  autocomplete="name"
                  required
                  maxlength="80"
                >
              </div>
              <div class="physical-card-field physical-card-field--span">
                <label for="physical-card-address-line1">Dirección principal</label>
                <input
                  type="text"
                  id="physical-card-address-line1"
                  name="physicalCardAddress1"
                  placeholder="Calle, edificio y número"
                  autocomplete="address-line1"
                  required
                  maxlength="120"
                >
              </div>
              <div class="physical-card-field physical-card-field--span">
                <label for="physical-card-address-line2">Referencia adicional <span class="optional">(opcional)</span></label>
                <input
                  type="text"
                  id="physical-card-address-line2"
                  name="physicalCardAddress2"
                  placeholder="Apartamento, piso o punto de referencia"
                  autocomplete="address-line2"
                  maxlength="120"
                >
              </div>
            </div>
            <div
              class="physical-card-step mobile-step"
              data-mobile-step-group="physical-card"
              data-mobile-step-index="2"
              data-mobile-step-title="Dirección de envío"
            >
              <div class="physical-card-field">
                <label for="physical-card-city">Ciudad</label>
                <input
                  type="text"
                  id="physical-card-city"
                  name="physicalCardCity"
                  placeholder="Ciudad"
                  autocomplete="address-level2"
                  required
                  maxlength="60"
                >
              </div>
              <div class="physical-card-field">
                <label for="physical-card-state">Estado / Provincia</label>
                <input
                  type="text"
                  id="physical-card-state"
                  name="physicalCardState"
                  placeholder="Estado o provincia"
                  autocomplete="address-level1"
                  required
                  maxlength="60"
                >
              </div>
              <div class="physical-card-field">
                <label for="physical-card-postal-code">Código postal</label>
                <input
                  type="text"
                  id="physical-card-postal-code"
                  name="physicalCardPostalCode"
                  placeholder="Código postal"
                  autocomplete="postal-code"
                  required
                  maxlength="20"
                >
              </div>
              <div class="physical-card-field">
                <label for="physical-card-country">País</label>
                <select id="physical-card-country" name="physicalCardCountry" autocomplete="country" required>
                  <option value="" disabled selected>Selecciona una opción</option>
                  <option value="Argentina">Argentina</option>
                  <option value="Chile">Chile</option>
                  <option value="Colombia">Colombia</option>
                  <option value="Costa Rica">Costa Rica</option>
                  <option value="España">España</option>
                  <option value="Estados Unidos">Estados Unidos</option>
                  <option value="México">México</option>
                  <option value="Panamá">Panamá</option>
                  <option value="Perú">Perú</option>
                  <option value="Venezuela">Venezuela</option>
                </select>
              </div>
            </div>
          </div>
          <div
            class="physical-card-step mobile-step"
            data-mobile-step-group="physical-card"
            data-mobile-step-index="3"
            data-mobile-step-title="Detalles adicionales"
          >
            <div class="physical-card-field physical-card-field--span">
              <label for="physical-card-instructions">Indicaciones para entrega <span class="optional">(opcional)</span></label>
              <textarea
                id="physical-card-instructions"
                name="physicalCardInstructions"
                placeholder="Detalles para el mensajero"
                maxlength="220"
                rows="3"
              ></textarea>
            </div>
            <p class="physical-card-helper">
              Verifica que la información coincida con tu documento oficial. Te notificaremos cada avance del envío.
            </p>
            <div class="physical-card-actions">
              <button type="submit" class="btn btn-primary btn-small" id="physical-card-submit-btn">
                <span id="physical-card-submit-label">Solicitar tarjeta física</span>
              </button>
              <button type="button" class="btn btn-outline btn-small" id="physical-card-edit-btn" hidden>
                <span id="physical-card-edit-label">Editar solicitud</span>
              </button>
            </div>
          </div>
          <div class="mobile-stepper-controls physical-card-controls" data-mobile-step-controls="physical-card" aria-hidden="true">
            <button type="button" class="mobile-stepper-button btn btn-outline btn-small" data-mobile-step-prev>Volver</button>
            <div class="mobile-stepper-status" aria-live="polite">
              <span class="mobile-stepper-count"><span data-mobile-step-current>1</span>/<span data-mobile-step-total>3</span></span>
              <span class="mobile-stepper-title" data-mobile-step-title>Datos del titular</span>
            </div>
            <button type="button" class="mobile-stepper-button btn btn-primary btn-small" data-mobile-step-next>Continuar</button>
          </div>
        </form>
        <div class="physical-card-confirmation" id="physical-card-confirmation" role="status" aria-live="polite" hidden>
          <div class="physical-card-confirmation-header">
            <span class="physical-card-confirmation-icon" aria-hidden="true">
              <svg class="icon">
                <use href="#icon-check"></use>
              </svg>
            </span>
            <div>
              <h3 class="physical-card-confirmation-title" data-physical-card-focus tabindex="-1">Solicitud enviada</h3>
              <p class="physical-card-confirmation-message" id="physical-card-delivery-text"></p>
              <p class="physical-card-confirmation-meta" id="physical-card-requested-at"></p>
            </div>
          </div>
          <dl class="physical-card-summary">
            <div class="physical-card-summary-row">
              <dt>Nombre</dt>
              <dd id="physical-card-summary-name" class="empty">—</dd>
            </div>
            <div class="physical-card-summary-row">
              <dt>Dirección</dt>
              <dd id="physical-card-summary-address" class="empty">—</dd>
            </div>
            <div class="physical-card-summary-row">
              <dt>Ciudad y estado</dt>
              <dd id="physical-card-summary-city" class="empty">—</dd>
            </div>
            <div class="physical-card-summary-row">
              <dt>Código postal</dt>
              <dd id="physical-card-summary-postal" class="empty">—</dd>
            </div>
            <div class="physical-card-summary-row">
              <dt>País</dt>
              <dd id="physical-card-summary-country" class="empty">—</dd>
            </div>
            <div class="physical-card-summary-row">
              <dt>Indicaciones</dt>
              <dd id="physical-card-summary-instructions" class="empty">Sin comentarios adicionales</dd>
            </div>
          </dl>
        </div>
      </section>

      <section
        class="travel-notice-indicator scroll-target quick-access-panel"
        id="travel-notice-indicator"
        aria-labelledby="quick-access-tab-travel-notice-indicator"
        aria-live="polite"
        tabindex="-1"
        role="tabpanel"
        hidden
      >
        <span class="travel-notice-icon" aria-hidden="true">
          <svg class="icon">
            <use href="#icon-plane"></use>
          </svg>
        </span>
        <div class="travel-notice-text" role="status">
          <span class="travel-notice-title">Sin avisos de viaje</span>
          <span class="travel-notice-subtitle">Notifica tus viajes para evitar bloqueos inesperados.</span>
        </div>
      </section>

      <section
        class="card-controls-panel scroll-target quick-access-panel"
        id="card-controls"
        aria-labelledby="quick-access-tab-card-controls"
        tabindex="-1"
        role="tabpanel"
        hidden
      >
        <div class="nfc-settings-group">
          <div class="nfc-settings" role="group" aria-labelledby="freeze-toggle-label">
            <div class="nfc-settings-info">
              <span class="icon-badge" aria-hidden="true">
                <svg class="icon" aria-hidden="true">
                  <use href="#icon-snowflake"></use>
                </svg>
              </span>
              <div>
                <span class="toggle-title" id="freeze-toggle-label">Congelar tarjeta</span>
                <span class="toggle-description">Desactiva temporalmente tu tarjeta.</span>
              </div>
            </div>
            <label class="switch" for="freeze-toggle">
              <input type="checkbox" id="freeze-toggle" aria-labelledby="freeze-toggle-label" aria-describedby="freeze-status">
              <span class="slider" aria-hidden="true"></span>
            </label>
          </div>
          <p class="nfc-status-text" id="freeze-status" aria-live="polite">Tarjeta activa</p>
        </div>

        <div class="nfc-settings-group">
          <div class="nfc-settings" role="group" aria-labelledby="online-toggle-label">
            <div class="nfc-settings-info">
              <span class="icon-badge" aria-hidden="true">
                <svg class="icon" aria-hidden="true">
                  <use href="#icon-cart"></use>
                </svg>
              </span>
              <div>
                <span class="toggle-title" id="online-toggle-label">Compras online</span>
                <span class="toggle-description">Habilita tu tarjeta para compras por Internet.</span>
              </div>
            </div>
            <label class="switch" for="online-toggle">
              <input type="checkbox" id="online-toggle" aria-labelledby="online-toggle-label" aria-describedby="online-status">
              <span class="slider" aria-hidden="true"></span>
            </label>
          </div>
          <p class="nfc-status-text" id="online-status" aria-live="polite">Compras online desactivadas</p>
        </div>

        <div class="nfc-settings-group">
          <div class="nfc-settings" role="group" aria-labelledby="nfc-toggle-label">
            <div class="nfc-settings-info">
              <span class="icon-badge" aria-hidden="true">
                <svg class="icon" aria-hidden="true">
                  <use href="#icon-wifi"></use>
                </svg>
              </span>
              <div>
                <span class="toggle-title" id="nfc-toggle-label">Activar NFC</span>
                <span class="toggle-description">Enciende el chip para pagos sin contacto desde tu dispositivo.</span>
              </div>
            </div>
            <label class="switch" for="nfc-toggle">
              <input type="checkbox" id="nfc-toggle" aria-labelledby="nfc-toggle-label" aria-describedby="nfc-status">
              <span class="slider" aria-hidden="true"></span>
            </label>
          </div>

          <p class="nfc-status-text" id="nfc-status" aria-live="polite">NFC desactivado</p>
        </div>
      </section>

      <section
        class="security-center scroll-target quick-access-panel"
        id="security-center"
        aria-labelledby="quick-access-tab-security-center security-center-title"
        tabindex="-1"
        role="tabpanel"
        hidden
      >
        <header class="security-center-header">
          <div class="security-heading">
            <span class="icon-badge" aria-hidden="true">
              <svg class="icon" aria-hidden="true">
                <use href="#icon-shield"></use>
              </svg>
            </span>
            <div>
              <h2 class="security-heading-title" id="security-center-title">Centro de reclamos y seguridad</h2>
              <p class="security-heading-description">
                Gestiona reclamos, pagos no reconocidos, notificaciones y alertas de tu tarjeta virtual.
              </p>
            </div>
          </div>
          <button type="button" class="btn btn-primary btn-small">
            <svg class="icon" aria-hidden="true">
              <use href="#icon-file"></use>
            </svg>
            <span>Crear nuevo reclamo</span>
          </button>
        </header>

        <div class="security-grid" role="list">
          <article class="security-card" role="listitem">
            <header>
              <h3 class="security-card-title">Reclamos activos</h3>
              <span class="status-pill review">En revisión</span>
            </header>
            <p class="security-card-description">Seguimiento en tiempo real de tus solicitudes abiertas con soporte.</p>
            <ul class="security-list">
              <li class="security-list-item">
                <div class="security-list-text">
                  <span>Compra en LíneaPlus</span>
                  <span class="security-meta">Creado el 08 Jul 2024</span>
                </div>
                <span class="status-badge review">Analizando</span>
              </li>
              <li class="security-list-item">
                <div class="security-list-text">
                  <span>Reverso de comisión</span>
                  <span class="security-meta">Actualizado el 05 Jul 2024</span>
                </div>
                <span class="status-badge approved">Resuelto</span>
              </li>
            </ul>
          </article>

          <article class="security-card" role="listitem">
            <header>
              <h3 class="security-card-title">Pagos no reconocidos</h3>
              <span class="status-pill alert">Pendientes</span>
            </header>
            <p class="security-card-description">Confirma o desconoce operaciones sospechosas y protege tu saldo.</p>
            <div class="transaction-alert" role="group" aria-labelledby="unrecognized-transaction-title">
              <div class="transaction-alert-details">
                <span class="transaction-alert-title" id="unrecognized-transaction-title">TechStore Premium</span>
                <span class="security-meta">12 Jul 2024 · Miami, US</span>
              </div>
              <span class="transaction-alert-amount">$89.00</span>
            </div>
            <div class="security-actions" role="group" aria-label="Decidir sobre la operación">
              <button type="button" class="btn btn-success btn-small">
                <svg class="icon" aria-hidden="true">
                  <use href="#icon-check"></use>
                </svg>
                <span>Aprobar operación</span>
              </button>
              <button type="button" class="btn btn-danger btn-small">
                <svg class="icon" aria-hidden="true">
                  <use href="#icon-close"></use>
                </svg>
                <span>Rechazar operación</span>
              </button>
            </div>
          </article>

          <article class="security-card" role="listitem">
            <header>
              <h3 class="security-card-title">Alertas configuradas</h3>
              <span class="status-pill success">Activas</span>
            </header>
            <p class="security-card-description">Recibe notificaciones inmediatas por montos elevados o consumos internacionales.</p>
            <ul class="security-list">
              <li class="security-list-item">
                <div class="security-list-text">
                  <span>Alertas por compras superiores a $100</span>
                  <span class="security-meta">Último aviso: hace 2 horas</span>
                </div>
                <span class="status-badge review">Vigilando</span>
              </li>
              <li class="security-list-item">
                <div class="security-list-text">
                  <span>Alertas por uso internacional</span>
                  <span class="security-meta">Activo desde el 01 Jul 2024</span>
                </div>
                <span class="status-badge approved">Activa</span>
              </li>
            </ul>
          </article>
        </div>

        <div class="security-notifications">
          <h3 class="security-subtitle">Notificaciones y alertas recientes</h3>
          <ul class="notification-list">
            <li class="notification-item">
              <div class="notification-text">
                <span class="notification-title">Alerta de consumo internacional</span>
                <span class="notification-meta">Hace 2 horas · Compra en París, FR por $152.00</span>
              </div>
              <span class="tag alert">
                <svg class="icon" aria-hidden="true">
                  <use href="#icon-alert"></use>
                </svg>
                <span>Alerta</span>
              </span>
            </li>
            <li class="notification-item">
              <div class="notification-text">
                <span class="notification-title">Reclamo actualizado</span>
                <span class="notification-meta">Tu reclamo #45821 cambió a estado "En revisión".</span>
              </div>
              <span class="tag info">
                <svg class="icon" aria-hidden="true">
                  <use href="#icon-info"></use>
                </svg>
                <span>Notificación</span>
              </span>
            </li>
          </ul>
        </div>

        <div class="transaction-history" aria-labelledby="transaction-history-title">
          <div class="transaction-history-header">
            <h3 class="transaction-history-title" id="transaction-history-title">Historial de transacciones</h3>
            <a href="historial-tarjeta.html" class="history-link">Ver todo el historial</a>
          </div>
          <table>
            <thead>
              <tr>
                <th scope="col">Fecha</th>
                <th scope="col">Detalle</th>
                <th scope="col">Estado</th>
                <th scope="col">Monto</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>12 Jul 2024</td>
                <td>Compra TechStore Premium</td>
                <td><span class="status-badge review">En revisión</span></td>
                <td class="amount">$89.00</td>
              </tr>
              <tr>
                <td>10 Jul 2024</td>
                <td>Reverso de comisión</td>
                <td><span class="status-badge approved">Aprobado</span></td>
                <td class="amount">$12.50</td>
              </tr>
              <tr>
                <td>08 Jul 2024</td>
                <td>Pago en LíneaPlus</td>
                <td><span class="status-badge rejected">Rechazado</span></td>
                <td class="amount">-$54.00</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section
        class="app-connections scroll-target quick-access-panel"
        id="app-connections"
        aria-labelledby="quick-access-tab-app-connections app-connections-title"
        tabindex="-1"
        role="tabpanel"
        hidden
      >
        <div class="app-connections-header">
          <div class="app-connections-heading">
            <span class="icon-badge" aria-hidden="true">
              <svg class="icon" aria-hidden="true">
                <use href="#icon-link"></use>
              </svg>
            </span>
            <div>
              <h2 class="app-connections-title" id="app-connections-title">Conecta con otras apps</h2>
              <p class="app-connections-description">
                Vincula tu tarjeta virtual Remeex para enviar y recibir dinero desde tus plataformas favoritas.
              </p>
            </div>
          </div>
        </div>
        <div class="integration-grid" role="list">
          <article class="integration-card" data-app-id="paypal" role="listitem">
            <div class="integration-header">
              <div class="integration-icon paypal" aria-hidden="true">
                <svg class="icon">
                  <use href="#icon-paypal"></use>
                </svg>
              </div>
              <div>
                <h3 class="integration-name">PayPal</h3>
                <p class="integration-description">Recibe pagos y retíralos con tu tarjeta sin esperas.</p>
              </div>
            </div>
            <div class="integration-footer">
              <span class="integration-status" data-status-label>Sin vincular</span>
              <button type="button" class="btn btn-outline btn-small integration-action" data-app-action aria-pressed="false">
                <span class="integration-action-label">Vincular</span>
              </button>
            </div>
          </article>
          <article class="integration-card" data-app-id="zinli" role="listitem">
            <div class="integration-header">
              <div class="integration-icon zinli" aria-hidden="true">
                <svg class="icon">
                  <use href="#icon-wallet"></use>
                </svg>
              </div>
              <div>
                <h3 class="integration-name">Zinli</h3>
                <p class="integration-description">Recarga tu monedero Zinli usando la tarjeta virtual al instante.</p>
              </div>
            </div>
            <div class="integration-footer">
              <span class="integration-status" data-status-label>Sin vincular</span>
              <button type="button" class="btn btn-outline btn-small integration-action" data-app-action aria-pressed="false">
                <span class="integration-action-label">Vincular</span>
              </button>
            </div>
          </article>
          <article class="integration-card" data-app-id="wise" role="listitem">
            <div class="integration-header">
              <div class="integration-icon wise" aria-hidden="true">
                <svg class="icon">
                  <use href="#icon-globe"></use>
                </svg>
              </div>
              <div>
                <h3 class="integration-name">Wise</h3>
                <p class="integration-description">Envía transferencias internacionales y controla tasas en Wise.</p>
              </div>
            </div>
            <div class="integration-footer">
              <span class="integration-status" data-status-label>Sin vincular</span>
              <button type="button" class="btn btn-outline btn-small integration-action" data-app-action aria-pressed="false">
                <span class="integration-action-label">Vincular</span>
              </button>
            </div>
          </article>
          <article class="integration-card" data-app-id="westernunion" role="listitem">
            <div class="integration-header">
              <div class="integration-icon westernunion" aria-hidden="true">
                <svg class="icon">
                  <use href="#icon-building"></use>
                </svg>
              </div>
              <div>
                <h3 class="integration-name">Western Union</h3>
                <p class="integration-description">Recibe remesas y envíos de dinero directo a tu tarjeta.</p>
              </div>
            </div>
            <div class="integration-footer">
              <span class="integration-status" data-status-label>Sin vincular</span>
              <button type="button" class="btn btn-outline btn-small integration-action" data-app-action aria-pressed="false">
                <span class="integration-action-label">Vincular</span>
              </button>
            </div>
          </article>
          <article class="integration-card" data-app-id="patreon" role="listitem">
            <div class="integration-header">
              <div class="integration-icon patreon" aria-hidden="true">
                <svg class="icon">
                  <use href="#icon-patreon"></use>
                </svg>
              </div>
              <div>
                <h3 class="integration-name">Patreon</h3>
                <p class="integration-description">Recibe tus aportes de miembros y transfiérelos sin demoras.</p>
              </div>
            </div>
            <div class="integration-footer">
              <span class="integration-status" data-status-label>Sin vincular</span>
              <button type="button" class="btn btn-outline btn-small integration-action" data-app-action aria-pressed="false">
                <span class="integration-action-label">Vincular</span>
              </button>
            </div>
          </article>
          <article class="integration-card" data-app-id="onlyfans" role="listitem">
            <div class="integration-header">
              <div class="integration-icon onlyfans" aria-hidden="true">
                <svg class="icon">
                  <use href="#icon-heart"></use>
                </svg>
              </div>
              <div>
                <h3 class="integration-name">OnlyFans</h3>
                <p class="integration-description">Administra cobros y retiros automáticos desde OnlyFans.</p>
              </div>
            </div>
            <div class="integration-footer">
              <span class="integration-status" data-status-label>Sin vincular</span>
              <button type="button" class="btn btn-outline btn-small integration-action" data-app-action aria-pressed="false">
                <span class="integration-action-label">Vincular</span>
              </button>
            </div>
          </article>
        </div>
      </section>

      </div>

      <p class="card-text">
        Gestiona tu tarjeta virtual y controla cuándo mostrar los datos completos para compras en línea seguras.
      </p>

      <a href="tarjetaremeex.html" class="btn btn-primary">Ir a mi panel de tarjeta</a>
    </section>
  </main>

  <div class="nfc-payment-overlay" id="nfc-payment-overlay" aria-hidden="true">
    <div
      class="nfc-payment-content"
      role="dialog"
      aria-modal="true"
      aria-labelledby="nfc-payment-title"
      aria-describedby="nfc-payment-description nfc-payment-status"
      tabindex="-1"
    >
      <button type="button" class="nfc-payment-close" id="nfc-payment-close" aria-label="Cerrar animación de pago">
        <svg class="icon" aria-hidden="true">
          <use href="#icon-close"></use>
        </svg>
      </button>
      <div class="nfc-payment-visual" aria-hidden="true">
        <div class="nfc-pulse nfc-pulse-one"></div>
        <div class="nfc-pulse nfc-pulse-two"></div>
        <div class="nfc-pulse nfc-pulse-three"></div>
        <div class="nfc-payment-card" id="nfc-payment-card">
          <span class="nfc-ready-label">
            <svg class="icon" aria-hidden="true">
              <use href="#icon-wave"></use>
            </svg>
            <span id="nfc-payment-ready-label-text">NFC activo</span>
          </span>
          <div class="nfc-card-branding">
            <img
              src="https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/chip.png"
              class="nfc-card-chip"
              alt=""
              aria-hidden="true"
            >
            <img
              src="https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/visa.png"
              class="nfc-card-brand"
              alt="Marca de la tarjeta"
            >
          </div>
          <div class="nfc-card-number" id="nfc-payment-number">4165 9800 7015 6852</div>
          <div class="nfc-card-meta">
            <div class="nfc-card-field">
              <span class="field-label">Titular</span>
              <span class="field-value" id="nfc-payment-holder">USUARIO</span>
            </div>
            <div class="nfc-card-field">
              <span class="field-label">Vence</span>
              <span class="field-value" id="nfc-payment-expiry">04/28</span>
            </div>
          </div>
          <div class="nfc-card-signal" aria-hidden="true">
            <span class="nfc-signal-bar"></span>
            <span class="nfc-signal-bar"></span>
            <span class="nfc-signal-bar"></span>
          </div>
        </div>
      </div>
      <div class="nfc-payment-info">
        <h2 class="nfc-payment-title" id="nfc-payment-title">Acerca tu dispositivo para pagar</h2>
        <p class="nfc-payment-meta" id="nfc-payment-meta">Titular: USUARIO · Terminación 6852 · Estado: Activa</p>
        <p class="nfc-payment-description" id="nfc-payment-description">
          Mantén la tarjeta cerca del terminal con NFC habilitado hasta recibir confirmación.
        </p>
        <div class="nfc-payment-status-line">
          <span class="nfc-status-dot" aria-hidden="true"></span>
          <span class="nfc-payment-status-text" id="nfc-payment-status" aria-live="polite">Inicializando chip NFC...</span>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="travel-notice-backdrop" hidden></div>
  <div class="travel-notice-modal" id="travel-notice-modal" role="dialog" aria-modal="true" aria-labelledby="travel-notice-modal-title" aria-hidden="true" hidden>
    <div class="travel-notice-modal__content">
      <header class="travel-notice-modal__header">
        <h2 class="travel-notice-modal__title" id="travel-notice-modal-title">Registrar aviso de viaje</h2>
        <button type="button" class="travel-notice-modal__close" id="travel-notice-close-btn" aria-label="Cerrar formulario de aviso de viaje">
          <span aria-hidden="true">&times;</span>
        </button>
      </header>
      <form id="travel-notice-form" class="travel-notice-form" aria-describedby="travel-notice-helper-text">
        <div class="form-field">
          <label for="travel-destination">Destino</label>
          <input type="text" id="travel-destination" name="travelDestination" placeholder="Ciudad o país" autocomplete="off" required maxlength="80">
        </div>
        <div class="travel-notice-dates">
          <div class="form-field">
            <label for="travel-start-date">Fecha de salida</label>
            <input type="date" id="travel-start-date" name="travelStartDate" required>
          </div>
          <div class="form-field">
            <label for="travel-end-date">Fecha de regreso</label>
            <input type="date" id="travel-end-date" name="travelEndDate" required>
          </div>
        </div>
        <p class="travel-notice-helper" id="travel-notice-helper-text">Comparte las fechas de viaje para evitar bloqueos inesperados al usar tu tarjeta.</p>
        <div class="modal-actions">
          <button type="button" class="btn btn-outline btn-small" id="travel-notice-cancel-btn">Cancelar</button>
          <button type="submit" class="btn btn-primary btn-small">Guardar aviso</button>
        </div>
      </form>
    </div>
  </div>

  <div class="toast-container" id="toast-container" aria-live="polite" aria-atomic="true"></div>

  <script>
    (function () {
      if (typeof window.showToast === 'function') {
        return;
      }

      window.showToast = function (type, title, message) {
        var container = document.getElementById('toast-container');
        if (!container) {
          alert(title + '\n' + message);
          return;
        }

        var toast = document.createElement('div');
        toast.className = 'toast ' + (type || 'info');

        var titleEl = document.createElement('div');
        titleEl.className = 'toast-title';
        titleEl.textContent = title || '';
        toast.appendChild(titleEl);

        if (message) {
          var messageEl = document.createElement('div');
          messageEl.className = 'toast-message';
          messageEl.textContent = message;
          toast.appendChild(messageEl);
        }

        container.appendChild(toast);

        requestAnimationFrame(function () {
          toast.classList.add('visible');
        });

        setTimeout(function () {
          toast.classList.remove('visible');
          setTimeout(function () {
            toast.remove();
          }, 300);
        }, 3200);
      };
    })();
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', initVirtualCard);

    const CARD_STORAGE_KEYS = {
      state: 'virtualCardPreferences',
      data: 'virtualCardData'
    };

    const CARD_STYLE_STORAGE_KEY = 'virtualCardStyle';
    const CARD_STYLE_COUNT = 25;

    const CONNECTION_STORAGE_KEY = 'virtualCardConnections';

    const PHYSICAL_CARD_STORAGE_KEY = 'virtualPhysicalCardRequest';

    const PHYSICAL_CARD_DELIVERY_DAYS = 6;

    const APP_CONNECTION_CONFIG = {
      paypal: {
        name: 'PayPal',
        connectMessage: 'Tu tarjeta se vinculó con PayPal. Retira fondos y paga sin esperas.',
        disconnectMessage: 'Se desactivó la conexión con PayPal.'
      },
      zinli: {
        name: 'Zinli',
        connectMessage: 'Tu tarjeta quedó asociada a Zinli para recargas instantáneas.',
        disconnectMessage: 'Se canceló la vinculación con Zinli.'
      },
      wise: {
        name: 'Wise',
        connectMessage: 'La tarjeta está disponible en Wise para tus transferencias globales.',
        disconnectMessage: 'Se desactivó Wise como destino de tu tarjeta.'
      },
      westernunion: {
        name: 'Western Union',
        connectMessage: 'Podrás recibir remesas de Western Union directamente en tu tarjeta.',
        disconnectMessage: 'La vinculación con Western Union fue desactivada.'
      },
      patreon: {
        name: 'Patreon',
        connectMessage: 'Recibirás los aportes de Patreon en tu tarjeta virtual.',
        disconnectMessage: 'Se detuvo el abono automático desde Patreon.'
      },
      onlyfans: {
        name: 'OnlyFans',
        connectMessage: 'Los cobros de OnlyFans se transferirán a tu tarjeta virtual.',
        disconnectMessage: 'Se deshabilitó la integración con OnlyFans.'
      }
    };

    const DEFAULT_CARD_DATA = {
      number: '4165980070156852',
      holder: 'USUARIO',
      expiry: '04/28',
      cvv: '740',
      status: 'active'
    };

    const CONFIG = {
      CARD_DATA: Object.assign({}, DEFAULT_CARD_DATA)
    };

    const REMEEX_VALIDATION_REMINDER =
      'Recuerda validar tu cuenta Remeex Visa en tu perfil para mantener tus operaciones activas.';

    function withValidationReminder(message) {
      const base = typeof message === 'string' ? message.trim() : '';
      if (!base) {
        return REMEEX_VALIDATION_REMINDER;
      }

      const normalizedBase = base.toLowerCase();
      const normalizedReminder = REMEEX_VALIDATION_REMINDER.toLowerCase();

      if (normalizedBase.indexOf(normalizedReminder) !== -1) {
        return base;
      }

      return base + ' ' + REMEEX_VALIDATION_REMINDER;
    }

    const DEFAULT_CARD_STATE = {
      status: DEFAULT_CARD_DATA.status,
      showData: true,
      onlineEnabled: false,
      nfcEnabled: false,
      balance: 0,
      dailyLimit: 2000,
      monthlyLimit: 10000,
      travelNotices: [],
      multiCurrency: getDefaultMultiCurrencyState()
    };

    function getDefaultMultiCurrencyState() {
      return {
        usd: { enabled: DEFAULT_MULTI_CURRENCY_STATE.usd.enabled, amount: DEFAULT_MULTI_CURRENCY_STATE.usd.amount },
        eur: { enabled: DEFAULT_MULTI_CURRENCY_STATE.eur.enabled, amount: DEFAULT_MULTI_CURRENCY_STATE.eur.amount },
        bs: { enabled: DEFAULT_MULTI_CURRENCY_STATE.bs.enabled, amount: DEFAULT_MULTI_CURRENCY_STATE.bs.amount },
        usdt: { enabled: DEFAULT_MULTI_CURRENCY_STATE.usdt.enabled, amount: DEFAULT_MULTI_CURRENCY_STATE.usdt.amount }
      };
    }

    const LIMIT_TYPE_CONFIG = {
      daily: {
        stateKey: 'dailyLimit',
        inputId: 'daily-limit-input',
        statusId: 'card-daily-limit-status',
        cardSelector: '.financial-limit-card[data-limit-type="daily"]',
        toastContext: 'límite diario',
        maxValue: DEFAULT_CARD_STATE.dailyLimit
      },
      monthly: {
        stateKey: 'monthlyLimit',
        inputId: 'monthly-limit-input',
        statusId: 'card-monthly-limit-status',
        cardSelector: '.financial-limit-card[data-limit-type="monthly"]',
        toastContext: 'límite mensual',
        maxValue: DEFAULT_CARD_STATE.monthlyLimit
      }
    };

    const TRAVEL_NOTICE_MAX_DESTINATION_LENGTH = 80;
    const TRAVEL_NOTICE_DATE_PATTERN = /^\d{4}-\d{2}-\d{2}$/;

    const CURRENCY_FORMATTER = new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    });

    const BALANCE_STORAGE_KEY = 'remeexBalance';
    const SESSION_BALANCE_KEY = 'remeexSessionBalance';
    const EXCHANGE_RATE_STORAGE_KEY = 'remeexSessionExchangeRate';
    const DEVICE_ID_STORAGE_KEY = 'remeexDeviceId';
    const ACCOUNT_ACTIVATION_STORAGE_KEY = 'remeexAccountActivated';

    const DEFAULT_EXCHANGE_RATES = {
      USD_TO_BS: 151.1,
      USD_TO_EUR: 0.94
    };

    const DEFAULT_MULTI_CURRENCY_STATE = {
      usd: { enabled: true, amount: 0 },
      eur: { enabled: false, amount: 0 },
      bs: { enabled: false, amount: 0 },
      usdt: { enabled: false, amount: 0 }
    };

    const DEFAULT_PHYSICAL_CARD_REQUEST = {
      requested: false,
      fullName: '',
      addressLine1: '',
      addressLine2: '',
      city: '',
      stateProvince: '',
      postalCode: '',
      country: '',
      instructions: '',
      submittedAt: null,
      estimatedDelivery: null
    };

    const MULTI_CURRENCY_OPTIONS = {
      usd: { code: 'USD', label: 'Dólares estadounidenses', prefix: '$' },
      eur: { code: 'EUR', label: 'Euros', prefix: '€' },
      bs: { code: 'VES', label: 'Bolívares digitales', prefix: 'Bs' },
      usdt: { code: 'USDT', label: 'Tether (USDT)', prefix: '₮' }
    };

    const MULTI_CURRENCY_FORMATTERS = {
      USD: new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2, maximumFractionDigits: 2 }),
      EUR: new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR', minimumFractionDigits: 2, maximumFractionDigits: 2 }),
      VES: new Intl.NumberFormat('es-VE', { style: 'currency', currency: 'VES', minimumFractionDigits: 2, maximumFractionDigits: 2 }),
      USDT: new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
    };

    const NFC_PAYMENT_SEQUENCE_ACTIVE = [
      'Inicializando chip NFC...',
      'Emitiendo señal segura...',
      'Listo para acercar y pagar.'
    ];

    const NFC_PAYMENT_SEQUENCE_INACTIVE = [
      'Encendiendo NFC virtual...',
      'Verificando tarjeta digital...',
      'Listo para acercar y pagar.'
    ];

    const NFC_PAYMENT_SEQUENCE_FROZEN = ['Tu tarjeta está congelada. Actívala para pagar sin contacto.'];

    const NFC_PAYMENT_STATUS_INTERVAL = 1600;

    const NFC_PAYMENT_DEFAULT_DESCRIPTION =
      'Mantén la tarjeta cerca del terminal con NFC habilitado hasta recibir confirmación.';

    const NFC_PAYMENT_FROZEN_DESCRIPTION =
      'Activa la tarjeta para reiniciar la señal NFC y poder pagar sin contacto.';

    const ACTION_PROCESSING_DEFAULT_DURATION = 900;
    const ACTION_PROCESSING_MIN_VISIBLE = 420;

    const MOBILE_STEPPER_BREAKPOINT = 600;
    const mobileStepGroups = new Map();
    const mobileStepControls = new Map();
    const mobileStepState = new Map();
    let mobileStepperMediaQuery = null;
    let mobileStepperEnabled = false;

    let cardState = Object.assign({}, DEFAULT_CARD_STATE);

    let exchangeRates = Object.assign({}, DEFAULT_EXCHANGE_RATES);

    let availableBalances = { usd: 0, eur: 0, bs: 0, usdt: 0 };

    let multiCurrencyStateLoadedFromStorage = false;

    let nfcSimulationTimeout = null;

    let travelNoticeModal = null;
    let travelNoticeBackdrop = null;
    let travelNoticeForm = null;
    let travelDestinationInput = null;
    let travelStartInput = null;
    let travelEndInput = null;
    let travelNoticeBadge = null;
    let travelModalCloseTimeout = null;
    let travelModalLastFocus = null;
    let appConnectionsState = {};

    let physicalCardRequestState = Object.assign({}, DEFAULT_PHYSICAL_CARD_REQUEST);
    let physicalCardForm = null;
    let physicalCardStatusEl = null;
    let physicalCardConfirmationEl = null;
    let physicalCardDeliveryTextEl = null;
    let physicalCardRequestDateEl = null;
    let physicalCardSummaryNameEl = null;
    let physicalCardSummaryAddressEl = null;
    let physicalCardSummaryCityEl = null;
    let physicalCardSummaryPostalEl = null;
    let physicalCardSummaryCountryEl = null;
    let physicalCardSummaryInstructionsEl = null;
    let physicalCardEditButton = null;
    let physicalCardEditLabel = null;
    let physicalCardSubmitButton = null;
    let physicalCardSubmitLabel = null;
    let physicalCardFields = {};
    let physicalCardEditMode = false;

    let accountActivationOverlay = null;

    let nfcPaymentOverlay = null;
    let nfcPaymentDialogEl = null;
    let nfcPaymentCloseButton = null;
    let nfcPaymentStatusEl = null;
    let nfcPaymentNumberEl = null;
    let nfcPaymentHolderEl = null;
    let nfcPaymentExpiryEl = null;
    let nfcPaymentMetaEl = null;
    let nfcPaymentReadyLabelText = null;
    let nfcPaymentDescriptionEl = null;
    let nfcPaymentCardEl = null;
    let nfcPaymentTriggerButton = null;
    let nfcPaymentLastFocus = null;
    let nfcPaymentStatusTimers = [];
    let nfcOverlayKeydownHandlerRegistered = false;

    let panelLoader = null;
    let panelLoaderLabel = null;
    let panelLoaderVisibleSince = 0;
    let panelLoaderHideTimeout = null;

    function initializeAccountActivationOverlay() {
      accountActivationOverlay = document.querySelector('.account-activation-overlay');
      const isActivated = getStoredAccountActivationState();
      setAccountActivationState(isActivated, { persist: false });
    }

    function getStoredAccountActivationState() {
      if (typeof localStorage === 'undefined') {
        return false;
      }

      return localStorage.getItem(ACCOUNT_ACTIVATION_STORAGE_KEY) === 'true';
    }

    function setAccountActivationState(isActivated, options) {
      const shouldPersist = !options || options.persist !== false;
      const activated = Boolean(isActivated);

      const bodyEl = document.body;
      if (bodyEl) {
        bodyEl.classList.toggle('account-activation-dismissed', activated);
      }

      if (accountActivationOverlay) {
        accountActivationOverlay.setAttribute('aria-hidden', activated ? 'true' : 'false');

        if (!activated) {
          const focusTarget = accountActivationOverlay.querySelector('.activation-home-button');
          if (focusTarget && typeof focusTarget.focus === 'function') {
            focusTarget.focus();
          }
        }
      }

      if (shouldPersist && typeof localStorage !== 'undefined') {
        if (activated) {
          localStorage.setItem(ACCOUNT_ACTIVATION_STORAGE_KEY, 'true');
        } else {
          localStorage.removeItem(ACCOUNT_ACTIVATION_STORAGE_KEY);
        }
      }
    }

    function showAccountActivationOverlay() {
      setAccountActivationState(false);
    }

    function hideAccountActivationOverlay() {
      setAccountActivationState(true);
    }

    function initializePanelLoader() {
      panelLoader = document.getElementById('panel-loader');
      panelLoaderLabel = panelLoader ? panelLoader.querySelector('[data-loader-label]') : null;
    }

    function ensurePanelLoader() {
      if (!panelLoader) {
        initializePanelLoader();
      }

      return Boolean(panelLoader);
    }

    function showActionLoader(message) {
      if (!ensurePanelLoader()) {
        return;
      }

      if (panelLoaderHideTimeout) {
        clearTimeout(panelLoaderHideTimeout);
        panelLoaderHideTimeout = null;
      }

      panelLoaderVisibleSince = Date.now();
      panelLoader.classList.add('is-visible');
      panelLoader.setAttribute('aria-hidden', 'false');
      panelLoader.setAttribute('aria-busy', 'true');

      if (panelLoaderLabel) {
        panelLoaderLabel.textContent = message || 'Procesando...';
      }
    }

    function hideActionLoader() {
      if (!ensurePanelLoader()) {
        return;
      }

      const elapsed = Date.now() - panelLoaderVisibleSince;
      const delay = Math.max(0, ACTION_PROCESSING_MIN_VISIBLE - elapsed);

      if (panelLoaderHideTimeout) {
        clearTimeout(panelLoaderHideTimeout);
      }

      panelLoaderHideTimeout = setTimeout(function () {
        panelLoader.classList.remove('is-visible');
        panelLoader.setAttribute('aria-hidden', 'true');
        panelLoader.removeAttribute('aria-busy');
        panelLoaderHideTimeout = null;
      }, delay);
    }

    function simulateActionProcessing(options) {
      const settings = options || {};
      const duration =
        typeof settings.duration === 'number' && settings.duration > 0
          ? settings.duration
          : ACTION_PROCESSING_DEFAULT_DURATION;
      const message = settings.message || 'Procesando...';

      showActionLoader(message);

      if (typeof settings.onStart === 'function') {
        settings.onStart();
      }

      setTimeout(function () {
        if (typeof settings.onComplete === 'function') {
          settings.onComplete();
        }

        hideActionLoader();

        if (typeof settings.onFinally === 'function') {
          settings.onFinally();
        }
      }, duration);
    }

    function initVirtualCard() {
      initializeAccountActivationOverlay();
      const storedName = (localStorage.getItem('userFullName') || DEFAULT_CARD_DATA.holder).trim();
      loadCardData(storedName);
      initializePanelLoader();
      loadCardState();
      loadStoredExchangeRates();
      loadAvailableBalances();
      applyDefaultMultiCurrencyAmountsIfNeeded();
      clampMultiCurrencyAllocations();
      loadFinancialInfo();
      hydrateStyleFromQueryIfAvailable();
      updateCardDisplay();
      applySavedCardStyle();
      initializePhysicalCardRequest();
      setupEventListeners();
      initializeAppConnections();
    }

    function setupEventListeners() {
      const freezeToggle = document.getElementById('freeze-toggle');
      if (freezeToggle) {
        freezeToggle.addEventListener('change', toggleCardFreeze);
      }

      const toggleDataBtn = document.getElementById('toggle-data-btn');
      if (toggleDataBtn) {
        toggleDataBtn.addEventListener('click', toggleCardDataVisibility);
      }

      const replaceCardBtn = document.getElementById('replace-card-btn');
      if (replaceCardBtn) {
        replaceCardBtn.addEventListener('click', replaceCard);
      }

      const onlineToggle = document.getElementById('online-toggle');
      if (onlineToggle) {
        onlineToggle.addEventListener('change', toggleOnlinePurchases);
      }

      const nfcToggle = document.getElementById('nfc-toggle');
      if (nfcToggle) {
        nfcToggle.addEventListener('change', handleNfcToggle);
      }

      setupLimitInputs();
      setupMultiCurrencyControls();
      setupTravelNoticeFeature();
      setupCopyButtons();
      setupQuickAccessNavigation();
      initializeMobileStepperSystem();

      setupNfcPaymentOverlay();

      window.addEventListener('storage', handleStorageChanges);
    }

    function setupQuickAccessNavigation() {
      const quickAccessNav = document.querySelector('.quick-access-nav');
      const panelContainer = document.querySelector('.quick-access-panels');

      if (!quickAccessNav || !panelContainer) {
        return;
      }

      const quickAccessList = quickAccessNav.querySelector('.quick-access-list');
      const prevControl = quickAccessNav.querySelector('.quick-access-control[data-direction="prev"]');
      const nextControl = quickAccessNav.querySelector('.quick-access-control[data-direction="next"]');
      const mobileStatus = quickAccessNav.querySelector('.quick-access-mobile-status');
      const mobileStatusIcon = mobileStatus ? mobileStatus.querySelector('.quick-access-mobile-status-icon') : null;
      const mobileStatusLabel = mobileStatus ? mobileStatus.querySelector('.quick-access-mobile-status-label') : null;

      const tabButtons = quickAccessList
        ? Array.prototype.slice.call(quickAccessList.querySelectorAll('[data-panel-target]'))
        : [];

      if (tabButtons.length === 0) {
        return;
      }

      const panels = {};
      Array.prototype.slice.call(panelContainer.querySelectorAll('.quick-access-panel')).forEach(function (panel) {
        if (panel && panel.id) {
          panels[panel.id] = panel;

          if (!panel.hasAttribute('tabindex')) {
            panel.setAttribute('tabindex', '-1');
          }
        }
      });

      if (Object.keys(panels).length === 0) {
        return;
      }

      let activeButton = null;
      let activePanel = null;
      let activeIndex = -1;

      function setButtonState(button, isActive) {
        if (!button) {
          return;
        }

        button.setAttribute('aria-selected', isActive ? 'true' : 'false');
        button.setAttribute('aria-expanded', isActive ? 'true' : 'false');
        button.setAttribute('tabindex', isActive ? '0' : '-1');
        button.classList.toggle('is-active', Boolean(isActive));
      }

      function setPanelState(panel, isActive) {
        if (!panel) {
          return;
        }

        panel.classList.toggle('is-active', Boolean(isActive));

        if (isActive) {
          panel.removeAttribute('hidden');
        } else if (!panel.hasAttribute('hidden')) {
          panel.setAttribute('hidden', '');
        }
      }

      function focusPanel(panel) {
        if (!panel || typeof panel.focus !== 'function') {
          return;
        }

        try {
          panel.focus({ preventScroll: true });
        } catch (error) {
          panel.focus();
        }
      }

      function updateHash(panelId) {
        if (!panelId) {
          return;
        }

        const hash = '#' + panelId;
        if (window.history && typeof window.history.replaceState === 'function') {
          window.history.replaceState(null, '', hash);
        } else {
          window.location.hash = hash;
        }
      }

      function updateControls() {
        if (prevControl) {
          prevControl.disabled = !activeButton || activeIndex <= 0;
        }

        if (nextControl) {
          nextControl.disabled = !activeButton || activeIndex === tabButtons.length - 1 || activeIndex === -1;
        }
      }

      function updateMobileStatus() {
        if (!mobileStatus) {
          return;
        }

        if (!activeButton) {
          mobileStatus.classList.remove('is-visible');

          if (mobileStatusIcon) {
            mobileStatusIcon.innerHTML = '';
          }

          if (mobileStatusLabel) {
            mobileStatusLabel.textContent = '';
          }

          return;
        }

        const labelEl = activeButton.querySelector('.quick-access-label');
        const labelText = labelEl ? labelEl.textContent : activeButton.textContent;

        if (mobileStatusLabel) {
          mobileStatusLabel.textContent = labelText ? labelText.trim() : '';
        }

        if (mobileStatusIcon) {
          const iconEl = activeButton.querySelector('.quick-access-icon');
          mobileStatusIcon.innerHTML = iconEl ? iconEl.innerHTML : '';
        }

        mobileStatus.classList.add('is-visible');
      }

      function scrollActiveButtonIntoView() {
        if (!activeButton || typeof activeButton.scrollIntoView !== 'function') {
          return;
        }

        const container = quickAccessList;
        const shouldScroll = container && container.scrollWidth > container.clientWidth + 1;

        if (!shouldScroll) {
          return;
        }

        try {
          activeButton.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        } catch (error) {
          activeButton.scrollIntoView();
        }
      }

      function activate(button, panel, options) {
        const settings = Object.assign({ focusPanel: false, updateHash: false }, options);

        if (button === activeButton && panel === activePanel) {
          if (settings.focusPanel) {
            focusPanel(panel);
          }

          if (settings.updateHash && panel) {
            updateHash(panel.id);
          }

          scrollActiveButtonIntoView();
          updateControls();
          updateMobileStatus();

          return;
        }

        setButtonState(activeButton, false);
        setPanelState(activePanel, false);

        activeButton = button || null;
        activePanel = panel || null;
        activeIndex = tabButtons.indexOf(activeButton);

        setButtonState(activeButton, true);
        setPanelState(activePanel, true);

        updateControls();
        updateMobileStatus();
        scrollActiveButtonIntoView();

        if (settings.focusPanel) {
          focusPanel(activePanel);
        }

        if (settings.updateHash && activePanel) {
          updateHash(activePanel.id);
        }

        if (activePanel) {
          try {
            const panelChangeEvent = new CustomEvent('quickaccess:panelchange', {
              detail: {
                panelId: activePanel.id,
                button: activeButton
              }
            });
            document.dispatchEvent(panelChangeEvent);
          } catch (error) {
            const fallbackEvent = document.createEvent('CustomEvent');
            fallbackEvent.initCustomEvent(
              'quickaccess:panelchange',
              true,
              true,
              { panelId: activePanel.id, button: activeButton }
            );
            document.dispatchEvent(fallbackEvent);
          }
        }
      }

      function showPanelById(panelId, options) {
        const panel = panels[panelId];
        const button = tabButtons.find(function (candidate) {
          return candidate.getAttribute('data-panel-target') === panelId;
        });

        if (!panel || !button) {
          return false;
        }

        activate(button, panel, options);
        return true;
      }

      function showPanelFromHash(options) {
        const hash = (window.location.hash || '').replace(/^#/, '');
        if (!hash) {
          return false;
        }

        return showPanelById(hash, options);
      }

      function moveToIndex(offset) {
        if (!activeButton) {
          return;
        }

        const currentIndex = tabButtons.indexOf(activeButton);
        if (currentIndex === -1) {
          return;
        }

        const targetIndex = currentIndex + offset;
        if (targetIndex < 0 || targetIndex >= tabButtons.length) {
          return;
        }

        const nextButton = tabButtons[targetIndex];
        if (!nextButton) {
          return;
        }

        const targetId = nextButton.getAttribute('data-panel-target');
        if (targetId) {
          showPanelById(targetId, { focusPanel: true, updateHash: true });
        }
      }

      tabButtons.forEach(function (button) {
        const targetId = button.getAttribute('data-panel-target');
        const panel = panels[targetId];

        if (!targetId || !panel) {
          return;
        }

        if (!button.id) {
          button.id = 'quick-access-tab-' + targetId;
        }

        button.setAttribute('aria-controls', targetId);

        var existingLabel = panel.getAttribute('aria-labelledby') || '';
        var labelTokens = [button.id];

        existingLabel
          .split(/\s+/)
          .filter(function (token) {
            return token && token !== button.id;
          })
          .forEach(function (token) {
            labelTokens.push(token);
          });

        panel.setAttribute('aria-labelledby', labelTokens.join(' '));

        setButtonState(button, false);
        setPanelState(panel, false);

        button.addEventListener('click', function (event) {
          event.preventDefault();
          showPanelById(targetId, { focusPanel: true, updateHash: true });
        });
      });

      if (prevControl) {
        prevControl.addEventListener('click', function (event) {
          event.preventDefault();
          moveToIndex(-1);
        });
      }

      if (nextControl) {
        nextControl.addEventListener('click', function (event) {
          event.preventDefault();
          moveToIndex(1);
        });
      }

      if (!showPanelFromHash({ focusPanel: false, updateHash: false })) {
        const defaultButton = tabButtons.find(function (button) {
          return button.classList.contains('is-active') || button.getAttribute('aria-selected') === 'true';
        }) || tabButtons[0];

        if (defaultButton) {
          const defaultTarget = defaultButton.getAttribute('data-panel-target');
          showPanelById(defaultTarget, { focusPanel: false, updateHash: false });
        }
      }

      window.addEventListener('hashchange', function () {
        showPanelFromHash({ focusPanel: true, updateHash: false });
      });
    }

    function collectMobileStepperElements() {
      mobileStepGroups.clear();
      mobileStepControls.clear();

      const stepNodes = Array.prototype.slice.call(
        document.querySelectorAll('.mobile-step[data-mobile-step-group]')
      );

      stepNodes.forEach(function (stepEl) {
        const group = stepEl.getAttribute('data-mobile-step-group');
        if (!group) {
          return;
        }

        if (!mobileStepGroups.has(group)) {
          mobileStepGroups.set(group, []);
        }

        const indexAttr = stepEl.getAttribute('data-mobile-step-index');
        const parsedIndex = indexAttr != null ? parseInt(indexAttr, 10) : NaN;
        const title = stepEl.getAttribute('data-mobile-step-title') || '';
        const panel = stepEl.getAttribute('data-mobile-step-panel') || '';
        const groupSteps = mobileStepGroups.get(group);
        const index = Number.isFinite(parsedIndex) ? parsedIndex : groupSteps.length + 1;

        groupSteps.push({
          element: stepEl,
          index: index,
          title: title,
          panel: panel
        });

        stepEl.classList.remove('mobile-step-active');
        stepEl.removeAttribute('aria-hidden');
        stepEl.removeAttribute('data-mobile-step-active');
      });

      mobileStepGroups.forEach(function (steps) {
        steps.sort(function (a, b) {
          return a.index - b.index;
        });
      });

      const controlNodes = Array.prototype.slice.call(
        document.querySelectorAll('[data-mobile-step-controls]')
      );

      controlNodes.forEach(function (controlsEl) {
        const group = controlsEl.getAttribute('data-mobile-step-controls');
        if (!group) {
          return;
        }

        if (!mobileStepControls.has(group)) {
          mobileStepControls.set(group, []);
        }

        const controlsEntry = {
          element: controlsEl,
          prevButton: controlsEl.querySelector('[data-mobile-step-prev]'),
          nextButton: controlsEl.querySelector('[data-mobile-step-next]'),
          currentEl: controlsEl.querySelector('[data-mobile-step-current]'),
          totalEl: controlsEl.querySelector('[data-mobile-step-total]'),
          titleEl: controlsEl.querySelector('[data-mobile-step-title]')
        };

        if (!controlsEl.__mobileStepperBound) {
          if (controlsEntry.prevButton) {
            controlsEntry.prevButton.addEventListener('click', function () {
              moveMobileStep(group, -1);
            });
          }

          if (controlsEntry.nextButton) {
            controlsEntry.nextButton.addEventListener('click', function () {
              moveMobileStep(group, 1);
            });
          }

          controlsEl.__mobileStepperBound = true;
        }

        mobileStepControls.get(group).push(controlsEntry);
      });

      mobileStepGroups.forEach(function (steps, group) {
        if (!mobileStepState.has(group)) {
          mobileStepState.set(group, { index: 0 });
        } else {
          const state = mobileStepState.get(group);
          if (state) {
            state.index = Math.min(Math.max(state.index, 0), Math.max(steps.length - 1, 0));
          }
        }
      });
    }

    function updateMobileStepperControls(group, isMobile) {
      const controlsList = mobileStepControls.get(group) || [];
      const steps = mobileStepGroups.get(group) || [];
      const totalSteps = steps.length;
      const state = mobileStepState.get(group) || { index: 0 };
      const currentIndex = Math.min(Math.max(state.index, 0), Math.max(totalSteps - 1, 0));

      controlsList.forEach(function (controls) {
        const element = controls.element;
        const prevButton = controls.prevButton;
        const nextButton = controls.nextButton;
        const currentEl = controls.currentEl;
        const totalEl = controls.totalEl;
        const titleEl = controls.titleEl;

        const shouldShow = Boolean(isMobile && totalSteps > 1);

        if (element) {
          element.setAttribute('aria-hidden', shouldShow ? 'false' : 'true');
        }

        if (currentEl) {
          currentEl.textContent = String(totalSteps === 0 ? 0 : currentIndex + 1);
        }

        if (totalEl) {
          totalEl.textContent = String(totalSteps);
        }

        if (titleEl) {
          titleEl.textContent = steps[currentIndex] ? steps[currentIndex].title : '';
        }

        if (prevButton) {
          const disablePrev = !shouldShow || currentIndex === 0;
          prevButton.disabled = disablePrev;
          prevButton.setAttribute('aria-disabled', disablePrev ? 'true' : 'false');
        }

        if (nextButton) {
          const isLast = currentIndex >= totalSteps - 1;
          const hideNext = !shouldShow || isLast;
          nextButton.disabled = hideNext;
          nextButton.hidden = hideNext;
          nextButton.setAttribute('aria-disabled', hideNext ? 'true' : 'false');
        }
      });
    }

    function applyMobileStepperMode(isMobile) {
      mobileStepperEnabled = Boolean(isMobile);

      mobileStepGroups.forEach(function (steps, group) {
        if (!mobileStepperEnabled) {
          steps.forEach(function (step) {
            step.element.classList.remove('mobile-step-active');
            step.element.removeAttribute('aria-hidden');
            step.element.removeAttribute('data-mobile-step-active');
          });

          updateMobileStepperControls(group, false);
          return;
        }

        const state = mobileStepState.get(group) || { index: 0 };
        const safeIndex = Math.min(Math.max(state.index, 0), Math.max(steps.length - 1, 0));
        mobileStepState.set(group, { index: safeIndex });
        activateMobileStep(group, safeIndex, { scrollIntoView: false });
      });
    }

    function activateMobileStep(group, index, options) {
      if (!mobileStepperEnabled) {
        return;
      }

      const steps = mobileStepGroups.get(group);
      if (!steps || steps.length === 0) {
        return;
      }

      const totalSteps = steps.length;
      const targetIndex = Math.min(Math.max(index, 0), totalSteps - 1);
      mobileStepState.set(group, { index: targetIndex });

      steps.forEach(function (step, stepIndex) {
        if (stepIndex === targetIndex) {
          step.element.classList.add('mobile-step-active');
          step.element.setAttribute('aria-hidden', 'false');
          step.element.setAttribute('data-mobile-step-active', 'true');
        } else {
          step.element.classList.remove('mobile-step-active');
          step.element.setAttribute('aria-hidden', 'true');
          step.element.removeAttribute('data-mobile-step-active');
        }
      });

      updateMobileStepperControls(group, true);

      const activeStep = steps[targetIndex];
      if (activeStep && activeStep.panel) {
        ensureQuickAccessPanelVisible(activeStep.panel);
      }

      if (options && options.scrollIntoView && activeStep && activeStep.element) {
        try {
          activeStep.element.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } catch (error) {
          activeStep.element.scrollIntoView();
        }
      }
    }

    function moveMobileStep(group, offset) {
      if (!mobileStepperEnabled || !offset) {
        return;
      }

      const state = mobileStepState.get(group) || { index: 0 };
      activateMobileStep(group, state.index + offset, { scrollIntoView: true });
    }

    function ensureQuickAccessPanelVisible(panelId) {
      if (!panelId) {
        return;
      }

      const panel = document.getElementById(panelId);
      if (!panel) {
        return;
      }

      if (!panel.hidden) {
        return;
      }

      const button = document.querySelector(
        '.quick-access-item[data-panel-target="' + panelId + '"]'
      );

      if (button && typeof button.click === 'function') {
        button.click();
      }
    }

    function handleQuickAccessPanelChange(event) {
      if (!mobileStepperEnabled || !event) {
        return;
      }

      const detail = event.detail || {};
      const panelId = detail.panelId;

      if (!panelId) {
        return;
      }

      if (panelId === 'card-financial-overview' && mobileStepGroups.has('card-overview')) {
        const state = mobileStepState.get('card-overview') || { index: 0 };
        activateMobileStep('card-overview', state.index, { scrollIntoView: false });
      }

      if (panelId === 'physical-card-request' && mobileStepGroups.has('physical-card')) {
        const state = mobileStepState.get('physical-card') || { index: 0 };
        activateMobileStep('physical-card', state.index, { scrollIntoView: false });
      }
    }

    function initializeMobileStepperSystem() {
      if (typeof window === 'undefined' || typeof document === 'undefined') {
        return;
      }

      collectMobileStepperElements();

      mobileStepperMediaQuery = window.matchMedia(
        '(max-width: ' + MOBILE_STEPPER_BREAKPOINT + 'px)'
      );

      function handleMediaQueryChange(event) {
        applyMobileStepperMode(event.matches);
      }

      if (typeof mobileStepperMediaQuery.addEventListener === 'function') {
        mobileStepperMediaQuery.addEventListener('change', handleMediaQueryChange);
      } else if (typeof mobileStepperMediaQuery.addListener === 'function') {
        mobileStepperMediaQuery.addListener(handleMediaQueryChange);
      }

      applyMobileStepperMode(mobileStepperMediaQuery.matches);

      document.addEventListener('quickaccess:panelchange', handleQuickAccessPanelChange);
    }

    function setupNfcPaymentOverlay() {
      nfcPaymentOverlay = document.getElementById('nfc-payment-overlay');
      nfcPaymentDialogEl = nfcPaymentOverlay ? nfcPaymentOverlay.querySelector('[role="dialog"]') : null;
      nfcPaymentTriggerButton = document.getElementById('nfc-payment-btn');
      nfcPaymentCloseButton = document.getElementById('nfc-payment-close');
      nfcPaymentStatusEl = document.getElementById('nfc-payment-status');
      nfcPaymentNumberEl = document.getElementById('nfc-payment-number');
      nfcPaymentHolderEl = document.getElementById('nfc-payment-holder');
      nfcPaymentExpiryEl = document.getElementById('nfc-payment-expiry');
      nfcPaymentMetaEl = document.getElementById('nfc-payment-meta');
      nfcPaymentReadyLabelText = document.getElementById('nfc-payment-ready-label-text');
      nfcPaymentDescriptionEl = document.getElementById('nfc-payment-description');
      nfcPaymentCardEl = document.getElementById('nfc-payment-card');

      if (nfcPaymentTriggerButton) {
        nfcPaymentTriggerButton.setAttribute('aria-expanded', 'false');
        nfcPaymentTriggerButton.addEventListener('click', showNfcPaymentOverlay);
      }

      if (!nfcPaymentOverlay) {
        return;
      }

      if (nfcPaymentCloseButton) {
        nfcPaymentCloseButton.addEventListener('click', hideNfcPaymentOverlay);
      }

      nfcPaymentOverlay.addEventListener('click', function (event) {
        if (event.target === nfcPaymentOverlay) {
          hideNfcPaymentOverlay();
        }
      });

      if (!nfcOverlayKeydownHandlerRegistered) {
        document.addEventListener('keydown', handleNfcOverlayGlobalKeydown, true);
        nfcOverlayKeydownHandlerRegistered = true;
      }

      syncNfcPaymentCardDisplay();
      updateNfcPaymentStatusBaseline();
    }

    function showNfcPaymentOverlay(event) {
      if (event && typeof event.preventDefault === 'function') {
        event.preventDefault();
      }

      if (!nfcPaymentOverlay || isNfcPaymentOverlayVisible()) {
        return;
      }

      nfcPaymentLastFocus = document.activeElement;

      syncNfcPaymentCardDisplay();

      nfcPaymentOverlay.classList.add('is-visible');
      nfcPaymentOverlay.setAttribute('aria-hidden', 'false');

      if (document.body) {
        document.body.classList.add('nfc-overlay-open');
      }

      applyNfcPreviewState();
      clearNfcStatusSequence();
      startNfcStatusSequence();

      if (nfcPaymentTriggerButton) {
        nfcPaymentTriggerButton.setAttribute('aria-expanded', 'true');
      }

      requestAnimationFrame(function () {
        const focusables = getNfcOverlayFocusableElements();
        if (focusables.length) {
          focusables[0].focus({ preventScroll: true });
        } else if (nfcPaymentDialogEl && typeof nfcPaymentDialogEl.focus === 'function') {
          nfcPaymentDialogEl.focus({ preventScroll: true });
        }
      });
    }

    function hideNfcPaymentOverlay(event) {
      if (event && typeof event.preventDefault === 'function') {
        event.preventDefault();
      }

      if (!nfcPaymentOverlay || !isNfcPaymentOverlayVisible()) {
        return;
      }

      nfcPaymentOverlay.classList.remove('is-visible');
      nfcPaymentOverlay.setAttribute('aria-hidden', 'true');

      if (document.body) {
        document.body.classList.remove('nfc-overlay-open');
      }

      if (nfcPaymentTriggerButton) {
        nfcPaymentTriggerButton.setAttribute('aria-expanded', 'false');
      }

      resetNfcPreviewState();
      clearNfcStatusSequence();
      updateNfcPaymentStatusBaseline();

      if (nfcPaymentLastFocus && typeof nfcPaymentLastFocus.focus === 'function') {
        nfcPaymentLastFocus.focus({ preventScroll: true });
      }

      nfcPaymentLastFocus = null;
    }

    function applyNfcPreviewState() {
      const cardDisplay = document.getElementById('card-display');
      if (cardDisplay) {
        cardDisplay.classList.add('nfc-preview-active');
      }

      const indicator = document.getElementById('nfc-indicator');
      if (indicator && nfcPaymentOverlay) {
        const wasActive = indicator.classList.contains('active');
        nfcPaymentOverlay.dataset.indicatorWasActive = wasActive ? 'true' : 'false';
        indicator.classList.add('active');
        indicator.setAttribute('aria-hidden', 'false');
      }
    }

    function resetNfcPreviewState() {
      const cardDisplay = document.getElementById('card-display');
      if (cardDisplay) {
        cardDisplay.classList.remove('nfc-preview-active');
      }

      const indicator = document.getElementById('nfc-indicator');
      if (indicator && nfcPaymentOverlay) {
        const shouldRemainActive = nfcPaymentOverlay.dataset.indicatorWasActive === 'true';
        if (!shouldRemainActive) {
          indicator.classList.remove('active');
          indicator.setAttribute('aria-hidden', 'true');
        }
        delete nfcPaymentOverlay.dataset.indicatorWasActive;
      }
    }

    function syncNfcPaymentCardDisplay() {
      if (!nfcPaymentOverlay) {
        return;
      }

      const showData = Boolean(cardState.showData);
      const holderName = (CONFIG.CARD_DATA.holder || DEFAULT_CARD_DATA.holder || '').trim() || DEFAULT_CARD_DATA.holder;
      const formattedNumber = showData ? formatCardNumber(CONFIG.CARD_DATA.number) : '•••• •••• •••• ••••';
      const formattedExpiry = showData ? CONFIG.CARD_DATA.expiry : '••/••';

      if (nfcPaymentNumberEl) {
        nfcPaymentNumberEl.textContent = formattedNumber;
      }

      if (nfcPaymentHolderEl) {
        nfcPaymentHolderEl.textContent = holderName;
      }

      if (nfcPaymentExpiryEl) {
        nfcPaymentExpiryEl.textContent = formattedExpiry;
      }

      const sanitizedNumber = (CONFIG.CARD_DATA.number || '').replace(/\D/g, '');
      const lastDigits = sanitizedNumber.slice(-4) || '—';
      const statusEl = document.getElementById('card-status');
      const statusText = statusEl ? statusEl.textContent.trim() : CONFIG.CARD_DATA.status === 'frozen' ? 'Congelada' : 'Activa';

      if (nfcPaymentMetaEl) {
        nfcPaymentMetaEl.textContent = 'Titular: ' + holderName + ' · Terminación ' + lastDigits + ' · Estado: ' + statusText;
      }

      const isFrozen = CONFIG.CARD_DATA.status === 'frozen';
      const isNfcEnabled = Boolean(cardState.nfcEnabled);

      if (nfcPaymentReadyLabelText) {
        if (isFrozen) {
          nfcPaymentReadyLabelText.textContent = 'Tarjeta congelada';
        } else if (isNfcEnabled) {
          nfcPaymentReadyLabelText.textContent = 'NFC activo';
        } else {
          nfcPaymentReadyLabelText.textContent = 'Activando NFC';
        }
      }

      nfcPaymentOverlay.dataset.nfcEnabled = isNfcEnabled ? 'true' : 'false';
      nfcPaymentOverlay.dataset.cardStatus = CONFIG.CARD_DATA.status || 'active';

      if (nfcPaymentCardEl) {
        nfcPaymentCardEl.classList.toggle('is-disabled', isFrozen);
      }

      updateNfcPaymentDescription(isFrozen);

      if (!isNfcPaymentOverlayVisible()) {
        updateNfcPaymentStatusBaseline();
      }
    }

    function updateNfcPaymentDescription(isFrozen) {
      if (!nfcPaymentDescriptionEl) {
        return;
      }

      nfcPaymentDescriptionEl.textContent = isFrozen
        ? NFC_PAYMENT_FROZEN_DESCRIPTION
        : NFC_PAYMENT_DEFAULT_DESCRIPTION;
    }

    function updateNfcPaymentStatusBaseline() {
      if (!nfcPaymentStatusEl) {
        return;
      }

      nfcPaymentStatusEl.classList.remove('is-ready');

      if (CONFIG.CARD_DATA.status === 'frozen') {
        nfcPaymentStatusEl.textContent = NFC_PAYMENT_SEQUENCE_FROZEN[0];
        return;
      }

      if (cardState.nfcEnabled) {
        nfcPaymentStatusEl.textContent = 'NFC listo para presentar en terminal.';
      } else {
        nfcPaymentStatusEl.textContent = 'Activa el NFC para pagar sin contacto.';
      }
    }

    function buildNfcStatusSequence() {
      if (CONFIG.CARD_DATA.status === 'frozen') {
        return NFC_PAYMENT_SEQUENCE_FROZEN.slice();
      }

      if (cardState.nfcEnabled) {
        return NFC_PAYMENT_SEQUENCE_ACTIVE.slice();
      }

      return NFC_PAYMENT_SEQUENCE_INACTIVE.slice();
    }

    function startNfcStatusSequence() {
      if (!nfcPaymentStatusEl) {
        return;
      }

      const sequence = buildNfcStatusSequence();
      clearNfcStatusSequence();

      sequence.forEach(function (message, index) {
        const timer = setTimeout(function () {
          if (!nfcPaymentStatusEl) {
            return;
          }

          nfcPaymentStatusEl.textContent = message;

          if (index === sequence.length - 1 && CONFIG.CARD_DATA.status === 'active') {
            nfcPaymentStatusEl.classList.add('is-ready');
          } else {
            nfcPaymentStatusEl.classList.remove('is-ready');
          }
        }, index * NFC_PAYMENT_STATUS_INTERVAL);

        nfcPaymentStatusTimers.push(timer);
      });
    }

    function clearNfcStatusSequence() {
      while (nfcPaymentStatusTimers.length) {
        clearTimeout(nfcPaymentStatusTimers.pop());
      }

      if (nfcPaymentStatusEl) {
        nfcPaymentStatusEl.classList.remove('is-ready');
      }
    }

    function handleNfcOverlayGlobalKeydown(event) {
      if (!isNfcPaymentOverlayVisible()) {
        return;
      }

      if (event.key === 'Escape') {
        event.preventDefault();
        hideNfcPaymentOverlay();
        return;
      }

      if (event.key !== 'Tab') {
        return;
      }

      const focusables = getNfcOverlayFocusableElements();
      if (!focusables.length) {
        event.preventDefault();
        return;
      }

      const first = focusables[0];
      const last = focusables[focusables.length - 1];
      const activeElement = document.activeElement;

      if (event.shiftKey) {
        if (activeElement === first || !nfcPaymentOverlay.contains(activeElement)) {
          event.preventDefault();
          last.focus();
        }
      } else if (activeElement === last) {
        event.preventDefault();
        first.focus();
      }
    }

    function getNfcOverlayFocusableElements() {
      if (!nfcPaymentOverlay) {
        return [];
      }

      const elements = nfcPaymentOverlay.querySelectorAll(
        'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
      );

      return Array.prototype.slice
        .call(elements)
        .filter(function (element) {
          if (element.hasAttribute('disabled')) {
            return false;
          }

          if (element.getAttribute('aria-hidden') === 'true') {
            return false;
          }

          return element.tabIndex >= 0;
        });
    }

    function isNfcPaymentOverlayVisible() {
      return Boolean(nfcPaymentOverlay && nfcPaymentOverlay.classList.contains('is-visible'));
    }

    function initializePhysicalCardRequest() {
      physicalCardRequestState = loadPhysicalCardRequestState();

      physicalCardForm = document.getElementById('physical-card-form');
      physicalCardStatusEl = document.getElementById('physical-card-status');
      physicalCardConfirmationEl = document.getElementById('physical-card-confirmation');
      physicalCardDeliveryTextEl = document.getElementById('physical-card-delivery-text');
      physicalCardRequestDateEl = document.getElementById('physical-card-requested-at');
      physicalCardSummaryNameEl = document.getElementById('physical-card-summary-name');
      physicalCardSummaryAddressEl = document.getElementById('physical-card-summary-address');
      physicalCardSummaryCityEl = document.getElementById('physical-card-summary-city');
      physicalCardSummaryPostalEl = document.getElementById('physical-card-summary-postal');
      physicalCardSummaryCountryEl = document.getElementById('physical-card-summary-country');
      physicalCardSummaryInstructionsEl = document.getElementById('physical-card-summary-instructions');
      physicalCardEditButton = document.getElementById('physical-card-edit-btn');
      physicalCardEditLabel = document.getElementById('physical-card-edit-label');
      physicalCardSubmitButton = document.getElementById('physical-card-submit-btn');
      physicalCardSubmitLabel = document.getElementById('physical-card-submit-label');

      physicalCardFields = {
        fullName: document.getElementById('physical-card-full-name'),
        address1: document.getElementById('physical-card-address-line1'),
        address2: document.getElementById('physical-card-address-line2'),
        city: document.getElementById('physical-card-city'),
        state: document.getElementById('physical-card-state'),
        postalCode: document.getElementById('physical-card-postal-code'),
        country: document.getElementById('physical-card-country'),
        instructions: document.getElementById('physical-card-instructions')
      };

      if (!physicalCardForm) {
        return;
      }

      if (typeof physicalCardForm.addEventListener === 'function') {
        physicalCardForm.addEventListener('submit', handlePhysicalCardSubmit);
      }

      if (physicalCardEditButton && typeof physicalCardEditButton.addEventListener === 'function') {
        physicalCardEditButton.addEventListener('click', handlePhysicalCardEditToggle);
      }

      updatePhysicalCardUI();
    }

    function loadPhysicalCardRequestState() {
      if (typeof localStorage === 'undefined') {
        return Object.assign({}, DEFAULT_PHYSICAL_CARD_REQUEST);
      }

      try {
        const storedValue = localStorage.getItem(PHYSICAL_CARD_STORAGE_KEY);
        if (!storedValue) {
          return Object.assign({}, DEFAULT_PHYSICAL_CARD_REQUEST);
        }

        const parsedValue = JSON.parse(storedValue);
        if (!parsedValue || typeof parsedValue !== 'object') {
          return Object.assign({}, DEFAULT_PHYSICAL_CARD_REQUEST);
        }

        return normalizePhysicalCardRequest(parsedValue);
      } catch (error) {
        console.warn('No se pudo cargar la solicitud de tarjeta física:', error);
        return Object.assign({}, DEFAULT_PHYSICAL_CARD_REQUEST);
      }
    }

    function savePhysicalCardRequestState() {
      if (typeof localStorage === 'undefined') {
        return;
      }

      try {
        const payload = preparePhysicalCardStateForStorage(physicalCardRequestState);
        localStorage.setItem(PHYSICAL_CARD_STORAGE_KEY, JSON.stringify(payload));
      } catch (error) {
        console.warn('No se pudo guardar la solicitud de tarjeta física:', error);
      }
    }

    function preparePhysicalCardStateForStorage(state) {
      if (!state) {
        return Object.assign({}, DEFAULT_PHYSICAL_CARD_REQUEST);
      }

      return normalizePhysicalCardRequest(state);
    }

    function handlePhysicalCardSubmit(event) {
      if (event && typeof event.preventDefault === 'function') {
        event.preventDefault();
      }

      if (!physicalCardForm) {
        return;
      }

      if (typeof physicalCardForm.reportValidity === 'function' && !physicalCardForm.reportValidity()) {
        return;
      }

      const formData = new FormData(physicalCardForm);

      const requestPayload = {
        requested: true,
        fullName: formData.get('physicalCardFullName'),
        addressLine1: formData.get('physicalCardAddress1'),
        addressLine2: formData.get('physicalCardAddress2'),
        city: formData.get('physicalCardCity'),
        stateProvince: formData.get('physicalCardState'),
        postalCode: formData.get('physicalCardPostalCode'),
        country: formData.get('physicalCardCountry'),
        instructions: formData.get('physicalCardInstructions')
      };

      const submittedAt = new Date();
      const estimatedDeliveryDate = computeDeliveryEstimate(submittedAt, PHYSICAL_CARD_DELIVERY_DAYS);

      requestPayload.submittedAt = submittedAt.toISOString();
      requestPayload.estimatedDelivery = estimatedDeliveryDate.toISOString();

      physicalCardRequestState = normalizePhysicalCardRequest(requestPayload);
      physicalCardEditMode = false;

      savePhysicalCardRequestState();
      updatePhysicalCardUI();

      const confirmationMessage = buildPhysicalCardDeliveryMessage(physicalCardRequestState);
      if (typeof showToast === 'function') {
        showToast('success', 'Solicitud enviada', withValidationReminder(confirmationMessage));
      }

      if (physicalCardConfirmationEl && !physicalCardConfirmationEl.hidden) {
        if (typeof physicalCardConfirmationEl.scrollIntoView === 'function') {
          physicalCardConfirmationEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        const focusTarget = physicalCardConfirmationEl.querySelector('[data-physical-card-focus]');
        if (focusTarget && typeof focusTarget.focus === 'function') {
          focusTarget.focus();
        }
      }
    }

    function handlePhysicalCardEditToggle(event) {
      if (event && typeof event.preventDefault === 'function') {
        event.preventDefault();
      }

      if (!physicalCardRequestState.requested) {
        return;
      }

      physicalCardEditMode = !physicalCardEditMode;

      if (!physicalCardEditMode && physicalCardForm && typeof physicalCardForm.reset === 'function') {
        physicalCardForm.reset();
      }

      updatePhysicalCardUI();
    }

    function updatePhysicalCardUI() {
      if (!physicalCardForm) {
        return;
      }

      const isRequested = Boolean(physicalCardRequestState.requested);
      const isEditing = physicalCardEditMode && isRequested;

      if (isRequested && !isEditing) {
        updatePhysicalCardSummary(physicalCardRequestState);
      }

      if (!isRequested || isEditing) {
        populatePhysicalCardFormValues(physicalCardRequestState);
      }

      if (physicalCardSubmitButton) {
        physicalCardSubmitButton.disabled = isRequested && !isEditing;
      }

      if (physicalCardSubmitLabel) {
        physicalCardSubmitLabel.textContent = isEditing ? 'Guardar cambios' : 'Solicitar tarjeta física';
      }

      physicalCardForm.hidden = isRequested && !isEditing;
      physicalCardForm.setAttribute('aria-hidden', isRequested && !isEditing ? 'true' : 'false');

      if (physicalCardConfirmationEl) {
        const shouldShowConfirmation = isRequested && !isEditing;
        physicalCardConfirmationEl.hidden = !shouldShowConfirmation;
        physicalCardConfirmationEl.setAttribute('aria-hidden', shouldShowConfirmation ? 'false' : 'true');
      }

      if (physicalCardEditButton) {
        physicalCardEditButton.hidden = !isRequested;
        physicalCardEditButton.setAttribute('aria-pressed', isEditing ? 'true' : 'false');

        const editLabel = physicalCardEditLabel || physicalCardEditButton;
        if (editLabel) {
          editLabel.textContent = isEditing ? 'Cancelar edición' : 'Editar solicitud';
        }
      }

      if (physicalCardStatusEl) {
        physicalCardStatusEl.classList.remove('is-requested', 'is-editing');
        let statusText = 'Tarjeta física pendiente';
        let stateValue = 'pending';

        if (isRequested && !isEditing) {
          const etaLabel = formatDateForShort(physicalCardRequestState.estimatedDelivery);
          statusText = etaLabel
            ? 'Solicitud enviada · Entrega estimada: ' + etaLabel
            : 'Solicitud enviada · Entrega estimada en ' + PHYSICAL_CARD_DELIVERY_DAYS + ' días';
          physicalCardStatusEl.classList.add('is-requested');
          stateValue = 'requested';
        } else if (isEditing) {
          statusText = 'Editando datos de envío';
          physicalCardStatusEl.classList.add('is-editing');
          stateValue = 'editing';
        }

        physicalCardStatusEl.textContent = statusText;
        physicalCardStatusEl.setAttribute('data-state', stateValue);
      }

      if (physicalCardDeliveryTextEl) {
        if (isRequested && !isEditing) {
          physicalCardDeliveryTextEl.textContent = buildPhysicalCardDeliveryMessage(physicalCardRequestState);
        } else {
          physicalCardDeliveryTextEl.textContent = '';
        }
      }

      if (physicalCardRequestDateEl) {
        if (isRequested && !isEditing) {
          const requestDate = formatDateTimeForHumans(physicalCardRequestState.submittedAt);
          if (requestDate) {
            physicalCardRequestDateEl.textContent = 'Solicitud realizada el ' + requestDate;
            physicalCardRequestDateEl.hidden = false;
          } else {
            physicalCardRequestDateEl.textContent = '';
            physicalCardRequestDateEl.hidden = true;
          }
        } else {
          physicalCardRequestDateEl.textContent = '';
          physicalCardRequestDateEl.hidden = true;
        }
      }
    }

    function populatePhysicalCardFormValues(state) {
      const safeState = state || DEFAULT_PHYSICAL_CARD_REQUEST;

      if (physicalCardFields.fullName) {
        const fallbackName =
          safeState.fullName ||
          (CONFIG && CONFIG.CARD_DATA && CONFIG.CARD_DATA.holder ? CONFIG.CARD_DATA.holder : '');
        physicalCardFields.fullName.value = fallbackName;
      }

      if (physicalCardFields.address1) {
        physicalCardFields.address1.value = safeState.addressLine1 || '';
      }

      if (physicalCardFields.address2) {
        physicalCardFields.address2.value = safeState.addressLine2 || '';
      }

      if (physicalCardFields.city) {
        physicalCardFields.city.value = safeState.city || '';
      }

      if (physicalCardFields.state) {
        physicalCardFields.state.value = safeState.stateProvince || '';
      }

      if (physicalCardFields.postalCode) {
        physicalCardFields.postalCode.value = safeState.postalCode || '';
      }

      if (physicalCardFields.country) {
        if (safeState.country) {
          physicalCardFields.country.value = safeState.country;
          if (physicalCardFields.country.value !== safeState.country) {
            const hasExistingOption = Array.prototype.some.call(
              physicalCardFields.country.options || [],
              function (option) {
                return option && option.value === safeState.country;
              }
            );
            if (!hasExistingOption) {
              const option = document.createElement('option');
              option.value = safeState.country;
              option.textContent = safeState.country;
              physicalCardFields.country.appendChild(option);
            }
            physicalCardFields.country.value = safeState.country;
          }
        } else if (physicalCardFields.country.options && physicalCardFields.country.options.length > 0) {
          physicalCardFields.country.selectedIndex = 0;
        } else {
          physicalCardFields.country.value = '';
        }
      }

      if (physicalCardFields.instructions) {
        physicalCardFields.instructions.value = safeState.instructions || '';
      }
    }

    function updatePhysicalCardSummary(state) {
      if (!state || !state.requested) {
        return;
      }

      setSummaryField(physicalCardSummaryNameEl, state.fullName);
      setSummaryField(
        physicalCardSummaryAddressEl,
        joinNonEmptyParts([state.addressLine1, state.addressLine2], ', ')
      );
      setSummaryField(
        physicalCardSummaryCityEl,
        joinNonEmptyParts([state.city, state.stateProvince], ', ')
      );
      setSummaryField(physicalCardSummaryPostalEl, state.postalCode);
      setSummaryField(physicalCardSummaryCountryEl, state.country);
      setSummaryField(
        physicalCardSummaryInstructionsEl,
        state.instructions || 'Sin comentarios adicionales',
        !state.instructions
      );
    }

    function buildPhysicalCardDeliveryMessage(state) {
      if (!state || !state.requested) {
        return 'Tu tarjeta física llegará en aproximadamente ' + PHYSICAL_CARD_DELIVERY_DAYS + ' días.';
      }

      const etaText = formatDateForHumans(state.estimatedDelivery);
      if (etaText) {
        return 'Tu tarjeta física llegará aproximadamente el ' + etaText + '.';
      }

      return 'Tu tarjeta física llegará en aproximadamente ' + PHYSICAL_CARD_DELIVERY_DAYS + ' días.';
    }

    function normalizePhysicalCardRequest(entry) {
      const normalized = Object.assign({}, DEFAULT_PHYSICAL_CARD_REQUEST);

      if (!entry || typeof entry !== 'object') {
        return normalized;
      }

      normalized.requested = Boolean(entry.requested);
      normalized.fullName = sanitizeShippingField(entry.fullName, 80);
      normalized.addressLine1 = sanitizeShippingField(entry.addressLine1 || entry.address1, 120);
      normalized.addressLine2 = sanitizeShippingField(entry.addressLine2, 120);
      normalized.city = sanitizeShippingField(entry.city, 60);
      normalized.stateProvince = sanitizeShippingField(entry.stateProvince || entry.state || entry.region, 60);
      normalized.postalCode = sanitizeShippingField(entry.postalCode, 20, { uppercase: true });
      normalized.country = sanitizeShippingField(entry.country, 60);
      normalized.instructions = sanitizeShippingField(entry.instructions, 220);
      normalized.submittedAt = sanitizeIsoString(entry.submittedAt);
      normalized.estimatedDelivery = sanitizeIsoString(entry.estimatedDelivery);

      return normalized;
    }

    function sanitizeIsoString(value) {
      const date = parseDateInput(value);
      if (!date) {
        return null;
      }

      try {
        return date.toISOString();
      } catch (error) {
        return null;
      }
    }

    function sanitizeShippingField(value, maxLength, options) {
      if (typeof value !== 'string') {
        return '';
      }

      let cleaned = value.replace(/[<>]/g, '').replace(/[\r\n]+/g, ' ').trim();
      if (!cleaned) {
        return '';
      }

      if (maxLength && cleaned.length > maxLength) {
        cleaned = cleaned.slice(0, maxLength);
      }

      if (options && options.uppercase) {
        cleaned = cleaned.toUpperCase();
      }

      return cleaned;
    }

    function joinNonEmptyParts(parts, separator) {
      if (!Array.isArray(parts)) {
        return '';
      }

      const filtered = parts
        .map(function (entry) {
          return typeof entry === 'string' ? entry.trim() : '';
        })
        .filter(function (entry) {
          return entry !== '';
        });

      return filtered.join(separator || ', ');
    }

    function setSummaryField(element, value, markAsEmpty) {
      if (!element) {
        return;
      }

      const normalized = typeof value === 'string' ? value.trim() : '';
      const isEmpty = Boolean(markAsEmpty) || normalized === '';

      element.textContent = isEmpty ? normalized || '—' : normalized;
      element.classList.toggle('empty', isEmpty);
    }

    function computeDeliveryEstimate(baseDate, days) {
      const base = parseDateInput(baseDate) || new Date();
      const safeDays = Number.isFinite(days) ? days : PHYSICAL_CARD_DELIVERY_DAYS;
      const estimate = new Date(base.getTime());
      estimate.setHours(12, 0, 0, 0);
      estimate.setDate(estimate.getDate() + safeDays);
      return estimate;
    }

    function formatDateForHumans(value) {
      const date = parseDateInput(value);
      if (!date) {
        return '';
      }

      try {
        return date.toLocaleDateString('es-ES', {
          day: '2-digit',
          month: 'long',
          year: 'numeric'
        });
      } catch (error) {
        return formatDateForShort(date);
      }
    }

    function formatDateForShort(value) {
      const date = parseDateInput(value);
      if (!date) {
        return '';
      }

      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = String(date.getFullYear());
      return day + '/' + month + '/' + year;
    }

    function formatDateTimeForHumans(value) {
      const date = parseDateInput(value);
      if (!date) {
        return '';
      }

      try {
        return date.toLocaleString('es-ES', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
      } catch (error) {
        const baseDate = formatDateForShort(date);
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        return baseDate ? baseDate + ' ' + hours + ':' + minutes : hours + ':' + minutes;
      }
    }

    function parseDateInput(value) {
      if (value instanceof Date) {
        return new Date(value.getTime());
      }

      if (typeof value === 'number' && Number.isFinite(value)) {
        return new Date(value);
      }

      if (typeof value !== 'string') {
        return null;
      }

      const trimmed = value.trim();
      if (!trimmed) {
        return null;
      }

      const timestamp = Date.parse(trimmed);
      if (Number.isNaN(timestamp)) {
        return null;
      }

      const date = new Date(timestamp);
      return Number.isNaN(date.getTime()) ? null : date;
    }


    function initializeAppConnections() {
      appConnectionsState = loadAppConnectionsState();

      const connectionCards = document.querySelectorAll('.integration-card[data-app-id]');
      if (!connectionCards || connectionCards.length === 0) {
        return;
      }

      connectionCards.forEach(function (card) {
        if (!card) {
          return;
        }

        const appId = card.getAttribute('data-app-id');
        if (!appId) {
          return;
        }

        const actionButton = card.querySelector('[data-app-action]');
        const statusEl = card.querySelector('[data-status-label]');

        updateAppConnectionUI(appId, actionButton, statusEl, card);

        if (!actionButton || typeof actionButton.addEventListener !== 'function') {
          return;
        }

        if (actionButton.dataset.connectionInitialized === 'true') {
          return;
        }

        actionButton.dataset.connectionInitialized = 'true';

        actionButton.addEventListener('click', function (event) {
          if (event && typeof event.preventDefault === 'function') {
            event.preventDefault();
          }

          toggleAppConnection(appId, actionButton, statusEl, card);
        });
      });
    }

    function loadAppConnectionsState() {
      if (typeof localStorage === 'undefined') {
        return {};
      }

      try {
        const storedValue = localStorage.getItem(CONNECTION_STORAGE_KEY);
        if (!storedValue) {
          return {};
        }

        const parsedValue = JSON.parse(storedValue);
        if (!parsedValue || typeof parsedValue !== 'object') {
          return {};
        }

        const normalized = {};
        Object.keys(parsedValue).forEach(function (key) {
          normalized[key] = Boolean(parsedValue[key]);
        });

        return normalized;
      } catch (error) {
        console.warn('No se pudieron cargar las conexiones guardadas:', error);
        return {};
      }
    }

    function saveAppConnectionsState() {
      if (typeof localStorage === 'undefined') {
        return;
      }

      try {
        localStorage.setItem(CONNECTION_STORAGE_KEY, JSON.stringify(appConnectionsState));
      } catch (error) {
        console.warn('No se pudieron guardar las conexiones:', error);
      }
    }

    function toggleAppConnection(appId, actionButton, statusEl, card) {
      if (!appId) {
        return;
      }

      const currentState = Boolean(appConnectionsState[appId]);
      const nextState = !currentState;
      appConnectionsState[appId] = nextState;

      saveAppConnectionsState();
      updateAppConnectionUI(appId, actionButton, statusEl, card);

      const config = APP_CONNECTION_CONFIG[appId] || {};
      const platformName = config.name || 'la plataforma';
      const message = nextState
        ? config.connectMessage || 'Tu tarjeta se vinculó con ' + platformName + '.'
        : config.disconnectMessage || 'Se desactivó la conexión con ' + platformName + '.';

      const toastType = nextState ? 'success' : 'info';
      const toastTitle = nextState ? 'Integración activada' : 'Integración desactivada';
      const toastMessage = withValidationReminder(message);

      if (typeof showToast === 'function') {
        showToast(toastType, toastTitle, toastMessage);
      }
    }

    function updateAppConnectionUI(appId, actionButton, statusEl, card) {
      const isConnected = Boolean(appConnectionsState[appId]);

      if (card) {
        card.classList.toggle('is-connected', isConnected);
        card.setAttribute('data-connection-state', isConnected ? 'connected' : 'disconnected');
      }

      if (statusEl) {
        statusEl.textContent = isConnected ? 'Vinculado' : 'Sin vincular';
        statusEl.classList.toggle('connected', isConnected);
        statusEl.setAttribute('data-status', isConnected ? 'connected' : 'disconnected');
      }

      if (actionButton) {
        const labelEl = actionButton.querySelector('.integration-action-label');
        const nextLabel = isConnected ? 'Desvincular' : 'Vincular';

        if (labelEl) {
          labelEl.textContent = nextLabel;
        } else {
          actionButton.textContent = nextLabel;
        }

        actionButton.classList.toggle('is-connected', isConnected);
        actionButton.setAttribute('aria-pressed', isConnected ? 'true' : 'false');
      }
    }

    function refreshAppConnectionsUI() {
      const connectionCards = document.querySelectorAll('.integration-card[data-app-id]');
      if (!connectionCards || connectionCards.length === 0) {
        return;
      }

      connectionCards.forEach(function (card) {
        if (!card) {
          return;
        }

        const appId = card.getAttribute('data-app-id');
        if (!appId) {
          return;
        }

        const actionButton = card.querySelector('[data-app-action]');
        const statusEl = card.querySelector('[data-status-label]');

        updateAppConnectionUI(appId, actionButton, statusEl, card);
      });
    }

    function setupLimitInputs() {
      Object.keys(LIMIT_TYPE_CONFIG).forEach(function (type) {
        const config = LIMIT_TYPE_CONFIG[type];
        if (!config) {
          return;
        }

        const input = document.getElementById(config.inputId);
        if (!input) {
          return;
        }

        input.addEventListener('change', function (event) {
          handleLimitInput(type, event.target.value);
        });

        input.addEventListener('blur', function () {
          syncLimitInputValue(type);
        });
      });

      updateLimitControls();
    }

    function setupTravelNoticeFeature() {
      travelNoticeModal = document.getElementById('travel-notice-modal');
      travelNoticeBackdrop = document.getElementById('travel-notice-backdrop');
      travelNoticeForm = document.getElementById('travel-notice-form');
      travelDestinationInput = document.getElementById('travel-destination');
      travelStartInput = document.getElementById('travel-start-date');
      travelEndInput = document.getElementById('travel-end-date');
      travelNoticeBadge = document.getElementById('travel-notice-badge');

      const openButton = document.getElementById('travel-notification-btn');
      if (openButton) {
        openButton.addEventListener('click', openTravelNoticeModal);
      }

      const cancelButton = document.getElementById('travel-notice-cancel-btn');
      if (cancelButton) {
        cancelButton.addEventListener('click', function (event) {
          if (event && typeof event.preventDefault === 'function') {
            event.preventDefault();
          }

          closeTravelNoticeModal();
        });
      }

      const closeButton = document.getElementById('travel-notice-close-btn');
      if (closeButton) {
        closeButton.addEventListener('click', function (event) {
          if (event && typeof event.preventDefault === 'function') {
            event.preventDefault();
          }

          closeTravelNoticeModal();
        });
      }

      if (travelNoticeBackdrop) {
        travelNoticeBackdrop.addEventListener('click', closeTravelNoticeModal);
      }

      if (travelNoticeForm) {
        travelNoticeForm.addEventListener('submit', handleTravelNoticeSubmit);
      }

      if (travelStartInput) {
        travelStartInput.addEventListener('change', syncTravelEndDateBounds);
      }

      updateTravelNoticeUI();
    }

    function setupCopyButtons() {
      const copyButtons = document.querySelectorAll('.card-panel [data-copy-target]');
      if (!copyButtons || copyButtons.length === 0) {
        return;
      }

      copyButtons.forEach(function (button) {
        if (!button || typeof button.addEventListener !== 'function') {
          return;
        }

        if (button.dataset.copyInitialized === 'true') {
          return;
        }

        button.dataset.copyInitialized = 'true';

        button.addEventListener('click', function (event) {
          if (event && typeof event.preventDefault === 'function') {
            event.preventDefault();
          }

          handleCopyButtonClick(button);
        });
      });
    }

    function handleCopyButtonClick(button) {
      if (!button) {
        return;
      }

      const target = button.getAttribute('data-copy-target');
      if (!target) {
        return;
      }

      const label = button.getAttribute('data-copy-label');
      const normalizedLabel = typeof label === 'string' && label ? label.toLowerCase() : '';
      const successTitle = button.getAttribute('data-copy-success-title') || 'Dato copiado';
      const successMessage =
        button.getAttribute('data-copy-success-message') ||
        (normalizedLabel ? 'Se copió ' + normalizedLabel + ' al portapapeles.' : 'El dato se copió al portapapeles.');

      const value = getCardDataForCopy(target);
      const textToCopy = typeof value === 'string' ? value.trim() : '';

      if (!textToCopy) {
        showToast('error', 'Dato no disponible', 'No hay información para copiar en este momento.');
        return;
      }

      copyTextToClipboard(textToCopy)
        .then(function () {
          showToast('success', successTitle, withValidationReminder(successMessage));
          animateCopyFeedback(button);
        })
        .catch(function (error) {
          console.warn('No se pudo copiar el texto al portapapeles:', error);
          showToast('error', 'No se pudo copiar', 'Tu navegador no permitió copiar el contenido.');
        });
    }

    function getCardDataForCopy(target) {
      if (!CONFIG || !CONFIG.CARD_DATA) {
        return '';
      }

      const cardData = CONFIG.CARD_DATA;

      switch (target) {
        case 'number':
          return formatCardNumber(cardData.number);
        case 'cvv':
          return cardData.cvv || '';
        case 'expiry':
          return cardData.expiry || '';
        case 'holder':
          return cardData.holder || '';
        case 'all':
          return buildCardDetailsString(cardData);
        default:
          return '';
      }
    }

    function buildCardDetailsString(cardData) {
      if (!cardData) {
        return '';
      }

      const sections = [];
      const formattedNumber = formatCardNumber(cardData.number);

      if (formattedNumber) {
        sections.push('Número: ' + formattedNumber);
      }

      if (cardData.holder) {
        sections.push('Titular: ' + cardData.holder);
      }

      if (cardData.expiry) {
        sections.push('Vencimiento: ' + cardData.expiry);
      }

      if (cardData.cvv) {
        sections.push('CVV: ' + cardData.cvv);
      }

      return sections.join('\n');
    }

    function copyTextToClipboard(text) {
      if (!text) {
        return Promise.reject(new Error('Texto vacío'));
      }

      if (
        typeof navigator !== 'undefined' &&
        navigator.clipboard &&
        typeof navigator.clipboard.writeText === 'function'
      ) {
        return navigator.clipboard.writeText(text);
      }

      return new Promise(function (resolve, reject) {
        if (typeof document === 'undefined' || !document.body) {
          reject(new Error('Clipboard API no disponible'));
          return;
        }

        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.setAttribute('readonly', '');
        textarea.style.position = 'fixed';
        textarea.style.top = '0';
        textarea.style.left = '-9999px';
        textarea.style.opacity = '0';

        document.body.appendChild(textarea);

        let copyError = null;

        try {
          textarea.focus();
          textarea.select();
          const succeeded = typeof document.execCommand === 'function' && document.execCommand('copy');
          if (!succeeded) {
            copyError = new Error('execCommand falló');
          }
        } catch (error) {
          copyError = error;
        }

        textarea.remove();

        if (copyError) {
          reject(copyError);
        } else {
          resolve();
        }
      });
    }

    function animateCopyFeedback(button) {
      if (!button) {
        return;
      }

      button.classList.add('is-copied');

      setTimeout(function () {
        button.classList.remove('is-copied');
      }, 400);
    }

    function openTravelNoticeModal() {
      if (!travelNoticeModal) {
        travelNoticeModal = document.getElementById('travel-notice-modal');
      }

      if (!travelNoticeModal) {
        return;
      }

      if (travelModalCloseTimeout) {
        clearTimeout(travelModalCloseTimeout);
        travelModalCloseTimeout = null;
      }

      travelModalLastFocus = document.activeElement;

      if (!travelNoticeBackdrop) {
        travelNoticeBackdrop = document.getElementById('travel-notice-backdrop');
      }

      if (travelNoticeBackdrop) {
        travelNoticeBackdrop.hidden = false;
        requestAnimationFrame(function () {
          travelNoticeBackdrop.classList.add('is-visible');
        });
      }

      initializeTravelNoticeFormValues();

      travelNoticeModal.hidden = false;
      travelNoticeModal.setAttribute('aria-hidden', 'false');

      requestAnimationFrame(function () {
        travelNoticeModal.classList.add('is-visible');
        if (travelDestinationInput && typeof travelDestinationInput.focus === 'function') {
          travelDestinationInput.focus();
          if (typeof travelDestinationInput.select === 'function') {
            travelDestinationInput.select();
          }
        }
      });

      document.addEventListener('keydown', handleTravelNoticeKeydown, true);
    }

    function closeTravelNoticeModal() {
      if (!travelNoticeModal) {
        travelNoticeModal = document.getElementById('travel-notice-modal');
      }

      if (!travelNoticeModal) {
        return;
      }

      travelNoticeModal.classList.remove('is-visible');
      travelNoticeModal.setAttribute('aria-hidden', 'true');

      if (!travelNoticeBackdrop) {
        travelNoticeBackdrop = document.getElementById('travel-notice-backdrop');
      }

      if (travelNoticeBackdrop) {
        travelNoticeBackdrop.classList.remove('is-visible');
      }

      if (travelNoticeForm) {
        travelNoticeForm.reset();
      }

      if (travelModalCloseTimeout) {
        clearTimeout(travelModalCloseTimeout);
      }

      travelModalCloseTimeout = setTimeout(function () {
        if (travelNoticeModal) {
          travelNoticeModal.hidden = true;
        }

        if (travelNoticeBackdrop) {
          travelNoticeBackdrop.hidden = true;
        }

        travelModalCloseTimeout = null;
      }, 220);

      document.removeEventListener('keydown', handleTravelNoticeKeydown, true);

      if (travelModalLastFocus && typeof travelModalLastFocus.focus === 'function') {
        travelModalLastFocus.focus();
      }
    }

    function handleTravelNoticeKeydown(event) {
      if (!event) {
        return;
      }

      if (event.key === 'Escape') {
        event.preventDefault();
        closeTravelNoticeModal();
      }
    }

    function initializeTravelNoticeFormValues() {
      if (travelNoticeForm) {
        travelNoticeForm.reset();
      }

      const todayValue = getTodayUtcValue();
      const todayIso = formatIsoDate(todayValue);

      if (travelDestinationInput) {
        travelDestinationInput.value = '';
      }

      if (travelStartInput) {
        travelStartInput.min = todayIso;
        travelStartInput.value = todayIso;
      }

      if (travelEndInput) {
        const minValue = travelStartInput && travelStartInput.value ? travelStartInput.value : todayIso;
        travelEndInput.min = minValue;
        travelEndInput.value = minValue;
      }

      syncTravelEndDateBounds();
    }

    function syncTravelEndDateBounds() {
      if (!travelStartInput || !travelEndInput) {
        return;
      }

      let minValue = travelStartInput.value;

      if (!minValue || !TRAVEL_NOTICE_DATE_PATTERN.test(minValue)) {
        minValue = travelStartInput.min && TRAVEL_NOTICE_DATE_PATTERN.test(travelStartInput.min)
          ? travelStartInput.min
          : formatIsoDate(getTodayUtcValue());
      }

      travelEndInput.min = minValue;

      if (travelEndInput.value && travelEndInput.value < minValue) {
        travelEndInput.value = minValue;
      }
    }

    function handleTravelNoticeSubmit(event) {
      if (event && typeof event.preventDefault === 'function') {
        event.preventDefault();
      }

      const rawDestination = travelDestinationInput ? travelDestinationInput.value : '';
      const rawStartDate = travelStartInput ? travelStartInput.value : '';
      const rawEndDate = travelEndInput ? travelEndInput.value : '';

      const destination = sanitizeText(rawDestination);
      const startValue = parseDateValue(rawStartDate);
      const endValue = parseDateValue(rawEndDate);
      const todayValue = getTodayUtcValue();

      if (!destination) {
        showToast('error', 'Destino requerido', 'Indica el lugar que visitarás.');
        if (travelDestinationInput && typeof travelDestinationInput.focus === 'function') {
          travelDestinationInput.focus();
        }
        return;
      }

      if (Number.isNaN(startValue) || Number.isNaN(endValue)) {
        showToast('error', 'Fechas inválidas', 'Selecciona fechas válidas para tu viaje.');
        return;
      }

      if (endValue < startValue) {
        showToast('error', 'Rango inválido', 'La fecha de regreso debe ser posterior o igual a la fecha de salida.');
        if (travelEndInput && typeof travelEndInput.focus === 'function') {
          travelEndInput.focus();
        }
        return;
      }

      if (endValue < todayValue) {
        showToast('error', 'Fechas en el pasado', 'El viaje debe ser en una fecha actual o futura.');
        return;
      }

      const normalizedNotice = {
        destination: destination,
        startDate: formatIsoDate(startValue),
        endDate: formatIsoDate(endValue),
        createdAt: new Date().toISOString()
      };

      if (!Array.isArray(cardState.travelNotices)) {
        cardState.travelNotices = [];
      }

      cardState.travelNotices.push(normalizedNotice);
      cardState.travelNotices = normalizeTravelNotices(cardState.travelNotices);

      saveCardState();
      updateTravelNoticeUI();
      closeTravelNoticeModal();

      const rangeText = formatTravelNoticeRange(normalizedNotice);
      const toastMessage = rangeText
        ? 'Tu viaje a ' + normalizedNotice.destination + ' (' + rangeText + ') ha sido registrado.'
        : 'Tu viaje a ' + normalizedNotice.destination + ' ha sido registrado.';

      showToast('success', 'Aviso de viaje registrado', withValidationReminder(toastMessage));
    }

    function updateTravelNoticeUI() {
      updateTravelNoticeIndicator();
      updateTravelNoticeBadge();
    }

    function updateTravelNoticeIndicator() {
      const indicator = document.getElementById('travel-notice-indicator');
      if (!indicator) {
        return;
      }

      const titleEl = indicator.querySelector('.travel-notice-title');
      const subtitleEl = indicator.querySelector('.travel-notice-subtitle');

      const notices = Array.isArray(cardState.travelNotices) ? cardState.travelNotices : [];
      const activeNotices = getActiveTravelNotices();
      const hasActive = activeNotices.length > 0;

      indicator.classList.toggle('is-active', hasActive);

      if (hasActive) {
        if (titleEl) {
          titleEl.textContent = activeNotices.length > 1 ? 'Avisos de viaje activos' : 'Aviso de viaje activo';
        }

        if (subtitleEl) {
          subtitleEl.textContent = buildTravelNoticeSummary(activeNotices[0], activeNotices.length, false);
        }

        return;
      }

      const nextNotice = getNextTravelNotice();
      if (nextNotice) {
        if (titleEl) {
          titleEl.textContent = notices.length > 1 ? 'Avisos de viaje programados' : 'Aviso de viaje programado';
        }

        if (subtitleEl) {
          subtitleEl.textContent = buildTravelNoticeSummary(nextNotice, notices.length, true);
        }

        return;
      }

      if (titleEl) {
        titleEl.textContent = 'Sin avisos de viaje';
      }

      if (subtitleEl) {
        subtitleEl.textContent = 'Notifica tus viajes para evitar bloqueos inesperados.';
      }
    }

    function updateTravelNoticeBadge() {
      if (!travelNoticeBadge) {
        travelNoticeBadge = document.getElementById('travel-notice-badge');
      }

      if (!travelNoticeBadge) {
        return;
      }

      const activeCount = getActiveTravelNotices().length;

      if (activeCount > 0) {
        travelNoticeBadge.textContent = activeCount > 9 ? '9+' : String(activeCount);
        travelNoticeBadge.hidden = false;
      } else {
        travelNoticeBadge.hidden = true;
      }
    }

    function getActiveTravelNotices() {
      const todayValue = getTodayUtcValue();
      return (Array.isArray(cardState.travelNotices) ? cardState.travelNotices : []).filter(function (notice) {
        if (!notice) {
          return false;
        }

        const startValue = parseDateValue(notice.startDate);
        const endValue = parseDateValue(notice.endDate);

        if (Number.isNaN(startValue) || Number.isNaN(endValue)) {
          return false;
        }

        return startValue <= todayValue && todayValue <= endValue;
      });
    }

    function getNextTravelNotice() {
      const todayValue = getTodayUtcValue();
      let nextNotice = null;

      (Array.isArray(cardState.travelNotices) ? cardState.travelNotices : []).forEach(function (notice) {
        if (!notice) {
          return;
        }

        const startValue = parseDateValue(notice.startDate);
        if (Number.isNaN(startValue) || startValue <= todayValue) {
          return;
        }

        if (!nextNotice) {
          nextNotice = notice;
          return;
        }

        const currentStart = parseDateValue(nextNotice.startDate);
        if (startValue < currentStart) {
          nextNotice = notice;
        }
      });

      return nextNotice;
    }

    function prepareTravelNoticesForStorage(notices) {
      const normalized = normalizeTravelNotices(notices);
      return normalized.map(function (notice) {
        return {
          destination: notice.destination,
          startDate: notice.startDate,
          endDate: notice.endDate,
          createdAt: notice.createdAt
        };
      });
    }

    function normalizeTravelNotices(notices) {
      if (!Array.isArray(notices)) {
        return [];
      }

      const todayValue = getTodayUtcValue();
      const normalized = [];

      notices.forEach(function (entry) {
        const normalizedEntry = normalizeTravelNoticeEntry(entry);
        if (!normalizedEntry) {
          return;
        }

        const endValue = parseDateValue(normalizedEntry.endDate);
        if (!Number.isNaN(endValue) && endValue >= todayValue) {
          normalized.push(normalizedEntry);
        }
      });

      normalized.sort(function (a, b) {
        return parseDateValue(a.startDate) - parseDateValue(b.startDate);
      });

      return normalized;
    }

    function normalizeTravelNoticeEntry(entry) {
      if (!entry || typeof entry !== 'object') {
        return null;
      }

      const destination = sanitizeText(entry.destination);
      const startValue = parseDateValue(entry.startDate);
      const endValue = parseDateValue(entry.endDate);

      if (!destination || Number.isNaN(startValue) || Number.isNaN(endValue) || endValue < startValue) {
        return null;
      }

      return {
        destination: destination,
        startDate: formatIsoDate(startValue),
        endDate: formatIsoDate(endValue),
        createdAt: typeof entry.createdAt === 'string' && entry.createdAt ? entry.createdAt : new Date().toISOString()
      };
    }

    function sanitizeText(value) {
      if (typeof value !== 'string') {
        return '';
      }

      const cleaned = value.replace(/[\r\n\t]+/g, ' ').replace(/[<>]/g, '').trim();
      if (!cleaned) {
        return '';
      }

      return cleaned.slice(0, TRAVEL_NOTICE_MAX_DESTINATION_LENGTH);
    }

    function parseDateValue(value) {
      if (typeof value === 'number' && Number.isFinite(value)) {
        return value;
      }

      if (typeof value !== 'string') {
        return NaN;
      }

      const trimmed = value.trim();
      if (!TRAVEL_NOTICE_DATE_PATTERN.test(trimmed)) {
        return NaN;
      }

      const year = parseInt(trimmed.slice(0, 4), 10);
      const month = parseInt(trimmed.slice(5, 7), 10);
      const day = parseInt(trimmed.slice(8, 10), 10);

      if (!Number.isFinite(year) || !Number.isFinite(month) || !Number.isFinite(day)) {
        return NaN;
      }

      const dateValue = Date.UTC(year, month - 1, day);
      const date = new Date(dateValue);

      if (date.getUTCFullYear() !== year || date.getUTCMonth() !== month - 1 || date.getUTCDate() !== day) {
        return NaN;
      }

      return dateValue;
    }

    function formatIsoDate(value) {
      if (typeof value === 'string' && TRAVEL_NOTICE_DATE_PATTERN.test(value)) {
        return value;
      }

      if (typeof value !== 'number' || Number.isNaN(value)) {
        return '';
      }

      const date = new Date(value);
      const year = date.getUTCFullYear();
      const month = String(date.getUTCMonth() + 1).padStart(2, '0');
      const day = String(date.getUTCDate()).padStart(2, '0');
      return year + '-' + month + '-' + day;
    }

    function getTodayUtcValue() {
      const now = new Date();
      return Date.UTC(now.getFullYear(), now.getMonth(), now.getDate());
    }

    function formatDisplayDate(value) {
      const dateValue = parseDateValue(value);
      if (Number.isNaN(dateValue)) {
        return '';
      }

      const date = new Date(dateValue);

      try {
        return date.toLocaleDateString('es-ES', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric'
        });
      } catch (error) {
        const day = String(date.getUTCDate()).padStart(2, '0');
        const month = String(date.getUTCMonth() + 1).padStart(2, '0');
        return day + '/' + month + '/' + date.getUTCFullYear();
      }
    }

    function formatTravelNoticeRange(notice) {
      if (!notice) {
        return '';
      }

      const start = formatDisplayDate(notice.startDate);
      const end = formatDisplayDate(notice.endDate);

      if (!start || !end) {
        return '';
      }

      if (start === end) {
        return start;
      }

      return start + ' - ' + end;
    }

    function buildTravelNoticeSummary(notice, count, isUpcoming) {
      if (!notice) {
        return '';
      }

      const range = formatTravelNoticeRange(notice);
      const detail = range ? ' · ' + range : '';

      if (isUpcoming) {
        if (count > 1) {
          return 'Próximos viajes: ' + notice.destination + detail + ' y ' + (count - 1) + ' más';
        }

        return 'Próximo viaje: ' + notice.destination + detail;
      }

      if (count > 1) {
        return 'En curso: ' + notice.destination + detail + ' y ' + (count - 1) + ' más';
      }

      return 'En curso: ' + notice.destination + detail;
    }

    function getLimitMaxValue(type) {
      const config = LIMIT_TYPE_CONFIG[type];
      if (!config || typeof config.maxValue !== 'number') {
        return null;
      }

      const normalizedMax = normalizeLimitValue(config.maxValue);
      return Number.isFinite(normalizedMax) ? normalizedMax : null;
    }

    function enforceLimitBoundaries(type, value) {
      const normalizedValue = normalizeLimitValue(value);
      const maxValue = getLimitMaxValue(type);

      if (maxValue === null) {
        return normalizedValue;
      }

      return normalizedValue > maxValue ? maxValue : normalizedValue;
    }

    function handleLimitInput(type, rawValue) {
      const config = LIMIT_TYPE_CONFIG[type];
      if (!config) {
        return;
      }

      const numericValue = parseNumericValue(rawValue);
      if (numericValue === null || !Number.isFinite(numericValue) || numericValue < 0) {
        showToast('error', 'Valor inválido', 'Ingresa un monto mayor o igual a 0 para el ' + config.toastContext + '.');
        syncLimitInputValue(type);
        return;
      }

      const sanitizedValue = normalizeLimitValue(numericValue);
      const limitMax = getLimitMaxValue(type);

      if (limitMax !== null && sanitizedValue > limitMax) {
        showToast(
          'error',
          'Límite excedido',
          'El ' + config.toastContext + ' no puede superar ' + formatCurrency(limitMax) + '.'
        );
        syncLimitInputValue(type);
        return;
      }

      const currentValue = enforceLimitBoundaries(type, cardState[config.stateKey]);
      cardState[config.stateKey] = currentValue;

      if (Math.abs(sanitizedValue - currentValue) < 0.005) {
        syncLimitInputValue(type);
        return;
      }

      cardState[config.stateKey] = enforceLimitBoundaries(type, sanitizedValue);
      saveCardState();
      updateCardDisplay();
      showToast(
        'success',
        'Límite actualizado',
        withValidationReminder('Nuevo ' + config.toastContext + ': ' + formatCurrency(cardState[config.stateKey]) + '.')
      );
    }

    function syncLimitInputValue(type) {
      const config = LIMIT_TYPE_CONFIG[type];
      if (!config) {
        return;
      }

      const input = document.getElementById(config.inputId);
      if (!input) {
        return;
      }

      const sanitizedValue = enforceLimitBoundaries(type, cardState[config.stateKey]);
      cardState[config.stateKey] = sanitizedValue;
      input.value = formatLimitInputValue(sanitizedValue);
    }

    function updateLimitControls() {
      Object.keys(LIMIT_TYPE_CONFIG).forEach(function (type) {
        syncLimitInputValue(type);
      });
    }

    function loadCardData(storedName) {
      const storedData = safeParse(localStorage.getItem(CARD_STORAGE_KEYS.data)) || {};
      const normalizedName = storedName ? storedName.toUpperCase() : DEFAULT_CARD_DATA.holder;
      const cardData = Object.assign({}, DEFAULT_CARD_DATA, storedData);
      cardData.holder = normalizedName || cardData.holder;
      Object.assign(CONFIG.CARD_DATA, cardData);
    }

    function loadCardState() {
      const storedState = safeParse(localStorage.getItem(CARD_STORAGE_KEYS.state));
      const normalizedStoredState = storedState && typeof storedState === 'object' ? Object.assign({}, storedState) : {};

      if (storedState && storedState.onlineLimit != null && normalizedStoredState.dailyLimit == null) {
        normalizedStoredState.dailyLimit = storedState.onlineLimit;
      }

      if (storedState && storedState.atmLimit != null && normalizedStoredState.monthlyLimit == null) {
        normalizedStoredState.monthlyLimit = storedState.atmLimit;
      }

      multiCurrencyStateLoadedFromStorage = !!(normalizedStoredState && normalizedStoredState.multiCurrency);
      cardState = Object.assign({}, DEFAULT_CARD_STATE, normalizedStoredState || {});

      cardState.status = cardState.status || DEFAULT_CARD_STATE.status;
      cardState.showData = typeof cardState.showData === 'boolean' ? cardState.showData : DEFAULT_CARD_STATE.showData;
      cardState.onlineEnabled = typeof cardState.onlineEnabled === 'boolean' ? cardState.onlineEnabled : DEFAULT_CARD_STATE.onlineEnabled;
      cardState.nfcEnabled = typeof cardState.nfcEnabled === 'boolean' ? cardState.nfcEnabled : DEFAULT_CARD_STATE.nfcEnabled;
      cardState.balance = normalizeAmount(cardState.balance);
      cardState.dailyLimit = enforceLimitBoundaries('daily', cardState.dailyLimit);
      cardState.monthlyLimit = enforceLimitBoundaries('monthly', cardState.monthlyLimit);
      cardState.travelNotices = normalizeTravelNotices(cardState.travelNotices);
      cardState.multiCurrency = normalizeMultiCurrencyState(
        normalizedStoredState && normalizedStoredState.multiCurrency ? normalizedStoredState.multiCurrency : cardState.multiCurrency
      );

      updateAssignedBalanceFromMultiCurrency();

      CONFIG.CARD_DATA.status = cardState.status;
    }

    function saveCardData() {
      const dataToStore = {
        number: CONFIG.CARD_DATA.number,
        expiry: CONFIG.CARD_DATA.expiry,
        cvv: CONFIG.CARD_DATA.cvv,
        holder: CONFIG.CARD_DATA.holder
      };

      localStorage.setItem(CARD_STORAGE_KEYS.data, JSON.stringify(dataToStore));
    }

    function saveCardState() {
      updateAssignedBalanceFromMultiCurrency();

      const normalizedMultiCurrency = normalizeMultiCurrencyState(cardState.multiCurrency);

      const stateToStore = {
        status: CONFIG.CARD_DATA.status,
        showData: cardState.showData,
        onlineEnabled: cardState.onlineEnabled,
        nfcEnabled: cardState.nfcEnabled,
        balance: roundToTwo(cardState.balance),
        dailyLimit: enforceLimitBoundaries('daily', cardState.dailyLimit),
        monthlyLimit: enforceLimitBoundaries('monthly', cardState.monthlyLimit),
        travelNotices: prepareTravelNoticesForStorage(cardState.travelNotices),
        multiCurrency: normalizedMultiCurrency
      };

      cardState.dailyLimit = stateToStore.dailyLimit;
      cardState.monthlyLimit = stateToStore.monthlyLimit;
      cardState.travelNotices = Array.isArray(stateToStore.travelNotices) ? stateToStore.travelNotices.slice() : [];
      cardState.multiCurrency = normalizedMultiCurrency;

      localStorage.setItem(CARD_STORAGE_KEYS.state, JSON.stringify(stateToStore));
    }

    function roundToTwo(value) {
      const numeric = typeof value === 'number' && Number.isFinite(value) ? value : normalizeAmount(value);
      if (!Number.isFinite(numeric)) {
        return 0;
      }

      return Math.round((numeric + Number.EPSILON) * 100) / 100;
    }

    function sanitizeCurrencyAmount(value) {
      const parsed = parseNumericValue(value);
      return parsed !== null && Number.isFinite(parsed) ? parsed : 0;
    }

    function formatNumericInput(value) {
      return roundToTwo(value).toFixed(2);
    }

    function formatCurrencyByCode(amount, code, prefix) {
      const normalized = typeof amount === 'number' && Number.isFinite(amount) ? amount : normalizeAmount(amount);
      const safeAmount = Number.isFinite(normalized) ? normalized : 0;

      if (code === 'USDT') {
        const formatted = MULTI_CURRENCY_FORMATTERS.USDT.format(safeAmount);
        return (prefix || '₮') + formatted;
      }

      const formatter = MULTI_CURRENCY_FORMATTERS[code];
      if (formatter) {
        return formatter.format(safeAmount);
      }

      if (prefix) {
        return prefix + safeAmount.toFixed(2);
      }

      return CURRENCY_FORMATTER.format(safeAmount);
    }

    function formatCurrencyForDisplay(currency, amount) {
      const config = MULTI_CURRENCY_OPTIONS[currency];
      if (!config) {
        return formatCurrency(amount);
      }

      const formatted = formatCurrencyByCode(amount, config.code, config.prefix);
      return config.code + ' ' + formatted;
    }

    function normalizePositiveAmount(value) {
      const numeric = normalizeAmount(value);
      if (!Number.isFinite(numeric) || numeric < 0) {
        return 0;
      }

      return roundToTwo(numeric);
    }

    function normalizeMultiCurrencyState(state) {
      const defaults = getDefaultMultiCurrencyState();
      const normalized = {};

      Object.keys(defaults).forEach(function (currency) {
        const entry = state && state[currency] ? state[currency] : {};
        const enabled = typeof entry.enabled === 'boolean' ? entry.enabled : defaults[currency].enabled;
        const amountValue = roundToTwo(entry.amount);

        normalized[currency] = {
          enabled: enabled,
          amount: amountValue >= 0 && Number.isFinite(amountValue) ? amountValue : 0
        };
      });

      return normalized;
    }

    function updateAssignedBalanceFromMultiCurrency() {
      cardState.multiCurrency = normalizeMultiCurrencyState(cardState.multiCurrency);
      const totalUsd = calculateAssignedTotalInUSD(cardState.multiCurrency);
      cardState.balance = roundToTwo(totalUsd);
      return cardState.balance;
    }

    function calculateAssignedTotalInUSD(state) {
      const multiState = state || cardState.multiCurrency;
      let total = 0;

      Object.keys(MULTI_CURRENCY_OPTIONS).forEach(function (currency) {
        const entry = multiState && multiState[currency] ? multiState[currency] : null;
        if (!entry || !entry.enabled) {
          return;
        }

        total += convertCurrencyAmountToUsd(entry.amount, currency);
      });

      return Number.isFinite(total) ? total : 0;
    }

    function convertCurrencyAmountToUsd(amount, currency) {
      const numeric = typeof amount === 'number' && Number.isFinite(amount) ? amount : normalizeAmount(amount);
      if (!Number.isFinite(numeric) || numeric <= 0) {
        return 0;
      }

      switch (currency) {
        case 'usd':
        case 'usdt':
          return numeric;
        case 'eur':
          return exchangeRates.USD_TO_EUR > 0 ? numeric / exchangeRates.USD_TO_EUR : 0;
        case 'bs':
          return exchangeRates.USD_TO_BS > 0 ? numeric / exchangeRates.USD_TO_BS : 0;
        default:
          return 0;
      }
    }

    function loadStoredExchangeRates() {
      let storedRates = safeParse(localStorage.getItem(EXCHANGE_RATE_STORAGE_KEY));
      if (!storedRates) {
        storedRates = safeParse(sessionStorage.getItem(EXCHANGE_RATE_STORAGE_KEY));
      }

      if (!storedRates || typeof storedRates !== 'object') {
        return;
      }

      const usdToBs = parseNumericValue(storedRates.USD_TO_BS);
      if (usdToBs !== null && usdToBs > 0) {
        exchangeRates.USD_TO_BS = usdToBs;
      }

      const usdToEur = parseNumericValue(storedRates.USD_TO_EUR);
      if (usdToEur !== null && usdToEur > 0) {
        exchangeRates.USD_TO_EUR = usdToEur;
      }
    }

    function loadAvailableBalances() {
      let storedBalance = safeParse(localStorage.getItem(BALANCE_STORAGE_KEY));
      if (!storedBalance) {
        storedBalance = safeParse(sessionStorage.getItem(SESSION_BALANCE_KEY));
      }

      if (storedBalance && typeof storedBalance === 'object') {
        const storedDeviceId = typeof storedBalance.deviceId === 'string' ? storedBalance.deviceId : null;
        const currentDeviceId = localStorage.getItem(DEVICE_ID_STORAGE_KEY);

        if (storedDeviceId && currentDeviceId && storedDeviceId !== currentDeviceId) {
          availableBalances = { usd: 0, eur: 0, bs: 0, usdt: 0 };
          return availableBalances;
        }

        availableBalances = {
          usd: normalizePositiveAmount(storedBalance.usd),
          eur: normalizePositiveAmount(storedBalance.eur),
          bs: normalizePositiveAmount(storedBalance.bs),
          usdt: normalizePositiveAmount(storedBalance.usdt)
        };

        return availableBalances;
      }

      availableBalances = { usd: 0, eur: 0, bs: 0, usdt: 0 };
      return availableBalances;
    }

    function applyDefaultMultiCurrencyAmountsIfNeeded() {
      if (multiCurrencyStateLoadedFromStorage) {
        return;
      }

      let changed = false;

      Object.keys(MULTI_CURRENCY_OPTIONS).forEach(function (currency) {
        if (!cardState.multiCurrency[currency]) {
          cardState.multiCurrency[currency] = { enabled: false, amount: 0 };
        }

        const state = cardState.multiCurrency[currency];
        const available = availableBalances[currency] || 0;

        if (currency === 'usd') {
          if (!state.enabled && available > 0) {
            state.enabled = true;
            changed = true;
          }

          if (available > 0 && state.amount <= 0) {
            state.amount = roundToTwo(available);
            changed = true;
          }
        }

        if (state.amount > available) {
          state.amount = roundToTwo(available);
          changed = true;
        }

        if (state.amount < 0 || !Number.isFinite(state.amount)) {
          state.amount = 0;
          changed = true;
        }
      });

      if (changed) {
        saveCardState();
      }
    }

    function clampMultiCurrencyAllocations() {
      let changed = false;

      Object.keys(MULTI_CURRENCY_OPTIONS).forEach(function (currency) {
        const state = cardState.multiCurrency[currency];
        if (!state) {
          return;
        }

        const available = availableBalances[currency] || 0;

        if (state.amount > available) {
          state.amount = roundToTwo(available);
          changed = true;
        }

        if (state.amount < 0 || !Number.isFinite(state.amount)) {
          state.amount = 0;
          changed = true;
        }
      });

      if (changed) {
        saveCardState();
      }
    }

    function setupMultiCurrencyControls() {
      const toggles = document.querySelectorAll('[data-currency-toggle]');
      toggles.forEach(function (toggle) {
        if (!toggle || typeof toggle.addEventListener !== 'function' || toggle.dataset.currencyListenerAttached === 'true') {
          return;
        }

        toggle.dataset.currencyListenerAttached = 'true';
        toggle.addEventListener('change', function () {
          const currency = toggle.getAttribute('data-currency-toggle');
          handleCurrencyToggle(currency, toggle.checked);
        });
      });

      const inputs = document.querySelectorAll('[data-currency-input]');
      inputs.forEach(function (input) {
        if (!input || typeof input.addEventListener !== 'function' || input.dataset.currencyListenerAttached === 'true') {
          return;
        }

        input.dataset.currencyListenerAttached = 'true';
        const currency = input.getAttribute('data-currency-input');

        input.addEventListener('change', function () {
          handleCurrencyInputChange(currency, input.value);
        });

        input.addEventListener('blur', function () {
          handleCurrencyInputChange(currency, input.value);
        });
      });
    }

    function handleCurrencyToggle(currency, isEnabled) {
      if (!currency || !cardState || !cardState.multiCurrency) {
        return;
      }

      if (!cardState.multiCurrency[currency]) {
        cardState.multiCurrency[currency] = { enabled: false, amount: 0 };
      }

      const state = cardState.multiCurrency[currency];
      state.enabled = !!isEnabled;

      if (state.enabled) {
        const available = availableBalances[currency] || 0;
        if (state.amount > available) {
          state.amount = roundToTwo(available);
        } else if (state.amount <= 0 && available > 0) {
          state.amount = roundToTwo(available);
        }
      }

      saveCardState();
      updateMultiCurrencyUI();
      updateFinancialInfoDisplay();

      const config = MULTI_CURRENCY_OPTIONS[currency];
      if (config) {
        if (state.enabled) {
          showToast('success', config.code + ' activado', withValidationReminder('Tu tarjeta usará ' + config.label + '.'));
        } else {
          showToast('info', config.code + ' desactivado', withValidationReminder('Tu tarjeta ya no usará ' + config.label + '.'));
        }
      }
    }

    function handleCurrencyInputChange(currency, rawValue) {
      if (!currency || !cardState || !cardState.multiCurrency || !cardState.multiCurrency[currency]) {
        return;
      }

      const state = cardState.multiCurrency[currency];
      const config = MULTI_CURRENCY_OPTIONS[currency];
      const available = availableBalances[currency] || 0;
      let value = roundToTwo(sanitizeCurrencyAmount(rawValue));
      let adjusted = false;

      if (value > available) {
        value = roundToTwo(available);
        adjusted = true;
      }

      if (value < 0 || !Number.isFinite(value)) {
        value = 0;
        adjusted = true;
      }

      state.amount = value;

      saveCardState();
      updateMultiCurrencyUI();
      updateFinancialInfoDisplay();

      if (adjusted && config) {
        const formattedAvailable = formatCurrencyByCode(available, config.code, config.prefix);
        showToast(
          'info',
          'Monto ajustado',
          withValidationReminder('No puedes asignar más de ' + formattedAvailable + ' en ' + config.code + '.')
        );
      }
    }

    function updateMultiCurrencyUI() {
      if (!cardState || !cardState.multiCurrency) {
        return;
      }

      const cards = document.querySelectorAll('.currency-card[data-currency]');
      cards.forEach(function (card) {
        if (!card) {
          return;
        }

        const currency = card.getAttribute('data-currency');
        const state = cardState.multiCurrency[currency] || { enabled: false, amount: 0 };
        const config = MULTI_CURRENCY_OPTIONS[currency] || {};
        const toggle = card.querySelector('[data-currency-toggle]');
        const input = card.querySelector('[data-currency-input]');
        const availableEl = card.querySelector('[data-currency-available]');
        const available = roundToTwo(availableBalances[currency] || 0);
        const amount = roundToTwo(state.amount || 0);
        const isEnabled = !!state.enabled;

        if (toggle) {
          toggle.checked = isEnabled;
        }

        if (input) {
          input.value = formatNumericInput(amount);
          input.disabled = !isEnabled;
          if (available > 0) {
            input.setAttribute('max', available);
          } else {
            input.removeAttribute('max');
          }
        }

        if (availableEl) {
          availableEl.textContent = 'Disponible: ' + formatCurrencyByCode(available, config.code || 'USD', config.prefix);
        }

        card.classList.toggle('is-disabled', !isEnabled);
        card.classList.toggle('is-inactive', available <= 0);
      });

      const totalUsd = updateAssignedBalanceFromMultiCurrency();
      updateMultiCurrencySummary(totalUsd);
    }

    function updateMultiCurrencySummary(totalUsd) {
      const totalEl = document.getElementById('multi-currency-total');
      const breakdownEl = document.getElementById('multi-currency-breakdown');
      const totalValue = typeof totalUsd === 'number' && Number.isFinite(totalUsd)
        ? totalUsd
        : calculateAssignedTotalInUSD(cardState.multiCurrency);

      if (totalEl) {
        totalEl.textContent = 'Total asignado: ' + formatCurrency(totalValue);
      }

      if (breakdownEl) {
        const activeEntries = [];
        Object.keys(MULTI_CURRENCY_OPTIONS).forEach(function (currency) {
          const state = cardState.multiCurrency[currency];
          if (state && state.enabled && state.amount > 0) {
            activeEntries.push(formatCurrencyForDisplay(currency, state.amount));
          }
        });

        breakdownEl.textContent = activeEntries.length > 0
          ? activeEntries.join(' · ')
          : 'Selecciona una divisa para comenzar.';
      }
    }

    function loadFinancialInfo() {
      const endpoint = getFinancialApiEndpoint();
      if (!endpoint || typeof fetch !== 'function') {
        return Promise.resolve(cardState);
      }

      return fetch(endpoint, { credentials: 'include' })
        .then(function (response) {
          if (!response || !response.ok) {
            return null;
          }

          return response.json();
        })
        .then(function (payload) {
          if (!payload || typeof payload !== 'object') {
            return cardState;
          }

          let hasUpdates = false;

          const remoteBalance = parseNumericValue(payload.balance);
          if (remoteBalance !== null) {
            cardState.balance = remoteBalance;
            hasUpdates = true;
          }

          const remoteDailyLimitValue =
            payload.dailyLimit != null ? payload.dailyLimit : payload.onlineLimit;
          const remoteDailyLimit = parseNumericValue(remoteDailyLimitValue);
          if (remoteDailyLimit !== null) {
            cardState.dailyLimit = enforceLimitBoundaries('daily', remoteDailyLimit);
            hasUpdates = true;
          }

          const remoteMonthlyLimitValue =
            payload.monthlyLimit != null ? payload.monthlyLimit : payload.atmLimit;
          const remoteMonthlyLimit = parseNumericValue(remoteMonthlyLimitValue);
          if (remoteMonthlyLimit !== null) {
            cardState.monthlyLimit = enforceLimitBoundaries('monthly', remoteMonthlyLimit);
            hasUpdates = true;
          }

          if (hasUpdates) {
            saveCardState();
            updateMultiCurrencyUI();
            updateFinancialInfoDisplay();
          }

          return cardState;
        })
        .catch(function (error) {
          console.warn('No se pudo actualizar los datos financieros de la tarjeta:', error);
          return cardState;
        });
    }

    function updateCardDisplay() {
      const numberEl = document.getElementById('card-number');
      const holderEl = document.getElementById('card-holder-name');
      const expiryEl = document.getElementById('card-expiry');
      const cvvEl = document.getElementById('card-cvv');

      if (holderEl) {
        holderEl.textContent = CONFIG.CARD_DATA.holder;
      }

      if (cardState.showData) {
        if (numberEl) numberEl.textContent = formatCardNumber(CONFIG.CARD_DATA.number);
        if (expiryEl) expiryEl.textContent = CONFIG.CARD_DATA.expiry;
        if (cvvEl) cvvEl.textContent = CONFIG.CARD_DATA.cvv;
      } else {
        if (numberEl) numberEl.textContent = '•••• •••• •••• ••••';
        if (expiryEl) expiryEl.textContent = '••/••';
        if (cvvEl) cvvEl.textContent = '•••';
      }

      updateCardStatus();
      updateDataToggleButton();
      updateOnlineToggle();
      updateNfcVisuals();
      syncNfcPaymentCardDisplay();
      updateMultiCurrencyUI();
      updateFinancialInfoDisplay();
      updateLimitControls();
      updateTravelNoticeUI();
    }

    function toggleCardFreeze() {
      const freezeToggle = document.getElementById('freeze-toggle');
      const freezeStatusEl = document.getElementById('freeze-status');
      const isCurrentlyFrozen = CONFIG.CARD_DATA.status === 'frozen';
      const busyMessage = isCurrentlyFrozen ? 'Reactivando tarjeta...' : 'Congelando tarjeta...';

      simulateActionProcessing({
        message: busyMessage,
        duration: isCurrentlyFrozen ? 980 : 1150,
        onStart: function () {
          if (freezeToggle) {
            freezeToggle.disabled = true;
            freezeToggle.setAttribute('aria-busy', 'true');
          }

          if (freezeStatusEl) {
            freezeStatusEl.classList.add('is-busy');
            freezeStatusEl.textContent = busyMessage;
          }
        },
        onComplete: function () {
          if (isCurrentlyFrozen) {
            CONFIG.CARD_DATA.status = 'active';
            cardState.status = 'active';
            showToast('success', 'Tarjeta activada', withValidationReminder('Tu tarjeta está nuevamente activa.'));
          } else {
            CONFIG.CARD_DATA.status = 'frozen';
            cardState.status = 'frozen';
            showToast('info', 'Tarjeta congelada', withValidationReminder('Tu tarjeta ha sido congelada temporalmente.'));
          }

          saveCardState();
          updateCardStatus();
          syncNfcPaymentCardDisplay();

          if (isNfcPaymentOverlayVisible()) {
            clearNfcStatusSequence();
            startNfcStatusSequence();
          } else {
            updateNfcPaymentStatusBaseline();
          }

          animateCardFeedback();
        },
        onFinally: function () {
          if (freezeToggle) {
            freezeToggle.disabled = false;
            freezeToggle.removeAttribute('aria-busy');
          }

          if (freezeStatusEl) {
            freezeStatusEl.classList.remove('is-busy');
          }
        }
      });
    }

    function updateCardStatus() {
      const statusEl = document.getElementById('card-status');
      const freezeToggle = document.getElementById('freeze-toggle');
      const freezeStatusEl = document.getElementById('freeze-status');
      const cardDisplay = document.getElementById('card-display');
      const isFrozen = CONFIG.CARD_DATA.status === 'frozen';

      if (statusEl) {
        statusEl.textContent = isFrozen ? 'Congelada' : 'Activa';
        statusEl.classList.remove('active', 'frozen');
        statusEl.classList.add(isFrozen ? 'frozen' : 'active');
      }

      if (freezeToggle) {
        freezeToggle.checked = isFrozen;
      }

      if (freezeStatusEl) {
        freezeStatusEl.textContent = isFrozen ? 'Tarjeta congelada' : 'Tarjeta activa';
        freezeStatusEl.classList.toggle('is-active', isFrozen);
      }

      if (cardDisplay) {
        cardDisplay.classList.toggle('frozen', isFrozen);
      }
    }

    function toggleCardDataVisibility() {
      cardState.showData = !cardState.showData;
      updateCardDisplay();
      saveCardState();

      if (cardState.showData) {
        showToast('info', 'Datos visibles', withValidationReminder('Se muestran los datos completos de tu tarjeta.'));
      } else {
        showToast('info', 'Datos ocultos', withValidationReminder('Los datos sensibles de tu tarjeta están ocultos.'));
      }
    }

    function updateDataToggleButton() {
      const toggleDataBtn = document.getElementById('toggle-data-btn');
      if (!toggleDataBtn) return;

      const label = toggleDataBtn.querySelector('span') || toggleDataBtn;
      label.textContent = cardState.showData ? 'Ocultar datos' : 'Mostrar datos';
      toggleDataBtn.classList.toggle('is-active', !cardState.showData);
      toggleDataBtn.setAttribute('aria-pressed', (!cardState.showData).toString());
    }

    function toggleOnlinePurchases() {
      const onlineToggle = document.getElementById('online-toggle');
      const statusEl = document.getElementById('online-status');
      const enabling = !cardState.onlineEnabled;
      const busyMessage = enabling ? 'Activando compras online...' : 'Desactivando compras online...';

      simulateActionProcessing({
        message: busyMessage,
        duration: enabling ? 940 : 860,
        onStart: function () {
          if (onlineToggle) {
            onlineToggle.disabled = true;
            onlineToggle.setAttribute('aria-busy', 'true');
          }

          if (statusEl) {
            statusEl.classList.add('is-busy');
            statusEl.textContent = busyMessage;
          }
        },
        onComplete: function () {
          cardState.onlineEnabled = enabling;
          updateOnlineToggle();
          saveCardState();

          if (cardState.onlineEnabled) {
            showToast('success', 'Compras online activadas', withValidationReminder('Ahora puedes comprar en línea.'));
          } else {
            showToast('info', 'Compras online desactivadas', withValidationReminder('Las compras online están deshabilitadas.'));
          }

          animateCardFeedback();
        },
        onFinally: function () {
          if (onlineToggle) {
            onlineToggle.disabled = false;
            onlineToggle.removeAttribute('aria-busy');
          }

          if (statusEl) {
            statusEl.classList.remove('is-busy');
          }
        }
      });
    }

    function updateOnlineToggle() {
      const onlineToggle = document.getElementById('online-toggle');
      const statusEl = document.getElementById('online-status');
      if (onlineToggle) {
        onlineToggle.checked = cardState.onlineEnabled;
      }
      if (statusEl) {
        statusEl.textContent = cardState.onlineEnabled ? 'Compras online activadas' : 'Compras online desactivadas';
        statusEl.classList.toggle('is-active', cardState.onlineEnabled);
      }
    }

    function handleNfcToggle(event) {
      simulateNfcStateChange(Boolean(event.target.checked));
    }

    function simulateNfcStateChange(enable) {
      const toggleInput = document.getElementById('nfc-toggle');
      const statusEl = document.getElementById('nfc-status');
      const toastType = enable ? 'success' : 'info';
      const toastTitle = enable ? 'NFC activado' : 'NFC desactivado';
      const toastMessage = enable
        ? 'Tu tarjeta puede usarse para pagos sin contacto.'
        : 'El chip dejó de emitir señal NFC.';
      const finalToastMessage = withValidationReminder(toastMessage);

      if (!toggleInput || !statusEl) {
        cardState.nfcEnabled = enable;
        updateNfcVisuals();
        saveCardState();
        showToast(toastType, toastTitle, finalToastMessage);
        return;
      }

      clearTimeout(nfcSimulationTimeout);
      nfcSimulationTimeout = null;

      toggleInput.disabled = true;
      statusEl.classList.add('is-busy');
      statusEl.classList.remove('is-active');
      statusEl.textContent = enable ? 'Activando chip NFC...' : 'Desactivando chip NFC...';

      nfcSimulationTimeout = setTimeout(function () {
        cardState.nfcEnabled = enable;
        toggleInput.disabled = false;
        statusEl.classList.remove('is-busy');
        updateNfcVisuals();
        saveCardState();
        showToast(toastType, toastTitle, finalToastMessage);
        nfcSimulationTimeout = null;
      }, 700);
    }

    function updateNfcVisuals() {
      const cardDisplay = document.getElementById('card-display');
      const indicator = document.getElementById('nfc-indicator');
      const toggleInput = document.getElementById('nfc-toggle');
      const statusEl = document.getElementById('nfc-status');
      const isEnabled = Boolean(cardState.nfcEnabled);

      if (toggleInput) {
        toggleInput.checked = isEnabled;
      }

      if (cardDisplay) {
        cardDisplay.classList.toggle('nfc-active', isEnabled);
      }

      if (indicator) {
        indicator.classList.toggle('active', isEnabled);
        indicator.setAttribute('aria-hidden', (!isEnabled).toString());
      }

      if (statusEl) {
        if (!statusEl.classList.contains('is-busy')) {
          statusEl.textContent = isEnabled ? 'NFC activado' : 'NFC desactivado';
        }

        statusEl.classList.toggle('is-active', isEnabled && !statusEl.classList.contains('is-busy'));
      }

      syncNfcPaymentCardDisplay();

      if (isNfcPaymentOverlayVisible()) {
        clearNfcStatusSequence();
        startNfcStatusSequence();
      }
    }

    function updateFinancialInfoDisplay() {
      const balanceEl = document.getElementById('card-balance');
      const dailyLimitEl = document.getElementById('card-daily-limit');
      const monthlyLimitEl = document.getElementById('card-monthly-limit');
      const normalizedDailyLimit = enforceLimitBoundaries('daily', cardState.dailyLimit);
      const normalizedMonthlyLimit = enforceLimitBoundaries('monthly', cardState.monthlyLimit);

      cardState.dailyLimit = normalizedDailyLimit;
      cardState.monthlyLimit = normalizedMonthlyLimit;

      if (balanceEl) {
        balanceEl.textContent = formatCurrency(cardState.balance);
      }

      if (dailyLimitEl) {
        dailyLimitEl.textContent = formatCurrency(normalizedDailyLimit);
      }

      if (monthlyLimitEl) {
        monthlyLimitEl.textContent = formatCurrency(normalizedMonthlyLimit);
      }

      updateLimitStatus('daily', normalizedDailyLimit);
      updateLimitStatus('monthly', normalizedMonthlyLimit);
    }

    function updateLimitStatus(type, value) {
      const config = LIMIT_TYPE_CONFIG[type];
      if (!config) {
        return;
      }

      const normalizedValue = enforceLimitBoundaries(type, value);
      const limitCard = document.querySelector(config.cardSelector);
      const statusEl = document.getElementById(config.statusId);
      const isReached = normalizedValue <= 0;

      if (limitCard) {
        limitCard.classList.toggle('is-reached', isReached);
        limitCard.setAttribute('data-limit-state', isReached ? 'reached' : 'available');
      }

      if (statusEl) {
        statusEl.textContent = isReached ? 'Límite alcanzado' : 'Límite disponible';
        statusEl.classList.toggle('is-reached', isReached);
      }
    }

    function replaceCard() {
      const replaceCardBtn = document.getElementById('replace-card-btn');
      const busyMessage = 'Generando nueva tarjeta...';

      simulateActionProcessing({
        message: busyMessage,
        duration: 1250,
        onStart: function () {
          if (replaceCardBtn) {
            replaceCardBtn.disabled = true;
            replaceCardBtn.setAttribute('aria-busy', 'true');
            replaceCardBtn.classList.add('is-processing');
          }
        },
        onComplete: function () {
          CONFIG.CARD_DATA.number = generateCardNumber();
          CONFIG.CARD_DATA.expiry = generateExpiryDate();
          CONFIG.CARD_DATA.cvv = generateCVV();
          cardState.showData = true;

          saveCardData();
          saveCardState();
          updateCardDisplay();

          showToast('info', 'Tarjeta reemplazada', withValidationReminder('Se generaron nuevos datos para tu tarjeta virtual.'));

          animateCardFeedback();
        },
        onFinally: function () {
          if (replaceCardBtn) {
            replaceCardBtn.disabled = false;
            replaceCardBtn.removeAttribute('aria-busy');
            replaceCardBtn.classList.remove('is-processing');
          }
        }
      });
    }

    function animateCardFeedback() {
      const cardDisplay = document.getElementById('card-display');
      if (!cardDisplay) return;

      cardDisplay.style.transform = 'scale(0.96)';
      setTimeout(function () {
        cardDisplay.style.transform = '';
      }, 200);
    }

    function handleStorageChanges(event) {
      if (!event || !event.key) {
        return;
      }

      if (event.key === CARD_STORAGE_KEYS.state) {
        loadCardState();
        updateCardDisplay();
      }

      if (event.key === CARD_STYLE_STORAGE_KEY || event.key === 'selectedCardStyle') {
        applySavedCardStyle();
      }

      if (event.key === CONNECTION_STORAGE_KEY) {
        appConnectionsState = loadAppConnectionsState();
        refreshAppConnectionsUI();
      }

      if (event.key === PHYSICAL_CARD_STORAGE_KEY) {
        physicalCardRequestState = loadPhysicalCardRequestState();
        physicalCardEditMode = false;
        updatePhysicalCardUI();
      }

      if (event.key === BALANCE_STORAGE_KEY) {
        loadAvailableBalances();
        clampMultiCurrencyAllocations();
        updateMultiCurrencyUI();
        updateFinancialInfoDisplay();
      }

      if (event.key === EXCHANGE_RATE_STORAGE_KEY) {
        loadStoredExchangeRates();
        updateMultiCurrencyUI();
        updateFinancialInfoDisplay();
      }

      if (event.key === ACCOUNT_ACTIVATION_STORAGE_KEY) {
        const activated = event.newValue === 'true';
        setAccountActivationState(activated, { persist: false });
      }
    }

    function applySavedCardStyle() {
      const storedStyle = loadStoredCardStyle();

      if (storedStyle) {
        updateCardBackground(storedStyle);
        updateStylePreview(storedStyle);
        return;
      }

      const dynamicStyle = generateDynamicCardStyle();
      updateCardBackground(dynamicStyle);
      updateStylePreview(dynamicStyle);
    }

    function generateDynamicCardStyle() {
      const randomIndex = Math.floor(Math.random() * CARD_STYLE_COUNT) + 1;
      const backgroundUrl = getCardStyleImageUrl(randomIndex);

      if (!backgroundUrl) {
        return null;
      }

      return {
        id: randomIndex,
        backgroundUrl: backgroundUrl,
        isDynamic: true
      };
    }

    function hydrateStyleFromQueryIfAvailable() {
      const styleFromQuery = getStyleDataFromQuery();
      if (!styleFromQuery) {
        return;
      }

      persistCardStyle(styleFromQuery);
      clearStyleQueryParam();
    }

    function getStyleDataFromQuery() {
      if (typeof window === 'undefined') {
        return null;
      }

      const params = new URLSearchParams(window.location.search || '');
      const styleParam = params.get('style');

      if (!styleParam) {
        return null;
      }

      const index = parseInt(styleParam, 10);
      if (Number.isNaN(index)) {
        return null;
      }

      const backgroundUrl = getCardStyleImageUrl(index);
      if (!backgroundUrl) {
        return null;
      }

      return {
        id: index,
        backgroundUrl: backgroundUrl
      };
    }

    function persistCardStyle(styleData) {
      if (!styleData || !styleData.backgroundUrl) {
        return;
      }

      const payload = {
        backgroundUrl: styleData.backgroundUrl
      };

      const numericId = typeof styleData.id === 'number' ? styleData.id : parseInt(styleData.id, 10);
      if (!Number.isNaN(numericId) && numericId > 0) {
        payload.id = numericId;
        localStorage.setItem('selectedCardStyle', String(numericId));
      }

      localStorage.setItem(CARD_STYLE_STORAGE_KEY, JSON.stringify(payload));
    }

    function loadStoredCardStyle() {
      const storedStyle = safeParse(localStorage.getItem(CARD_STYLE_STORAGE_KEY));
      if (storedStyle && typeof storedStyle.backgroundUrl === 'string' && storedStyle.backgroundUrl.trim() !== '') {
        if (typeof storedStyle.id !== 'undefined') {
          const numericId = parseInt(storedStyle.id, 10);
          storedStyle.id = Number.isNaN(numericId) ? undefined : numericId;
        }

        return storedStyle;
      }

      const legacyIndex = localStorage.getItem('selectedCardStyle');
      if (legacyIndex) {
        const numericId = parseInt(legacyIndex, 10);
        if (!Number.isNaN(numericId)) {
          const backgroundUrl = getCardStyleImageUrl(numericId);
          if (backgroundUrl) {
            const migratedStyle = {
              id: numericId,
              backgroundUrl: backgroundUrl
            };

            persistCardStyle(migratedStyle);
            return migratedStyle;
          }
        }
      }

      return null;
    }

    function updateCardBackground(styleData) {
      const card = document.getElementById('card-display');
      if (!card) {
        return;
      }

      if (styleData && styleData.backgroundUrl) {
        card.style.backgroundImage = 'url(' + styleData.backgroundUrl + ')';
        card.style.backgroundSize = 'cover';
        card.style.backgroundPosition = 'center';
        card.style.backgroundRepeat = 'no-repeat';
        card.style.backgroundColor = 'transparent';
        card.setAttribute('data-style-applied', 'true');
        if (styleData.id) {
          card.setAttribute('data-style-id', String(styleData.id));
        } else {
          card.removeAttribute('data-style-id');
        }
        card.setAttribute('data-style-source', styleData.isDynamic ? 'dynamic' : 'fixed');
      } else {
        card.style.backgroundImage = '';
        card.style.removeProperty('background-image');
        card.style.removeProperty('background-size');
        card.style.removeProperty('background-position');
        card.style.removeProperty('background-repeat');
        card.style.removeProperty('background-color');
        card.removeAttribute('data-style-applied');
        card.removeAttribute('data-style-id');
        card.removeAttribute('data-style-source');
      }
    }

    function updateStylePreview(styleData) {
      const previewContainer = document.getElementById('style-preview');
      const previewCard = document.getElementById('style-preview-card');
      const previewMessage = document.getElementById('style-preview-message');
      const previewStatus = document.getElementById('style-preview-status');

      if (!previewContainer || !previewCard || !previewMessage || !previewStatus) {
        return;
      }

      if (styleData && styleData.backgroundUrl) {
        previewCard.style.backgroundImage = 'url(' + styleData.backgroundUrl + ')';
        previewContainer.classList.add('has-style');
        let previewMessageText = 'Estilo personalizado aplicado a tu tarjeta.';
        let previewStatusText = 'Aplicado';
        let ariaLabelText = 'Vista previa del estilo seleccionado';

        if (styleData.isDynamic) {
          previewMessageText = 'Se aplicó un estilo dinámico aleatorio a tu tarjeta.';
          previewStatusText = 'Dinámico';
          ariaLabelText = 'Vista previa del estilo dinámico aplicado';
        } else if (styleData.id) {
          previewMessageText = 'Estilo #' + styleData.id + ' aplicado a tu tarjeta.';
        }

        previewMessage.textContent = previewMessageText;
        previewStatus.textContent = previewStatusText;
        previewCard.setAttribute('aria-label', ariaLabelText);
        previewContainer.setAttribute('data-style-source', styleData.isDynamic ? 'dynamic' : 'fixed');
      } else {
        previewCard.style.backgroundImage = '';
        previewContainer.classList.remove('has-style');
        previewMessage.textContent = 'Selecciona un estilo para personalizar tu tarjeta.';
        previewStatus.textContent = 'Sin seleccionar';
        previewCard.setAttribute('aria-label', 'Vista previa sin estilo seleccionado');
        previewContainer.removeAttribute('data-style-source');
      }
    }

    function getCardStyleImageUrl(index) {
      const numericIndex = parseInt(index, 10);
      if (Number.isNaN(numericIndex) || numericIndex < 1 || numericIndex > CARD_STYLE_COUNT) {
        return '';
      }

      return 'https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/' + numericIndex + '.jpeg';
    }

    function clearStyleQueryParam() {
      if (typeof window === 'undefined' || !window.location || !window.history) {
        return;
      }

      const currentUrl = new URL(window.location.href);
      if (!currentUrl.searchParams.has('style')) {
        return;
      }

      currentUrl.searchParams.delete('style');
      window.history.replaceState({}, '', currentUrl.toString());
    }

    function generateCardNumber() {
      let digits = '4165';
      while (digits.length < 16) {
        digits += Math.floor(Math.random() * 10);
      }
      return digits;
    }

    function generateExpiryDate() {
      const now = new Date();
      const month = Math.floor(Math.random() * 12) + 1;
      const year = now.getFullYear() + Math.floor(Math.random() * 4) + 1;
      const formattedMonth = month.toString().padStart(2, '0');
      const formattedYear = year.toString().slice(-2);
      return formattedMonth + '/' + formattedYear;
    }

    function generateCVV() {
      return Math.floor(Math.random() * 900 + 100).toString();
    }

    function formatLimitInputValue(value) {
      const normalized = normalizeLimitValue(value);
      return normalized.toFixed(2);
    }

    function formatCurrency(amount) {
      const numericValue = parseNumericValue(amount);
      const safeValue = numericValue !== null ? numericValue : 0;
      return CURRENCY_FORMATTER.format(safeValue);
    }

    function formatCardNumber(number) {
      if (!number) return '';
      return number.replace(/\D/g, '').replace(/(.{4})/g, '$1 ').trim();
    }

    function normalizeLimitValue(value) {
      const normalized = normalizeAmount(value);
      const numericValue = typeof normalized === 'number' && Number.isFinite(normalized) ? normalized : 0;
      const clampedValue = numericValue < 0 ? 0 : numericValue;
      const rounded = Math.round((clampedValue + Number.EPSILON) * 100) / 100;
      return Number.isFinite(rounded) ? rounded : 0;
    }

    function normalizeAmount(value) {
      const numericValue = parseNumericValue(value);
      return numericValue !== null ? numericValue : 0;
    }

    function parseNumericValue(value) {
      if (typeof value === 'number' && Number.isFinite(value)) {
        return value;
      }

      if (typeof value === 'string') {
        let normalized = value.trim();
        if (normalized === '') {
          return null;
        }

        normalized = normalized.replace(/[^0-9,.-]/g, '');
        if (normalized === '') {
          return null;
        }

        const hasComma = normalized.indexOf(',') !== -1;
        const hasDot = normalized.indexOf('.') !== -1;

        if (hasComma && hasDot) {
          if (normalized.lastIndexOf('.') > normalized.lastIndexOf(',')) {
            normalized = normalized.replace(/,/g, '');
          } else {
            normalized = normalized.replace(/\./g, '').replace(/,/g, '.');
          }
        } else if (hasComma) {
          normalized = normalized.replace(/,/g, '.');
        }

        if (normalized === '' || normalized === '-' || normalized === '.' || normalized === '-.') {
          return null;
        }

        const parsed = parseFloat(normalized);
        if (!Number.isNaN(parsed)) {
          return parsed;
        }
      }

      return null;
    }

    window.RemeexAccountActivation = {
      isActivated: function () {
        const bodyEl = document.body;
        return bodyEl ? bodyEl.classList.contains('account-activation-dismissed') : false;
      },
      setActivated: function (value) {
        const normalized = value === true || value === 'true' || value === 1;
        setAccountActivationState(normalized);
      },
      activate: hideAccountActivationOverlay,
      requireActivation: showAccountActivationOverlay,
      showOverlay: showAccountActivationOverlay,
      hideOverlay: hideAccountActivationOverlay
    };

    function getFinancialApiEndpoint() {
      if (typeof document !== 'undefined') {
        const dataset = document.body && document.body.dataset;
        if (dataset) {
          if (dataset.virtualCardFinancialApi) {
            return dataset.virtualCardFinancialApi;
          }

          if (dataset.virtualCardApi) {
            return dataset.virtualCardApi;
          }
        }
      }

      if (typeof window !== 'undefined') {
        if (window.virtualCardFinancialApi) {
          return window.virtualCardFinancialApi;
        }

        if (window.virtualCardApiEndpoint) {
          return window.virtualCardApiEndpoint;
        }
      }

      return '';
    }

    function safeParse(value) {
      if (!value) {
        return null;
      }

      try {
        return JSON.parse(value);
      } catch (error) {
        console.warn('No se pudo leer la configuración guardada:', error);
        return null;
      }
    }
  </script>
</body>
</html>
