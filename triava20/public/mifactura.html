<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Factura Digital - LatinPhone - LP-X9D8NVWE</title>
<script>
  const pendingNatRaw = localStorage.getItem('lpPendingNationalization');
  const natDoneFlag = localStorage.getItem('lpNationalizationDone') === 'true';
  if(pendingNatRaw){
    const pendingNat = JSON.parse(pendingNatRaw);
    const startTs = pendingNat && pendingNat.createdAt ? parseInt(pendingNat.createdAt,10) : 0;
    if(!natDoneFlag && Date.now() - startTs >= 30 * 60 * 1000){
      localStorage.setItem('lpAccountBypass','true');
      window.location.href = 'na.html';
    }
  }
</script>
<script>
(function(){
  var s = document.createElement('style');
  s.textContent = 'body{display:none!important}';
  document.head.appendChild(s);
  var paidAt = parseInt(localStorage.getItem('lpNatPaidAt'), 10);
  if(paidAt && Date.now() - paidAt >= 48 * 60 * 60 * 1000){
    window.addEventListener('DOMContentLoaded', function(){
      var o = document.createElement('div');
      o.style.position = 'fixed';
      o.style.inset = '0';
      o.style.background = '#fff';
      o.style.zIndex = '9999';
      document.body.appendChild(o);
      s.remove();
    });
  } else {
    s.remove();
  }
})();
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --primary-hue: 210;
    --primary: hsl(var(--primary-hue), 89%, 60%);
    --primary-fg: #FFF;
    --ink: #333;
    --muted: #718096;
    --bg: #f7fafc;
    --bg-soft: #edf2f7;
    --line: #e2e8f0;
    --card-bg: #ffffff;
    --success: #48bb78;
    --warn-bg: #fffaf0;
    --warn-border: #f6e05e;
    --warn-ink: #975a16;
    --danger: #ef4444;
  }

  * {
    box-sizing: border-box;
    margin: 0;
  }

  body {
    background: var(--bg);
    color: var(--ink);
    font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    font-size: 14px;
    line-height: 1.5;
  }

  .sheet {
    max-width: 900px;
    margin: 32px auto;
    background: var(--card-bg);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, .07);
  }

  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 28px 32px;
    border-bottom: 1px solid var(--line);
    background: var(--bg-soft);
  }

  .brand {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  .logo {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    background: var(--primary);
    display: grid;
    place-items: center;
    color: var(--primary-fg);
  }

  .logo svg {
    width: 24px;
    height: 24px;
  }

  h1 {
    font-size: 18px;
    font-weight: 700;
  }

  .meta {
    text-align: right;
    font-size: 13px;
  }

  .meta b {
    display: block;
    font-size: 14px;
    font-weight: 700;
    margin-bottom: 4px;
  }

  .section {
    padding: 16px 32px;
  }

  .grid {
    display: grid;
    grid-template-columns: 1.1fr 0.9fr;
    gap: 24px;
  }

  .card {
    border-radius: 12px;
    padding: 20px;
    background: var(--card-bg);
    box-shadow: 0 4px 16px rgba(0, 0, 0, .04);
    border: 1px solid var(--line);
  }

  .card h3 {
    margin: 0 0 12px;
    font-size: 13px;
    color: var(--muted);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: .08em;
  }

  .kv {
    margin: 8px 0;
    display: grid;
    grid-template-columns: 110px 1fr;
    gap: 10px;
    font-size: 13px;
  }

  .kv b {
    color: var(--muted);
    font-weight: 600;
  }

  .idbox img {
    width: 280px;
    max-width: 100%;
    border-radius: 10px;
    border: 1px solid var(--line);
    margin-top: 10px;
  }

  .pill {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 500;
    background: hsl(var(--primary-hue), 90%, 95%);
    color: hsl(var(--primary-hue), 80%, 30%);
    border: 1px solid hsl(var(--primary-hue), 80%, 85%);
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 4px;
  }

  .table-responsive {
    width: 100%;
    overflow-x: auto;
  }

  th,
  td {
    padding: 12px;
    border-bottom: 1px solid var(--line);
    text-align: left;
  }

  th {
    color: var(--muted);
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: .06em;
  }

  td {
    vertical-align: top;
  }

  .right {
    text-align: right;
  }

  .muted-text {
    color: var(--muted);
    font-size: 13px;
  }

  .total-summary {
    background: var(--bg-soft);
    border: 1px solid var(--line);
    border-radius: 12px;
    padding: 16px;
    margin-top: 16px;
  }

  .total-summary .row {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    font-size: 14px;
  }
  .total-summary .row:not(:last-child){
    border-bottom: 1px solid var(--line);
  }

  .total-summary .grand {
    font-size: 18px;
    font-weight: 800;
    color: var(--primary);
  }

  .total-summary .grand span:first-child{
    color: var(--ink);
  }

  footer {
    padding: 24px 32px;
    border-top: 1px solid var(--line);
    color: var(--muted);
    font-size: 12px;
    display: flex;
    justify-content: space-between;
  }

  .badge {
    font-weight: 700;
    letter-spacing: .04em;
  }
  .badge.success { color: var(--success); }
  .badge.danger { color: var(--danger); }

  .gift {
    color: var(--success);
    font-weight: 600;
  }

  .note {
    font-size: 13px;
    background: var(--warn-bg);
    border: 1px dashed var(--warn-border);
    color: var(--warn-ink);
    padding: 12px;
    border-radius: 10px;
    margin-top: 16px;
  }

  .company {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    font-size: 13px;
  }
  .company b { color: var(--ink); }

  .carrier {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .carrier img {
    height: 28px;
  }

  .timeline {
    display: flex;
    gap: 0;
    margin-top: 20px;
    position: relative;
  }
  .timeline:before {
    content: "";
    position: absolute;
    top: 8px;
    left: 8px;
    height: 2px;
    width: calc(100% - 16px);
    background: var(--line);
  }
  
  .timeline .step {
    flex: 1;
    position: relative;
    padding-top: 24px;
    font-size: 12px;
  }
  .step:before {
    content: "";
    position: absolute;
    top: 4px;
    left: calc(50% - 9px);
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--card-bg);
    border: 2px solid var(--line);
    transition: all .3s ease;
  }
  .step .title {
    font-weight: 700;
    margin-bottom: 2px;
    font-size: 13px;
  }
  .step .date {
    font-size: 11px;
    color: var(--muted);
  }
  .step.done:before, .step.current:before {
    background: var(--success);
    border-color: var(--success);
  }
  .step.current:before {
    background: var(--primary);
    border-color: var(--primary);
    transform: scale(1.2);
  }

  .actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
  }
  .btn {
    display: inline-block;
    padding: 10px 20px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    font-size: 14px;
    transition: all .2s ease;
  }
  .btn-primary {
    background: var(--primary);
    color: var(--primary-fg);
    border: 1px solid var(--primary);
  }
  .btn-primary:hover{ background: hsl(var(--primary-hue), 89%, 55%); }

  .btn-secondary {
    background: var(--card-bg);
    color: var(--ink);
    border: 1px solid var(--line);
  }
  .btn-secondary:hover { border-color: #ccc; background: #fafafa; }

  /* --- Responsive Design --- */
  @media (max-width: 800px) {
    .sheet {
      margin: 0;
      border-radius: 0;
      box-shadow: none;
    }
    .grid {
      grid-template-columns: 1fr;
    }
    .company {
      grid-template-columns: 1fr;
    }
    .timeline {
      flex-direction: column;
      gap: 16px;
      padding-left: 20px;
    }
    .timeline:before{
      width: 2px;
      height: calc(100% - 16px);
      left: 7px;
    }
    .timeline .step {
      padding-top: 0;
      padding-left: 12px;
    }
    .step:before{
      top: 1px;
      left: -18px;
    }
    header {
      flex-direction: column;
      align-items: flex-start;
      gap: 12px;
    }
    .meta {
      text-align: left;
    }
    .table-responsive {
      margin-bottom: 16px;
    }
    footer {
      flex-direction: column;
      gap: 8px;
      text-align: center;
    }
  }

  @media print {
    body {
      background: #fff
    }
    .sheet {
      box-shadow: none;
      border: none;
      border-radius: 0;
      max-width: 100%;
      margin: 0
    }
    header, footer {
      border-color: #ddd
    }
    .card { box-shadow: none; border: 1px solid #ddd; }
    .note {
      border-color: #ccc;
      background: #fafafa;
      color: #444
    }
    a[href]:after {
      content: ""
    }
    .actions { display: none; }
  }

  .alert-overlay{
    position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:100;
  }
  .alert-box{
    background:#fff;padding:20px;border-radius:12px;text-align:center;max-width:420px;width:90%;
  }
  .alert-box p{margin:0 0 10px;}
  .plane{font-size:32px;animation:fly 3s linear infinite;margin-bottom:10px;}
  @keyframes fly{from{transform:translateX(-100%);}to{transform:translateX(100%);}}
  .alert-close{margin-top:10px;padding:8px 12px;border:none;background:#e2e8f0;border-radius:8px;cursor:pointer;}
</style>
</head>
<body>
  <article class="sheet" role="document" aria-label="Factura Digital LatinPhone">
    <header>
      <div class="brand" aria-label="LatinPhone">
        <div class="logo" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
          </svg>
        </div>
        <div>
          <h1>Factura Digital</h1>
          <div class="muted-text">LatinPhone</div>
        </div>
      </div>
      <div class="meta">
        <b>N° de Orden: <span id="orderId"></span></b>
        <span>Fecha: <span id="orderDate"></span></span>
      </div>
    </header>

    <section class="section">
      <div class="card">
        <h3>Remitente / Datos de la Empresa</h3>
        <div class="company">
          <div>
            <b>LATIN PHONE Florida (USA)</b><br />
            Latinphone Store LLC<br />
            8400 NW 36th St, Suite 215<br />
            Doral, FL 33166, United States<br />
            <b>EIN:</b> 65-9876543
          </div>
          <div>
            <b>Oficina Caracas</b><br />
            Torre Cavendes, Piso 8, Oficina L8-9C<br />
            Caracas, Venezuela<br />
            <a href="mailto:latinphone@usa.com">latinphone@usa.com</a><br />
            Tel: +1 (813) 358-4564
          </div>
        </div>
      </div>
    </section>

    <section class="section grid" aria-label="Datos de cliente y entrega">
      <div class="card">
        <h3>Facturación (Cliente)</h3>
        <div class="kv"><b>Nombre</b><span id="custName"></span></div>
        <div class="kv"><b>Documento</b><span id="custDoc"></span></div>
        <div class="kv"><b>Teléfono</b><span id="custPhone"></span></div>
        <div class="kv"><b>Dirección</b><span id="custAddress"></span></div>
        <div class="kv"><b>Estado</b><span id="custState"></span></div>
        <div class="kv"><b>Ciudad</b><span id="custCity"></span></div>

        <div class="idbox">
            <span class="pill">Documento de identidad adjunto</span>
            </div>
      </div>

      <div class="card">
        <h3>Entrega / Transporte</h3>
        <div class="carrier">
          <b>Empresa:</b> <img id="courierLogo" alt="" style="height:24px;"> <span id="courierName"></span>
        </div>
        <div class="kv"><b>Estado</b><span id="shipState"></span></div>
        <div class="kv"><b>Ciudad</b><span id="shipCity"></span></div>
        
        <div class="timeline" aria-label="Línea de tiempo de entrega">
          <div class="step done">
            <div class="title">Comprado</div>
            <div class="date">07/09/2025</div>
          </div>
          <div class="step current">
            <div class="title">Despacho</div>
            <div class="date">07–08/09</div>
          </div>
          <div class="step">
            <div class="title">En tránsito</div>
            <div class="date">09/09</div>
          </div>
          <div class="step">
            <div class="title">Para retiro</div>
            <div class="date">10/09 (est.)</div>
          </div>
        </div>
        
        <div class="note" role="note">
            <b>Importante:</b> el paquete solo puede ser retirado por el titular presentando su documento de identidad.
        </div>
      </div>
    </section>

    <section class="section" aria-label="Detalle de compra">
      <div class="card">
        <h3>Productos</h3>
        <div class="table-responsive">
          <table role="table" aria-label="Tabla de productos">
          <thead>
            <tr>
              <th>Descripción</th>
              <th class="right">Cant.</th>
              <th class="right" id="priceHeader">Precio (USD)</th>
              <th class="right" id="amountHeader">Importe (USD)</th>
            </tr>
          </thead>
          <tbody id="productsBody"></tbody>
          </table>
        </div>

        <div class="total-summary" aria-label="Resumen de totales">
          <div class="row"><span>Subtotal</span><b id="subtotalUSD"></b></div>
          <div class="row"><span id="taxLabel">IVA (16%)</span><b id="taxUSD"></b></div>
          <div class="row"><span>Envío</span><b id="shippingUSD"></b></div>
          <div class="row grand"><span id="totalLabel">Total USD</span><span id="totalUSD"></span></div>
          <div class="row"><span class="badge" id="natLabel">Tasa de nacionalización</span><b id="natStatus" class="badge"></b></div>
          <div class="row" id="natPendingMsg" style="display:none;color:var(--danger);font-size:12px">Pendiente por pago. La compra podría ser anulada.</div>
        </div>
        
        <div style="margin-top:20px;display:flex;gap:12px;flex-wrap:wrap">
            <div class="pill">Pago: Tarjeta</div>
            <div class="pill">Transporte: <span id="courierPill"></span></div>
            <div class="pill">Estado: <span id="statusPill" class="badge success"></span></div>
        </div>

      </div>
    </section>
    
    <section class="section" aria-label="Acciones y Observaciones">
        <div class="grid">
            <div class="card">
                <h3>Observaciones</h3>
                <p class="muted-text" style="margin:0">
                    Gracias por tu compra. Te enviaremos la guía y número de rastreo al momento del despacho. La tasa de nacionalización, de aplicar, será gestionada por el cliente.
                </p>
            </div>
            <div class="card">
                <h3>Acciones</h3>
                <div class="actions">
                    <a href="#" class="btn btn-primary">Descargar PDF</a>
                    <a href="#" class="btn btn-secondary">Imprimir</a>
                    <a href="miseguimiento.html" class="btn btn-secondary">Ver tracking</a>
                </div>
            </div>
        </div>
    </section>

    <footer>
      <div>LatinPhone © 2025 — Comprobante válido con número de orden.</div>
      <div>Generado: <span id="orderDateFooter"></span> • Orden: <span id="orderIdFooter"></span></div>
    </footer>
  </article>

  <!-- Aviso de nacionalización -->
  <div id="alertOverlay" class="alert-overlay">
    <div class="alert-box">
      <div class="plane" aria-hidden="true">✈️</div>
      <p>¡El equipo ya va en camino!</p>
      <p>La nacionalización fue pagada con éxito.</p>
      <button id="alertClose" class="alert-close">Cerrar</button>
    </div>
  </div>

  <script>
  (function(){
    const overlay = document.getElementById('alertOverlay');
    const closeBtn = document.getElementById('alertClose');
    if(closeBtn) closeBtn.addEventListener('click', ()=> overlay.style.display='none');

    const courierInfo = {
      dhl:{name:'DHL',logo:'https://www.logo.wine/a/logo/DHL/DHL-Logo.wine.svg'},
      fedex:{name:'FedEx',logo:'https://www.logo.wine/a/logo/FedEx_Express/FedEx_Express-Logo.wine.svg'},
      zoom:{name:'ZOOM',logo:'https://upload.wikimedia.org/wikipedia/commons/7/71/Grupo_ZOOM_logo.png?20211116211646'},
      tealca:{name:'TEALCA',logo:'https://www.tealca.es/wp-content/uploads/logo.png'},
      mrw:{name:'MRW',logo:'https://upload.wikimedia.org/wikipedia/commons/2/26/MRW_logo.svg'},
      liberty:{name:'Liberty Express',logo:'https://libertyexpress.com/wp-content/themes/kutis/assets/svg/logo_banner.svg'}
    };

    const country = localStorage.getItem('lpCountry');
    const currency = country === 'colombia' ? 'COP' : 'USD';
    const locale = country === 'colombia' ? 'es-CO' : 'es-ES';
    const rate = country === 'colombia' ? 4000 : 1;
    const fmt = (val) => new Intl.NumberFormat(locale,{style:'currency',currency}).format(val * rate);

    const orders = JSON.parse(localStorage.getItem('lpOrders')||'[]');
    if(!orders.length) return;
    const order = orders[orders.length-1];
    const user = JSON.parse(localStorage.getItem('lpUser')||'{}');
    const address = (JSON.parse(localStorage.getItem('lpAddresses')||'[]'))[0]||{};
    const totals = order.totals || JSON.parse(localStorage.getItem('latinphone_cart_totals')||'{}');
    const courier = courierInfo[order.shipping?.courier] || {name: order.shipping?.courier || '', logo:''};

    document.getElementById('orderId').textContent = order.id;
    document.getElementById('orderDate').textContent = order.date;
    document.getElementById('orderIdFooter').textContent = order.id;
    document.getElementById('orderDateFooter').textContent = order.date;
    document.getElementById('custName').textContent = user.name || '';
    document.getElementById('custDoc').textContent = user.doc || '';
    document.getElementById('custPhone').textContent = user.phone || '';
    document.getElementById('custAddress').textContent = address.line1 || '';
    document.getElementById('custState').textContent = address.region || '';
    document.getElementById('custCity').textContent = address.city || '';
    document.getElementById('shipState').textContent = address.region || '';
    document.getElementById('shipCity').textContent = address.city || '';
    document.getElementById('courierLogo').src = courier.logo;
    document.getElementById('courierLogo').alt = courier.name;
    document.getElementById('courierName').textContent = courier.name;
    document.getElementById('courierPill').textContent = courier.name.toUpperCase();
    document.getElementById('statusPill').textContent = order.status;

    const tbody = document.getElementById('productsBody');
    order.items.forEach(it=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${it.name} — <i>${it.color||''}</i></td><td class="right">${it.qty}</td><td class="right">${fmt(it.price)}</td><td class="right">${fmt(it.price*it.qty)}</td>`;
      tbody.appendChild(tr);
    });

    document.getElementById('subtotalUSD').textContent = fmt(totals.subtotal||0);
    document.getElementById('taxUSD').textContent = fmt(totals.tax||0);
    document.getElementById('shippingUSD').textContent = fmt(totals.shipping||0);
    document.getElementById('totalUSD').textContent = fmt((totals.total!==undefined?totals.total:order.total)||0);

    document.getElementById('priceHeader').textContent = `Precio (${currency})`;
    document.getElementById('amountHeader').textContent = `Importe (${currency})`;
    document.getElementById('totalLabel').textContent = `Total ${currency}`;
    document.getElementById('taxLabel').textContent = country === 'colombia' ? 'IVA (19%)' : 'IVA (16%)';

    const natStatus = document.getElementById('natStatus');
    const natPendingMsg = document.getElementById('natPendingMsg');
    const proof = localStorage.getItem(`lp_nacionalizacion_${order.id}`);
    const natDone = proof || localStorage.getItem('lpNationalizationDone') === 'true';
    overlay.style.display = natDone ? 'flex' : 'none';
    if(natDone){
      natStatus.textContent = 'Pagada';
      natStatus.classList.add('success');
    }else{
      natStatus.textContent = 'Pendiente';
      natStatus.classList.add('danger');
      natPendingMsg.style.display = 'block';
    }
  })();
  </script>
</body>
</html>
