<!DOCTYPE html>
<html lang="es">
<head>
  <script src="repair.js"></script>
  <script src="js/exchange-rate.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>REMEEX - Verificación de Identidad</title>
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="apple-touch-icon" href="visabluapple.png">
  <meta name="description" content="Remeex VISA: Verificación de identidad segura y rápida."/>
  <meta name="theme-color" content="#1a1f71">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="REMEEX">
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="theme.css">

  <style>
    :root {
      --primary: #1a1f71;
      --primary-dark: #0c1045;
      --primary-light: #3244b6;
      --secondary: #00579f;
      --accent: #f7b600;
      --success: #00d34d;
      --danger: #ff4d4d;
      --warning: #ffad33;
      --info: #0095ff;
      --neutral-100: #ffffff;
      --neutral-200: #f5f7fa;
      --neutral-300: #eaecf0;
      --neutral-400: #d0d5dd;
      --neutral-500: #9da4b4;
      --neutral-600: #6e7891;
      --neutral-700: #4f5d75;
      --neutral-800: #293249;
      --neutral-900: #1a1f37;

      --shadow-sm: 0 1px 3px rgba(16, 24, 40, 0.1);
      --shadow-md: 0 4px 8px -2px rgba(16, 24, 40, 0.1), 0 2px 4px -2px rgba(16, 24, 40, 0.06);
      --shadow-lg: 0 12px 16px -4px rgba(16, 24, 40, 0.08), 0 4px 6px -2px rgba(16, 24, 40, 0.03);
      --shadow-xl: 0 20px 24px -4px rgba(16, 24, 40, 0.08), 0 8px 8px -4px rgba(16, 24, 40, 0.03);
      
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --radius-full: 9999px;
      
      --transition-fast: all 0.2s ease;
      --transition-base: all 0.3s ease;
      --transition-slow: all 0.5s ease;
      
      --card-gradient: linear-gradient(135deg, #1a1f71 0%, #0c1045 100%);
      --success-gradient: linear-gradient(135deg, #00c057 0%, #00a346 100%);
      
      --animation-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);

      --header-height: 70px;
      --nav-height: 70px;
      --wizard-nav-height: 60px;
      --safe-area-top: env(safe-area-inset-top, 0px);
      --safe-area-bottom: env(safe-area-inset-bottom, 0px);
    }

    @supports (height: 100dvh) {
      :root {
        --vh: 100dvh;
      }
    }

    @supports not (height: 100dvh) {
      :root {
        --vh: 100vh;
      }
    }

    @media (max-width: 480px) {
      html { 
        font-size: 90%; 
      }
      :root {
        --header-height: 65px;
        --nav-height: 65px;
        --wizard-nav-height: 55px;
      }
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      height: 100%;
      height: var(--vh);
      overflow-x: hidden;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--neutral-200);
      color: var(--neutral-900);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      position: relative;
      display: flex;
      flex-direction: column;
      min-height: 100%;
      min-height: var(--vh);
    }
    
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--neutral-200);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--neutral-500);
      border-radius: var(--radius-full);
    }

    .main-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      padding-top: var(--header-height);
      padding-bottom: var(--nav-height);
    }

    .header-container {
      position: fixed;
      top: 0;
      top: var(--safe-area-top);
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-bottom: 1px solid var(--neutral-300);
      box-shadow: var(--shadow-sm);
      z-index: 1000;
      height: var(--header-height);
      display: flex;
      align-items: center;
      padding: 0 1rem;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }

    .header-info {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      min-width: 0;
    }

    .welcome-text {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .greeting {
      font-size: 0.85rem;
      color: var(--neutral-600);
    }

    .user-name {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--neutral-900);
    }

    .header-avatar {
      width: 24px;
      height: 24px;
      border-radius: var(--radius-full);
      background: var(--card-gradient);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 600;
      flex-shrink: 0;
    }

    .users-online {
      font-size: 0.7rem;
      color: var(--neutral-500);
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .balance-card-compact {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: var(--neutral-200);
      padding: 0.5rem 0.75rem;
      border-radius: var(--radius-md);
    }

    .balance-main {
      display: flex;
      flex-direction: column;
      gap: 0.125rem;
    }

    .balance-amount {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 1rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .currency-toggle-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.125rem 0.375rem;
      border-radius: var(--radius-sm);
      font-size: 0.65rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .currency-toggle-btn:hover {
      background: var(--primary-light);
    }

    .balance-equivalent {
      font-size: 0.65rem;
      color: var(--neutral-600);
    }

    .mode-toggle {}

    .toggle-mode-btn {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      background: var(--neutral-300);
      border: none;
      padding: 0.375rem 0.625rem;
      border-radius: var(--radius-md);
      font-size: 0.7rem;
      font-weight: 500;
      color: var(--neutral-700);
      cursor: pointer;
      transition: var(--transition-base);
      min-width: 55px;
    }

    .toggle-mode-btn:hover {
      background: var(--neutral-400);
    }

    .toggle-mode-btn i {
      font-size: 0.85rem;
    }

    .wizard-container {
      flex: 1;
      overflow-y: auto;
      padding: 0.75rem;
      max-width: 100%;
      margin: 0 auto;
    }

    .progress-container-wizard {
      margin-bottom: 1.5rem;
    }

    .progress-bar-wizard {
      height: 6px;
      background: var(--neutral-300);
      border-radius: var(--radius-full);
      overflow: hidden;
      margin-bottom: 0.75rem;
    }

    .progress-fill-wizard {
      height: 100%;
      background: var(--card-gradient);
      transition: width 0.4s var(--animation-bounce);
      border-radius: var(--radius-full);
    }

    .progress-text-wizard {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.85rem;
      color: var(--neutral-600);
    }

    .progress-percentage-wizard {
      font-weight: 600;
      color: var(--primary);
    }

    .wizard-step {
      display: none;
      animation: fadeIn 0.4s ease;
    }

    .wizard-step.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .step-header {
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .step-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--neutral-900);
      margin-bottom: 0.5rem;
    }

    .step-subtitle {
      font-size: 0.95rem;
      color: var(--neutral-600);
    }

    .card {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      box-shadow: var(--shadow-md);
      margin-bottom: 1rem;
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .card-icon {
      width: 56px;
      height: 56px;
      background: var(--card-gradient);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.75rem;
      flex-shrink: 0;
    }

    .card-icon.success {
      background: var(--success-gradient);
    }

    .card-icon.warning {
      background: linear-gradient(135deg, var(--warning) 0%, #ff9500 100%);
    }

    .card-icon.info {
      background: linear-gradient(135deg, var(--info) 0%, #0077cc 100%);
    }

    .card-title-group h2 {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--neutral-900);
      margin-bottom: 0.25rem;
    }

    .card-subtitle {
      font-size: 0.9rem;
      color: var(--neutral-600);
    }

    .card-body {
      line-height: 1.7;
      color: var(--neutral-700);
    }

    .card-body p {
      margin-bottom: 1rem;
    }

    .card-body p:last-child {
      margin-bottom: 0;
    }

    .info-box {
      background: linear-gradient(135deg, rgba(0, 149, 255, 0.1) 0%, rgba(0, 149, 255, 0.05) 100%);
      border-left: 4px solid var(--info);
      border-radius: var(--radius-md);
      padding: 1rem;
      margin: 1rem 0;
    }

    .info-box-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .info-box-icon {
      width: 32px;
      height: 32px;
      background: var(--info);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1rem;
    }

    .info-box-title {
      font-weight: 600;
      color: var(--info);
      font-size: 0.95rem;
    }

    .info-box-content {
      font-size: 0.9rem;
      color: var(--neutral-700);
      line-height: 1.6;
    }

    .warning-box {
      background: linear-gradient(135deg, rgba(255, 173, 51, 0.1) 0%, rgba(255, 173, 51, 0.05) 100%);
      border-left: 4px solid var(--warning);
      border-radius: var(--radius-md);
      padding: 1rem;
      margin: 1rem 0;
    }

    .warning-box-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .warning-box-icon {
      width: 32px;
      height: 32px;
      background: var(--warning);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1rem;
    }

    .warning-box-title {
      font-weight: 600;
      color: var(--warning);
      font-size: 0.95rem;
    }

    .warning-box-content {
      font-size: 0.9rem;
      color: var(--neutral-700);
      line-height: 1.6;
    }

    .success-box {
      background: linear-gradient(135deg, rgba(0, 211, 77, 0.1) 0%, rgba(0, 211, 77, 0.05) 100%);
      border-left: 4px solid var(--success);
      border-radius: var(--radius-md);
      padding: 1rem;
      margin: 1rem 0;
    }

    .success-box-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .success-box-icon {
      width: 32px;
      height: 32px;
      background: var(--success);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1rem;
    }

    .success-box-title {
      font-weight: 600;
      color: var(--success);
      font-size: 0.95rem;
    }

    .success-box-content {
      font-size: 0.9rem;
      color: var(--neutral-700);
      line-height: 1.6;
    }

    .steps-list {
      list-style: none;
      margin: 1.5rem 0;
    }

    .steps-list li {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      transition: var(--transition-base);
    }

    .steps-list li:hover {
      background: var(--neutral-300);
      transform: translateX(4px);
    }

    .step-number {
      width: 32px;
      height: 32px;
      background: var(--card-gradient);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 0.9rem;
      flex-shrink: 0;
    }

    .step-content {
      flex: 1;
      padding-top: 0.25rem;
    }

    .step-title-item {
      font-weight: 600;
      color: var(--neutral-900);
      margin-bottom: 0.25rem;
      font-size: 0.95rem;
    }

    .step-description {
      color: var(--neutral-700);
      font-size: 0.85rem;
      line-height: 1.5;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      font-weight: 500;
      color: var(--neutral-900);
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }

    .form-input {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 2px solid var(--neutral-300);
      border-radius: var(--radius-md);
      font-size: 1rem;
      font-family: inherit;
      transition: var(--transition-fast);
      background: var(--neutral-100);
      color: var(--neutral-900);
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(26, 31, 113, 0.1);
    }

    .form-input.code-input {
      font-size: 1.5rem;
      font-weight: 600;
      text-align: center;
      letter-spacing: 0.5rem;
      font-family: 'Courier New', monospace;
    }

    .form-hint {
      display: block;
      margin-top: 0.5rem;
      font-size: 0.85rem;
      color: var(--neutral-600);
    }

    .form-error {
      display: none;
      margin-top: 0.5rem;
      font-size: 0.85rem;
      color: var(--danger);
    }

    .form-error.show {
      display: block;
    }

    .credentials-box {
      background: var(--neutral-200);
      border: 2px dashed var(--neutral-400);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      margin: 1rem 0;
    }

    .credential-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem;
      background: var(--neutral-100);
      border-radius: var(--radius-sm);
      margin-bottom: 0.75rem;
    }

    .credential-item:last-child {
      margin-bottom: 0;
    }

    .credential-label {
      font-weight: 500;
      color: var(--neutral-700);
      font-size: 0.9rem;
    }

    .credential-value {
      font-weight: 600;
      color: var(--primary);
      font-size: 1rem;
      font-family: 'Courier New', monospace;
    }

    .wizard-navigation {
      position: fixed;
      bottom: var(--nav-height);
      bottom: calc(var(--nav-height) + var(--safe-area-bottom));
      left: 0;
      right: 0;
      background: var(--neutral-100);
      padding: 0.75rem;
      box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.05);
      z-index: 899;
      display: flex;
      gap: 0.75rem;
      max-width: 100%;
      height: var(--wizard-nav-height);
      align-items: center;
    }

    .nav-btn {
      flex: 1;
      height: 45px;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 0.9rem;
      border: none;
      cursor: pointer;
      transition: all 0.3s var(--animation-bounce);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .nav-btn.primary {
      background: var(--primary);
      color: white;
    }

    .nav-btn.primary:hover:not(:disabled):not(.disabled) {
      background: var(--primary-light);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .nav-btn.secondary {
      background: transparent;
      border: 2px solid var(--neutral-400);
      color: var(--neutral-700);
    }

    .nav-btn.secondary:hover {
      background: var(--neutral-200);
      transform: translateY(-2px);
    }

    .nav-btn:disabled,
    .nav-btn.disabled {
      background: var(--neutral-400);
      color: var(--neutral-600);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      bottom: var(--safe-area-bottom);
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top: 1px solid var(--neutral-300);
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
      z-index: 900;
      height: var(--nav-height);
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 0 0.5rem;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      padding: 0.5rem;
      flex: 1;
      max-width: 80px;
      text-decoration: none;
      color: var(--neutral-600);
      transition: var(--transition-base);
      border-radius: var(--radius-md);
      cursor: pointer;
    }

    .nav-item:hover {
      background: rgba(26, 31, 113, 0.05);
    }

    .nav-item.active {
      color: var(--primary);
    }

    .nav-icon {
      font-size: 1.2rem;
    }

    .nav-label {
      font-size: 0.7rem;
      font-weight: 500;
    }

    .checkmark-container {
      display: flex;
      justify-content: center;
      margin: 2rem 0;
    }

    .checkmark {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: block;
      stroke-width: 3;
      stroke: white;
      stroke-miterlimit: 10;
      box-shadow: inset 0px 0px 0px var(--success);
      animation: fill 0.4s ease-in-out 0.4s forwards, scale 0.3s ease-in-out 0.9s both;
    }

    .checkmark-circle {
      stroke-dasharray: 166;
      stroke-dashoffset: 166;
      stroke-width: 3;
      stroke-miterlimit: 10;
      stroke: var(--success);
      fill: none;
      animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
    }

    .checkmark-check {
      transform-origin: 50% 50%;
      stroke-dasharray: 48;
      stroke-dashoffset: 48;
      animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
    }

    @keyframes stroke {
      100% {
        stroke-dashoffset: 0;
      }
    }

    @keyframes scale {
      0%, 100% {
        transform: none;
      }
      50% {
        transform: scale3d(1.1, 1.1, 1);
      }
    }

    @keyframes fill {
      100% {
        box-shadow: inset 0px 0px 0px 30px var(--success);
      }
    }

    .hidden {
      display: none !important;
    }

    /* Modal Overlay */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      z-index: 9999;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      animation: fadeIn 0.3s ease;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--neutral-100);
      border-radius: var(--radius-xl);
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-xl);
      animation: scaleIn 0.3s var(--animation-bounce);
    }

    @keyframes scaleIn {
      from {
        transform: scale(0.9);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--neutral-300);
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .modal-icon {
      width: 48px;
      height: 48px;
      background: var(--card-gradient);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .modal-title-group h3 {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--neutral-900);
      margin-bottom: 0.25rem;
    }

    .modal-subtitle {
      font-size: 0.85rem;
      color: var(--neutral-600);
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-section {
      margin-bottom: 1.5rem;
    }

    .modal-section:last-child {
      margin-bottom: 0;
    }

    .modal-section-title {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--neutral-900);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .modal-section-title i {
      color: var(--primary);
    }

    .modal-credentials {
      background: var(--neutral-200);
      border: 2px solid var(--primary);
      border-radius: var(--radius-lg);
      padding: 1.25rem;
    }

    .modal-credential-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem;
      background: var(--neutral-100);
      border-radius: var(--radius-sm);
      margin-bottom: 0.75rem;
    }

    .modal-credential-item:last-child {
      margin-bottom: 0;
    }

    .modal-credential-label {
      font-weight: 500;
      color: var(--neutral-700);
      font-size: 0.9rem;
    }

    .modal-credential-value {
      font-weight: 700;
      color: var(--primary);
      font-size: 1.05rem;
      font-family: 'Courier New', monospace;
    }

    .modal-steps-list {
      list-style: none;
      padding-left: 0;
    }

    .modal-steps-list li {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      margin-bottom: 0.75rem;
      font-size: 0.9rem;
      color: var(--neutral-700);
    }

    .modal-steps-list li:last-child {
      margin-bottom: 0;
    }

    .modal-step-number {
      width: 24px;
      height: 24px;
      background: var(--primary);
      color: white;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: 600;
      flex-shrink: 0;
    }

    .modal-footer {
      padding: 1.5rem;
      border-top: 1px solid var(--neutral-300);
      display: flex;
      gap: 0.75rem;
    }

    .modal-btn {
      flex: 1;
      padding: 0.875rem 1.5rem;
      border: none;
      border-radius: var(--radius-md);
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition-base);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .modal-btn-secondary {
      background: var(--neutral-300);
      color: var(--neutral-700);
    }

    .modal-btn-secondary:hover {
      background: var(--neutral-400);
    }

    .modal-btn-primary {
      background: var(--card-gradient);
      color: white;
      box-shadow: var(--shadow-md);
    }

    .modal-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    @media (max-width: 576px) {
      .step-title {
        font-size: 1.2rem;
      }

      .step-subtitle {
        font-size: 0.8rem;
      }

      .nav-item {
        max-width: 60px;
      }

      .nav-label {
        font-size: 0.55rem;
      }

      .users-online {
        display: none;
      }

      .modal {
        border-radius: var(--radius-lg);
        max-height: 85vh;
      }

      .modal-header {
        padding: 1.25rem;
      }

      .modal-icon {
        width: 40px;
        height: 40px;
        font-size: 1.25rem;
      }

      .modal-title-group h3 {
        font-size: 1.1rem;
      }

      .modal-body {
        padding: 1.25rem;
      }

      .modal-footer {
        padding: 1.25rem;
        flex-direction: column;
      }

      .modal-btn {
        width: 100%;
      }

      .modal-credentials {
        padding: 1rem;
      }

      .modal-credential-value {
        font-size: 0.9rem;
      }
    }

    @media (min-width: 768px) {
      .wizard-container {
        max-width: 700px;
        padding: 1rem 1.5rem;
      }

      .wizard-navigation {
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        max-width: 700px;
      }
    }
  </style>
</head>

<body>
  <!-- Main Container -->
  <div class="main-container">
    <!-- Header con Balance Siempre Visible -->
    <div class="header-container">
      <div class="header-content">
        <div class="header-info">
          <div class="welcome-text">
            <span class="greeting">Hola</span>
            <span class="user-name" id="user-name">Usuario</span>
            <div class="header-avatar" id="header-avatar">U</div>
          </div>
          <div id="users-online-count" class="users-online">98 usuarios conectados</div>
        </div>
        
        <!-- Balance Card Compacta -->
        <div class="balance-card-compact">
          <div class="balance-main">
            <div class="balance-amount">
              <span id="balance-value">Bs 0,00</span>
              <button id="currency-toggle" class="currency-toggle-btn">USD</button>
            </div>
            <div id="balance-equivalent-display" class="balance-equivalent">≈ $0.00 | ≈ €0.00</div>
          </div>
          <div class="mode-toggle">
            <button id="toggle-mode-btn" class="toggle-mode-btn" onclick="window.location.href='homevisa.html'">
              <i class="fas fa-home"></i>
              <span id="mode-toggle-text">Inicio</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Wizard Container -->
    <div id="wizard-container" class="wizard-container">
      <!-- Barra de progreso -->
      <div class="progress-container-wizard" id="progressContainer">
        <div class="progress-bar-wizard">
          <div class="progress-fill-wizard" id="progressFill" style="width: 0%"></div>
        </div>
        <div class="progress-text-wizard">
          <span>Verificación de Identidad</span>
          <span class="progress-percentage-wizard" id="progressPercentage">0%</span>
        </div>
      </div>

      <!-- Step 1: Bienvenida -->
      <div id="wizard-step-1" class="wizard-step active">
        <div class="step-header">
          <h2 class="step-title">Bienvenido al Proceso de Verificación</h2>
          <p class="step-subtitle">Vamos a verificar tu identidad paso a paso</p>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-user-shield"></i>
            </div>
            <div class="card-title-group">
              <h2>Verificación de Identidad</h2>
              <p class="card-subtitle">Proceso seguro y rápido</p>
            </div>
          </div>
          <div class="card-body">
            <p>Has solicitado volver a realizar el proceso de verificación de identidad para tu cuenta REMEEX VISA.</p>
            <p>Este proceso es necesario para garantizar la seguridad de tu cuenta y cumplir con las normativas vigentes.</p>
          </div>
        </div>

        <div class="info-box">
          <div class="info-box-header">
            <div class="info-box-icon">
              <i class="fas fa-clock"></i>
            </div>
            <span class="info-box-title">Tiempo estimado</span>
          </div>
          <div class="info-box-content">
            El proceso completo toma aproximadamente 5-10 minutos. Asegúrate de tener tiempo disponible antes de continuar.
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: var(--neutral-900);">¿Qué necesitas?</h3>
            <ul class="steps-list">
              <li>
                <div class="step-number">1</div>
                <div class="step-content">
                  <div class="step-title-item">Código UBII</div>
                  <div class="step-description">El código de 6 dígitos que recibiste en tu teléfono móvil</div>
                </div>
              </li>
              <li>
                <div class="step-number">2</div>
                <div class="step-content">
                  <div class="step-title-item">Documento de identidad</div>
                  <div class="step-description">Tu documento vigente y en buen estado (cédula o pasaporte)</div>
                </div>
              </li>
              <li>
                <div class="step-number">3</div>
                <div class="step-content">
                  <div class="step-title-item">Buena conexión a internet</div>
                  <div class="step-description">Para completar el proceso sin interrupciones</div>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Step 2: Código UBII -->
      <div id="wizard-step-2" class="wizard-step">
        <div class="step-header">
          <h2 class="step-title">Código UBII</h2>
          <p class="step-subtitle">Verifica tu número de teléfono</p>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-icon info">
              <i class="fas fa-mobile-alt"></i>
            </div>
            <div class="card-title-group">
              <h2>Código de Verificación</h2>
              <p class="card-subtitle">Ingresa el código recibido</p>
            </div>
          </div>
          <div class="card-body">
            <p>Ingresa el código de 6 dígitos que recibiste en tu teléfono móvil.</p>
          </div>
        </div>

        <div class="card">
          <form id="codeForm" onsubmit="validateCode(event)">
            <div class="form-group">
              <label class="form-label" for="ubiiCode">Código UBII</label>
              <input 
                type="text" 
                id="ubiiCode" 
                class="form-input code-input" 
                placeholder="000000"
                maxlength="6"
                pattern="[0-9]{6}"
                required
                autocomplete="off"
                inputmode="numeric"
              >
              <span class="form-hint">Ingresa los 6 dígitos recibidos por SMS</span>
              <span class="form-error" id="codeError">El código debe tener 6 dígitos</span>
            </div>
          </form>
        </div>

        <div class="info-box">
          <div class="info-box-header">
            <div class="info-box-icon">
              <i class="fas fa-info-circle"></i>
            </div>
            <span class="info-box-title">¿No recibiste el código?</span>
          </div>
          <div class="info-box-content">
            Si no has recibido el código, verifica que tu número de teléfono esté correcto o contacta con soporte.
          </div>
        </div>
      </div>

      <!-- Step 3: Preparación de Documento -->
      <div id="wizard-step-3" class="wizard-step">
        <div class="step-header">
          <h2 class="step-title">Documento de Identidad</h2>
          <p class="step-subtitle">Prepara tu documento</p>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-icon warning">
              <i class="fas fa-id-card"></i>
            </div>
            <div class="card-title-group">
              <h2>Documento Requerido</h2>
              <p class="card-subtitle">Vigente y en buen estado</p>
            </div>
          </div>
          <div class="card-body">
            <p>Antes de continuar, asegúrate de tener tu documento de identidad vigente y en buen estado a la mano.</p>
          </div>
        </div>

        <div class="warning-box">
          <div class="warning-box-header">
            <div class="warning-box-icon">
              <i class="fas fa-exclamation-triangle"></i>
            </div>
            <span class="warning-box-title">Requisitos del documento</span>
          </div>
          <div class="warning-box-content">
            Tu documento debe estar vigente, en buen estado, sin daños visibles y completamente legible. No se aceptan copias o fotografías de documentos.
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: var(--neutral-900);">Documentos aceptados</h3>
            <ul class="steps-list">
              <li>
                <div class="step-number"><i class="fas fa-check"></i></div>
                <div class="step-content">
                  <div class="step-title-item">Cédula de Identidad</div>
                  <div class="step-description">Documento vigente y en buen estado</div>
                </div>
              </li>
              <li>
                <div class="step-number"><i class="fas fa-check"></i></div>
                <div class="step-content">
                  <div class="step-title-item">Pasaporte</div>
                  <div class="step-description">Pasaporte vigente con foto visible</div>
                </div>
              </li>
            </ul>
          </div>
        </div>

        <div class="info-box">
          <div class="info-box-header">
            <div class="info-box-icon">
              <i class="fas fa-camera"></i>
            </div>
            <span class="info-box-title">Condiciones de iluminación</span>
          </div>
          <div class="info-box-content">
            Busca un lugar bien iluminado y evita reflejos en tu documento. La cámara de tu dispositivo debe estar limpia.
          </div>
        </div>
      </div>

      <!-- Step 4: Instrucciones UbiiPagos -->
      <div id="wizard-step-4" class="wizard-step">
        <div class="step-header">
          <h2 class="step-title">Verificación con UbiiPagos</h2>
          <p class="step-subtitle">Proveedor de identidad autorizado</p>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-icon info">
              <i class="fas fa-building"></i>
            </div>
            <div class="card-title-group">
              <h2>Proveedor de Identidad</h2>
              <p class="card-subtitle">UbiiPagos - Servicio Seguro</p>
            </div>
          </div>
          <div class="card-body">
            <p>Utilizaremos el proveedor de identidad y banca <strong>UbiiPagos</strong> para verificar tu identidad de forma segura.</p>
          </div>
        </div>

        <div class="info-box">
          <div class="info-box-header">
            <div class="info-box-icon">
              <i class="fas fa-shield-alt"></i>
            </div>
            <span class="info-box-title">Proceso seguro</span>
          </div>
          <div class="info-box-content">
            UbiiPagos es un proveedor autorizado y seguro. Tus datos están protegidos durante todo el proceso.
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: var(--neutral-900);">Pasos a seguir en UbiiPagos</h3>
            <ul class="steps-list">
              <li>
                <div class="step-number">1</div>
                <div class="step-content">
                  <div class="step-title-item">Iniciar sesión</div>
                  <div class="step-description">En la sección <strong>Persona Natural</strong>, inicia sesión con las credenciales proporcionadas abajo</div>
                </div>
              </li>
              <li>
                <div class="step-number">2</div>
                <div class="step-content">
                  <div class="step-title-item">Completar documentos</div>
                  <div class="step-description">Una vez dentro, haz clic en el botón <strong>"Completar Documentos"</strong></div>
                </div>
              </li>
              <li>
                <div class="step-number">3</div>
                <div class="step-content">
                  <div class="step-title-item">Seguir el proceso</div>
                  <div class="step-description">Sigue las instrucciones en pantalla para completar la verificación con tu documento</div>
                </div>
              </li>
              <li>
                <div class="step-number">4</div>
                <div class="step-content">
                  <div class="step-title-item">Cerrar sesión</div>
                  <div class="step-description">Una vez finalizado, cierra sesión en UbiiPagos</div>
                </div>
              </li>
            </ul>
          </div>
        </div>

        <div class="credentials-box">
          <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--neutral-900); text-align: center;">
            <i class="fas fa-key"></i> Credenciales de acceso
          </h3>
          <div class="credential-item">
            <span class="credential-label">Email:</span>
            <span class="credential-value">cesarperez@remeexvisa.com</span>
          </div>
          <div class="credential-item">
            <span class="credential-label">Clave:</span>
            <span class="credential-value">firma1215**</span>
          </div>
          <div class="credential-item">
            <span class="credential-label">Sección:</span>
            <span class="credential-value">Persona Natural</span>
          </div>
        </div>

        <div class="warning-box">
          <div class="warning-box-header">
            <div class="warning-box-icon">
              <i class="fas fa-clipboard-check"></i>
            </div>
            <span class="warning-box-title">No olvides</span>
          </div>
          <div class="warning-box-content">
            Después de completar el proceso en UbiiPagos, asegúrate de cerrar sesión correctamente antes de regresar a REMEEX.
          </div>
        </div>
      </div>

      <!-- Step 5: Confirmación Final -->
      <div id="wizard-step-5" class="wizard-step">
        <div class="checkmark-container">
          <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
            <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
            <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
          </svg>
        </div>

        <div class="step-header">
          <h2 class="step-title">Proceso Iniciado</h2>
          <p class="step-subtitle">Verificación en progreso</p>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-icon success">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="card-title-group">
              <h2>¡Listo para Verificar!</h2>
              <p class="card-subtitle">Último paso</p>
            </div>
          </div>
          <div class="card-body">
            <p>Has completado los pasos necesarios para la verificación de identidad.</p>
            <p>Una vez que completes el proceso en UbiiPagos y cierres sesión, regresa a REMEEX VISA.</p>
          </div>
        </div>

        <div class="success-box">
          <div class="success-box-header">
            <div class="success-box-icon">
              <i class="fas fa-hourglass-half"></i>
            </div>
            <span class="success-box-title">Tiempo de confirmación</span>
          </div>
          <div class="success-box-content">
            La confirmación de tu verificación suele demorar aproximadamente <strong>15 minutos</strong>. Recibirás una notificación una vez completada.
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: var(--neutral-900);">Próximos pasos</h3>
            <ul class="steps-list">
              <li>
                <div class="step-number">1</div>
                <div class="step-content">
                  <div class="step-title-item">Completa la verificación en UbiiPagos</div>
                  <div class="step-description">Sigue las instrucciones en la plataforma de UbiiPagos</div>
                </div>
              </li>
              <li>
                <div class="step-number">2</div>
                <div class="step-content">
                  <div class="step-title-item">Cierra sesión</div>
                  <div class="step-description">No olvides cerrar sesión en UbiiPagos al terminar</div>
                </div>
              </li>
              <li>
                <div class="step-number">3</div>
                <div class="step-content">
                  <div class="step-title-item">Espera la confirmación</div>
                  <div class="step-description">Recibirás una notificación cuando tu verificación sea aprobada</div>
                </div>
              </li>
            </ul>
          </div>
        </div>

        <div class="info-box">
          <div class="info-box-header">
            <div class="info-box-icon">
              <i class="fas fa-headset"></i>
            </div>
            <span class="info-box-title">¿Necesitas ayuda?</span>
          </div>
          <div class="info-box-content">
            Si tienes algún problema durante el proceso, no dudes en contactar con nuestro equipo de soporte.
          </div>
        </div>
      </div>
    </div>

    <!-- Wizard Navigation -->
    <div class="wizard-navigation">
      <button class="nav-btn secondary" id="prev-step-btn" onclick="previousStep()" disabled>
        <i class="fas fa-arrow-left"></i>
        <span>Atrás</span>
      </button>
      <button class="nav-btn primary" id="next-step-btn" onclick="nextStep()">
        <span>Continuar</span>
        <i class="fas fa-arrow-right"></i>
      </button>
      <button class="nav-btn primary hidden" id="go-ubiipagos-btn" onclick="showUbiiPagosModal()">
        <span>Ir a UbiiPagos a verificar</span>
        <i class="fas fa-external-link-alt"></i>
      </button>
      <button class="nav-btn primary hidden" id="finish-btn" onclick="goToHome()">
        <i class="fas fa-home"></i>
        <span>Volver a REMEEX</span>
      </button>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
      <a href="homevisa.html" class="nav-item">
        <i class="fas fa-home nav-icon"></i>
        <span class="nav-label">Inicio</span>
      </a>
      <a href="transferencia.html" class="nav-item">
        <i class="fas fa-exchange-alt nav-icon"></i>
        <span class="nav-label">Retirar</span>
      </a>
      <a href="recarga3.html" class="nav-item">
        <i class="fas fa-plus-circle nav-icon"></i>
        <span class="nav-label">Recargar</span>
      </a>
      <a href="#" class="nav-item active">
        <i class="fas fa-shield-check nav-icon"></i>
        <span class="nav-label">Verificar</span>
      </a>
      <a href="perfilvisa.html" class="nav-item">
        <i class="fas fa-user-circle nav-icon"></i>
        <span class="nav-label">Perfil</span>
      </a>
    </div>
  </div>

  <!-- Modal de Confirmación UbiiPagos -->
  <div class="modal-overlay" id="ubiipagos-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-icon">
          <i class="fas fa-building"></i>
        </div>
        <div class="modal-title-group">
          <h3>Ir a UbiiPagos</h3>
          <p class="modal-subtitle">Revisa tus credenciales antes de continuar</p>
        </div>
      </div>

      <div class="modal-body">
        <div class="modal-section">
          <div class="modal-section-title">
            <i class="fas fa-key"></i>
            <span>Credenciales de Acceso</span>
          </div>
          <div class="modal-credentials">
            <div class="modal-credential-item">
              <span class="modal-credential-label">Email:</span>
              <span class="modal-credential-value">cesarperez@remeexvisa.com</span>
            </div>
            <div class="modal-credential-item">
              <span class="modal-credential-label">Contraseña:</span>
              <span class="modal-credential-value">firma1215**</span>
            </div>
            <div class="modal-credential-item">
              <span class="modal-credential-label">Sección:</span>
              <span class="modal-credential-value">Persona Natural</span>
            </div>
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">
            <i class="fas fa-list-check"></i>
            <span>Pasos a Seguir</span>
          </div>
          <ul class="modal-steps-list">
            <li>
              <div class="modal-step-number">1</div>
              <span>Inicia sesión con las credenciales en <strong>Persona Natural</strong></span>
            </li>
            <li>
              <div class="modal-step-number">2</div>
              <span>Haz clic en <strong>"Completar Documentos"</strong></span>
            </li>
            <li>
              <div class="modal-step-number">3</div>
              <span>Sigue el proceso de verificación con tu documento</span>
            </li>
            <li>
              <div class="modal-step-number">4</div>
              <span>Cierra sesión y regresa a REMEEX</span>
            </li>
          </ul>
        </div>

        <div class="info-box">
          <div class="info-box-header">
            <div class="info-box-icon">
              <i class="fas fa-info-circle"></i>
            </div>
            <span class="info-box-title">Importante</span>
          </div>
          <div class="info-box-content">
            Ten tu documento de identidad vigente a la mano. El proceso toma aproximadamente 5 minutos.
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="modal-btn modal-btn-secondary" onclick="closeUbiiPagosModal()">
          <i class="fas fa-times"></i>
          <span>Cancelar</span>
        </button>
        <button class="modal-btn modal-btn-primary" onclick="confirmGoToUbiiPagos()">
          <span>Continuar a UbiiPagos</span>
          <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </div>
  </div>

  <script>
    // Variables globales
    let currentStep = 1;
    const totalSteps = 5;
    const ubiiCode = localStorage.getItem('ubiiVerificationCode') || '';

    // Inicialización
    document.addEventListener('DOMContentLoaded', function() {
      updateProgress();
      updateNavigationButtons();
      loadUserData();
      
      // Auto-rellenar código si existe
      if (ubiiCode) {
        const codeInput = document.getElementById('ubiiCode');
        if (codeInput) {
          codeInput.value = ubiiCode;
        }
      }
    });

    // Cargar datos del usuario
    function loadUserData() {
      try {
        const regData = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
        const userData = JSON.parse(localStorage.getItem('visaUserData') || '{}');
        const data = Object.assign({}, regData, userData);
        
        // Actualizar nombre en header
        if (data.firstName) {
          const userNameEl = document.getElementById('user-name');
          if (userNameEl) {
            userNameEl.textContent = data.firstName;
          }
          
          // Actualizar avatar
          const avatarEl = document.getElementById('header-avatar');
          if (avatarEl && data.firstName) {
            avatarEl.textContent = data.firstName.charAt(0).toUpperCase();
          }
        }

        // Actualizar balance (simulado)
        const balance = data.balance || { bs: 0, usd: 0, eur: 0 };
        updateBalanceDisplay(balance);
      } catch (e) {
        console.error('Error loading user data:', e);
      }
    }

    // Actualizar display del balance
    function updateBalanceDisplay(balance) {
      const balanceValue = document.getElementById('balance-value');
      if (balanceValue && balance) {
        balanceValue.textContent = `Bs ${formatNumber(balance.bs || 0)}`;
      }
      
      const balanceEquiv = document.getElementById('balance-equivalent-display');
      if (balanceEquiv && balance) {
        balanceEquiv.textContent = `≈ $${formatNumber(balance.usd || 0)} | ≈ €${formatNumber(balance.eur || 0)}`;
      }
    }

    // Formatear números
    function formatNumber(num) {
      return new Intl.NumberFormat('es-VE', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }).format(num);
    }

    // Actualizar barra de progreso
    function updateProgress() {
      const progress = (currentStep / totalSteps) * 100;
      document.getElementById('progressFill').style.width = progress + '%';
      document.getElementById('progressPercentage').textContent = Math.round(progress) + '%';
    }

    // Actualizar botones de navegación
    function updateNavigationButtons() {
      const prevBtn = document.getElementById('prev-step-btn');
      const nextBtn = document.getElementById('next-step-btn');
      const ubiiBtn = document.getElementById('go-ubiipagos-btn');
      const finishBtn = document.getElementById('finish-btn');
      
      // Botón Atrás
      if (prevBtn) {
        prevBtn.disabled = currentStep === 1;
      }
      
      // Ocultar todos los botones primero
      if (nextBtn) nextBtn.classList.remove('hidden');
      if (ubiiBtn) ubiiBtn.classList.add('hidden');
      if (finishBtn) finishBtn.classList.add('hidden');
      
      // Mostrar botón correcto según el paso
      if (currentStep === 4) {
        if (nextBtn) nextBtn.classList.add('hidden');
        if (ubiiBtn) ubiiBtn.classList.remove('hidden');
      } else if (currentStep === 5) {
        if (nextBtn) nextBtn.classList.add('hidden');
        if (ubiiBtn) ubiiBtn.classList.add('hidden');
        if (finishBtn) finishBtn.classList.remove('hidden');
      }
    }

    // Navegar al siguiente paso
    function nextStep() {
      // Validar paso actual
      if (currentStep === 2) {
        if (!validateCode()) {
          return;
        }
      }
      
      if (currentStep < totalSteps) {
        // Ocultar paso actual
        document.getElementById('wizard-step-' + currentStep).classList.remove('active');
        
        // Incrementar paso
        currentStep++;
        
        // Mostrar nuevo paso
        document.getElementById('wizard-step-' + currentStep).classList.add('active');
        
        // Actualizar progreso y botones
        updateProgress();
        updateNavigationButtons();
        
        // Scroll al inicio
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    // Navegar al paso anterior
    function previousStep() {
      if (currentStep > 1) {
        // Ocultar paso actual
        document.getElementById('wizard-step-' + currentStep).classList.remove('active');
        
        // Decrementar paso
        currentStep--;
        
        // Mostrar nuevo paso
        document.getElementById('wizard-step-' + currentStep).classList.add('active');
        
        // Actualizar progreso y botones
        updateProgress();
        updateNavigationButtons();
        
        // Scroll al inicio
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    // Validar código UBII
    function validateCode(event) {
      if (event) {
        event.preventDefault();
      }
      
      const codeInput = document.getElementById('ubiiCode');
      const codeError = document.getElementById('codeError');
      const code = codeInput.value.trim();
      
      // Validar que sea un código de 6 dígitos
      if (!/^\d{6}$/.test(code)) {
        codeError.classList.add('show');
        codeInput.style.borderColor = 'var(--danger)';
        return false;
      }
      
      // Guardar código
      localStorage.setItem('ubiiVerificationCode', code);
      
      // Limpiar error
      codeError.classList.remove('show');
      codeInput.style.borderColor = 'var(--success)';
      
      return true;
    }

    // Mostrar modal de UbiiPagos
    function showUbiiPagosModal() {
      const modal = document.getElementById('ubiipagos-modal');
      if (modal) {
        modal.classList.add('active');
        // Prevenir scroll del body
        document.body.style.overflow = 'hidden';
      }
    }

    // Cerrar modal de UbiiPagos
    function closeUbiiPagosModal() {
      const modal = document.getElementById('ubiipagos-modal');
      if (modal) {
        modal.classList.remove('active');
        // Restaurar scroll del body
        document.body.style.overflow = '';
      }
    }

    // Confirmar y ir a UbiiPagos
    function confirmGoToUbiiPagos() {
      localStorage.setItem('ubiiVerificationStarted', Date.now().toString());
      // Avanzar al paso 5 antes de redirigir
      closeUbiiPagosModal();
      nextStep();
      // Redirigir después de un breve delay para que el usuario vea el paso 5
      setTimeout(() => {
        window.location.href = 'https://ubiionline.ubiipagos.com/login';
      }, 1500);
    }

    // Ir a UbiiPagos (función legacy, ahora muestra modal)
    function goToUbiiPagos() {
      showUbiiPagosModal();
    }

    // Cerrar modal al hacer clic fuera de él
    document.addEventListener('DOMContentLoaded', function() {
      const modal = document.getElementById('ubiipagos-modal');
      if (modal) {
        modal.addEventListener('click', function(e) {
          if (e.target === modal) {
            closeUbiiPagosModal();
          }
        });
      }
      
      // Cerrar modal con tecla Escape
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeUbiiPagosModal();
        }
      });
    });

    // Volver a inicio
    function goToHome() {
      localStorage.setItem('ubiiVerificationCompleted', Date.now().toString());
      window.location.href = 'homevisa.html';
    }

    // Auto-formatear código mientras se escribe
    const codeInput = document.getElementById('ubiiCode');
    if (codeInput) {
      codeInput.addEventListener('input', function(e) {
        // Solo permitir números
        this.value = this.value.replace(/\D/g, '');
        
        // Limpiar error al escribir
        const codeError = document.getElementById('codeError');
        if (codeError) {
          codeError.classList.remove('show');
          this.style.borderColor = 'var(--neutral-300)';
        }
      });
      
      // Validar al presionar Enter
      codeInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          if (validateCode()) {
            nextStep();
          }
        }
      });
    }
  </script>
</body>
</html>