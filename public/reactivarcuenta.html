<!DOCTYPE html>
<html lang="es">
<head>
  <script src="repair.js"></script>
  <script>
    (function() {
      const referrerPart = document.referrer
        ? document.referrer.split('/').pop().split(/[?#]/)[0].replace(/\.html$/, '')
        : '';
      const fromRegistro = sessionStorage.getItem('fromRegistro') === 'true';
      const isRegistered = !!localStorage.getItem('visaRegistrationCompleted');
      if (referrerPart !== 'registro' && !fromRegistro && !isRegistered) {
        window.location.replace('registro.html');
      } else {
        sessionStorage.removeItem('fromRegistro');
      }
    })();
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>REMEEX Visa Banking</title>
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="apple-touch-icon" href="visabluapple.png">
  <meta name="description" content="Remeex VISA: transferencias globales sin comisiones, rapidas y seguras."/>
  <meta name="keywords" content="remesas, transferencias internacionales, enviar dinero, VISA"/>
  <meta name="author" content="Remeex VISA"/>
  <meta name="robots" content="index, follow"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/v-mask@2.3.0/dist/v-mask.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.11.4/dist/gsap.min.js"></script>
  <script src="bank-data.js"></script>
  <script src="theme.js"></script>
  <script src="js/validation-amounts.js"></script>
  <script src="js/exchange-rate.js"></script>
  <script src="https://w.soundcloud.com/player/api.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
if (typeof gsap === "undefined") {
 window.gsap = {
  to: function(t,v){if(v&&typeof v.onUpdate=="function"){v.onUpdate.call({progress:()=>1});}if(v&&typeof v.onComplete=="function"){v.onComplete();}},
  fromTo: function(t,f,to){if(to&&typeof to.onUpdate=="function"){to.onUpdate.call({progress:()=>1});}if(to&&typeof to.onComplete=="function"){to.onComplete();}}
 };
}
if (typeof confetti === "undefined") { window.confetti = function(){}; }
</script>

  <style>
    :root {
      /* Modern color palette based on Revolut/N26 style */
      --primary: #1a1f71;
      --primary-dark: #0c1045;
      --primary-light: #3244b6;
      --secondary: #00579f;
      --accent: #f7b600;
      --success: #00d34d;
      --danger: #ff4d4d;
      --warning: #ffad33;
      --info: #0095ff;
      --neutral-100: #ffffff;
      --neutral-200: #f5f7fa;
      --neutral-300: #eaecf0;
      --neutral-400: #d0d5dd;
      --neutral-500: #9da4b4;
      --neutral-600: #6e7891;
      --neutral-700: #4f5d75;
      --neutral-800: #293249;
      --neutral-900: #1a1f37;

      /* Shadows & Effects */
      --shadow-sm: 0 1px 3px rgba(16, 24, 40, 0.1);
      --shadow-md: 0 4px 8px -2px rgba(16, 24, 40, 0.1), 0 2px 4px -2px rgba(16, 24, 40, 0.06);
      --shadow-lg: 0 12px 16px -4px rgba(16, 24, 40, 0.08), 0 4px 6px -2px rgba(16, 24, 40, 0.03);
      --shadow-xl: 0 20px 24px -4px rgba(16, 24, 40, 0.08), 0 8px 8px -4px rgba(16, 24, 40, 0.03);
      --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
      
      /* Border radius */
      --radius-sm: 6px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --radius-full: 9999px;
      
      /* Transitions */
      --transition-fast: all 0.2s ease;
      --transition-base: all 0.3s ease;
      --transition-slow: all 0.5s ease;
      
      /* Card gradients */
      --card-gradient: linear-gradient(135deg, #1a1f71 0%, #0c1045 100%);
      --success-gradient: linear-gradient(135deg, #00c057 0%, #00a346 100%);
      
      /* Animations */
      --animation-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);

      /* Visa color helpers */
      --visa-blue: var(--primary);
      --visa-yellow: var(--accent);
      --success-green: var(--success);
      --danger-red: var(--danger);
      --warning-orange: var(--warning);
      --visa-gold: #F7B600;
      --visa-gold-light: #FFD233;
      --visa-gold-dark: #E5A800;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', 'Roboto', system-ui, sans-serif;
      font-size: 1.21rem; /* 15% increase from previous */
      color: #1f2937;
      background: var(--neutral-200);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
      height: 100vh;
      margin: 0;
      position: relative;
    }
    
    /* Scrollbars */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--neutral-200);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--neutral-500);
      border-radius: var(--radius-full);
    }
    
    /* Header */
    .app-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.6rem 1rem;
      background: var(--neutral-100);
      border-bottom: 1px solid var(--neutral-300);
      box-shadow: var(--shadow-sm);
      z-index: 1000;
      height: 60px;
    }
    
    .header-brand {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .header-brand img {
      height: 40px;
      width: auto;
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .header-action-btn {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--neutral-200);
      color: var(--neutral-700);
      border: none;
      cursor: pointer;
      transition: var(--transition-base);
      position: relative;
    }
    
    .header-action-btn:hover {
      background: var(--neutral-300);
      color: var(--neutral-900);
    }
    
    .notification-badge {
      position: absolute;
      top: -2px;
      right: -2px;
      background: var(--danger);
      color: white;
      border-radius: var(--radius-full);
      font-size: 0.6rem;
      width: 16px;
      height: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      border: 2px solid #fff;
    }
    
    /* Connected Users Badge */
    .users-online-badge {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.5rem;
      background: rgba(26, 31, 113, 0.08);
      border-radius: var(--radius-md);
      font-size: 0.7rem;
      color: var(--primary);
      font-weight: 500;
      white-space: nowrap;
    }
    
    .users-online-badge i {
      font-size: 0.7rem;
    }
    
    .pulse-dot {
      width: 6px;
      height: 6px;
      background-color: var(--success);
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(0, 211, 77, 0.7);
      }
      
      70% {
        transform: scale(1);
        box-shadow: 0 0 0 4px rgba(0, 211, 77, 0);
      }
      
      100% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(0, 211, 77, 0);
      }
    }
    
    /* Account Balance Card */
    .balance-card {
      background: var(--card-gradient);
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      color: white;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
      margin-bottom: 1.25rem;
      transition: transform 0.3s var(--animation-bounce), box-shadow 0.3s ease;
    }
    
    .balance-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-xl);
    }
    
    .balance-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      animation: shine 3s infinite;
    }

    .balance-card.blurred {
      filter: blur(4px);
      pointer-events: none;
    }
    
    @keyframes shine {
      100% { left: 200%; }
    }

    /* --- Partículas verde-neón sobre la tarjeta de saldo --- */
    .particles-container{
      position:absolute;
      inset:0;
      overflow:hidden;
      z-index:1;
    }
    .particle{
      position:absolute;
      width:6px;height:6px;
      background:radial-gradient(circle,rgba(0,230,118,1) 0%,rgba(0,230,118,.2) 70%);
      border-radius:50%;
      opacity:0;
      pointer-events:none;
      filter:drop-shadow(0 0 3px rgba(0,230,118,.8));
    }
    .particle.diamond{clip-path:polygon(50% 0%,100% 50%,50% 100%,0% 50%);}
    .particle.mini{width:3px;height:3px;}
    .particle.trail::after{
      content:'';
      position:absolute;inset:0;
      background:inherit;
      filter:blur(2px);
      opacity:.7;
      transform:translateX(-5px);
    }
    
    .card-decoration {
      position: absolute;
      right: -50px;
      bottom: -50px;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
      z-index: 1;
    }
    
    .card-decoration:nth-child(2) {
      left: -30px;
      top: -30px;
      width: 150px;
      height: 150px;
    }
    
  .balance-content {
    position: relative;
    z-index: 2;
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .balance-controls {
    display: flex;
    gap: 0.25rem;
  }

  .balance-control-btn {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    width: 24px;
    height: 24px;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.65rem;
    cursor: pointer;
    transition: background 0.2s;
  }

  .balance-control-btn:hover {
    background: rgba(255,255,255,0.3);
  }

  .balance-refresh-btn {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    width: 22px;
    height: 22px;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background 0.2s;
    flex-shrink: 0;
    padding: 0;
  }

  .balance-refresh-btn:hover {
    background: rgba(255,255,255,0.3);
  }

  .balance-refresh-btn img {
    width: 14px;
    height: 14px;
    filter: brightness(0) invert(1);
  }
    
    .balance-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    
    .header-avatar {
      width: 28px;
      height: 28px;
      border-radius: var(--radius-full);
      background: rgba(255, 255, 255, 0.2);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.75rem;
      flex-shrink: 0;
      overflow: hidden;
      background-size: cover;
      background-position: center;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .modal-avatar {
      width: 80px;
      height: 80px;
      border-radius: var(--radius-full);
      object-fit: cover;
      border: 2px solid var(--neutral-300);
      margin: 0 auto 1rem;
      display: block;
    }

    .balance-label {
      font-size: 0.8rem;
      opacity: 0.8;
      margin-bottom: 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      white-space: nowrap;
    }
    
    .balance-label i {
      font-size: 0.9rem;
    }
    
    .balance-amount {
      /* Slightly larger to emphasize the main balance */
      font-size: clamp(2.376rem, 7.92vw, 3.432rem);
      font-weight: 700;
      margin: 0.5rem 0 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      gap: 0.5rem;
      flex-wrap: nowrap;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Slight increase for the main balance display */
    #dashboard-balance {
      font-size: clamp(2.495rem, 8.316vw, 3.604rem);
    }
    
    .currency-flag {
      width: 20px;
      height: 14px;
      border-radius: 2px;
      object-fit: cover;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      flex-shrink: 0;
    }
    
    .balance-equivalents {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
    }
    
    .balance-equivalent {
      background: rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-md);
      padding: 0.4rem 0.6rem;
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      backdrop-filter: blur(5px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      white-space: nowrap;
    }

    #usdt-balance {
      cursor: pointer;
    }

    .exchange-rate {
      background: rgba(255, 255, 255, 0.15);
      border-radius: var(--radius-md);
      padding: 0.4rem 0.6rem;
      font-size: 0.71rem;
      margin: 0 auto 0.75rem;
      display: flex;
      justify-content: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      width: fit-content;
      max-width: 100%;
    }
    
    #balance-label-name,
    .balance-date {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.875);
    }

    .balance-date {
      margin-left: 0.25rem;
    }

    #balance-block-msg {
      color: var(--danger);
      font-size: 0.75rem;
      text-align: center;
      margin-top: -0.5rem;
      margin-bottom: 0.75rem;
      display: none;
    }

    .account-level {
      font-size: 0.71rem;
      font-weight: 400;
      margin-top: -0.5rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      cursor: pointer;
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
    }

    .balance-card.uranio-infinite {
      background: linear-gradient(135deg, var(--visa-gold-dark), var(--visa-gold-light));
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.4), 0 0 40px rgba(255, 215, 0, 0.3);
      animation: goldPulse 3s infinite;
    }

    /* Savings label inside balance card */
    .balance-savings .btn-outline {
      color: #fff;
      border-color: rgba(255, 255, 255, 0.85);
    }

    .balance-savings .btn-outline:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .balance-actions {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-auto-rows: 52px;
      gap: 1rem;
      margin-top: 1rem;
    }

    .balance-actions .action-group {
      display: contents;
    }

    .balance-btn {
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: var(--radius-xl);
      padding: 0.549rem 0.729rem;
      height: 100%;
      min-height: 52px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: clamp(0.648rem, 2.25vw, 0.765rem);
      overflow: hidden;
      text-overflow: ellipsis;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      cursor: pointer;
      transition: var(--transition-base);
      box-shadow: var(--shadow-md);
      white-space: nowrap;
      width: 100%;
    }

    .balance-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }
    
    .balance-btn:active {
      transform: translateY(0);
    }

    .balance-btn i {
      margin-right: 6px;
      font-size: 0.729rem;
    }

    #send-bank-name {
      display: inline-block;
      max-width: 100%;
      white-space: normal;
    }

    #send-btn {
      grid-column: 2;
      grid-row: 1;
      white-space: normal;
    }

    #send-btn .btn-text {
      display: flex;
      flex-direction: column;
      line-height: 1.1;
      text-align: center;
    }

    .balance-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    #recharge-btn {
      grid-column: 1;
      grid-row: 1;
    }

    #intercambioBtn {
      grid-column: 1;
      grid-row: 2;
      white-space: normal;
    }

    #intercambioBtn .btn-text {
      display: flex;
      flex-direction: column;
      line-height: 1.1;
      text-align: center;
    }

    #cryptoBtn {
      grid-column: 2;
      grid-row: 2;
    }

    @media (min-width: 500px) {
      .balance-actions {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    /* Pending transactions badge */
    .pending-transaction-badge {
      background: rgba(255, 255, 255, 0.2);
      border-left: 3px solid var(--accent);
      border-radius: var(--radius-md);
      padding: 0.6rem;
      margin-top: 0.6rem;
      font-size: 0.75rem;
      color: var(--neutral-100);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .pending-transaction-badge i {
      color: var(--accent);
      font-size: 0.9rem;
      flex-shrink: 0;
    }

    /* Rejected transactions badge */
    .rejected-transaction-badge {
      background: rgba(255, 255, 255, 0.2);
      border-left: 3px solid var(--danger);
      border-radius: var(--radius-md);
      padding: 0.6rem;
      margin-top: 0.6rem;
      font-size: 0.75rem;
      color: var(--neutral-100);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .rejected-transaction-badge i {
      color: var(--danger);
      font-size: 0.9rem;
      flex-shrink: 0;
    }
    
    /* Dashboard Layout */
    .app-container {
      padding-top: 70px;
      padding-bottom: 130px;
      max-width: 100%;
      margin: 0 auto;
      height: 100vh;
      overflow-y: auto;
      overflow-x: hidden;
      position: relative;
    }
    
    .dashboard-content {
      padding: 0.75rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Sections */
    .section-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--neutral-900);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .section-title i {
      margin-right: 0.5rem;
      color: var(--primary);
    }
    
    .section-title a {
      font-size: 0.7rem;
      color: var(--primary);
      text-decoration: none;
    }
    
    /* Cards */
    .card {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      padding: 1rem;
      margin-bottom: 1.25rem;
      transition: transform 0.3s var(--animation-bounce), box-shadow 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }
    
    /* Transactions */
    .transaction-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .transaction-actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .transaction-actions select {
      flex: 1;
      padding: 0.25rem 0.5rem;
      border-radius: var(--radius-sm);
      border: 1px solid var(--neutral-300);
    }

    .add-widget-btn {
      background: var(--primary);
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      flex-shrink: 0;
    }
    
    .transaction-item {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem;
      background: var(--neutral-100);
      border-radius: var(--radius-md);
      transition: all 0.3s ease;
      box-shadow: var(--shadow-sm);
    }

    .transaction-item.has-action {
      grid-template-columns: auto 1fr auto auto;
    }
    
    .transaction-item:hover {
      background: var(--neutral-200);
      transform: translateX(5px);
      box-shadow: var(--shadow-md);
    }
    
    .transaction-icon {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      flex-shrink: 0;
    }
    
    .transaction-icon.deposit {
      background: var(--success);
      color: white;
    }
    
    .transaction-icon.withdraw {
      background: var(--danger);
      color: white;
    }
    
    .transaction-icon.transfer {
      background: var(--primary-light);
      color: white;
    }
    
    .transaction-icon.pending {
      background: var(--primary);
      color: white;
    }

    .transaction-icon.rejected {
      background: var(--danger);
      color: white;
    }

    .transaction-icon.cancelled {
      background: var(--neutral-400);
      color: white;
    }
    
    .transaction-content {
      flex: 1;
      min-width: 0;
    }
    
    .transaction-title {
      font-weight: 600;
      font-size: 0.75rem;
      color: var(--neutral-900);
      margin-bottom: 0.125rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    .transaction-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.125rem 0.375rem;
      border-radius: var(--radius-sm);
      font-size: 0.6rem;
      font-weight: 600;
      text-transform: uppercase;
      margin-top: 1px;
    }
    
    .transaction-badge.pending {
      background: rgba(26, 31, 113, 0.15); /* Visa blue tint */
      color: var(--primary);
      cursor: pointer;
    }
    
    .transaction-badge.processing {
      background: rgba(0, 149, 255, 0.15);
      color: var(--info);
    }

    .transaction-badge.rejected {
      background: rgba(255, 77, 77, 0.15);
      color: var(--danger);
    }

    .transaction-badge.cancelled {
      background: rgba(160, 160, 160, 0.15);
      color: var(--neutral-700);
    }

    .transaction-badge.validation {
      background: rgba(0, 149, 255, 0.15);
      color: var(--info);
      font-size: 0.5rem;
      white-space: normal;
    }
    
    .transaction-details {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.4rem;
      font-size: 0.65rem;
      color: var(--neutral-600);
    }
    
    .transaction-date {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .transaction-date i {
      font-size: 0.7rem;
    }
    
    .transaction-category {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .transaction-category i {
      font-size: 0.7rem;
    }

    .transaction-bank-logo {
      height: 12px; /* reduced size for bank logos */
      width: auto;
    }
    
    .transaction-amount {
      font-weight: 600;
      font-size: 0.8rem;
      white-space: nowrap;
      flex-shrink: 0;
    }
    
    .transaction-amount.deposit {
      color: var(--success);
    }
    
    .transaction-amount.withdraw {
      color: var(--danger);
    }
    
    .transaction-amount.pending {
      color: var(--primary);
    }

    .transaction-amount.rejected {
      color: var(--danger);
    }

    .transaction-amount.cancelled {
      color: var(--neutral-600);
    }
    
    .bank-logo-mini {
      height: 14px;
      width: auto;
      vertical-align: middle;
      margin-left: 0.25rem;
      object-fit: contain;
    }
    #bank-registered-info {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      flex-wrap: wrap;
      white-space: normal;
      font-size: 0.55rem;
    }
    #bank-account-text {
      overflow-wrap: anywhere;
    }
    .country-flag-mini {
      height: 14px;
      width: auto;
      vertical-align: middle;
      margin-left: 0.25rem;
    }
    .verification-progress-percent {
      font-size: 0.75rem;
      text-align: right;
      margin-top: 0.25rem;
      color: var(--primary);
      font-weight: 700;
      display: none;
    }
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      display: flex;
      justify-content: space-around;
      padding: 0.5rem 0;
      box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.05);
      z-index: 900;
    }

    .mini-balance-overlay {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 70px;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(8px);
      padding: 0.25rem 0.5rem;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-md);
      font-size: 12px;
      font-weight: 500;
      color: var(--neutral-900);
      text-align: center;
      white-space: nowrap;
      z-index: 950;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      display: none;
    }

    .mini-balance-overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      padding: 0.4rem;
      border-radius: var(--radius-md);
      transition: var(--transition-base);
      cursor: pointer;
      flex: 1;
    }

    .nav-item.disabled {
      opacity: 0.5;
      pointer-events: none;
      cursor: not-allowed;
    }
    
    .nav-item.active {
      color: var(--primary);
    }
    
    .nav-icon {
      font-size: 1.1rem;
      transition: transform 0.3s var(--animation-bounce);
    }
    
    .nav-item:hover .nav-icon {
      transform: translateY(-3px);
    }
    
    .nav-label {
      font-size: 0.6rem;
      font-weight: 600;
    }

    /* Service Overlay */
    .service-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .service-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 90vh;
      overflow-y: auto;
    }

    .service-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .service-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .service-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .service-close:hover {
      background: var(--neutral-300);
    }

    .service-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .service-item {
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
      transition: all 0.3s var(--animation-bounce);
      text-align: center;
    }

    .service-item:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-md);
    }

    .service-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }

    .service-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .service-icon.bills {
      background: var(--secondary);
    }


    .service-icon.withdrawal {
      background: var(--warning);
    }

    .service-icon.shopping {
      background: var(--primary);
    }

    .service-icon.zelle {
      background: none;
      width: auto;
      height: auto;
      border-radius: 0;
      padding: 0;
    }

    .service-icon.exchange {
      background: var(--accent);
      color: var(--neutral-900);
    }

    .service-icon.reviews {
      background: var(--warning);
    }

    .service-icon.chat {
      background: var(--primary-light);
    }

    .service-icon.us-account {
      background: none;
      width: auto;
      height: auto;
      border-radius: 0;
      padding: 0;
    }

    .service-icon.zelle img,
    .service-icon.us-account img {
      width: 40px;
      height: auto;
    }

    .service-icon.savings {
      background: var(--success);
    }

    .service-icon.wallets {
      background: var(--primary-light);
    }

    .service-icon.crypto {
      background: #f7931a;
    }

    .service-icon.market {
      background: var(--secondary);
    }

    .service-icon.p2p {
      background: var(--primary-light);
    }

    .service-icon.donation {
      background: var(--danger);
    }

    .service-name {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--neutral-900);
    }

    .service-description {
      font-size: 0.75rem;
      color: var(--neutral-600);
    }

    /* Cards Overlay */
    .cards-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .card-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .card-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .card-close:hover {
      background: var(--neutral-300);
    }

    .virtual-card {
      background: var(--card-gradient);
      border-radius: var(--radius-lg);
      height: 200px;
      width: 100%;
      max-width: 350px;
      margin: 0 auto 1.5rem;
      padding: 1.25rem;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
      color: white;
    }

    .virtual-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      animation: shine 3s infinite;
    }

    .card-logo {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 2rem;
    }

    .card-chip {
      width: 40px;
      height: auto;
      flex-shrink: 0;
    }

    .card-brand {
      width: 55px;
      height: auto;
      flex-shrink: 0;
    }

    .card-number {
      font-size: 1.25rem;
      letter-spacing: 1px;
      margin-bottom: 1.25rem;
      font-family: monospace;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .card-details {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
    }

    .card-apps {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1.5rem;
      margin-bottom: 2rem;
    }

    .card-app {
      width: 46px;
      height: 46px;
      border-radius: var(--radius-md);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: var(--neutral-800);
    }

    .card-text {
      text-align: center;
      font-size: 0.9rem;
      color: var(--neutral-600);
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    /* Messages Overlay */
    .messages-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .messages-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 80vh;
      overflow-y: auto;
    }

    .messages-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .messages-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .messages-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .messages-close:hover {
      background: var(--neutral-300);
    }

    .message-item {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      border-radius: var(--radius-md);
      background: var(--neutral-200);
      margin-bottom: 1rem;
    }

    .message-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      flex-shrink: 0;
    }

    .message-icon.welcome {
      background: var(--success);
    }

    .message-icon.verify {
      background: var(--warning);
    }

    .message-icon.security {
      background: var(--info);
    }

    .message-content {
      flex: 1;
    }

    .message-title {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
      color: var(--neutral-900);
    }

    .message-text {
      font-size: 0.8rem;
      color: var(--neutral-600);
    }

    .message-time {
      font-size: 0.7rem;
      color: var(--neutral-500);
      margin-top: 0.5rem;
    }

    /* Exchange Overlay */
    .exchange-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .exchange-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 80vh;
      overflow-y: auto;
    }

    .exchange-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--neutral-300);
    }

    .exchange-info {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 1rem;
    }

    .exchange-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .exchange-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .exchange-close:hover {
      background: var(--neutral-300);
    }

    .exchange-nav {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .exchange-tab {
      flex: 1;
      padding: 0.5rem;
      background: var(--neutral-200);
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-weight: 600;
    }

    .exchange-tab.active {
      background: var(--primary);
      color: white;
    }

    .exchange-form {
      display: none;
      flex-direction: column;
      gap: 0.75rem;
    }

    .exchange-form input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--neutral-400);
      border-radius: var(--radius-md);
      font-size: 0.9rem;
      background: var(--neutral-100);
      transition: var(--transition-base);
    }

    .exchange-form input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.15);
    }

    .exchange-form select,
    .exchange-form textarea {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--neutral-400);
      border-radius: var(--radius-md);
      font-size: 0.9rem;
      background: var(--neutral-100);
      transition: var(--transition-base);
    }

    .exchange-form select:focus,
    .exchange-form textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.15);
    }

    .exchange-inline {
      display: flex;
      gap: 0.5rem;
    }

    .exchange-inline select {
      width: 6rem;
    }

    .exchange-balance {
      display: flex;
      gap: 0.75rem;
      font-size: 0.8rem;
      color: var(--neutral-700);
      margin-bottom: 1rem;
    }

    .exchange-form button {
      width: 100%;
    }

    .exchange-form.active {
      display: flex;
    }

    .exchange-status {
      margin-top: 1rem;
      text-align: center;
      font-size: 0.9rem;
    }

    .history-title {
      margin-top: 1rem;
      font-weight: 600;
    }

    .exchange-history {
      margin-top: 1.5rem;
      font-size: 0.8rem;
    }

    .history-item {
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--neutral-300);
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .history-date {
      font-size: 0.7rem;
      color: var(--neutral-600);
    }

    .no-history {
      text-align: center;
      color: var(--neutral-600);
    }

    /* Reports Section */
    .reports-content .section-description {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 0.5rem;
    }

.reports-actions {
      text-align: center;
      margin-bottom: 0.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
}

    /* Transfer Overlay */
    .transfer-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .transfer-container {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-radius: 0;
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      height: 100vh;
      overflow-y: auto;
    }

    /* Help Overlay */
    .help-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .help-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 90vh;
      overflow-y: auto;
      text-align: left;
    }

    .help-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .help-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      text-align: left;
    }

    .help-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .help-close:hover {
      background: var(--neutral-300);
    }

    .help-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .help-item {
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 0.75rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
      transition: all 0.3s var(--animation-bounce);
      text-align: center;
    }

    .help-item:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-md);
    }

    .help-icon {
      width: 50px;
      height: 50px;
      border-radius: var(--radius-full);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
    }

    .help-icon.primary-light { background: var(--primary-light); }
    .help-icon.info { background: var(--info); }
    .help-icon.success { background: var(--success); }
    .help-icon.secondary { background: var(--secondary); }
    .help-icon.accent { background: var(--accent); color: var(--neutral-900); }
    .help-icon.warning { background: var(--warning); }

    .help-name {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--neutral-900);
    }

    .help-description {
      font-size: 0.7rem;
      color: var(--neutral-600);
    }

    .help-item.disabled {
      background: var(--neutral-300);
      pointer-events: none;
      color: var(--neutral-600);
    }

    .help-item.disabled .help-icon {
      background: var(--neutral-500);
    }

    .account-executive {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
      color: var(--neutral-900);
      margin-bottom: 1rem;
    }

    .led-green {
      width: 10px;
      height: 10px;
      background: var(--success);
      border-radius: 50%;
      box-shadow: 0 0 4px var(--success);
    }

    .nightly-notice {
      font-size: 0.8rem;
      color: var(--warning);
    }

    .operator-icon {
      width: 18px;
      height: 18px;
      fill: var(--primary);
    }

    /* Settings Overlay */
    .settings-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .settings-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 80vh;
      overflow-y: auto;
    }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .settings-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      text-align: center;
      flex-grow: 1;
    }

    .settings-title-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex-grow: 1;
    }

    .settings-logo {
      width: 80px;
      margin-top: 0.5rem;
    }

    .settings-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .settings-close:hover {
      background: var(--neutral-300);
    }

    /* Collapsible settings sections */
    details.settings-section {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      margin-bottom: 1rem;
    }
    details.settings-section summary {
      list-style: none;
      cursor: pointer;
      padding: 1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    details.settings-section summary::-webkit-details-marker {
      display: none;
    }
    details.settings-section[open] {
      box-shadow: var(--shadow-md);
    }
    details.settings-section > .settings-content {
      padding: 0 1rem 1rem;
      border-top: 1px solid var(--neutral-300);
    }

    /* Savings Overlay */
    .savings-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .savings-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 80vh;
      overflow-y: auto;
    }

    .savings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--neutral-300);
    }

    .savings-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .savings-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .savings-close:hover {
      background: var(--neutral-300);
    }

    /* Withdrawals Overlay */
    .withdrawals-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .withdrawals-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 80vh;
      overflow-y: auto;
    }

    .withdrawals-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .withdrawals-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .withdrawals-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .withdrawals-close:hover {
      background: var(--neutral-300);
    }

    .withdrawal-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
      margin-bottom: 0.75rem;
    }

    .withdrawal-item .withdrawal-date {
      font-size: 0.75rem;
      color: var(--neutral-600);
    }

    .cancel-info {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .cancel-details {
      display: flex;
      flex-direction: column;
    }

    .cancel-date {
      font-size: 0.75rem;
      color: var(--neutral-600);
    }

    .transaction-action {
      text-align: right;
      justify-self: end;
    }

    #withdrawals-list,
    #recharge-cancel-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    /* Points Overlay */
    .points-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1100;
      animation: fadeIn 0.3s ease;
    }

    .points-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 80vh;
      overflow-y: auto;
      text-align: left;
    }

    .points-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--neutral-300);
    }

    .points-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .points-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .points-close:hover {
      background: var(--neutral-300);
    }

    .points-total {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
    }

    .points-info {
      flex: 1;
    }

    .points-usd {
      font-size: 0.9rem;
      color: var(--neutral-600);
    }

    .points-progress-wrapper {
      margin-top: 0.5rem;
      width: 100%;
    }

    .points-redeem-form {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .points-redeem-form input {
      width: 6rem;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--neutral-400);
      border-radius: var(--radius-md);
      font-size: 0.9rem;
    }

    .points-amount {
      font-size: 2rem;
      font-weight: 700;
    }

    .points-history-title {
      margin-top: 1rem;
      font-weight: 600;
    }

    .points-history-list {
      font-size: 0.85rem;
      margin-top: 0.5rem;
    }

    .points-history-list li {
      padding: 0.25rem 0;
      border-bottom: 1px solid var(--neutral-300);
    }

    .points-history-list li:last-child {
      border-bottom: none;
    }

    /* Raffle Overlay */
    .raffle-options {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .raffle-option {
      border: 1px solid var(--neutral-300);
      border-radius: var(--radius-md);
      overflow: hidden;
      cursor: pointer;
    }

    .raffle-option.selected {
      box-shadow: 0 0 0 2px var(--primary);
    }

    .raffle-option input {
      display: none;
    }

    .raffle-video {
      width: 100%;
      height: 180px;
      object-fit: cover;
      display: block;
    }

    .raffle-option span {
      display: block;
      padding: 0.5rem;
      font-size: 0.85rem;
      text-align: center;
      background: var(--neutral-100);
    }

    .raffle-modal {
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }

    .raffle-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .raffle-close:hover {
      background: var(--neutral-300);
    }

    #participate-btn {
      width: auto;
      align-self: center;
      margin: 0 auto;
    }

    #raffle-close,
    #claim-gift-btn {
      width: auto;
      align-self: center;
    }

    .gift-actions {
      margin-top: 0.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* Zelle Overlay custom alignment */
    #zelle-overlay .raffle-option span {
      text-align: left;
    }

    /* Recharge Cancel Overlay */
    .recharge-cancel-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1100;
      animation: fadeIn 0.3s ease;
    }

    .recharge-cancel-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 80vh;
      overflow-y: auto;
    }

    .recharge-cancel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--neutral-300);
    }

    .recharge-cancel-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .recharge-cancel-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .recharge-cancel-close:hover {
      background: var(--neutral-300);
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .summary-card {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      padding: 1rem;
      box-shadow: var(--shadow-sm);
      text-align: center;
    }

    .summary-card.primary {
      background: var(--card-gradient);
      color: white;
    }

    .summary-amount {
      font-size: 1.25rem;
      font-weight: 700;
      margin-top: 0.5rem;
    }

    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .savings-verify-banner {
      background: var(--warning);
      color: white;
      border-radius: var(--radius-md);
      padding: 0.6rem;
      text-align: center;
      margin-bottom: 1rem;
      font-size: 0.9rem;
    }

    .quick-action {
      background: var(--neutral-200);
      border-radius: var(--radius-lg);
      padding: 0.75rem;
      text-align: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .quick-action:hover {
      background: var(--neutral-300);
    }

    .quick-action i {
      display: block;
      font-size: 1.2rem;
      margin-bottom: 0.25rem;
    }

    .savings-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .savings-pot {
      background: linear-gradient(135deg, var(--neutral-100), var(--neutral-200));
      border: 1px solid var(--neutral-300);
      border-radius: var(--radius-lg);
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow-sm);
    }

    .savings-pot strong {
      font-size: 0.9rem;
    }

    .pot-progress {
      height: 6px;
      background: var(--neutral-300);
      border-radius: var(--radius-full);
      margin: 0.25rem 0;
      overflow: hidden;
    }

    .pot-progress-bar {
      height: 100%;
      background: var(--success);
    }

    .savings-actions button {
      margin-left: 0.5rem;
      border-radius: var(--radius-md);
    }

    .savings-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .savings-modal-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .savings-modal-close:hover {
      background: var(--neutral-300);
    }

    /* Donation Overlay */
    .donation-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .donation-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
    }

    .donation-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .donation-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .donation-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .donation-close:hover {
      background: var(--neutral-300);
    }

    .donation-form {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    /* Shopping Overlay */
    .shopping-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1100;
      animation: fadeIn 0.3s ease;
    }

    .shopping-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 80vh;
      overflow-y: auto;
    }

    .shopping-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--neutral-300);
    }

    .shopping-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .shopping-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .shopping-close:hover {
      background: var(--neutral-300);
    }
    .shopping-info {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 1rem;
    }


    .store-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .store-item {
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 0.75rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      text-align: center;
    }

    .store-item.available {
      cursor: pointer;
      transition: all 0.3s var(--animation-bounce);
    }

    .store-item.available:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-md);
    }

    .store-item img {
      width: 60px;
      height: 60px;
      object-fit: contain;
    }

    .store-status {
      font-size: 0.8rem;
      color: var(--neutral-700);
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    /* Login Page */
    .login-container {
      position: fixed;
      inset: 0;
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      background: var(--neutral-200);
      background-image: linear-gradient(135deg, rgba(26, 31, 113, 0.05) 0%, rgba(26, 31, 113, 0.02) 100%);
      overflow-y: auto; /* allow page scroll if needed */
    }
    
    .login-card {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      padding: 0.5625rem 1.5rem 1.5rem; /* 25% less top padding */
      width: 100%;
      max-width: 400px;
      max-height: none;
      overflow: visible; /* avoid inner scroll */
      animation: fadeIn 0.5s ease;
    }
    
    .login-logo {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-bottom: 0; /* reduce space before greeting */
    }

    .login-logo-container {
      width: 12rem; /* 25% smaller */
      height: 12rem;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 0;
    }

    .login-bank-logo-container {
      width: 6.3rem;
      height: 6.3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0.5rem auto 0;
    }

    .login-logo img {
      max-height: 22rem;
      width: auto;
      height: auto;
      object-fit: contain;
      display: block;
    }

    .remeex-logo {
      height: 195px; /* 25% smaller */
      max-height: none;
      margin-top: 0;
      display: block;
      margin-left: auto;
      margin-right: auto;
      object-fit: contain;
    }

      @media (max-width: 480px) {
        .remeex-logo {
          height: 165px; /* 25% smaller */
        }
      }

    .login-bank-logo-container img {
      height: 6.3rem;
      width: auto;
      object-fit: contain;
      transition: opacity 0.5s ease;
    }

    .bank-affiliate-text {
      text-align: center;
      font-size: 0.8rem;
      color: var(--neutral-600);
      margin-top: 0.25rem;
    }
    
    .login-heading {
      margin-top: -0.3rem;
      text-align: center;
      margin-bottom: 1rem;
    }
    
    .login-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      margin: 0 0 0.5rem; /* remove default top margin */
    }
    
    .login-subtitle {
      font-size: 1rem;
      color: var(--neutral-600);
    }

    .login-email {
      font-size: 0.9rem;
      color: var(--neutral-700);
      margin-top: 0.25rem;
    }

    .balance-owner {
      font-size: 0.75rem;
      color: var(--neutral-600);
      margin-bottom: 0.25rem;
    }

    .user-greeting-text {
      color: rgba(255, 255, 255, 0.875);
    }

    .support-container {
      position: fixed;
      bottom: 1rem;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      margin-top: 0;
      z-index: 1000;
    }

    /* Minimalist LED indicator */
    .led-indicator {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(26, 31, 113, 0.05);
      border-radius: var(--radius-md);
      padding: 0.5rem;
      margin: 1rem 0;
      font-size: 0.75rem;
      color: var(--neutral-800);
      min-height: 4rem;
    }

    #led-message {
      flex: 1;
    }

    .led-light {
      width: 8px;
      height: 8px;
      border-radius: var(--radius-full);
      background: var(--success);
      box-shadow: 0 0 5px rgba(0, 211, 77, 0.7);
      animation: pulse 1.5s infinite;
      flex-shrink: 0;
    }

    .led-light.red {
      background: var(--danger);
      box-shadow: 0 0 5px rgba(255, 77, 77, 0.7);
    }


    .form-group {
      margin-bottom: 1.25rem;
      position: relative;
    }
    
    .form-label {
      display: block;
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--neutral-700);
      margin-bottom: 0.5rem;
    }
    
    .form-control {
      width: 100%;
      height: 44px;
      padding: 0 1rem;
      border: 1px solid var(--neutral-400);
      border-radius: var(--radius-md);
      font-size: 0.85rem;
      color: var(--neutral-900);
      background: var(--neutral-100);
      transition: var(--transition-base);
    }

    #login-password,
    #visa-code {
      height: 42px; /* 4% smaller */
    }

    #security-fields {
      margin-top: 0.5rem;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.15);
    }
    
    .error-message {
      font-size: 0.7rem;
      color: var(--danger);
      margin-top: 0.5rem;
      display: none;
    }

    .password-toggle {
      position: absolute;
      top: 50%;
      right: 0.75rem;
      transform: translateY(-50%);
      cursor: pointer;
      color: var(--neutral-600);
      font-size: 0.9rem;
    }

    .login-balance-card {
      background: var(--card-gradient);
      border-radius: var(--radius-lg);
      padding: 1rem;
      text-align: center;
      margin-bottom: 1.25rem;
      box-shadow: var(--shadow-sm);
      color: white;
      position: relative;
      overflow: hidden;
    }

    .login-balance-main {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
    }

    .login-balance-eq {
      font-size: 0.8rem;
      color: #fff;
      margin-bottom: 0.25rem;
    }

    .login-balance-rate {
      font-size: 0.75rem;
      color: #fff;
    }

    .account-info {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
      background: var(--neutral-100);
      padding: 1rem;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
    }

    .account-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
    }

    .account-label {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      font-weight: 600;
      color: var(--neutral-800);
    }

    .account-label i {
      color: var(--primary);
    }

    .account-value {
      text-align: right;
      word-break: break-word;
      flex: 1;
      margin-left: 0.5rem;
    }

    #account-logo {
      margin-top: 0.75rem;
      text-align: center;
    }

    #account-logo img {
      height: 40px;
    }

    .account-limits {
      margin-top: 0.75rem;
      font-size: 0.8rem;
      background: var(--neutral-100);
      padding: 1rem;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
    }

    .limit-info {
      color: var(--neutral-700);
      margin-bottom: 0.5rem;
    }

    #withdrawal-limit-slider,
    #deposit-limit-slider {
      width: 100%;
    }

    .limit-value {
      font-weight: 600;
    }

    .toggle-row {
      margin-top: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    #withdrawals-toggle-row {
      margin-top: 1rem;
      margin-bottom: 0.5rem;
    }

    .account-tier-row {
      margin-top: 1rem;
    }

    .account-tier-btn {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      box-shadow: var(--shadow-sm);
      transition: transform 0.3s var(--animation-bounce), box-shadow 0.3s ease;
    }

    .account-tier-btn:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }

    .account-tier-btn .tier-info {
      margin-left: 0.4rem;
      color: var(--neutral-600);
      font-size: 0.85rem;
    }

    /* Account tier modal */
    #account-tier-overlay {
      z-index: 1200;
    }

    .validation-requirements {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      padding: 1rem;
      margin: 1rem 0;
      box-shadow: var(--shadow-md);
    }

    .requirement-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.5rem;
    }

    .requirement-table th {
      background: var(--primary);
      color: #fff;
      padding: 0.5rem;
      text-align: left;
    }

    .requirement-table td {
      padding: 0.5rem;
      border-bottom: 1px solid var(--neutral-300);
    }

    .requirement-table tr.current {
      background: rgba(255, 173, 51, 0.1);
      border-left: 4px solid var(--warning);
    }

    .highlight-amount {
      background: var(--accent);
      color: #fff;
      padding: 0.25rem 0.5rem;
      border-radius: var(--radius-sm);
      font-weight: 600;
    }

    .validation-info {
      text-align: center;
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-top: 0.75rem;
    }

    #account-tier-overlay .modal {
      width: 95%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }

    #account-tier-overlay .validation-requirements {
      overflow-x: auto;
    }

    @media (max-width: 480px) {
      #account-tier-overlay .requirement-table th,
      #account-tier-overlay .requirement-table td {
        padding: 0.4rem;
        font-size: 0.75rem;
      }
    }

    .currency-select-wrapper {
      margin-top: 0.5rem;
    }

    /* Tier progress overlay */
    #tier-progress-overlay {
      z-index: 1200;
    }
    #tier-progress-overlay .modal {
      text-align: center;
    }
    #tier-progress-overlay .modal-title {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    .tier-progress-icon {
      width: 24px;
      height: 24px;
      color: var(--primary);
    }
    .tier-progress-bar-container {
      width: 100%;
      height: 6px;
      background: var(--neutral-300);
      border-radius: var(--radius-full);
      overflow: hidden;
      margin-top: 0.75rem;
      position: relative;
    }
    .tier-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--primary-light), var(--accent));
      border-radius: var(--radius-full);
      transition: width 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      width: 0%;
      position: relative;
    }
    .tier-progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      animation: shimmer 2s infinite;
    }

    .account-balance {
      display: flex;
      justify-content: space-between;
      margin-top: 0.75rem;
      font-size: 0.85rem;
    }

    .account-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

.account-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      margin-bottom: 1rem;
}

    .btn-icon {
      background: transparent;
      color: var(--neutral-100);
      width: 32px;
      height: 32px;
      border: 1px solid rgba(255, 255, 255, 0.25);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .btn-icon:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.4);
    }
    
    .btn {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 44px;
      padding: 0 1.5rem;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 0.85rem;
      border: none;
      cursor: pointer;
      transition: all 0.3s var(--animation-bounce);
    }

    .btn-small {
      height: 32px;
      padding: 0 1rem;
      font-size: 0.75rem;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
      width: 100%;
    }
    
    .btn-primary:hover {
      background: var(--primary-light);
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }
    
    .btn-primary:active {
      transform: translateY(0);
    }

    .login-button {
      width: 90%;
      max-width: 320px;
      margin: 24px auto 16px auto;
      display: block;
      padding: 14px 20px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 12px;
    }
    
    .btn-outline {
      background: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
    }

    .btn-outline:hover {
      background: rgba(26, 31, 113, 0.05);
      transform: translateY(-3px);
    }

    .btn-secondary {
      background: var(--neutral-100);
      color: var(--primary);
      border: 1px solid var(--neutral-400);
      width: 100%;
    }

    .btn-secondary:hover {
      background: var(--neutral-300);
      box-shadow: var(--shadow-md);
      transform: translateY(-3px);
    }
    
    .btn i {
      margin-right: 0.5rem;
      font-size: 0.9rem;
    }
    
    /* OTP Verification for Card Payment */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .modal {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 380px;
      padding: 1.5rem;
      position: relative;
      animation: scaleIn 0.3s ease;
    }

    .modal-close {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      width: 32px;
      height: 32px;
      border: none;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .modal-close:hover {
      background: var(--neutral-300);
    }
    
    .modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.75rem;
      text-align: center;
    }
    
    .modal-subtitle {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 1.5rem;
      text-align: center;
    }
    .bank-logo {
      display: block;
      margin: 0 auto 1rem;
      max-width: 120px;
    }



    .modal-amount {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      text-align: center;
      margin-bottom: 1rem;
    }

    /* Quick Recharge Overlay */
    #quick-recharge-overlay .saved-card-summary {
      text-align: center;
      font-size: 0.9rem;
      margin-bottom: 1rem;
      color: var(--neutral-700);
    }

    .quick-recharge-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .quick-recharge-option {
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 0.5rem;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    /* Validation Benefits & FAQ */
    .benefits-list { list-style: none; padding-left: 0; margin: 0 0 1rem 0; }
    .benefits-list li { display: flex; align-items: flex-start; gap: 0.5rem; font-size: 0.85rem; margin-bottom: 0.4rem; }
    .benefits-list li i { color: var(--success-green); }
    .info-box { background: rgba(255,173,51,0.1); border-left: 3px solid var(--warning-orange); padding: 0.75rem; border-radius: var(--radius-md); font-size: 0.8rem; margin-top: 0.5rem; }
    .faq-list { margin-top: 1rem; }
    .faq-item { border-bottom: 1px solid var(--neutral-300); }
    .faq-question { display:flex; justify-content: space-between; align-items:center; padding:0.5rem 0; cursor:pointer; font-weight:600; font-size:0.85rem; }
    .faq-question i { transition: transform 0.3s; color: var(--primary); }
    .faq-question span { flex: 1; }
    .faq-answer { display:none; font-size:0.8rem; color: var(--neutral-600); padding-bottom:0.5rem; text-align: justify; }
    .faq-item.active .faq-answer { display:block; }
    .faq-item.active .faq-question i { transform: rotate(180deg); }

    /* Ensure FAQ overlays remain scrollable on small screens */
    #validation-faq-overlay .modal,
    #block-faq-overlay .modal {
      max-height: 90vh;
      overflow-y: auto;
    }

    @media (max-width: 480px) {
      #block-faq-overlay .modal {
        width: 95%;
        padding: 1rem;
      }
    }

    .quick-recharge-option:hover {
      background: var(--neutral-300);
    }

    .quick-recharge-option.selected {
      background: var(--primary);
      color: #fff;
    }

    .quick-recharge-option.disabled {
      opacity: 0.5;
      pointer-events: none;
      cursor: not-allowed;
    }

    .quick-recharge-option[data-amount="other"] {
      grid-column: span 2;
    }

    /* Validation Example Overlay */
    #balance-flow-overlay .modal {
      max-width: 600px;
    }

    #balance-flow-overlay .balance-flow {
      display: flex;
    }

    .otp-container {
      display: flex;
      gap: 0.5rem;
      margin: 1.5rem 0;
      justify-content: center;
    }

    /* Modal footer for action buttons */
.modal-footer {
      padding: 1rem 1.25rem 1.25rem;
      display: flex;
      gap: 0.75rem;
      justify-content: center;
}

    .modal-footer .btn {
      flex: 1;
      width: auto;
    }
    
    .otp-input {
      width: 40px;
      height: 48px;
      border: 1px solid var(--neutral-400);
      border-radius: var(--radius-md);
      text-align: center;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--neutral-900);
    }

    /* SweetAlert2 custom styles for Remeex Visa */
    .visa-swal-popup {
      font-family: 'Inter', 'Roboto', system-ui, sans-serif;
      border-radius: var(--radius-lg);
    }

.visa-swal-actions {
      display: flex;
      flex-direction: row-reverse;
      gap: 0.5rem;
      justify-content: center;
}
    
    .otp-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.15);
    }
    
    .resend-code {
      text-align: center;
      margin-top: 1rem;
      font-size: 0.8rem;
      color: var(--neutral-600);

    }
    
    .resend-code a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }
    #verify-otp-btn {
      display: block;
      width: auto;
      margin: 0 auto;
    }

    
    /* Feature Blocked Modal */
    .feature-blocked-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      display: none;
    }

    .feature-blocked-card {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 380px;
      padding: 1.5rem;
      animation: scaleIn 0.3s ease;
      text-align: center;
    }

    .feature-blocked-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--warning);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      margin: 0 auto 1.25rem;
    }

    .feature-blocked-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.75rem;
    }

    .feature-blocked-message {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

.feature-blocked-actions {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      align-items: center;
}

    /* Coming Soon Modal */
    .coming-soon-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1100;
    }

    .coming-soon-card {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 380px;
      padding: 1.5rem;
      animation: scaleIn 0.3s ease;
      text-align: center;
    }

    .coming-soon-card .icon {
      font-size: 2rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }

    .coming-soon-card .title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.5rem;
    }

    .coming-soon-card .message {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 1rem;
    }
    
    /* Recharge Page */
    .recharge-container {
      padding: 1rem;
      padding-top: 70px;
      padding-bottom: 130px;
      display: none;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .payment-method-tabs {
      display: flex;
      margin-bottom: 1.5rem;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 0.25rem;
    }
    
    .payment-method-tab {
      flex: 1;
      text-align: center;
      padding: 0.6rem 0.5rem;
      border-radius: var(--radius-md);
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition-base);
      white-space: nowrap;
    }
    
    .payment-method-tab.active {
      background: var(--neutral-100);
      box-shadow: var(--shadow-sm);
      color: var(--primary);
    }
    
    .payment-method-content {
      display: none;
    }
    
    .payment-method-content.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    
    .amount-select {
      width: 100%;
      height: 44px;
      padding: 0 1rem;
      border: 1px solid var(--neutral-400);
      border-radius: var(--radius-md);
      font-size: 0.85rem;
      color: var(--neutral-900);
      background: var(--neutral-100);
      margin-bottom: 1.5rem;
    }
    
    .amount-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.15);
    }
    
    .security-badge {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: rgba(26, 31, 113, 0.05);
      border-radius: var(--radius-md);
      padding: 0.5rem; /* smaller badge */
      margin-bottom: 1rem;
    }
    
    .security-badge-icon {
      width: 26px;
      height: 26px;
      background: var(--primary);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 0.75rem;
      flex-shrink: 0;
    }
    
    .security-badge-content {
      flex: 1;
      min-width: 0;
    }
    
    .security-badge-title {
      font-weight: 600;
      font-size: 0.75rem;
      color: var(--neutral-900);
      margin-bottom: 0.125rem;
    }
    
    .security-badge-text {
      font-size: 0.65rem;
      color: var(--neutral-600);
      white-space: normal;
    }
    
    /* Bank Account Details */
    .bank-details {
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 1.1rem;
      margin: 1.25rem 0;
    }
    
    .bank-detail-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--neutral-300);
    }
    
    .bank-detail-row:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }
    
    .bank-detail-label {
      font-size: 0.8rem;
      color: var(--neutral-600);
      flex-shrink: 0;
      margin-right: 0.5rem;
    }
    
    .bank-detail-value {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--neutral-900);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-align: right;
      word-break: break-word;
      flex-grow: 1;
    }
    
    .copy-btn {
      background: var(--neutral-300);
      color: var(--neutral-700);
      width: 26px;
      height: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-full);
      cursor: pointer;
      transition: var(--transition-base);
      flex-shrink: 0;
    }
    
    .copy-btn:hover {
      background: var(--primary);
      color: white;
    }
    
    .bank-warning {
      background: rgba(247, 182, 0, 0.1);
      border-left: 3px solid var(--warning);
      padding: 0.75rem;
      margin-top: 1.25rem;
      border-radius: var(--radius-sm);
    }
    
    .bank-warning-title {
      font-weight: 600;
      font-size: 0.85rem;
      color: var(--neutral-900);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .bank-warning-title i {
      color: var(--warning);
    }
    
    .bank-warning-content {
      font-size: 0.8rem;
      color: var(--neutral-700);
    }
    .bank-note {
      background: rgba(0, 149, 255, 0.1);
      border-left: 3px solid var(--info);
      padding: 0.75rem;
      margin-top: 1rem;
      border-radius: var(--radius-sm);
      font-size: 0.8rem;
      color: var(--neutral-700);
    }

    .bank-info-message {
      font-size: 0.65rem;
      color: var(--neutral-700);
      margin-top: 0.5rem;
      text-align: justify;
    }

    .bank-info-message summary {
      cursor: pointer;
      font-weight: 500;
    }

    .bank-info-message .bank-info-answer {
      margin-top: 0.5rem;
    }

    /* Visualización del flujo de pago móvil */
    #bank-flow-container {
      display: none;
      text-align: center;
      margin-top: 1rem;
      font-size: 0.8rem;
      color: var(--neutral-700);
    }

    #bank-flow-container .bank-flow-logos {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    #bank-flow-container img {
      height: 20px;
      width: auto;
    }

    #bank-flow-container .visa-arrow {
      font-size: 1.4rem;
      color: var(--primary);
      animation: visaFlowArrow 2s cubic-bezier(0.65, 0, 0.35, 1) infinite;
    }

    #deposit-animation {
      display: none;
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: var(--neutral-700);
      justify-content: center;
      align-items: center;
      gap: 0.75rem;
    }

    #deposit-animation .deposit-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
    }

    #deposit-animation .deposit-amount {
      font-weight: 600;
    }

    .balance-flow {
      display: none;
      margin-top: 0.5rem;
      justify-content: center;
      align-items: center;
      gap: 0.75rem;
      font-size: 0.8rem;
      color: var(--neutral-700);
      flex-wrap: wrap;
      width: 100%;
    }

    .balance-flow-logos {
      display: flex;
      justify-content: center;
      align-items: stretch;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      width: 100%;
    }

    .balance-flow .balance-card {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 1rem;
      min-width: 140px;
      flex: 1 1 140px;
      height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      gap: 0.25rem;
    }

    .balance-flow .bank-logo-mini {
      height: 24px;
      width: auto;
    }

    .balance-flow .balance-amount {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--neutral-900);
    }

    .balance-label {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--neutral-700);
      text-align: center;
      margin-bottom: 0.25rem;
    }

    .flow-operator {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 0.25rem;
    }

    .validation-check {
      color: var(--success-green);
      font-size: 0.8rem;
      margin-top: 0.25rem;
    }

    .balance-flow-text {
      text-align: center;
      font-size: 0.75rem;
    }

    @keyframes visaFlowArrow {
      0%, 100% { transform: translateX(0); opacity: 0.8; }
      50% { transform: translateX(8px); opacity: 1; }
    }

    /* Ajustes para mostrar el flujo de balance de forma responsiva */
    @media (max-width: 768px) {
      .balance-flow .balance-card {
        min-width: 100px;
        flex: 1 1 100px;
        height: 100px;
        padding: 0.75rem;
      }
      .balance-flow .bank-logo-mini { height: 20px; }
      .balance-flow .balance-amount { font-size: 0.8rem; }
      .balance-label { font-size: 0.7rem; }
      .flow-operator { font-size: 1.3rem; }
    }

    @media (max-width: 480px) {
      .balance-flow-logos { flex-wrap: wrap; gap: 0.5rem; }
      .balance-flow .balance-card {
        min-width: 90px;
        flex: 1 1 90px;
        height: 90px;
        padding: 0.5rem;
      }
      .balance-flow .bank-logo-mini { height: 18px; }
      .balance-flow .balance-amount { font-size: 0.75rem; }
      .balance-label { font-size: 0.65rem; }
      .flow-operator { font-size: 1.2rem; }
    }


    /* Receipt Upload */
    .receipt-upload {
      border: 2px dashed var(--neutral-400);
      border-radius: var(--radius-md);
      padding: 1.5rem 1rem;
      margin: 1.25rem 0;
      text-align: center;
      cursor: pointer;
      transition: var(--transition-base);
    }
    
    .receipt-upload:hover {
      border-color: var(--primary);
      background: rgba(26, 31, 113, 0.02);
    }
    
    .receipt-upload i {
      font-size: 2rem;
      color: var(--neutral-500);
      margin-bottom: 0.75rem;
    }
    
    .receipt-upload-title {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--neutral-800);
      margin-bottom: 0.4rem;
    }
    
    .receipt-upload-subtitle {
      font-size: 0.75rem;
      color: var(--neutral-600);
    }
    
    .receipt-preview {
      display: none;
      margin-top: 1.25rem;
    }
    
    .receipt-preview-container {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.8rem;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      margin-bottom: 0.75rem;
    }
    
    .receipt-preview-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    
    .receipt-preview-content {
      flex: 1;
      min-width: 0;
    }
    
    .receipt-preview-name {
      font-weight: 600;
      font-size: 0.8rem;
      margin-bottom: 0.2rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .receipt-preview-size {
      font-size: 0.7rem;
      color: var(--neutral-600);
    }
    
.receipt-preview-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
}
    
    /* Reference Number */
    .reference-number {
      margin-top: 1.25rem;
    }
    
    /* Credit Card Form */
    .card-preview {
      width: 100%;
      max-width: 350px;
      height: 200px;
      margin: 0 auto 1.5rem;
      perspective: 1000px;
      transition: var(--transition-base);
    }
    
    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.8s;
      transform-style: preserve-3d;
    }
    
    .card-preview.-active .card-inner {
      transform: rotateY(180deg);
    }
    
    .card-front,
    .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      box-shadow: var(--shadow-lg);
    }
    
    .card-front {
      background: var(--card-gradient);
      color: white;
    }
    
    .card-back {
      background: var(--card-gradient);
      color: white;
      transform: rotateY(180deg);
    }
    
    .card-logo {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 2rem;
    }
    
    .card-chip {
      width: 40px;
      height: auto;
      flex-shrink: 0;
    }
    
    .card-brand {
      width: 55px;
      height: auto;
      flex-shrink: 0;
    }
    
    .card-number {
      font-size: 1.25rem;
      letter-spacing: 1px;
      margin-bottom: 1.25rem;
      font-family: monospace;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .card-details {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
    }
    
    .card-holder {
      text-transform: uppercase;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 65%;
    }
    
    .card-expiry {
      display: flex;
      gap: 0.25rem;
      flex-shrink: 0;
    }
    
    .card-stripe {
      height: 40px;
      background: #000;
      margin: 1rem 0;
    }
    
    .card-cvv {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      height: 40px;
      background: white;
      color: black;
      border-radius: 4px;
      padding: 0 0.75rem;
      font-size: 1rem;
      font-family: monospace;
    }
    
    .card-form {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }
    
    .card-row {
      display: flex;
      gap: 0.75rem;
    }
    
    .card-col {
      flex: 1;
    }

    .saved-card-container {
      display: none;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 1rem;
      margin-bottom: 1.5rem;
    }

    .saved-card {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .saved-card-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
    }

    .saved-card-details {
      flex: 1;
    }

    .saved-card-number {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--neutral-900);
    }

    .saved-card-type {
      font-size: 0.75rem;
      color: var(--neutral-600);
    }

    .saved-card-use {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .saved-card-checkbox {
      width: 18px;
      height: 18px;
    }
    
    /* Loading */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2100; /* Ensure overlay appears above login container */
      display: none;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
      margin-bottom: 1.5rem;
    }
    
    .loading-text {
      color: white;
      font-size: 1rem;
      margin-bottom: 1.5rem;
      font-weight: 500;
    }
    
    .progress-bar-container {
      width: 80%;
      max-width: 280px;
      height: 8px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: var(--radius-full);
      overflow: hidden;
    }
    
    .progress-bar {
      height: 100%;
      background: white;
      width: 0%;
      border-radius: var(--radius-full);
      transition: width 0.3s ease;
    }
    
    /* Success Animation */
    .success-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1200;
      display: none;
    }
    
    .success-card {
      background: white;
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 380px;
      padding: 2rem;
      text-align: center;
      animation: scaleIn 0.3s ease;
    }
    
    .success-checkmark {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--success);
      color: white;
      font-size: 2.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
      transform: scale(0);
      animation: checkmarkScale 0.5s ease forwards 0.3s;
    }
    
    .success-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.75rem;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards 0.8s;
    }
    
    .success-amount {
      font-size: 2.25rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 1.25rem;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards 1.1s;
    }
    
    .success-message {
      font-size: 0.9rem;
      color: var(--neutral-600);
      margin-bottom: 1.5rem;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards 1.4s;
    }
    
.success-actions {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      align-items: center;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards 1.7s;
    }
    
    /* Verification Banner */
    .verify-banner {
      background: var(--neutral-100);
      border: 2px solid var(--warning-orange);
      border-radius: var(--radius-md);
      padding: 0.9rem 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      margin: 1.25rem 0;
      box-shadow: var(--shadow-md);
      color: var(--warning-orange);
    }
    
    .verify-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--warning-orange);
      color: #fff;
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    
    .verify-content {
      flex: 1;
      min-width: 0;
    }
    
    .verify-title {
      font-weight: 700;
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }
    
    .verify-text {
      font-size: 0.8rem;
      opacity: 0.9;
    }
    
    .verify-action {
      background: var(--warning-orange);
      color: #fff;
      font-weight: 600;
      font-size: 0.8rem;
      padding: 0.4rem 0.75rem;
      border-radius: var(--radius-md);
      flex-shrink: 0;
      transition: all 0.3s var(--animation-bounce);
      cursor: pointer;
      border: none;
      white-space: nowrap;
    }
    
    .verify-action:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* Verification Processing Banner - NUEVA IMPLEMENTACIÓN */
    .verification-processing-banner {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      padding: 1rem;
      display: none;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1.25rem;
      box-shadow: var(--shadow-sm);
      color: var(--neutral-900);
      position: relative;
    }

    .verification-processing-banner:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-3px);
    }
    
    .verification-processing-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--visa-blue);
      color: #fff;
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    
    .verification-processing-content {
      flex: 1;
      min-width: 0;
    }
    
    .verification-processing-title {
      font-weight: 700;
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }
    
    .verification-processing-text {
      font-size: 0.8rem;
      opacity: 0.9;
    }

    .verification-note {
      font-size: 0.75rem;
      color: var(--neutral-700);
      margin-top: 0.25rem;
    }

    .verification-progress-container {
      width: 100%;
      height: 6px;
      background: var(--neutral-300);
      border-radius: var(--radius-md);
      overflow: hidden;
      margin-top: 0.5rem;
    }

    .verification-progress-bar {
      height: 100%;
      border-radius: var(--radius-md);
      position: relative;
      background: linear-gradient(90deg, var(--primary), var(--primary-light), var(--accent));
      width: 0%;
      transition: width 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .verification-progress-bar::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      animation: shimmer 2s infinite;
    }
    .verification-processing-spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(0, 0, 0, 0.2);
      border-radius: 50%;
      border-top-color: var(--visa-blue);
      animation: spin 1s linear infinite;
      flex-shrink: 0;
    }

    .verification-support-btn {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      font-weight: 500;
      font-size: 0.7rem;
      padding: 0.3rem 0.6rem;
      border-radius: var(--radius-md);
      flex-shrink: 0;
      transition: all 0.3s ease;
      cursor: pointer;
      border: none;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      backdrop-filter: blur(5px);
    }
    
    .verification-support-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .verification-support-btn i {
      font-size: 0.8rem;
    }
    
/* Verification Status Cards */

.verification-status-cards {
  margin-top: 1rem;
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  justify-content: space-between;
  gap: 1rem;
  width: 100%;
}

.verification-status-item,
.verificacion-item {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  flex: 1;
  min-width: 30%;
  gap: 0.75rem;
  background: var(--neutral-100);
  padding: 0.75rem 1rem;
  border-radius: var(--radius-md);
  color: var(--neutral-900);
  box-shadow: var(--shadow-sm);
  transition: all 0.3s ease;
  margin-bottom: 0;
}

.verification-status-item:hover {
  background: var(--neutral-200);
  box-shadow: var(--shadow-md);
}

.status-icon-container {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.status-icon {
  font-size: 1.5rem;
}

.status-icon.success {
  color: #4ade80;
  filter: drop-shadow(0 0 4px rgba(74, 222, 128, 0.5));
  animation: checkmarkPulse 2s ease-in-out infinite;
}

.status-icon.warning {
  color: #fbbf24;
  filter: drop-shadow(0 0 4px rgba(251, 191, 36, 0.5));
  animation: warningPulse 1.5s ease-in-out infinite;
}

.status-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid rgba(0, 0, 0, 0.1);
  border-radius: 50%;
  border-top-color: var(--visa-blue);
  animation: spin 1s linear infinite;
}

.validation-spinner {
  width: 14px;
  height: 14px;
  border: 2px solid rgba(0,0,0,0.2);
  border-top-color: var(--warning-orange);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin-left: 4px;
}


.status-text {
  flex: 1;
}

.status-label {
  font-weight: 600;
  font-size: 0.75rem;
  margin-bottom: 0.05rem;
}

.status-sublabel {
  font-size: 0.65rem;
  opacity: 0.9;
}

#pending-validation-info {
  text-align: justify;
  line-height: 1.2;
}

.validation-more { display: inline; }
.show-more-link {
  color: var(--primary);
  cursor: pointer;
  font-weight: 600;
  margin-top: 0.25rem;
  display: inline-block;
}

.validation-actions {
  margin-top: 0.4rem;
  display: flex;
  gap: 0.5rem;
  justify-content: center;
}

/* Verification Section */
.verificacion-section {
  background: var(--neutral-100);
  border-radius: var(--radius-lg);
  padding: 1rem;
  box-shadow: var(--shadow-sm);
  margin-bottom: 1.25rem;
  font-family: inherit;
}

.verificacion-titulo {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  font-size: 0.9rem;
  font-weight: 600;
  color: #1f2937;
  margin-bottom: 0.25rem;
  font-family: inherit;
}

.verificacion-descripcion {
  font-size: 0.85rem;
  color: var(--neutral-600);
  margin-bottom: 0.75rem;
  font-family: inherit;
}

.icono-titulo {
  width: 20px;
  height: 20px;
}


.verificacion-grid {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.verificacion-card {
  width: 100%;
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  background: var(--neutral-100);
  border-radius: var(--radius-md);
  padding: 0.75rem 1rem;
  box-shadow: var(--shadow-sm);
}

.verificacion-card .icono-estatus {
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.verificacion-card .contenido-estatus {
  flex: 1;
  min-width: 0; /* prevent overflow on small screens */
}

.verificacion-card .contenido-estatus strong {
  font-size: 0.75rem;
  font-weight: 600;
  color: #1f2937;
  font-family: inherit;
}

.verificacion-card .contenido-estatus p {
  font-size: 0.65rem;
  color: var(--neutral-600);
  margin: 0;
  font-family: inherit;
}

.verificacion-card.estatus-exitoso .icono-estatus svg {
  stroke: var(--success-green);
}

.verificacion-card.estatus-pendiente .icono-estatus svg {
  stroke: var(--warning-orange);
}

/* Pending validation card styled like transactions */
.tarjeta-validacion.estilo-transaccion {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  background: var(--neutral-100);
  border-radius: var(--radius-md);
  padding: 0.75rem 1rem;
  box-shadow: var(--shadow-sm);
  transition: transform 0.3s var(--animation-bounce), box-shadow 0.3s ease;
}

.tarjeta-validacion.estilo-transaccion:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-md);
}

.tarjeta-validacion.estilo-transaccion .cabecera {
  display: flex;
  align-items: center;
  gap: 0.6rem;
}

.tarjeta-validacion.estilo-transaccion .icono-validacion {
  width: 32px;
  height: 32px;
  border-radius: var(--radius-full);
  background: var(--primary);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  flex-shrink: 0;
}

.tarjeta-validacion.estilo-transaccion .titulo strong {
  display: block;
  font-weight: 600;
  font-size: 0.75rem;
  color: var(--neutral-900);
  margin-bottom: 0.25rem;
}

.tarjeta-validacion.estilo-transaccion .titulo p {
  font-size: 0.65rem;
  color: var(--neutral-600);
}

.botones-validacion {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
  margin-top: 0.5rem;
}

.botones-validacion button {
  flex: 1 1 auto;
  height: auto;
  padding: 0.45rem 0.75rem;
  white-space: normal;
  line-height: 1.2;
}

.boton-accion {
  font-size: 0.85rem;
  padding: 0.45rem 0.95rem;
}

@keyframes checkmarkPulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
}

@keyframes warningPulse {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.05);
    opacity: 0.8;
  }
}

/* Update processing icon when in bank validation phase */
.verification-processing-icon.bank-phase {
  background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
}

.verification-processing-icon.bank-phase i {
  animation: iconRotate 3s ease-in-out infinite;
}

@keyframes iconRotate {
  0%, 100% {
    transform: rotate(0deg);
  }
  25% {
    transform: rotate(-5deg);
  }
  75% {
    transform: rotate(5deg);
  }
}

    /* Identity Verification Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      display: none;
    }
    
    /* Bank/Mobile Transfer Processing Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 70px;
      right: 16px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .toast {
      background: var(--neutral-900);
      color: white;
      border-radius: var(--radius-md);
      padding: 0.75rem 1rem;
      min-width: 250px;
      max-width: 320px;
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      animation: slideInRight 0.3s ease, fadeOut 0.3s ease 3s forwards;
    }
    
    .toast.success {
      border-left: 4px solid var(--success);
    }
    
    .toast.error {
      border-left: 4px solid var(--danger);
    }
    
    .toast.warning {
      border-left: 4px solid var(--warning);
    }
    
    .toast.info {
      border-left: 4px solid var(--info);
    }
    
    .toast-icon {
      flex-shrink: 0;
    }
    
    .toast-content {
      flex: 1;
      min-width: 0;
    }
    
    .toast-title {
      font-weight: 600;
      font-size: 0.85rem;
      margin-bottom: 0.2rem;
    }
    
    .toast-message {
      font-size: 0.75rem;
      opacity: 0.9;
      word-wrap: break-word;
    }
    
    .toast-close {
      color: var(--neutral-400);
      cursor: pointer;
      transition: var(--transition-base);
      flex-shrink: 0;
    }
    
    .toast-close:hover {
      color: white;
    }
    
    /* Inactivity Modal */
    .inactivity-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .inactivity-card {
      background: white;
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 320px;
      padding: 1.5rem;
      text-align: center;
      animation: scaleIn 0.3s ease;
    }
    
    .inactivity-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--warning);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      margin: 0 auto 1.25rem;
    }
    
    .inactivity-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.75rem;
    }
    
    .inactivity-message {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 1.25rem;
    }
    
    .inactivity-timer {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--danger);
      margin-bottom: 1.25rem;
    }
    
.inactivity-actions {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      align-items: center;
}
    
    /* Welcome Modal */
    .welcome-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1200;
      display: none;
    }
    
    .welcome-card {
      background: white;
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 380px;
      padding: 1.5rem;
      animation: scaleIn 0.3s ease;
    }
    
    .welcome-header {
      display: flex;
      align-items: center;
      gap: 1.25rem;
      margin-bottom: 1.25rem;
    }
    
    .welcome-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      flex-shrink: 0;
    }
    
    .welcome-title-container {
      flex: 1;
      min-width: 0;
    }
    
    .welcome-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.25rem;
    }
    
    .welcome-subtitle {
      font-size: 0.85rem;
      color: var(--neutral-600);
    }
    
    .welcome-content {
      margin-bottom: 1.5rem;
    }
    
    .welcome-step {
      display: flex;
      gap: 0.75rem;
      align-items: flex-start;
      margin-bottom: 1.25rem;
    }
    
    .welcome-step-icon {
      width: 28px;
      height: 28px;
      border-radius: var(--radius-full);
      background: var(--primary-light);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      flex-shrink: 0;
    }
    
    .welcome-step-content {
      flex: 1;
    }
    
    .welcome-step-title {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--neutral-900);
      margin-bottom: 0.25rem;
    }
    
    .welcome-step-description {
      font-size: 0.8rem;
      color: var(--neutral-600);
    }

    #welcome-continue {
      display: block;
      margin: 0 auto;
    }

    /* Logout Modal */
    .logout-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1200;
      display: none;
    }

    .logout-card {
      background: white;
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 380px;
      padding: 1.5rem;
      animation: scaleIn 0.3s ease;
      text-align: center;
    }

    .logout-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      margin: 0 auto 1.25rem;
    }

    .logout-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.75rem;
    }

    .logout-message {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 1.25rem;
    }

.logout-actions {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      align-items: center;
}

    /* Temporary Block Overlay */
    .temp-block-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1300;
      animation: fadeIn 0.3s ease;
    }

    .temp-block-card {
      background: white;
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 380px;
      padding: 1.5rem;
      text-align: center;
      animation: scaleIn 0.3s ease;
    }

    .temp-block-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--danger);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      margin: 0 auto 1.25rem;
    }

    .temp-block-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.75rem;
    }

    .temp-block-message {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 1rem;
    }

    .temp-block-input {
      margin-bottom: 0.75rem;
    }

    .block-balance {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 0.75rem;
    }

    .temp-block-overlay .btn,
    #login-block-overlay .btn {
      width: auto;
      flex: 1 1 auto;
    }
    /* Tawk.to */
    .tawkto-container {
      position: fixed;
      z-index: 1200;
      bottom: 20px;
      right: 20px;
      visibility: hidden;
      display: none;
    }

    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes checkmarkScale {
      from { transform: scale(0); }
      to { transform: scale(1); }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @keyframes shimmer {
      0% {
        transform: translateX(-100%);
      }
      100% {
        transform: translateX(100%);
      }
    }

    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; visibility: hidden; }
    }

    @keyframes slideUp {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    /* Custom toggle switch */
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--neutral-400);
      transition: .4s;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
    }
    
    input:checked + .slider {
      background-color: var(--primary);
    }
    
    input:focus + .slider {
      box-shadow: 0 0 1px var(--primary);
    }
    
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    
    .slider.round {
      border-radius: 24px;
    }
    
    .slider.round:before {
      border-radius: 50%;
    }

    /* Botón para procesar directamente el pago con tarjeta guardada */
    .saved-card-pay-btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      padding: 0.8rem 1rem;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s var(--animation-bounce);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 1rem;
      width: 100%;
    }
    
    .saved-card-pay-btn:hover {
      background: var(--primary-light);
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }
    
    .saved-card-pay-btn:active {
      transform: translateY(0);
    }

    /* Banner base style */
    .banner {
      display: flex;
      align-items: center;
      gap: 1rem;
      background: var(--neutral-100);
      border: 2px solid var(--visa-blue);
      border-radius: var(--radius-md);
      padding: 0.9rem 1rem;
      margin: 1.25rem 0;
      box-shadow: var(--shadow-md);
      color: var(--visa-blue);
    }
    .banner.warning { border-color: var(--warning-orange); color: var(--warning-orange); }
    .banner.success { border-color: var(--success-green); color: var(--success-green); }
    .banner.danger { border-color: var(--danger-red); color: var(--danger-red); }
    .banner .action {
      background: currentColor;
      color: #fff;
      border: none;
      border-radius: var(--radius-md);
      padding: 0.4rem 0.75rem;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition-base);
    }
    .banner .action:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); }

    /* Primera recarga - Banner */
    .first-recharge-banner {
      background: var(--neutral-100);
      border: 2px solid var(--visa-blue);
      border-radius: var(--radius-md);
      padding: 0.9rem 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      margin: 1.25rem 0;
      box-shadow: var(--shadow-md);
      color: var(--visa-blue);
    }
    
    .first-recharge-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--visa-blue);
      color: #fff;
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    
    .first-recharge-content {
      flex: 1;
      min-width: 0;
    }
    
    .first-recharge-title {
      font-weight: 700;
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }
    
    .first-recharge-text {
      font-size: 0.8rem;
      opacity: 0.9;
    }
    
    .first-recharge-action {
      background: var(--visa-blue);
      color: #fff;
      font-weight: 600;
      font-size: 0.8rem;
      padding: 0.4rem 0.75rem;
      border-radius: var(--radius-md);
      flex-shrink: 0;
      transition: all 0.3s var(--animation-bounce);
      cursor: pointer;
      border: none;
      white-space: nowrap;
    }
    
    .first-recharge-action:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* Beneficios de validación */
    .validation-benefits-banner {
      background: var(--neutral-100);
      border: 2px solid var(--success-green);
      border-radius: var(--radius-md);
      padding: 0.9rem 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      margin: 1.25rem 0;
      box-shadow: var(--shadow-md);
      color: var(--success-green);
    }

    .validation-benefits-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--success-green);
      color: #fff;
      font-size: 1.1rem;
      flex-shrink: 0;
    }

    .validation-benefits-content { flex: 1; min-width: 0; }
    .validation-benefits-title { font-weight: 700; margin-bottom: 0.25rem; font-size: 0.9rem; }
    .validation-benefits-text { font-size: 0.8rem; opacity: 0.9; }
    
    /* Notificación de seguridad */
    .security-notice-banner {
      background: #fff;
      border-left: 3px solid var(--info);
      border-radius: var(--radius-md);
      padding: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.8rem;
      margin: 1.75rem 0;
      box-shadow: var(--shadow-sm);
      /* Mantener altura constante para evitar saltos al cambiar de contenido */
      min-height: 90px;
    }
    
    .security-notice-icon {
      width: 72px;
      height: 72px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--info);
      flex-shrink: 0;
    }

    .security-notice-icon i {
      font-size: 2rem;
    }

    .security-notice-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 0;
      background: none;
    }
    
    .security-notice-content {
      flex: 1;
      min-width: 0;
      text-align: center;
    }
    
    .security-notice-title {
      font-weight: 600;
      color: var(--neutral-900);
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }
    
    .security-notice-text {
      color: var(--neutral-700);
      font-size: 0.8rem;
    }

    .security-notice-close {
      cursor: pointer;
      color: var(--neutral-600);
      font-size: 0.9rem;
    }

    /* Full image banner */
    .security-notice-banner.full-image {
      padding: 0;
      border: none;
      display: block;
      box-shadow: none;
      min-height: 160px; /* reserve space for carousel images */
      height: 160px;
      overflow: hidden;
      background: none;
    }

    #promo-full-img,
    #processing-promo-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
      border-radius: var(--radius-md);
    }

    /* Nuevo estilo para el contenedor de soporte después de 5 minutos */
    .support-needed-container {
      display: none;
      background: var(--warning);
      border-radius: var(--radius-md);
      padding: 0.75rem 1rem;
      margin: 1rem 0;
      color: var(--neutral-900);
      box-shadow: var(--shadow-md);
      animation: fadeIn 0.5s ease;
    }

    .support-needed-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .support-needed-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: white;
      color: var(--warning);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      flex-shrink: 0;
    }

    .support-needed-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.2rem;
    }

    .support-needed-subtitle {
      font-size: 0.8rem;
      opacity: 0.9;
    }

    .support-needed-content {
      font-size: 0.8rem;
      margin-bottom: 1rem;
      line-height: 1.4;
    }

    .whatsapp-support-btn {
      background: #25D366;
      color: white;
      border: none;
      border-radius: var(--radius-md);
      padding: 0.75rem;
      width: 100%;
      font-size: 0.9rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      text-decoration: none;
      transition: all 0.3s var(--animation-bounce);
      box-shadow: var(--shadow-md);
    }

    .whatsapp-support-btn:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-xl);
    }

    .whatsapp-support-btn i {
      font-size: 1.5rem;
    }

    /* Estilos para botones deshabilitados */
    .btn-primary:disabled,
    .saved-card-pay-btn:disabled {
      background: var(--neutral-500);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-outline:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-primary:disabled:hover,
    .saved-card-pay-btn:disabled:hover {
      background: var(--neutral-500);
      transform: none;
      box-shadow: none;
    }

    .btn-outline:disabled:hover {
      background: transparent;
      transform: none;
      box-shadow: none;
    }
    
    /* Mensaje de confirmación pago móvil */
    .mobile-payment-success {
      display: none;
      background: rgba(0, 211, 77, 0.1);
      border-left: 3px solid var(--success);
      border-radius: var(--radius-md);
      padding: 0.9rem;
      margin: 1.25rem 0;
      box-shadow: var(--shadow-sm);
    }
    
    .mobile-payment-success-icon {
      width: 36px;
      height: 36px;
      background: var(--success);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    
    .mobile-payment-success-content {
      flex: 1;
      min-width: 0;
    }
    
    .mobile-payment-success-title {
      font-weight: 600;
      color: var(--neutral-900);
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }
    
    .mobile-payment-success-text {
      color: var(--neutral-700);
      font-size: 0.8rem;
    }

    /* Nuevos estilos para los botones de configuración */
    .settings-buttons {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1rem;
    }

    .settings-nav-btn {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.9rem;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      transition: all 0.3s ease;
      text-decoration: none;
      color: var(--neutral-900);
      border: none;
      width: 100%;
      cursor: pointer;
    }

    .settings-nav-btn:hover {
      background: var(--neutral-300);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .settings-nav-icon {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      flex-shrink: 0;
      color: white;
    }

    .settings-nav-icon.verification {
      background: var(--primary);
    }

    .settings-nav-icon.activation {
      background: var(--success);
    }

    .settings-nav-icon.limits {
      background: var(--info);
    }

    .settings-nav-icon.withdrawals {
      background: var(--warning);
    }

    .settings-nav-icon.repair {
      background: var(--danger);
    }

    .settings-nav-icon.delete {
      background: var(--danger);
    }

    .settings-nav-icon.pin {
      background: var(--primary);
    }

    .settings-nav-icon.promotion {
      background: var(--accent);
    }

    .settings-nav-icon.points {
      background: var(--secondary);
    }
    .settings-nav-icon.wallets {
      background: var(--primary-light);
    }

    .settings-nav-icon.phone-change {
      background: var(--info);
    }


    .settings-nav-content {
      flex: 1;
      min-width: 0;
      text-align: left;
    }

    .settings-nav-title {
      font-weight: 600;
      font-size: 0.85rem;
      margin-bottom: 0.2rem;
    }

    .settings-nav-description {
      font-size: 0.75rem;
      color: var(--neutral-600);
    }

    .settings-nav-btn.disabled {
      background: var(--neutral-300);
      color: var(--neutral-600);
      pointer-events: none;
      cursor: not-allowed;
    }

    .settings-nav-btn.disabled .settings-nav-icon {
      background: var(--neutral-500);
    }

    /* Responsive Styles */
    @media (max-width: 479px) {
      .verification-processing-banner {
        flex-wrap: wrap;
        align-items: flex-start;
      }
      .verification-processing-content {
        width: 100%;
      }
      .verification-note {
        display: none;
      }
      #verification-progress-percent {
        text-align: left;
      }
      .users-online-badge {
        display: flex;
        padding: 0.25rem;
      }

      #users-online-count {
        display: none;
      }

      .pulse-dot {
        width: 8px;
        height: 8px;
      }

      .service-grid,
      .help-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .service-icon,
      .help-icon,
      .welcome-icon,
      .logout-icon,
      .inactivity-icon,
      .feature-blocked-icon {
        width: 40px;
        height: 40px;
        font-size: 1.1rem;
      }

      .transaction-item {
        grid-template-columns: auto 1fr auto;
        font-size: 0.75rem;
      }

      .transaction-title {
        font-size: 0.7rem;
      }

      .transaction-details {
        font-size: 0.6rem;
      }

      .transaction-amount {
        font-size: 0.75rem;
      }
    }

    @media (min-width: 480px) {
      .users-online-badge {
        display: flex;
      }

      #users-online-count {
        display: inline;
      }
      
      .saved-card-container {
        padding: 1.25rem;
      }
    }
    
@media (min-width: 768px) {
      .app-container {
        max-width: 100%;
      }
      
      .dashboard-content {
        padding: 1.25rem;
      }
      
      .header-brand-text {
        display: block;
      }
      
      .balance-amount {
        font-size: 3.115rem;
      }

      #dashboard-balance {
        font-size: 3.271rem;
      }

      .balance-actions {
        grid-auto-rows: 52px;
      }
      .balance-btn {
        font-size: clamp(0.648rem, 1.8vw, 0.765rem);
      }

      .service-grid,
      .help-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }
    
    @media (min-width: 1024px) {
      .dashboard-content {
        padding: 1.5rem;
      }
    }
    details.account-section {
      margin-top: 0.75rem;
      background: var(--neutral-100);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
      padding: 0.5rem 1rem;
    }
  details.account-section summary {
      cursor: pointer;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
  #banks-list div {
    padding: 0.25rem 0;
    border-bottom: 1px solid var(--neutral-200);
  }
  #holder-summary {
    font-size: 0.85rem;
    line-height: 1.4;
    margin-top: 0.5rem;
  }

    /* Page Overlay to display external pages within the dashboard */
    .page-overlay {
      position: fixed;
      top: 60px;
      bottom: 60px;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .page-container {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      overflow-y: auto;
    }

    .page-frame {
      width: 100%;
      height: 100%;
      border: none;
    }

    .page-close {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
      z-index: 10;
    }

    .page-close:hover {
      background: var(--neutral-300);
    }

    .support-menu {
      display: none;
      position: fixed;
      bottom: 5rem;
      right: 1.5rem;
      flex-direction: column;
      gap: 0.5rem;
      z-index: 1050;
    }

    .support-menu.show {
      display: flex;
    }

    .support-menu .btn {
      background: var(--neutral-100);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .support-menu .btn:hover {
      background: var(--neutral-200);
    }

    .support-fab {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 2rem;
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: var(--shadow-lg);
      cursor: pointer;
      z-index: 1051;
    }

    .support-fab svg {
      width: 1rem;
      height: 1rem;
    }

    /* Overlay de video de bienvenida */
    .welcome-video-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(10, 15, 30, 0.9);
      z-index: 1300;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .welcome-video-overlay.active {
      display: flex;
      opacity: 1;
    }

    .welcome-video-container {
      position: relative;
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    }

    .welcome-video-close {
      margin-top: 20px;
      padding: 10px 20px;
      border-radius: 30px;
      background: rgba(255, 255, 255, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--primary);
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      z-index: 10;
      transition: all 0.3s ease;
      opacity: 0;
      transform: scale(0);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    }

    .welcome-video-close.visible {
      opacity: 1;
      transform: scale(1);
    }

    .welcome-video-close:hover {
      background: rgba(255, 255, 255, 1);
      transform: scale(1.05);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
    }

    /* iPhone promo overlay */
    .iphone-ad-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1400;
    }

    .iphone-overlay-container {
      position: relative;
      width: 100%;
      height: 100vh;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .iphone-video-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 1;
    }

    .iphone-overlay-text {
      position: relative;
      z-index: 2;
      text-align: center;
      color: white;
      padding: 1.5rem;
    }

    .iphone-overlay-text h1 {
      font-size: 2.5rem;
      font-weight: 700;
      line-height: 1.4;
      background: rgba(0, 0, 0, 0.55);
      border-radius: 16px;
      padding: 1.2rem 2rem;
      display: inline-block;
      backdrop-filter: blur(8px);
    }

    .iphone-overlay-close {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 32px;
      height: 32px;
      background: rgba(0, 0, 0, 0.6);
      color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 3;
    }

  @media (max-width: 768px) {
      .iphone-overlay-text h1 {
        font-size: 1.6rem;
        padding: 1rem;
      }
  }

  .led-orange {
    width: 8px;
    height: 8px;
    border-radius: var(--radius-full);
    background: #FFA500;
    box-shadow: 0 0 4px rgba(255,165,0,0.7);
    cursor: pointer;
    display: inline-block;
  }

  .visa-spinner {
    width: 24px;
    height: 24px;
    animation: spin 1s linear infinite;
  }

  .id-preview-actions {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
  }

  /* USDT exchange overlay */
  #usdt-exchange-overlay .exchange-type {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }
  #usdt-exchange-overlay .exchange-type .btn {
    flex: 1;
  }
  #usdt-exchange-overlay .input-with-button {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  #usdt-exchange-overlay .input-with-button input {
    flex: 1;
    padding: 0.5rem;
    border: 1px solid var(--neutral-300);
    border-radius: var(--radius-sm);
  }
  #usdt-exchange-overlay .exchange-result {
    text-align: center;
    margin-top: 0.5rem;
    font-size: 0.9rem;
    color: var(--neutral-600);
  }

  #usdt-exchange-overlay .balance-info {
    text-align: center;
    font-size: 0.85rem;
    color: var(--neutral-700);
    margin-bottom: 0.5rem;
  }
  #usdt-exchange-overlay .exchange-summary {
    text-align: center;
    font-size: 0.85rem;
    color: var(--neutral-700);
    margin-top: 0.5rem;
  }
  #usdt-exchange-overlay .exchange-error {
    text-align: center;
    font-size: 0.85rem;
    color: var(--danger-red);
    margin-top: 0.5rem;
    display: none;
  }
  #usdt-exchange-overlay .success-message {
    text-align: center;
    font-size: 0.9rem;
    color: var(--success);
    margin-top: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }

  /* Gift progress section */
  .gift-section {
    text-align: center;
    margin-top: 1.5rem;
  }
  .gift-section img.gift-image {
    width: 120px;
    margin-bottom: 0.75rem;
  }
  .gift-actions {
    margin-top: 0.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* Sutil parpadeo para llamar la atención en el botón de instrucciones */
  @keyframes attentionBlink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.55; }
  }
  .attention-blink {
    animation: attentionBlink 1.8s ease-in-out infinite;
  }

  </style>
  <link rel="stylesheet" href="responsive.css">
  <style>
    html {
      font-size: 82.8%;
    }
    @media (min-width: 768px) {
      html { font-size: 115%; }
    }
  </style>
  <link rel="stylesheet" href="theme.css">
  <link rel="stylesheet" href="recargareportes.css">
  <style>
    .pay-methods-disabled {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 1rem;
    }
    .pay-methods-disabled .pay-disabled-btn {
      background: #fff;
      border: 1px solid rgba(0,0,0,0.1);
      padding: 0.5rem 1rem;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
      cursor: pointer;
      transition: var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .pay-methods-disabled .pay-disabled-btn:hover {
      box-shadow: var(--shadow-md);
    }
    .pay-methods-disabled img {
      max-height: 24px;
    }
    .social-links {
      display: flex;
      gap: 1.2rem;
      justify-content: center;
      margin-top: 0.5rem;
    }

    .social-link {
      width: 4rem;
      height: 4rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(255, 255, 255, 0.08);
      border-radius: 50%;
      color: var(--visa-blue);
      transition: var(--transition-base);
      font-size: 1.6rem;
      position: relative;
      overflow: hidden;
    }

    .social-link::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--visa-blue);
      opacity: 0;
      transition: opacity var(--transition-fast);
      z-index: -1;
    }

    .social-link:hover::before {
      opacity: 1;
    }

    .social-link:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-md);
      color: var(--neutral-100);
    }
  </style>
</head>

<body>
  <!-- Login Section -->
  <div class="login-container" id="login-container">
    <div class="login-card">
      <div class="login-logo">
        <div class="login-logo-container" id="login-logo">
          <img class="remeex-logo" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhnBzNdjl6bNp-nIdaiHVENczJhwlJNA7ocsyiOObMmzbu8at0dY5yGcZ9cLxLF39qI6gwNfqBxlkTDC0txVULEwQVwGkeEzN0Jq9MRTRagA48mh18UqTlR4WhsXOLAEZugUyhqJHB19xJgnkpe-S5VOWFgzpKFwctv3XP9XhH41vNTvq0ZS-nik58Qhr-O/s320/remeex.png" alt="REMEEX" onerror="this.onerror=null;this.src='remeex visa.jpg'">
        </div>
      </div>
      
      <div class="login-heading">
        <h1 class="login-title" id="welcome-message">Bienvenido</h1>
        <p class="login-subtitle" id="login-subtitle">Ingrese sus datos para acceder a su cuenta</p>
        <p class="login-email" id="welcome-email"></p>
      </div>
      
      <div class="security-badge">
        <div class="security-badge-icon">
          <i class="fas fa-shield-alt"></i>
        </div>
      <div class="security-badge-content">
        <div class="security-badge-title">Conexión segura</div>
        <div class="security-badge-text">Sus datos están protegidos con cifrado de nivel bancario</div>
      </div>
    </div>


      <div class="form-group" style="display:none;">
        <label class="form-label" for="full-name">Nombre Completo</label>
        <input type="text" class="form-control" id="full-name" placeholder="Ej: Juan Pérez" aria-describedby="name-error" readonly>
        <div class="error-message" id="name-error"></div>
      </div>

      <div class="form-group" style="display:none;">
        <label class="form-label" for="email">Correo Electrónico</label>
        <input type="email" class="form-control" id="email" placeholder="ejemplo@correo.com" aria-describedby="email-error" readonly>
        <div class="error-message" id="email-error"></div>
      </div>

      <button class="btn btn-secondary btn-small" id="toggle-security-fields" style="width:100%; margin:0.5rem 0;">
        Mostrar contraseña y código <i class="fas fa-chevron-down"></i>
      </button>

      <div id="security-fields" style="display:none;">
        <div class="form-group">
          <label class="form-label" for="login-password">Contraseña</label>
          <input type="password" class="form-control" id="login-password" placeholder="Tu contraseña" aria-describedby="login-password-error">
          <span class="password-toggle" id="toggle-login-password"><i class="fas fa-eye"></i></span>
          <div class="error-message" id="login-password-error">Por favor, introduce tu contraseña.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="visa-code">Código Visa de 20 dígitos</label>
          <input type="password" class="form-control" id="visa-code" placeholder="Enviado a tu correo electrónico" aria-describedby="code-error">
          <span class="password-toggle" id="toggle-visa-code"><i class="fas fa-eye"></i></span>
          <div class="error-message" id="code-error">La clave debe tener 20 dígitos.</div>
        </div>
      </div>

      <div class="login-balance-card" id="pre-login-balance" style="display:none;">
        <div class="particles-container"></div>
        <div class="balance-content">
          <div class="balance-owner user-greeting-text" id="pre-balance-owner"></div>
          <div class="login-balance-main">
            <span id="pre-main-balance">Bs 0,00</span>
            <button id="pre-refresh-balance-btn" class="balance-refresh-btn" aria-label="Actualizar saldo">
              <img
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAABrElEQVR4nK2WvytFYRjHv1d+RkShhJRSZrPFIpONwST/gEVIKWUwMGK1isXGKJS7WO5iMDAYiHKFDOpjOOdy7nufc95zLt96hve53+f5nPv+OicHKIX6JU1LGpfULmlF0nGawh8BSdEEbAGfBLoBBjw1ZiT92AXk+dUbMFQNJAlUD1xQroVqIUmgNQfyCrT8N6gDKDqgvb9AANUY+2NKUquTO8u0wwxZoHEjd5WiV6ukLVU+ZCDjb95QqR7P1OSAw9B7FI69a/RmgBo9oGXHv2SBbo3GSbp2mowBX47nK8yXgWYygmYjDfqAxxjfE5FbpFSwkxKyHYHUAecefx5oiILSFF2WisLYTflwO1GQgF7gIcZcNg1UMd3u7km1sMBdRlDB2qpLjmnR8ESj2WhcdH1xh+8gLDAPnxP9Bsg9Aqq1LgtJc5LuJa2G4yR1G7mCm7BAkvQqad4DKGnEyJ24CetSzapRZ/wi6eC/QW2SJp3cpqRihdOz0L5YcTbBKVBref8CGQbeI5ALoDPOXy1kkN9b/wPYwPMqyUGqD8ioJiStS3pW8BG5r+AoJOobCDpAqcnF0+wAAAAASUVORK5CYII="
                alt="Actualizar saldo">
            </button>
          </div>
          <div class="login-balance-eq">
            <span id="pre-usd-balance">≈ $0.00</span> |
            <span id="pre-eur-balance">≈ €0.00</span>
          </div>
          <div class="login-balance-rate" id="pre-exchange-rate">Tasa: --</div>
        </div>
      </div>
      
      <button class="btn btn-primary login-button" id="login-button">
        <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
      </button>

      <div class="login-bank-logo-container" id="login-bank-logo">
        <img id="login-bank-logo-img" alt="Banco afiliado" />
      </div>
      <p class="bank-affiliate-text" id="bank-affiliate-text">Bancos afiliados a Remeex Visa Venezuela</p>

      <div class="led-indicator" id="led-indicator" style="display:none;">
        <span class="led-light" id="led-light"></span>
        <span id="led-message"></span>
      </div>


  <div class="support-menu" id="support-menu">
    <a href="https://visa.remeexvisa.com" target="_blank" class="btn btn-outline">Ir a Remeex Visa</a>
    <a href="#" class="btn btn-outline" id="login-help">Ayuda</a>
    <a href="#" class="btn btn-outline" id="login-userchat">Chat con Usuarios</a>
  </div>
  <button class="support-fab" id="support-fab" aria-label="Soporte">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="10"></circle>
      <path d="M12 16v-2"></path>
      <path d="M12 12a2 2 0 1 0-2-2"></path>
    </svg>
    <span>Soporte</span>
  </button>
  </div>

</div>

  <!-- Audio para inicio de sesión -->
  <audio id="loginMusic" style="display:none;" preload="auto"></audio>
  <!-- Audio para recarga exitosa -->
  <audio id="rechargeSuccessSound" preload="auto" style="display:none;">
    <source src="remeexvisa12p.ogg" type="audio/ogg">
  </audio>
  <!-- Audio para progreso de verificación -->
  <audio id="verificationProgressSound" preload="auto" style="display:none;">
    <source src="remeexvisa1010.ogg" type="audio/ogg">
  </audio>
  <!-- Audio con instrucciones de validación -->
  <audio id="validationInstructionsSound" preload="auto" style="display:none;">
    <source src="explicacion.ogg" type="audio/ogg">
  </audio>
  <!-- Audio de recordatorio luego de la primera recarga -->
  <audio id="hourlyRechargeSound" preload="auto" style="display:none;">
    <source src="remeexvisa23.ogg" type="audio/ogg">
  </audio>
  <!-- Audio para explicación de bloqueo -->
  <audio id="blockExplanationAudio" preload="auto" style="display:none;">
    <source src="audiobloqueo.ogg" type="audio/ogg">
  </audio>

  <!-- App Header (only visible after login) -->
  <header class="app-header" id="app-header" style="display: none;">
    <div class="header-brand">
      <a href="https://visa.remeexvisa.com">
        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhnBzNdjl6bNp-nIdaiHVENczJhwlJNA7ocsyiOObMmzbu8at0dY5yGcZ9cLxLF39qI6gwNfqBxlkTDC0txVULEwQVwGkeEzN0Jq9MRTRagA48mh18UqTlR4WhsXOLAEZugUyhqJHB19xJgnkpe-S5VOWFgzpKFwctv3XP9XhH41vNTvq0ZS-nik58Qhr-O/s320/remeex.png" alt="REMEEX">
      </a>
    </div>
    
    <div class="header-actions">
      <div class="users-online-badge" id="online-users-link">
        <div class="pulse-dot"></div>
        <span id="users-online-count">124 usuarios conectados</span>
      </div>
      
      <button class="header-action-btn" id="notification-btn" aria-label="Notificaciones">
        <i class="fas fa-bell"></i>
        <span class="notification-badge" style="display:none">0</span>
      </button>
      <button class="header-action-btn" id="header-logout-btn" aria-label="Cerrar Sesión">
        <i class="fas fa-sign-out-alt"></i>
      </button>
    </div>
  </header>

  <!-- Dashboard Container -->
  <div class="app-container" id="dashboard-container" style="display: none;">
    <div class="dashboard-content">
      <!-- Home Section -->
      <div id="home-section">
        <!-- Main Account Card -->
        <div id="main-balance-card" class="balance-card">
          <div class="card-decoration"></div>
          <div class="card-decoration"></div>
          <!-- Contenedor de partículas -->
          <div class="particles-container" id="particlesContainer"></div>
          <div class="balance-content">
            <div class="balance-header">
              <div class="balance-label">
                <i class="fas fa-shield-alt"></i>
                <span id="balance-label-name" class="user-greeting-text">Saldo Disponible</span>
                <span id="balance-date" class="balance-date"></span>
              </div>
              <div class="header-right">
                <div class="header-avatar" id="header-avatar">JP</div>
                <div class="balance-controls">
                  <button id="currency-toggle-btn" class="balance-control-btn">USD</button>
                  <button id="balance-visibility-btn" class="balance-control-btn"><i class="fas fa-eye"></i></button>
                </div>
              </div>
            </div>
            
            <div class="balance-amount" id="dashboard-balance">
              <img src="https://upload.wikimedia.org/wikipedia/commons/0/06/Flag_of_Venezuela.svg" class="currency-flag" id="main-currency-flag" alt="Bandera de Venezuela">
              <span id="main-currency-symbol">Bs</span>
              <span id="main-balance-value">0,00</span>
              <button id="refresh-balance-btn" class="balance-refresh-btn" aria-label="Actualizar saldo">
                <img
                  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAABrElEQVR4nK2WvytFYRjHv1d+RkShhJRSZrPFIpONwST/gEVIKWUwMGK1isXGKJS7WO5iMDAYiHKFDOpjOOdy7nufc95zLt96hve53+f5nPv+OicHKIX6JU1LGpfULmlF0nGawh8BSdEEbAGfBLoBBjw1ZiT92AXk+dUbMFQNJAlUD1xQroVqIUmgNQfyCrT8N6gDKDqgvb9AANUY+2NKUquTO8u0wwxZoHEjd5WiV6ukLVU+ZCDjb95QqR7P1OSAw9B7FI69a/RmgBo9oGXHv2SBbo3GSbp2mowBX47nK8yXgWYygmYjDfqAxxjfE5FbpFSwkxKyHYHUAecefx5oiILSFF2WisLYTflwO1GQgF7gIcZcNg1UMd3u7km1sMBdRlDB2qpLjmnR8ESj2WhcdH1xh+8gLDAPnxP9Bsg9Aqq1LgtJc5LuJa2G4yR1G7mCm7BAkvQqad4DKGnEyJ24CetSzapRZ/wi6eC/QW2SJp3cpqRihdOz0L5YcTbBKVBref8CGQbeI5ALoDPOXy1kkN9b/wPYwPMqyUGqD8ioJiStS3pW8BG5r+AoJOobCDpAqcnF0+wAAAAASUVORK5CYII="
                  alt="Actualizar saldo">
              </button>
            </div>
            <div id="balance-block-msg">Saldo bloqueado temporalmente</div>
            
              <div class="balance-equivalents">
                <div class="balance-equivalent">
                  <img src="https://flagcdn.com/us.svg" class="currency-flag" alt="Bandera de EEUU">
                  <span id="usd-equivalent">≈ $0.00</span>
                </div>
                <div class="balance-equivalent">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/b/b7/Flag_of_Europe.svg" class="currency-flag" alt="Bandera de la Unión Europea">
                  <span id="eur-equivalent">≈ €0.00</span>
                </div>
                <div class="balance-equivalent" id="usdt-balance">
                  <img src="usdt.png" class="currency-flag" alt="USDT">
                  <span id="usdt-equivalent">≈ 0 USDT</span>
                </div>
              </div>
            
            <div class="exchange-rate" id="exchange-rate">
              <i class="fas fa-exchange-alt"></i> <span id="exchange-rate-display">Tasa: --</span>
            </div>
            
            <div class="account-level" id="account-level">
              <div class="pulse-dot"></div>
              <span id="account-level-text"></span>
            </div>

            <div class="balance-savings" id="balance-savings" style="display:none; margin-bottom:0.75rem;">
              <button class="btn btn-outline" id="view-savings-btn" style="font-size:0.75rem;"></button>
            </div>

            <!-- Pending Transaction Badge (hidden by default) -->
            <div class="pending-transaction-badge" id="pending-transaction-badge" style="display: none;">
              <i class="fas fa-clock"></i>
              <div>
                <div style="font-weight: 600; margin-bottom: 0.125rem;">Transacción pendiente</div>
                <div id="pending-transaction-amount">$0.00 en proceso de verificación</div>
              </div>
            </div>

            <!-- Rejected Transaction Badge (hidden by default) -->
            <div class="rejected-transaction-badge" id="rejected-transaction-badge" style="display: none;">
              <i class="fas fa-times"></i>
              <div>
                <div style="font-weight: 600; margin-bottom: 0.125rem;">Transacción rechazada</div>
                <div id="rejected-transaction-amount">$0.00 será devuelto</div>
              </div>
            </div>
            
            <div class="balance-actions">
              <div class="action-group" id="withdraw-group">
                <button class="balance-btn" id="send-btn">
                  <i class="fas fa-upload"></i>
                  <span class="btn-text">
                    <span class="line1">Retirar Dinero a</span>
                    <span class="line2" id="send-bank-name"></span>
                  </span>
                </button>
              </div>
              <div class="action-group" id="recharge-group">
                <button class="balance-btn" id="recharge-btn">
                  <i class="fas fa-plus-circle"></i> Agregar Dinero
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Banner promocional dinámico -->
        <div class="security-notice-banner" id="promo-banner">
          <img id="promo-full-img" style="display:none" alt="Promoción" />
          <div class="security-notice-icon" id="promo-icon">
            <i class="fas fa-lock"></i>
          </div>
          <div class="security-notice-content">
            <div class="security-notice-title" id="promo-title">Acceso Exclusivo a este Dispositivo</div>
            <div class="security-notice-text" id="promo-text">Por su seguridad, su saldo y transacciones solo están disponibles en este dispositivo donde ha iniciado sesión.</div>
          </div>
          <div class="security-notice-close" id="security-notice-close"><i class="fas fa-times"></i></div>
        </div>
  <script src="js/promo-banner.js"></script>
  <script src="js/processing-promo-banner.js"></script>
        
        <!-- Estado 1: Invitación a recargar -->
        <div class="verificacion-section" id="status-recharge" style="display:none;">
          <h3 class="verificacion-titulo" id="first-recharge-title">
            <svg class="icono-titulo" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <path stroke="#1d4ed8" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            ¡Haz tu primera recarga!
          </h3>
          <p class="verificacion-descripcion">Comienza a utilizar todos los servicios recargando con tarjeta de crédito.</p>
          <div class="verificacion-grid">
            <div class="verificacion-card estatus-pendiente">
              <div class="icono-estatus"><i class="fas fa-credit-card"></i></div>
              <div class="contenido-estatus">
                <strong class="status-label">Primera recarga pendiente</strong>
                <p class="status-sublabel" id="first-recharge-sublabel">
                  <span id="first-recharge-message"></span>
                  <img id="first-recharge-bank-logo" class="bank-logo-mini" alt="Logo del banco" style="display:none;">
                  <span id="first-recharge-bank-name"></span>
                </p>
                <div class="botones-validacion">
                  <button class="btn btn-outline btn-small first-recharge-action" id="first-recharge-button">Recargar</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Estado 1b: Recarga exitosa -->
        <div class="verificacion-section" id="status-recharge-success" style="display:none;">
          <h3 class="verificacion-titulo">
            <svg class="icono-titulo" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <path stroke="#10b981" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            ¡Recarga Exitosa!
          </h3>
          <p class="verificacion-descripcion">Tu saldo ha sido actualizado correctamente.</p>
          <div class="verificacion-grid">
            <div class="verificacion-card estatus-exitoso">
              <div class="icono-estatus"><i class="fas fa-check-circle"></i></div>
              <div class="contenido-estatus">
                <strong class="status-label">Recarga completada</strong>
                <p class="status-sublabel">Explora las funciones de la aplicación.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Estado 2: Solicitar verificación -->
        <div class="verificacion-section" id="status-request-verification" style="display:none;">
          <h3 class="verificacion-titulo" id="verify-identity-title">
            <svg class="icono-titulo" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <path stroke="#f59e0b" stroke-width="2" d="M12 12v8m0-16v4m8 4h-4m-8 0H4"/>
            </svg>
            Verificación de Identidad Requerida
          </h3>
          <p class="verificacion-descripcion">Para una mayor seguridad y acceso completo a todas las funciones, verifique su identidad.</p>
          <div class="verificacion-grid">
            <div class="verificacion-card estatus-pendiente">
              <div class="icono-estatus"><i class="fas fa-id-card"></i></div>
              <div class="contenido-estatus">
                <strong class="status-label">Sube tu documento de identidad</strong>
                <p class="status-sublabel">Completa la verificación para habilitar los retiros.</p>
                <div class="botones-validacion">
                  <button class="btn btn-outline btn-small" id="start-verification-card">Verificar</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Banner promo durante la verificación -->
        <div id="processing-promo-banner" class="security-notice-banner full-image" style="display:none; position:relative;">
          <img id="processing-promo-image" alt="Promoción" />
          <div class="security-notice-close" id="processing-promo-close" style="position:absolute;top:8px;right:8px;cursor:pointer;"><i class="fas fa-times"></i></div>
        </div>

        <!-- Estado 3: Proceso de verificación -->
        <div class="verificacion-section verification-processing-banner" id="status-processing-card" style="display:none;">
          <h3 class="verificacion-titulo" id="verification-processing-heading">Verificando Documentos</h3>
          <p class="verificacion-descripcion" id="verification-processing-text">Estamos revisando su documentación. Este proceso puede tardar unos minutos.</p>
          <div class="verificacion-grid" id="verification-progress-cards">
            <div class="verificacion-card estatus-pendiente">
              <div class="icono-estatus"><div id="main-processing-spinner" class="verification-processing-spinner"></div></div>
              <div class="contenido-estatus">
                <strong class="status-label" id="verification-processing-title">Procesando Verificación</strong>
                <div id="verification-progress-container" class="verification-progress-container">
                  <div id="verification-progress-bar" class="verification-progress-bar"></div>
                </div>
                <div id="verification-progress-percent" class="verification-progress-percent">0%</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Estado 4: Verificación en progreso -->
        <div class="verificacion-section" id="status-final" style="display:none;">
          <h3 class="verificacion-titulo" id="verification-final-heading">
            <svg class="icono-titulo" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <path stroke="#1d4ed8" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            Verificación en Progreso
          </h3>
          <p class="verificacion-descripcion" id="final-step-text">Falta un último paso para activar todas las funciones.</p>
          <div class="verificacion-grid" id="verification-status-cards">
            <div class="verificacion-card estatus-exitoso" id="status-documents">
              <div class="icono-estatus">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#10b981" width="24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
              </div>
              <div class="contenido-estatus">
                <strong id="status-documents-label" class="status-label">Documento de identidad validado con éxito</strong>
                <p id="id-validated-info" class="status-sublabel"></p>
              </div>
            </div>

            <div class="verificacion-card estatus-exitoso" id="status-bank">
              <div class="icono-estatus">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#10b981" width="24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
              </div>
              <div class="contenido-estatus">
                <strong id="status-bank-label" class="status-label">Cuenta de banco registrada con éxito</strong>
                <p id="bank-registered-info" class="status-sublabel">
                  <img id="bank-logo-mini" class="bank-logo-mini" alt="Logo del banco" loading="lazy" style="display:none;">
                  <span id="bank-name-text"></span>
                  <span id="bank-account-text"></span>
                </p>
              </div>
            </div>

            <div class="verificacion-card estatus-pendiente" id="status-bank-validation">
              <div class="icono-estatus">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#f59e0b" width="24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l2 2m-2 6a9 9 0 100-18 9 9 0 000 18z" />
                </svg>
              </div>
              <div class="contenido-estatus">
                <strong class="status-label">Validación de datos de cuenta pendiente</strong><span id="validation-spinner" class="validation-spinner" aria-hidden="true"></span>
                  <p id="pending-validation-info" class="status-sublabel">
                    <span id="validation-more" class="validation-more"></span>
                    <a href="#" id="validation-more-btn" class="show-more-link" onclick="toggleValidationMore(event)">Ver menos</a>
                  </p>
                <div class="botones-validacion">
                  <button class="btn btn-outline btn-small" id="start-recharge">Validar, realizar recarga</button>
                  <button class="btn btn-outline btn-small" id="view-status">Mi Estatus</button>
                  <button class="btn btn-outline btn-small" id="bank-support">Soporte</button>
                  <button class="btn btn-outline btn-small" id="view-account-level">Ver mi nivel de cuenta</button>
                  <button class="btn btn-outline btn-small" id="go-validation-data">Ver datos donde debo validar</button>
                    <button class="btn btn-outline btn-small" id="open-validation-benefits">Beneficios de validar</button>
                    <button class="btn btn-outline btn-small" id="open-validation-example" disabled>Ejemplo visual</button>
                    <button class="btn btn-outline btn-small attention-blink" id="play-instructions" style="margin-top: 0.5rem;"><i class="fas fa-play"></i> Escuchar instrucciones <span class="led-green" style="display:inline-block;margin-left:4px;"></span></button>
                    </div>
                  <div id="bank-validation-progress-container" class="verification-progress-container" style="display: none;">
                  <div id="bank-validation-progress-bar" class="verification-progress-bar"></div>
                </div>
                <div id="bank-validation-progress-percent" class="verification-progress-percent" style="display: none;">99%</div>
                <p style="text-align: center; margin-top: 0.5rem;">Reproduce el video explicativo. Si tarda en cargarse, espera a que se complete para evitar interrupciones y verifica tu conexión.</p>
                <div style="padding:50.16% 0 0 0;position:relative;">
                  <iframe src="https://player.vimeo.com/video/1106863750?badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479" frameborder="0" allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media; web-share" referrerpolicy="strict-origin-when-cross-origin" style="position:absolute;top:0;left:0;width:100%;height:100%;" title="Habilita tus retiros"></iframe>
                </div>
                <p id="validation-faq-text" style="text-align: center;"><span id="validation-user-name"></span>, si aún tienes dudas, por favor presiona el botón</p>
                    <div style="display:flex; justify-content:center; margin-top:0.5rem;">
                      <button class="btn btn-outline btn-small" id="open-validation-faq">¿Dudas?</button>
                    </div>
                    <script src="https://player.vimeo.com/api/player.js"></script>
                  </div>
            </div>
          </div>
        </div>
        
        <!-- Recent Transactions -->
        <div class="card">
          <div class="section-title" style="margin-bottom: 0.5rem;">
            <i class="fas fa-history"></i> Transacciones Recientes
            <a href="#" id="view-all-transactions">Ver todas</a>
          </div>
          <div class="transaction-actions">
            <select id="transaction-filter">
              <option value="all">Todas</option>
              <option value="sent">Enviados</option>
              <option value="received">Recibidos</option>
              <option value="savings">Ahorro</option>
              <option value="exchange">Intercambio entre usuarios Remeex</option>
              <option value="services">Servicios</option>
              <option value="summary">Consolidado</option>
            </select>
            <button id="add-widget" class="add-widget-btn"><i class="fas fa-plus"></i></button>
          </div>

        <div class="transaction-list" id="recent-transactions">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>




      </div>
    </div>
  </div>

  <div id="mini-balance-overlay" class="mini-balance-overlay"></div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav" id="bottom-nav" style="display: none;">
    <div class="nav-item" data-section="services">
      <div class="nav-icon"><i class="fas fa-list-alt"></i></div>
      <div class="nav-label" data-i18n="nav-services">Servicios</div>
    </div>
    
    <div class="nav-item" data-section="cards">
      <div class="nav-icon"><i class="fas fa-credit-card"></i></div>
      <div class="nav-label" data-i18n="nav-cards">Tarjetas</div>
    </div>
    
    <div class="nav-item active" data-section="home">
      <div class="nav-icon"><i class="fas fa-home"></i></div>
      <div class="nav-label" data-i18n="nav-home">Inicio</div>
    </div>
    
    <div class="nav-item" data-section="support">
      <div class="nav-icon"><i class="fas fa-headset"></i></div>
      <div class="nav-label" data-i18n="nav-support">Ayuda</div>
    </div>

    <div class="nav-item" data-section="settings">
      <div class="nav-icon"><i class="fas fa-cog"></i></div>
      <div class="nav-label" data-i18n="nav-settings">Ajustes</div>
    </div>
  </nav>

  <!-- Service Overlay -->
  <div class="service-overlay" id="service-overlay">
    <div class="service-container">
      <div class="service-header">
        <div class="service-title">Servicios</div>
        <div class="service-close" id="service-close"><i class="fas fa-times"></i></div>
      </div>
      <div class="service-grid">
        <div class="service-item" id="service-shopping">
          <div class="service-icon shopping">
            <i class="fas fa-shopping-cart"></i>
          </div>
          <div class="service-name">Compras</div>
          <div class="service-description">Usa tu tarjeta</div>
        </div>

        <div class="service-item" id="service-us-account">
          <div class="service-icon us-account">
            <img src="https://1000logos.net/wp-content/uploads/2016/10/Bank-of-America-Logo-500x281.png" alt="Bank of America logo" />
          </div>
          <div class="service-name">Mi cuenta en USA</div>
          <div class="service-description">Banca en EE.UU.</div>
        </div>

        <div class="service-item" id="service-zelle">
          <div class="service-icon zelle">
            <img src="https://www.logo.wine/a/logo/Zelle_(payment_service)/Zelle_(payment_service)-Logo.wine.svg" alt="Zelle logo" />
          </div>
          <div class="service-name">Activar Zelle</div>
          <div class="service-description">Pagos internacionales</div>
        </div>

        <div class="service-item" id="service-market">
          <div class="service-icon market">
            <i class="fas fa-handshake"></i>
          </div>
          <div class="service-name">Intercambio entre usuarios Remeex</div>
          <div class="service-description">Operaciones rápidas</div>
        </div>

        <div class="service-item" id="service-withdrawal">
          <div class="service-icon withdrawal">
            <img src="https://1000logos.net/wp-content/uploads/2020/07/Western-Union-Logo.png" alt="Western Union logo" />
          </div>
          <div class="service-name">Retiro en efectivo</div>
          <div class="service-description">Cobra tu saldo</div>
        </div>

        <div class="service-item" id="service-savings">
          <div class="service-icon savings">
            <i class="fas fa-piggy-bank"></i>
          </div>
          <div class="service-name">Mis ahorros</div>
          <div class="service-description">Crecimiento seguro</div>
        </div>

        <div class="service-item" id="service-wallets">
          <div class="service-icon wallets">
            <i class="fas fa-wallet"></i>
          </div>
          <div class="service-name">Wallets</div>
          <div class="service-description">Gestiona billeteras</div>
        </div>

        <div class="service-item" id="service-bills">
          <div class="service-icon bills">
            <i class="fas fa-file-invoice"></i>
          </div>
          <div class="service-name">Pago de Servicios</div>
          <div class="service-description">Luz, agua, teléfono</div>
        </div>

        <div class="service-item" id="service-donation">
          <div class="service-icon donation">
            <i class="fas fa-hand-holding-heart"></i>
          </div>
          <div class="service-name">Donación</div>
          <div class="service-description">Apoya fundaciones</div>
        </div>

        <div class="service-item" id="service-crypto">
          <div class="service-icon crypto">
            <i class="fab fa-bitcoin"></i>
          </div>
          <div class="service-name">Criptomonedas</div>
          <div class="service-description">Compra y vende</div>
        </div>

        <div class="service-item" id="service-p2p">
          <div class="service-icon p2p">
            <i class="fas fa-user-friends"></i>
          </div>
          <div class="service-name">P2P</div>
          <div class="service-description">Entre usuarios</div>
        </div>

        <div class="service-item" id="service-exchange">
          <div class="service-icon exchange">
            <i class="fas fa-exchange-alt"></i>
          </div>
          <div class="service-name">Cambio de Divisas</div>
          <div class="service-description">Mejores tasas</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Exchange Overlay -->
  <div class="exchange-overlay" id="exchange-overlay">
    <div class="exchange-container">
      <div class="exchange-header">
        <div class="exchange-title">Intercambio entre usuarios Remeex</div>
        <div class="exchange-close" id="exchange-close"><i class="fas fa-times"></i></div>
      </div>
      <p class="exchange-info">Envía y recibe fondos instantáneamente entre usuarios REMEEX. Tus operaciones se guardan y podrás retomarlas cuando quieras.</p>
      <div class="exchange-balance">
        <span id="bal-usd"></span>
        <span id="bal-bs"></span>
        <span id="bal-eur"></span>
      </div>
      <div class="exchange-nav">
        <button class="exchange-tab active" data-tab="send">Enviar</button>
        <button class="exchange-tab" data-tab="request">Solicitar</button>
      </div>
      <div class="exchange-form active" id="send-form">
        <input type="email" class="form-control" id="send-email" placeholder="Email del destinatario">
        <div class="exchange-inline">
          <input type="number" class="form-control" id="send-amount" min="50" max="1000" placeholder="Monto">
          <select id="send-currency">
            <option value="usd">USD</option>
            <option value="bs">Bs</option>
            <option value="eur">EUR</option>
          </select>
        </div>
        <textarea id="send-note" placeholder="Concepto (opcional)"></textarea>
        <button class="btn btn-primary" id="send-money-btn">Enviar</button>
        <div class="exchange-status" id="send-status"></div>
      </div>
      <div class="exchange-form" id="request-form">
        <input type="email" class="form-control" id="request-email" placeholder="Email del usuario">
        <div class="exchange-inline">
          <input type="number" class="form-control" id="request-amount" min="50" max="1000" placeholder="Monto">
          <select id="request-currency">
            <option value="usd">USD</option>
            <option value="bs">Bs</option>
            <option value="eur">EUR</option>
          </select>
        </div>
        <textarea id="request-note" placeholder="Concepto (opcional)"></textarea>
        <button class="btn btn-primary" id="request-money-btn">Solicitar</button>
        <div class="exchange-status" id="request-status"></div>
      </div>
      <h4 class="history-title">Historial Reciente</h4>
      <div class="exchange-history" id="exchange-history"></div>
    </div>
  </div>

  <!-- Cards Overlay -->
  <div class="cards-overlay" id="cards-overlay">
    <div class="card-container">
      <div class="card-header">
        <div class="card-title">Tarjeta Virtual VISA</div>
        <div class="card-close" id="card-close"><i class="fas fa-times"></i></div>
      </div>
      
      <div class="virtual-card">
        <div class="card-logo">
          <img src="https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/chip.png" class="card-chip" alt="Chip de tarjeta">
          <img src="https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/visa.png" class="card-brand" alt="Logo de Visa">
        </div>
        
        <div class="card-number">•••• •••• •••• ••••</div>
        
        <div class="card-details">
          <div style="opacity: 0.7;">Verificación requerida</div>
        </div>
      </div>
      
      <div class="card-apps">
        <div class="card-app"><i class="fab fa-amazon"></i></div>
        <div class="card-app"><i class="fab fa-apple"></i></div>
        <div class="card-app"><i class="fab fa-paypal"></i></div>
        <div class="card-app"><i class="fab fa-spotify"></i></div>
        <div class="card-app"><i class="fab fa-google-play"></i></div>
        <div class="card-app"><i class="fab fa-netflix"></i></div>
      </div>
      
      <div class="card-text">
        Para obtener su tarjeta virtual VISA y poder realizar compras en línea de forma segura, necesita verificar su identidad. Una vez verificado, podrá generar tarjetas virtuales para usar en Amazon, PayPal, Binance, Zinli y otras plataformas.
      </div>

      <a href="tarjetaremeex.html" class="btn btn-primary" id="card-panel-link">Ir a mi panel de tarjeta</a>

    </div>
  </div>

  <!-- Messages Overlay -->
  <div class="messages-overlay" id="messages-overlay">
    <div class="messages-container">
      <div class="messages-header">
        <div class="messages-title">Notificaciones</div>
        <div class="messages-close" id="messages-close"><i class="fas fa-times"></i></div>
      </div>
      
      <div id="messages-list"></div>
    </div>
  </div>

  <!-- Savings Overlay -->
  <div class="savings-overlay" id="savings-overlay">
    <div class="savings-container">
      <div class="savings-header">
        <div class="savings-title">Mis Ahorros</div>
        <div class="savings-close" id="savings-close"><i class="fas fa-times"></i></div>
      </div>
      <div class="summary-grid">
        <div class="summary-card primary">
          <div>Total Ahorrado</div>
          <div class="summary-amount" id="summary-total">$0.00</div>
        </div>
        <div class="summary-card">
          <div>Botes Activos</div>
          <div class="summary-amount" id="summary-count">0</div>
        </div>
      </div>

      <div class="quick-actions">
        <div class="quick-action" id="create-savings-btn">
          <i class="fas fa-plus"></i>
          <div>Nuevo Bote</div>
        </div>
      </div>

      <div class="savings-verify-banner" id="savings-verify-banner" style="display:none;"></div>

      <div class="savings-list" id="savings-list"></div>
    </div>
  </div>

  <!-- Points Overlay -->
  <div class="points-overlay" id="points-overlay">
    <div class="points-container">
      <div class="points-header">
        <div class="points-title">Mis Puntos</div>
        <div class="points-close" id="points-close"><i class="fas fa-times"></i></div>
      </div>
      <div class="points-total">
        <div class="points-info">
          <div class="points-amount" id="points-amount">0</div>
          <div class="points-usd" id="points-usd">$0.00</div>
          <div class="points-progress-wrapper tier-progress-bar-container">
            <div class="tier-progress-bar" id="points-progress-bar"></div>
          </div>
        </div>
        <div class="points-redeem-form">
          <input type="number" id="redeem-points-input" min="1" step="1" value="1" placeholder="Monto en USD">
          <button class="btn btn-primary btn-small" id="redeem-points-btn">Canjear</button>
        </div>
      </div>
      <div class="points-history">
        <div class="points-history-title">Historial reciente</div>
        <ul class="points-history-list" id="points-history"></ul>
      </div>
    </div>
  </div>

  <!-- Points Success Overlay -->
  <div class="success-container" id="points-success-overlay" style="display:none;">
    <div class="success-card">
      <div class="success-checkmark"><i class="fas fa-check"></i></div>
      <div class="success-title">¡Canje Exitoso!</div>
      <div class="success-amount" id="points-success-amount">$0.00</div>
      <div class="success-message">Tus puntos fueron convertidos a saldo.</div>
      <div class="success-actions">
        <button class="btn btn-primary" id="points-success-close"><i class="fas fa-check"></i> Entendido</button>
      </div>
    </div>
  </div>

  <!-- Raffle Overlay -->
  <div class="modal-overlay" id="promo-raffle-overlay" style="display:none;">
    <div class="modal raffle-modal" style="max-width:500px;">
      <div class="raffle-close" id="raffle-close-top"><i class="fas fa-times"></i></div>
      <div class="modal-title">Sorteo del Mes</div>
      <div class="modal-subtitle" id="raffle-subtitle"></div>
      <div class="modal-subtitle" id="raffle-description">Selecciona tu modelo favorito y participa por uno de los <strong>100 dispositivos</strong> que estamos sorteando:</div>
      <div class="raffle-options" id="raffle-selection">
        <label class="raffle-option">
          <input type="radio" name="raffle-phone" value="fold">
          <video class="raffle-video" src="https://images.samsung.com/es/smartphones/galaxy-z-fold7/buy/03_Gallery/01_Animated_KV/Q7_Animated_KV_PC.mp4" autoplay loop muted playsinline></video>
          <span>Samsung Galaxy Fold 7 – 1TB / 16GB RAM / Azul intenso</span>
        </label>
        <label class="raffle-option">
          <input type="radio" name="raffle-phone" value="flip">
          <video class="raffle-video" src="https://images.samsung.com/es/smartphones/galaxy-z-flip7/buy/03_Gallery/01_Animated_KV/B7_Animated_KV_PC.mp4" autoplay loop muted playsinline></video>
          <span>Samsung Galaxy Flip 7 – 512GB / 12GB RAM / Azul intenso</span>
        </label>
        <button class="btn btn-primary" id="participate-btn" style="margin-top:1rem;" disabled>Participar</button>
      </div>
      <div id="raffle-info" style="display:none;text-align:center;">
        <div style="margin-bottom:0.5rem;">Participas por: <strong id="raffle-selected"></strong></div>
        <div style="margin-bottom:0.5rem;">Ticket <span id="raffle-ticket"></span></div>
        <div>Sorteo en <span id="raffle-countdown"></span> días</div>
        <button class="btn btn-primary" id="raffle-close" style="margin-top:1rem;">Cerrar</button>
      </div>

      <div class="gift-section">
        <img class="gift-image" src="https://i05.appmifile.com/176_item_es/23/06/2025/b0df3426b45e6802e2f6569c0bcdd288.png" alt="Xiaomi Smart Band 10">
        <p>Gana una <strong>Xiaomi Smart Band 10</strong> al superar <strong>$1000</strong> de saldo.</p>
        <div class="tier-progress-bar-container">
          <div class="tier-progress-bar" id="gift-progress-bar"></div>
        </div>
        <div class="gift-actions">
          <p id="gift-congrats" style="display:none;">Felicidades</p>
          <button class="btn btn-primary" id="claim-gift-btn" style="display:none;">Reclamar regalo</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Raffle Success Overlay -->
  <div class="success-container" id="raffle-success-overlay" style="display:none;">
    <div class="success-card">
      <div class="success-checkmark"><i class="fas fa-check"></i></div>
      <div class="success-title">¡Listo! Ya estás participando.</div>
      <div class="success-message">Número de ticket <span id="raffle-success-ticket"></span><br>Te notificaremos si resultas ganador.</div>
      <div class="success-actions">
        <button class="btn btn-primary" id="raffle-success-close"><i class="fas fa-check"></i> Entendido</button>
      </div>
    </div>
  </div>

  <!-- Donation Overlay -->
  <div class="donation-overlay" id="donation-overlay">
    <div class="donation-container">
      <div class="donation-header">
        <div class="donation-title">Donaciones</div>
        <div class="donation-close" id="donation-close"><i class="fas fa-times"></i></div>
      </div>
      <div class="donation-form">
        <select id="donation-select">
          <option value="">Seleccione organización</option>
        </select>
        <input type="number" id="donation-amount" placeholder="Monto en USD">
        <button class="btn btn-primary" id="donate-submit">Donar</button>
      </div>
    </div>
  </div>

  <!-- Withdrawals Management Overlay -->
  <div class="withdrawals-overlay" id="withdrawals-overlay">
    <div class="withdrawals-container">
      <div class="withdrawals-header">
        <div class="withdrawals-title">Retiros Pendientes</div>
        <div class="withdrawals-close" id="withdrawals-close"><i class="fas fa-times"></i></div>
      </div>
      <div id="withdrawals-list"></div>
      <button class="btn btn-primary" id="cancel-all-withdrawals" style="margin-top:1rem;">Cancelar Todos</button>
    </div>
  </div>

  <!-- Recharge Cancellation Overlay -->
  <div class="recharge-cancel-overlay" id="recharge-cancel-overlay">
    <div class="recharge-cancel-container">
      <div class="recharge-cancel-header">
        <div class="recharge-cancel-title">Anular Operaciones</div>
        <div class="recharge-cancel-close" id="recharge-cancel-close"><i class="fas fa-times"></i></div>
      </div>
      <div id="recharge-cancel-list"></div>
    </div>
  </div>

  <!-- PIN Modal for Cancellation -->
  <div class="modal-overlay" id="cancel-pin-modal" style="display:none;">
    <div class="modal">
      <div class="modal-title">Ingresa tu PIN</div>
      <div class="modal-subtitle">Confirma la anulación ingresando tu PIN de 4 dígitos</div>
      <div class="otp-container">
        <input type="password" class="otp-input pin-digit" id="cancel-pin-1" maxlength="1" data-next="cancel-pin-2" inputmode="numeric" pattern="[0-9]*">
        <input type="password" class="otp-input pin-digit" id="cancel-pin-2" maxlength="1" data-next="cancel-pin-3" data-prev="cancel-pin-1" inputmode="numeric" pattern="[0-9]*">
        <input type="password" class="otp-input pin-digit" id="cancel-pin-3" maxlength="1" data-next="cancel-pin-4" data-prev="cancel-pin-2" inputmode="numeric" pattern="[0-9]*">
        <input type="password" class="otp-input pin-digit" id="cancel-pin-4" maxlength="1" data-prev="cancel-pin-3" inputmode="numeric" pattern="[0-9]*">
      </div>
      <div class="error-message" id="cancel-pin-error" style="text-align:center; display:none;">PIN incorrecto. Intenta nuevamente.</div>
      <div class="modal-footer">
        <button class="btn btn-outline" id="cancel-pin-cancel-btn"><i class="fas fa-times"></i> Cancelar</button>
        <button class="btn btn-primary" id="cancel-pin-confirm-btn"><i class="fas fa-check"></i> Continuar</button>
      </div>
    </div>
  </div>

  <!-- Change PIN Overlay -->
  <div class="modal-overlay" id="change-pin-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Cambiar PIN</div>
      <div class="modal-subtitle" id="change-pin-question"></div>
      <input type="text" id="change-pin-answer" class="form-control" placeholder="Respuesta" style="margin-bottom:1rem;">
      <div class="otp-container" id="change-pin-new" style="display:none;">
        <input type="password" class="otp-input pin-digit" id="change-pin-1" maxlength="1" data-next="change-pin-2" inputmode="numeric" pattern="[0-9]*">
        <input type="password" class="otp-input pin-digit" id="change-pin-2" maxlength="1" data-next="change-pin-3" data-prev="change-pin-1" inputmode="numeric" pattern="[0-9]*">
        <input type="password" class="otp-input pin-digit" id="change-pin-3" maxlength="1" data-next="change-pin-4" data-prev="change-pin-2" inputmode="numeric" pattern="[0-9]*">
        <input type="password" class="otp-input pin-digit" id="change-pin-4" maxlength="1" data-prev="change-pin-3" inputmode="numeric" pattern="[0-9]*">
      </div>
      <div class="error-message" id="change-pin-error" style="text-align:center; display:none;"></div>
      <div class="modal-footer">
        <button class="btn btn-outline" id="change-pin-cancel-btn"><i class="fas fa-times"></i> Cancelar</button>
        <button class="btn btn-primary" id="change-pin-confirm-btn" data-step="answer"><i class="fas fa-check"></i> Confirmar</button>
      </div>
    </div>
  </div>

  <!-- SMS Phone Validation Overlay -->
  <div class="modal-overlay" id="sms-validation-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Validar Número</div>
      <div class="modal-subtitle">Ingresa el código de 6 dígitos enviado a tu móvil</div>
      <input type="tel" id="sms-code-input" class="form-control" maxlength="6" placeholder="Código de 6 dígitos">
      <div class="error-message" id="sms-code-error" style="text-align:center; display:none;">Código incorrecto.</div>
      <div style="display:flex;gap:0.5rem;justify-content:center;margin-top:1rem;">
        <button class="btn btn-outline" id="sms-close-btn"><i class="fas fa-times"></i> Cancelar</button>
        <button class="btn btn-primary" id="sms-validate-btn"><i class="fas fa-check"></i> Validar</button>
      </div>
    </div>
  </div>

  <!-- SMS Success Overlay -->
  <div class="success-container" id="sms-success-overlay" style="display:none;">
    <div class="success-card">
      <div class="success-checkmark"><i class="fas fa-check"></i></div>
      <div class="success-title">Número de teléfono válido</div>
      <div class="success-actions">
        <button class="btn btn-primary" id="sms-success-close"><i class="fas fa-check"></i> Aceptar</button>
      </div>
    </div>
  </div>

  <!-- Change Phone Overlay -->
  <div class="modal-overlay" id="change-phone-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Cambiar Número</div>
      <div class="modal-subtitle">Esta función estará disponible muy pronto. Por ahora podrás actualizar tu teléfono al realizar tu primera recarga.</div>
      <div style="text-align:center;margin-top:1rem;">
        <button class="btn btn-primary" id="change-phone-close"><i class="fas fa-check"></i> Entendido</button>
      </div>
    </div>
  </div>
  <!-- Shopping Overlay -->
  <div class="shopping-overlay" id="shopping-overlay">
    <div class="shopping-container">
      <div class="shopping-header">
        <div class="shopping-title">Tiendas</div>
        <div class="shopping-close" id="shopping-close"><i class="fas fa-times"></i></div>
      </div>
      <p class="shopping-info">Al validar la cuenta puedes desbloquear más de 350 tiendas en alianza con REMEEX Visa y pagar con tu saldo de REMEEX Visa.</p>
      <div class="store-grid">
        <a href="latinphone" class="store-item available">
          <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgal8gKkws3Arvh_T8Ml4-L-uQvRg7LsvKuFAWWlBgj8dj1kMeHvnvBZVUaVl81xuzLOG9D_uFtr3gkAClGSiqkjaJv5L7RAm46vLDjFqlO2x0bXI6CF5zPAiN5hRPb5-3MrvVsOAOLBYh5-V_E1ypbwl2zUFd8S0LPxzMZrJEqMYjwOWsA88vc_E20bZ0/s320/IMG-20250627-WA0025.png" alt="Latinphone">
          <span class="store-status"><div class="led-green"></div>Disponible</span>
        </a>
        <a href="https://www.sambilonline.com/" target="_blank" class="store-item available">
          <img src="https://www.sambilonline.com/media/logo/stores/1/logo_sambil.webp" alt="Sambil Venezuela">
          <span class="store-status"><div class="led-green"></div>Disponible</span>
        </a>
        <a href="motosbera.html" class="store-item available">
          <img src="https://beravirtual.com/wp-content/uploads/2024/08/Logo-Beramotorcycles_1.png" alt="Motos Bera">
          <span class="store-status"><div class="led-green"></div>Disponible</span>
        </a>
        <a href="cashea.html" class="store-item available">
          <img src="https://runrun.es/wp-content/uploads/2024/08/cashea3-1024x768.jpg" alt="Cashea">
          <span class="store-status"><div class="led-green"></div>Disponible</span>
        </a>
        <a href="beco.html" class="store-item available">
          <img src="https://www.becoenlinea.com/wp-content/uploads/2024/02/Logo-BECO-1024x737.png" alt="Beco">
          <span class="store-status"><div class="led-green"></div>Disponible</span>
        </a>
        <a href="redticket.html" class="store-item available">
          <img src="https://www.redticket.com.ve/assets/Logo_redticket.svg" alt="Reticket">
          <span class="store-status"><div class="led-green"></div>Disponible</span>
        </a>
        <a href="yummyrides.html" class="store-item available">
          <img src="https://cdn.prod.website-files.com/627eccaab96d0621ae273f80/628d4094d0c58d3a70abfd84_rids.png" alt="Yummy Rides">
          <span class="store-status"><div class="led-green"></div>Disponible</span>
        </a>
        <a href="yummy.html" class="store-item available">
          <img src="https://cdn.prod.website-files.com/627eccaab96d0621ae273f80/67db11ce5629728b1c5320e3_logo%20yummy%20svg-p-1080.png" alt="Yummy">
          <span class="store-status"><div class="led-green"></div>Disponible</span>
        </a>
        <div class="store-item">
          <img src="https://www.ivoo.com/home_2-rJh.png" alt="Ivoo">
          <span class="store-status">Cerrado</span>
        </div>
        <div class="store-item">
          <img src="https://images.seeklogo.com/logo-png/3/1/daka-logo-png_seeklogo-38224.png?v=1963052372322810720" alt="Daka">
          <span class="store-status">Cerrado</span>
        </div>
        <div class="store-item">
          <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQvMUC67h27GOPpKlwN9lUe00q2r2vYZErY-w&s" alt="Damasco">
          <span class="store-status">Cerrado</span>
        </div>
        <div class="store-item">
          <img src="https://multimax.com.ve/wp-content/uploads/2024/11/MULTIMAX_GRIS-300x61.png" alt="Multimax">
          <span class="store-status">Cerrado</span>
        </div>
        <div class="store-item">
          <img src="Logo_CLX_Group.png" alt="CLX">
          <span class="store-status">Cerrado</span>
        </div>
        <div class="store-item">
          <img src="https://static.wixstatic.com/media/4b4152_90de5fac769c488f856bfc3770e89a9d~mv2.jpg/v1/fill/w_150,h_150,al_c,q_80,usm_0.66_1.00_0.01,enc_avif,quality_auto/Image-empty-state.jpg" alt="SoyTechno">
          <span class="store-status">Cerrado</span>
        </div>
        <div class="store-item">
          <img src="https://static.wixstatic.com/media/15a47a_d0099a8264554b30b715d7c338f8e34e~mv2.png/v1/fill/w_150,h_150,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/Image-empty-state.png" alt="Canguro">
          <span class="store-status">Cerrado</span>
        </div>
      </div>
  </div>
  </div>

  <!-- LatinPhone Support Overlay -->
  <div class="modal-overlay" id="latinphone-support-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Contacta a soporte de Latinphone</div>
      <div class="modal-subtitle">vía WhatsApp</div>
      <div style="padding:1rem;text-align:center;">
        <a href="https://wa.me/+18133584564" class="btn btn-primary" target="_blank">Abrir WhatsApp</a>
        <button class="btn btn-outline" id="latinphone-support-close" style="margin-left:0.5rem;">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Savings Action Modal -->
  <div class="modal-overlay" id="savings-action-modal" style="display:none;">
    <div class="modal">
      <div class="savings-modal-header">
        <div class="modal-title" id="savings-modal-title"></div>
        <div class="savings-modal-close" id="savings-modal-close"><i class="fas fa-times"></i></div>
      </div>
      <div id="savings-modal-body"></div>
      <button class="btn btn-primary" id="savings-modal-confirm">Confirmar</button>
    </div>
  </div>

  <!-- Help Overlay -->
  <div class="help-overlay" id="help-overlay" tabindex="-1">
    <div class="help-container" role="dialog" aria-modal="true" aria-labelledby="help-title">
      <div class="help-header">
        <div class="help-title" id="help-title">Ayuda</div>
        <div class="help-close" id="help-close"><i class="fas fa-times"></i></div>
      </div>
      <div class="account-executive">
        <div class="led-green" id="help-led"></div>
        <svg class="operator-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 2a7 7 0 00-7 7v4a2 2 0 002 2h1v3a1 1 0 001 1h3v-4a2 2 0 014 0v4h3a1 1 0 001-1v-3h1a2 2 0 002-2V9a7 7 0 00-7-7z"/>
        </svg>
        <span id="account-executive-text"></span>
        <div id="nightly-notice" class="nightly-notice" style="display:none;"></div>
      </div>
      <div class="help-grid">
        <div class="help-item disabled" id="help-faq">
          <div class="help-icon primary-light"><i class="fas fa-question"></i></div>
          <div class="help-name">FAQ</div>
          <div class="help-description">Common answers</div>
        </div>
        <div class="help-item" id="help-chat">
          <div class="help-icon info"><i class="fas fa-comments"></i></div>
          <div class="help-name">Live Chat</div>
          <div class="help-description">24 / 7 agent</div>
        </div>
        <div class="help-item" id="help-whatsapp">
          <div class="help-icon success"><i class="fab fa-whatsapp"></i></div>
          <div class="help-name">WhatsApp</div>
          <div class="help-description">+1 737-301-8059</div>
        </div>
        <div class="help-item" id="help-email">
          <div class="help-icon secondary"><i class="fas fa-envelope"></i></div>
          <div class="help-name">Email</div>
          <div class="help-description">contactcenter@visa.com</div>
        </div>
        <div class="help-item" id="help-userchat">
          <div class="help-icon info"><i class="fas fa-users"></i></div>
          <div class="help-name">Chat con Usuarios</div>
          <div class="help-description">Foro de soporte</div>
        </div>
        <div class="help-item" id="help-comments">
          <div class="help-icon accent"><i class="fas fa-comment-dots"></i></div>
          <div class="help-name">Comentarios</div>
          <div class="help-description">Tu opinión</div>
        </div>
        <div class="help-item disabled" id="help-tutorials">
          <div class="help-icon accent"><i class="fas fa-graduation-cap"></i></div>
          <div class="help-name">Tutorials</div>
          <div class="help-description">Step-by-step videos</div>
        </div>
        <div class="help-item disabled" id="help-status">
          <div class="help-icon warning"><i class="fas fa-clipboard-check"></i></div>
          <div class="help-name">Ticket Status</div>
          <div class="help-description">Track my requests</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Account Edit Modal -->
  <div class="modal-overlay" id="account-edit-modal" style="display:none;">
    <div class="modal">
      <div class="savings-modal-header">
        <div class="modal-title">Editar Cuenta</div>
        <div class="savings-modal-close" id="account-edit-close"><i class="fas fa-times"></i></div>
      </div>
      <div class="form-group" id="edit-name-group">
        <label class="form-label" for="edit-name">Nombre Completo</label>
        <input type="text" class="form-control" id="edit-name">
      </div>
      <div class="form-group" id="edit-id-group">
        <label class="form-label" for="edit-id">Cédula</label>
        <input type="text" class="form-control" id="edit-id" disabled>
      </div>
      <div class="form-group" id="edit-phone-group">
        <label class="form-label" for="edit-phone">Teléfono</label>
        <input type="text" class="form-control" id="edit-phone" disabled>
      </div>
      <div class="form-group" id="edit-bank-group">
        <label class="form-label" for="edit-bank">Banco</label>
        <select class="form-control" id="edit-bank"></select>
      </div>
      <div class="form-group" id="edit-account-number-group">
        <label class="form-label" for="edit-account-number">Número de Cuenta</label>
        <input type="text" class="form-control" id="edit-account-number">
      </div>
      <button class="btn btn-primary" id="save-account-btn">Guardar</button>
    </div>
  </div>

  <!-- Settings Overlay -->
  <div class="settings-overlay" id="settings-overlay">
    <div class="settings-container">
      <div class="settings-header">
        <div class="settings-title-wrapper">
          <div class="settings-title">Configuración</div>
          <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhnBzNdjl6bNp-nIdaiHVENczJhwlJNA7ocsyiOObMmzbu8at0dY5yGcZ9cLxLF39qI6gwNfqBxlkTDC0txVULEwQVwGkeEzN0Jq9MRTRagA48mh18UqTlR4WhsXOLAEZugUyhqJHB19xJgnkpe-S5VOWFgzpKFwctv3XP9XhH41vNTvq0ZS-nik58Qhr-O/s320/remeex.png" alt="Remeex Visa" class="settings-logo">
        </div>
        <div class="settings-close" id="settings-close"><i class="fas fa-times"></i></div>
      </div>

      <details class="settings-section">
        <summary><i class="fas fa-user"></i> Información de Cuenta</summary>
        <div class="settings-content">
          <div class="form-group">
            <label class="form-label" for="settings-name">Nombre Completo</label>
            <input type="text" class="form-control" id="settings-name" disabled>
          </div>

          <div class="form-group">
            <label class="form-label" for="settings-email">Correo Electrónico</label>
            <input type="email" class="form-control" id="settings-email" disabled>
          </div>
        </div>
      </details>

      <details class="settings-section">
        <summary><i class="fas fa-bell"></i> Notificaciones</summary>
        <div class="settings-content" style="display:flex; flex-direction:column; gap:1rem;">
          <div style="display:flex; align-items:center; justify-content:space-between;">
            <div>Notificaciones por correo</div>
            <label class="switch">
              <input type="checkbox" checked>
              <span class="slider round"></span>
            </label>
          </div>

          <div style="display:flex; align-items:center; justify-content:space-between;">
            <div>Notificaciones por SMS</div>
            <label class="switch">
              <input type="checkbox" checked>
              <span class="slider round"></span>
            </label>
          </div>

          <div style="display:flex; align-items:center; justify-content:space-between;">
            <div>Alertas de seguridad</div>
            <label class="switch">
              <input type="checkbox" checked>
              <span class="slider round"></span>
            </label>
          </div>
        </div>
      </details>

      <details class="settings-section">
        <summary><i class="fas fa-shield-alt"></i> Seguridad</summary>
        <div class="settings-content" style="display:flex; flex-direction:column; gap:1rem;">
          <div style="display:flex; align-items:center; justify-content:space-between;">
            <div>Autenticación de dos factores</div>
            <label class="switch">
              <input type="checkbox" id="twofactor-switch">
              <span class="slider round"></span>
            </label>
          </div>

          <div style="display:flex; align-items:center; justify-content:space-between;">
            <div>Notificaciones de inicio de sesión</div>
            <label class="switch">
              <input type="checkbox" checked>
              <span class="slider round"></span>
            </label>
          </div>

          <button class="btn btn-primary" id="verify-identity-btn">
            <i class="fas fa-id-card"></i> Verificar mi Identidad
          </button>
        </div>
      </details>

      <details class="settings-section">
        <summary><i class="fas fa-cogs"></i> Gestión de Cuenta</summary>
        <div class="settings-content">
          <div class="settings-buttons">
            <button class="settings-nav-btn" id="verification-nav-btn">
              <div class="settings-nav-icon verification">
                <i class="fas fa-id-card"></i>
              </div>
              <div class="settings-nav-content">
                <div class="settings-nav-title">Verificación</div>
                <div class="settings-nav-description">Verificar identidad y documentos</div>
              </div>
            </button>

            <button class="settings-nav-btn" id="activation-nav-btn">
              <div class="settings-nav-icon activation">
                <i class="fas fa-check-circle"></i>
              </div>
              <div class="settings-nav-content">
                <div class="settings-nav-title">Recarga Manual para activación</div>
                <div class="settings-nav-description">Activar servicios y funciones</div>
              </div>
            </button>

            <button class="settings-nav-btn" id="limits-nav-btn">
              <div class="settings-nav-icon limits">
                <i class="fas fa-chart-line"></i>
              </div>
              <div class="settings-nav-content">
                <div class="settings-nav-title">Límites</div>
                <div class="settings-nav-description">Ver tus límites mensuales</div>
              </div>
            </button>


            <button class="settings-nav-btn" id="manage-withdrawals-btn">
              <div class="settings-nav-icon withdrawals">
                <i class="fas fa-ban"></i>
              </div>
              <div class="settings-nav-content">
                <div class="settings-nav-title">Retiros Pendientes</div>
                <div class="settings-nav-description">Anular operaciones</div>
              </div>
            </button>

            <button class="settings-nav-btn" id="cancel-recharges-btn">
              <div class="settings-nav-icon withdrawals">
                <i class="fas fa-undo"></i>
              </div>
              <div class="settings-nav-content">
                <div class="settings-nav-title">Anular Operaciones</div>
                <div class="settings-nav-description">Recargas con tarjeta</div>
              </div>
            </button>

            <button class="settings-nav-btn" id="change-pin-btn">
              <div class="settings-nav-icon pin">
                <i class="fas fa-key"></i>
              </div>
              <div class="settings-nav-content">
                <div class="settings-nav-title">Cambiar PIN</div>
                <div class="settings-nav-description">Restablece tu PIN</div>
              </div>
            </button>

            <button class="settings-nav-btn" id="phone-verify-btn">
              <div class="settings-nav-icon verification">
                <i class="fas fa-sms"></i>
              </div>
              <div class="settings-nav-content">
                <div class="settings-nav-title">Validar mi número vía SMS</div>
                <div class="settings-nav-description">Confirmar teléfono móvil</div>
              </div>
            </button>

            <button class="settings-nav-btn" id="change-phone-btn">
              <div class="settings-nav-icon phone-change">
                <i class="fas fa-phone"></i>
              </div>
              <div class="settings-nav-content">
                <div class="settings-nav-title">Cambiar número de teléfono</div>
                <div class="settings-nav-description">Actualizar contacto</div>
              </div>
            </button>

            <button class="settings-nav-btn" id="lite-mode-btn">
              <div class="settings-nav-icon repair">
                <i class="fas fa-bolt"></i>
              </div>
              <div class="settings-nav-content">
                <div class="settings-nav-title">Modo Lite</div>
                <div class="settings-nav-description">Validación mínima por 12 h</div>
              </div>
            </button>

            <button class="settings-nav-btn" id="repair-btn">
              <div class="settings-nav-icon repair">
                <i class="fas fa-tools"></i>
              </div>
              <div class="settings-nav-content">
                <div class="settings-nav-title">Activar funciones premium</div>
                <div class="settings-nav-description">Solucionar problemas de activación</div>
              </div>
            </button>
            <button class="settings-nav-btn" id="link-wallets-btn">
              <div class="settings-nav-icon wallets">
                <i class="fas fa-wallet"></i>
              </div>
              <div class="settings-nav-content">
                <div class="settings-nav-title">Vincular Wallets para retiros</div>
                <div class="settings-nav-description">Sicronización de apps de terceros para retiros</div>
              </div>
            </button>

            <button class="settings-nav-btn" id="promo-nav-btn">
              <div class="settings-nav-icon promotion">
                <i class="fas fa-gift"></i>
              </div>
              <div class="settings-nav-content">
                <div class="settings-nav-title">Sorteo y promociones</div>
                <div class="settings-nav-description">Ofertas y premios</div>
              </div>
            </button>

            <button class="settings-nav-btn" id="points-nav-btn">
              <div class="settings-nav-icon points">
                <i class="fas fa-star"></i>
              </div>
              <div class="settings-nav-content">
                <div class="settings-nav-title">Mis puntos</div>
                <div class="settings-nav-description">Programa de recompensas</div>
              </div>
            </button>

            <button class="settings-nav-btn" id="qr-nav-btn">
              <div class="settings-nav-icon wallets">
                <i class="fas fa-qrcode"></i>
              </div>
              <div class="settings-nav-content">
                <div class="settings-nav-title">Mi QR</div>
                <div class="settings-nav-description">Compartir código</div>
              </div>
            </button>

            <button class="settings-nav-btn" id="delete-account-btn">
              <div class="settings-nav-icon delete">
                <i class="fas fa-user-slash"></i>
              </div>
              <div class="settings-nav-content">
                <div class="settings-nav-title">Eliminar Cuenta</div>
                <div class="settings-nav-description">Cerrar y eliminar mi cuenta</div>
              </div>
            </button>
          </div>
          <div class="toggle-row" id="withdrawals-toggle-row">
            <span>Retiros</span>
            <label class="switch">
              <input type="checkbox" id="withdrawals-switch" onchange="toggleWithdrawals()">
              <span class="slider round"></span>
            </label>
          </div>
          <div class="toggle-row account-tier-row">
            <span>Nivel de Cuenta</span>
            <button class="btn btn-outline account-tier-btn" id="account-tier-btn" title="Presiona aquí para más detalles">Estándar <i class="fas fa-info-circle tier-info"></i></button>
          </div>
          <div class="form-group" style="margin-top:1rem;">
            <label class="form-label" for="interface-language">Idioma</label>
            <select id="interface-language" class="form-control">
              <option value="es">Español</option>
              <option value="en">English</option>
            </select>
          </div>
    </div>
  </details>

  <details class="settings-section" id="reports-section">
    <summary><i class="fas fa-file-alt"></i> Reportes</summary>
    <div class="settings-content reports-content">
      <p class="section-description">Envía un ticket de soporte y consulta tu historial de reportes.</p>
      <div class="reports-actions">
        <button id="open-report-from-settings" class="btn btn-primary">Nuevo Reporte</button>
        <button class="btn btn-primary" id="resolve-problem-btn" style="display:none; background:#007bff;">
          <i class="fas fa-tools"></i> Tengo problemas con mi cuenta
        </button>
      </div>
      <h4 class="history-title">Historial de Reportes</h4>
      <div class="exchange-history reports-history" id="reports-history"></div>
    </div>
  </details>

  <details class="settings-section" id="currency-converter-section">
    <summary><i class="fas fa-money-bill-wave"></i> Conversor de Divisas</summary>
    <div class="settings-content">
      <div class="settings-buttons">
        <a href="calculadora.html" class="settings-nav-btn">
          <div class="settings-nav-icon wallets">
            <i class="fas fa-calculator"></i>
          </div>
          <div class="settings-nav-content">
            <div class="settings-nav-title">Calculadora</div>
            <div class="settings-nav-description">Herramienta de conversión</div>
          </div>
        </a>
        <a class="settings-nav-btn disabled">
          <div class="settings-nav-icon wallets">
            <i class="fas fa-handshake"></i>
          </div>
          <div class="settings-nav-content">
            <div class="settings-nav-title">Proveedores</div>
            <div class="settings-nav-description">Tasas de mercado</div>
          </div>
        </a>
      </div>
    </div>
  </details>
  <details class="settings-section" id="account-card" style="display:none;">
        <summary><i class="fas fa-id-card"></i> Mi Cuenta</summary>
        <div class="account-actions" >
          <button class="btn-icon" id="refresh-account-btn" title="Refrescar"><i class="fas fa-sync-alt"></i></button>
          <button class="btn-icon" id="edit-account-btn" title="Editar"><i class="fas fa-pen"></i></button>
        </div>
        <div class="account-info">
          <div class="account-row">
            <div class="account-label"><i class="fas fa-user"></i> Nombre:</div>
            <div class="account-value" id="account-name"></div>
          </div>
          <div class="account-row">
            <div class="account-label"><i class="far fa-id-card"></i> Cédula:</div>
            <div class="account-value" id="account-id"></div>
          </div>
          <div class="account-row">
            <div class="account-label"><i class="fas fa-phone"></i> Teléfono:</div>
            <div class="account-value" id="account-phone"></div>
          </div>
          <div class="account-row">
            <div class="account-label"><i class="fas fa-university"></i> Banco:</div>
            <div class="account-value" id="account-bank"></div>
          </div>
          <div class="account-row">
            <div class="account-label"><i class="fas fa-hashtag"></i> Número de Cuenta:</div>
            <div class="account-value" id="account-number-display"></div>
          </div>
          <div id="account-logo"></div>
        </div>
        <div class="account-balance">
          <div><strong>USD:</strong> <span id="account-balance-usd"></span></div>
          <div><strong>Bs:</strong> <span id="account-balance-bs"></span></div>
          <div><strong>EUR:</strong> <span id="account-balance-eur"></span></div>
        </div>
        <details class="account-section" id="limits-section">
          <summary><strong>Límites y Seguridad</strong></summary>
          <div class="account-limits">
            <div class="limit-info">
              <p>En Remeex puedes manejar hasta <strong>10.000 USD</strong> en tu cuenta.</p>
              <p>Los retiros a Banesco están permitidos hasta <strong>5.000 USD</strong> sin necesidad de justificantes. Tus límites se actualizan mensualmente.</p>
            </div>
            <label for="withdrawal-limit-slider">Límite de Retiros</label>
            <input type="range" id="withdrawal-limit-slider" min="25" max="10000" step="25">
            <div>Actual: <span id="withdrawal-limit-value" class="limit-value"></span> USD</div>
            <label for="deposit-limit-slider">Límite de Depósitos</label>
            <input type="range" id="deposit-limit-slider" min="25" max="10000" step="25">
            <div>Actual: <span id="deposit-limit-value" class="limit-value"></span> USD</div>
            <div class="toggle-row">
              <span>Habilitar Retiros</span>
              <label class="switch">
                <input type="checkbox" id="withdrawal-toggle">
                <span class="slider round"></span>
              </label>
            </div>
            <div class="toggle-row">
              <span>Congelar Cuenta</span>
              <label class="switch">
                <input type="checkbox" id="freeze-toggle">
                <span class="slider round"></span>
              </label>
            </div>
            <div class="currency-select-wrapper">
              <label for="primary-currency">Moneda Principal</label>
              <select id="primary-currency" class="form-control" >
                <option value="usd">USD</option>
                <option value="bs">Bs</option>
                <option value="eur">EUR</option>
              </select>
            </div>
            <div class="toggle-row">
              <span>Modo Oscuro</span>
              <label class="switch">
                <input type="checkbox" id="dark-mode-toggle">
                <span class="slider round"></span>
              </label>
            </div>
            <div class="toggle-row">
              <span>Modo Silver</span>
              <label class="switch">
                <input type="checkbox" id="silver-mode-toggle">
                <span class="slider round"></span>
              </label>
            </div>
            <div class="toggle-row">
              <span>Modo Gold</span>
              <label class="switch">
                <input type="checkbox" id="gold-mode-toggle">
                <span class="slider round"></span>
              </label>
            </div>
          </div>
        </details>
        <details class="account-section" id="banks-section">
          <summary><strong>Mis Bancos</strong></summary>
          <div class="account-banks" id="account-banks">
            <div id="banks-list"></div>
            <button class="btn btn-primary" id="add-bank-btn" style="margin-top:0.5rem;">Añadir Banco</button>
            <button class="btn btn-secondary" id="change-bank-btn" style="margin-top:0.5rem;">Cambiar Banco Principal</button>
          </div>
        </details>
        <details class="account-section" id="holder-section">
          <summary><strong>Agregar Nuevo Titular</strong></summary>
          <form id="holder-form">
            <div class="form-group">
              <label class="form-label" for="holder-name">Nombre</label>
              <input type="text" class="form-control" id="holder-name" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="holder-lastname">Apellidos</label>
              <input type="text" class="form-control" id="holder-lastname" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="holder-id">Documento de Identidad</label>
              <input type="text" class="form-control" id="holder-id" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="holder-email">Email</label>
              <input type="email" class="form-control" id="holder-email" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="holder-phone">Teléfono</label>
              <input type="tel" class="form-control" id="holder-phone" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="holder-cedula">Adjuntar Cédula</label>
              <input type="file" class="form-control" id="holder-cedula" accept="image/*,application/pdf" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="holder-limit">Límite en USD</label>
              <input type="number" class="form-control" id="holder-limit" min="1" required>
            </div>
            <button type="submit" class="btn btn-primary" id="holder-submit-btn">Registrar</button>
          </form>
          <div id="holder-summary" style="display:none;"></div>
        </details>
      </details>

      <div class="bank-note" style="margin-top:1rem;text-align:justify;font-size:0.7rem;">
        Remeex Visa es una marca de Visa International Service Association que opera en Venezuela
        a trav&eacute;s de Banco Plaza y CRIXTO VENEZUELA, C.A.<br>
        RIF: J-50025393-1<br>
        Direcci&oacute;n: Torre Banco Plaza, Av. Casanova, entre calle Villa Flor y calle Uni&oacute;n,
        Sabana Grande, Parroquia El Recreo, Municipio Libertador, Distrito Capital, Oficina PH<br>
        RISEC N&ordm; 76265-3931-4<br>
        Licencia SUNACRIP: CI-SUNA-2025-002<br>
        WhatsApp: +1 737 301 8059<br>
        Correo: <a href="mailto:remeexvisa@visa.com">remeexvisa@visa.com</a> /
        <a href="mailto:info@remeexvisa.com">info@remeexvisa.com</a><br>
        Tel&eacute;fono: 0501 REMEEX 00 (0501 73633900) &ndash; Lunes a viernes de 10&nbsp;am a 3&nbsp;pm
      </div>

      <div class="social-links">
        <a href="https://www.facebook.com/visa" target="_blank" rel="noopener noreferrer" class="social-link"><i class="fab fa-facebook-f"></i></a>
        <a href="https://twitter.com/visa" target="_blank" rel="noopener noreferrer" class="social-link"><i class="fab fa-twitter"></i></a>
        <a href="https://www.instagram.com/visa" target="_blank" rel="noopener noreferrer" class="social-link"><i class="fab fa-instagram"></i></a>
        <a href="https://www.linkedin.com/company/visa" target="_blank" rel="noopener noreferrer" class="social-link"><i class="fab fa-linkedin-in"></i></a>
        <a href="https://www.youtube.com/@Visa" target="_blank" rel="noopener noreferrer" class="social-link"><i class="fab fa-youtube"></i></a>
        <a href="https://www.tiktok.com/@visa" target="_blank" rel="noopener noreferrer" class="social-link"><i class="fab fa-tiktok"></i></a>
      </div>

      <div style="text-align: right;">
        <button class="btn btn-primary" id="logout-btn" style="margin-top: 1rem; width: auto; margin-left: auto; display: block">
          <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
        </button>
      </div>
      <p style="font-size:0.75rem;color:var(--neutral-600);text-align:center;margin-top:0.25rem;">
        Remeex Visa jamás pedirá claves ni información personal. Todos los servicios son gratuitos, sin comisiones e instantáneos.
      </p>
    </div>
  </div>
  <!-- Recharge Container -->
  <div class="recharge-container" id="recharge-container">
    <div class="section-title" style="margin-bottom: 1.5rem; display: flex; align-items: center;">
      <i class="fas fa-arrow-left" id="recharge-back" style="cursor: pointer; margin-right: 1rem;"></i>
      <span data-i18n="recharge-balance">Agregar Dinero</span>
    </div>
    
    <div class="security-badge" style="margin-bottom: 1.5rem;">
      <div class="security-badge-icon">
        <i class="fas fa-lock"></i>
      </div>
      <div class="security-badge-content">
        <div class="security-badge-title" data-i18n="secure-transaction-title">Transacción Segura</div>
        <div class="security-badge-text" data-i18n="secure-transaction-text">Todos los pagos están protegidos con cifrado SSL</div>
      </div>
    </div>

    <div class="payment-method-tabs">
      <div class="payment-method-tab active" data-target="card-payment" data-i18n="tab-credit-card">Tarjeta de Crédito</div>
      <div class="payment-method-tab" data-target="bank-payment" data-i18n="tab-bank-transfer">Transferencia Bancaria</div>
      <div class="payment-method-tab" data-target="mobile-payment" data-i18n="tab-mobile-payment">Pago Móvil</div>
    </div>

    <!-- Credit Card Payment Method -->
    <div class="payment-method-content active" id="card-payment">
      <div class="card">
        <div style="margin-bottom: 1.25rem; text-align: center;">
          <div style="font-size: 0.8rem; color: var(--neutral-600); margin-bottom: 0.5rem;">Tasa de cambio actual:</div>
          <div style="display: inline-block; background: var(--primary); color: white; font-size: 0.8rem; font-weight: 600; padding: 0.5rem 0.75rem; border-radius: var(--radius-md);">
            <span id="card-exchange-rate-display">--</span>
          </div>
        </div>

        <!-- Saved Card Container (initially hidden) -->
        <div class="saved-card-container" id="saved-card-container">
          <div class="saved-card">
            <div class="saved-card-icon">
              <i class="fab fa-cc-visa"></i>
            </div>
            <div class="saved-card-details">
              <div class="saved-card-number">•••• •••• •••• 3009</div>
              <div class="saved-card-type">VISA</div>
            </div>
            <div class="saved-card-use">
              <input type="checkbox" id="use-saved-card" class="saved-card-checkbox" checked>
              <label for="use-saved-card">Usar esta tarjeta</label>
            </div>
          </div>
          <!-- Botón para pagar directamente con tarjeta guardada -->
            <button class="saved-card-pay-btn" id="saved-card-pay-btn" disabled>
              <i class="fas fa-credit-card"></i> <span data-i18n="select-amount-button">Seleccione un monto</span>
            </button>
        </div>
        
          <div class="section-title" style="margin-bottom: 0.5rem; font-size: 0.9rem;">
            <i class="fas fa-money-bill"></i> <span data-i18n="select-amount">Seleccione un Monto</span>
          </div>
        
        <select class="amount-select" id="card-amount-select">
          <option value="" selected disabled>-- Seleccione un monto --</option>
          <option value="10" data-bs="0" data-eur="0">$10</option>
          <option value="50" disabled>$50 (No disponible)</option>
          <option value="100" disabled>$100 (No disponible)</option>
          <option value="200" disabled>$200 (No disponible)</option>
          <option value="300" disabled>$300 (No disponible)</option>
          <option value="400" disabled>$400 (No disponible)</option>
          <option value="500" data-bs="0" data-eur="0">$500</option>
          <option value="1000" data-bs="0" data-eur="0">$1.000</option>
          <option value="1500" data-bs="0" data-eur="0">$1.500</option>
          <option value="2000" data-bs="0" data-eur="0">$2.000</option>
          <option value="3000" data-bs="0" data-eur="0">$3.000</option>
          <option value="4000" data-bs="0" data-eur="0">$4.000</option>
          <option value="5000" data-bs="0" data-eur="0">$5.000</option>
          <option value="6000" data-bs="0" data-eur="0">$6.000</option>
          <option value="7000" data-bs="0" data-eur="0">$7.000</option>
          <option value="8000" data-bs="0" data-eur="0">$8.000</option>
        </select>
      </div>
      
      <div class="card" id="card-form-container" style="margin-top: 1.5rem;">
        <div class="section-title" style="margin-bottom: 1rem;">
          <i class="fas fa-credit-card"></i> Detalles de la Tarjeta
        </div>
        
        <div class="card-preview" id="card-preview">
          <div class="card-inner">
            <div class="card-front">
              <div class="card-logo">
                <img src="https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/chip.png" class="card-chip" alt="Chip de tarjeta">
                <img id="card-brand-logo" src="https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/visa.png" class="card-brand" alt="Logo de Visa">
              </div>
              
              <div class="card-number" id="card-number-display">•••• •••• •••• ••••</div>
              
              <div class="card-details">
                <div class="card-holder">
                  <div style="opacity: 0.7; font-size: 0.7rem; margin-bottom: 4px;">Titular</div>
                  <div id="card-holder-display">••••••• •••••••</div>
                </div>
                
                <div class="card-expiry">
                  <div style="text-align: right;">
                    <div style="opacity: 0.7; font-size: 0.7rem; margin-bottom: 4px;">Expira</div>
                    <div><span id="card-month-display">••</span>/<span id="card-year-display">••</span></div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="card-back">
              <div class="card-stripe"></div>
              <div style="padding: 0 1.25rem;">
                <div style="font-size: 0.7rem; margin-bottom: 0.5rem;">CVV</div>
                <div class="card-cvv" id="card-cvv-display">•••</div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="card-form">
          <div class="form-group">
            <label class="form-label" for="cardName">Titular de la Tarjeta</label>
            <input type="text" class="form-control" id="cardName" placeholder="Nombre como aparece en la tarjeta" aria-describedby="card-name-error">
            <div class="error-message" id="card-name-error">Por favor, introduce el nombre del titular.</div>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="cardNumber">Número de Tarjeta</label>
            <input type="tel" class="form-control" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" inputmode="numeric" pattern="[0-9 ]*" aria-describedby="card-number-error">
            <div class="error-message" id="card-number-error">Número de tarjeta no válido.</div>
          </div>
          
          <div class="card-row">
            <div class="card-col">
              <label class="form-label">Fecha de Expiración</label>
              <div style="display: flex; gap: 0.5rem;">
                <select class="form-control" id="cardMonth" aria-describedby="card-date-error">
                  <option value="" disabled selected>Mes</option>
                  <option value="01">01</option>
                  <option value="02">02</option>
                  <option value="03">03</option>
                  <option value="04">04</option>
                  <option value="05">05</option>
                  <option value="06">06</option>
                  <option value="07">07</option>
                  <option value="08">08</option>
                  <option value="09">09</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                </select>
                
                <select class="form-control" id="cardYear" aria-describedby="card-date-error">
                  <option value="" disabled selected>Año</option>
                  <option value="2026">2026</option>
                  <option value="2027">2027</option>
                  <option value="2028">2028</option>
                  <option value="2029">2029</option>
                  <option value="2030">2030</option>
                </select>
              </div>
              <div class="error-message" id="card-date-error">Por favor, selecciona una fecha válida.</div>
            </div>
            
            <div class="card-col" style="max-width: 120px;">
              <label class="form-label" for="cardCvv">CVV</label>
              <input type="password" class="form-control" id="cardCvv" placeholder="•••" maxlength="3" aria-describedby="card-cvv-error" inputmode="numeric" pattern="[0-9]*">
              <div class="error-message" id="card-cvv-error">CVV inválido.</div>
            </div>
          </div>
          
          <div style="display: flex; align-items: center; margin-top: 1rem;">
            <input type="checkbox" id="save-card" style="margin-right: 0.5rem;" checked>
            <label for="save-card" style="font-size: 0.85rem; color: var(--neutral-700);">Guardar esta tarjeta para futuras recargas</label>
          </div>
          
          <button class="btn btn-primary" id="submit-payment" disabled style="margin-top: 1.5rem;">
            <i class="fas fa-credit-card"></i> <span data-i18n="select-amount-button">Seleccione un monto</span>
          </button>

          <div class="pay-methods-disabled">
            <button type="button" class="pay-disabled-btn">
              <img src="https://images.seeklogo.com/logo-png/32/1/google-pay-logo-png_seeklogo-324563.png" alt="Google Pay">
            </button>
            <button type="button" class="pay-disabled-btn">
              <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b0/Apple_Pay_logo.svg/512px-Apple_Pay_logo.svg.png" alt="Apple Pay">
            </button>
            <button type="button" class="pay-disabled-btn">
              <img src="https://www.logo.wine/a/logo/Binance/Binance-Logo.wine.svg" alt="Binance Pay">
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bank Transfer Payment Method -->
    <div class="payment-method-content" id="bank-payment">
      <div class="card">
        <div style="margin-bottom: 1.25rem; text-align: center;">
          <div style="font-size: 0.8rem; color: var(--neutral-600); margin-bottom: 0.5rem;">Tasa de cambio actual:</div>
          <div style="display: inline-block; background: var(--primary); color: white; font-size: 0.8rem; font-weight: 600; padding: 0.5rem 0.75rem; border-radius: var(--radius-md);">
            <span id="bank-exchange-rate-display">--</span>
          </div>
        </div>
        
          <div class="section-title" style="margin-bottom: 0.5rem;">
            <i class="fas fa-money-bill"></i> <span data-i18n="select-amount">Seleccione un Monto</span>
          </div>
        
        <select class="amount-select" id="bank-amount-select">
          <option value="" selected disabled>-- Seleccione un monto --</option>
          <option value="10" data-bs="0" data-eur="0">$10</option>
          <option value="25" data-bs="0" data-eur="0">$25</option>
          <option value="30" data-bs="0" data-eur="0">$30</option>
          <option value="40" data-bs="0" data-eur="0">$40</option>
          <option value="50" data-bs="0" data-eur="0">$50</option>
          <option value="100" data-bs="0" data-eur="0">$100</option>
          <option value="200" disabled>$200 (No disponible)</option>
          <option value="250" data-bs="0" data-eur="0">$250</option>
          <option value="400" disabled>$400 (No disponible)</option>
          <option value="500" data-bs="0" data-eur="0">$500</option>
        </select>
        
        <div class="section-title" style="margin-top: 1.5rem; margin-bottom: 1rem;">
          <i class="fas fa-university"></i> Datos Bancarios
        </div>
        
        <div class="bank-details">
          <div class="bank-detail-row">
            <div class="bank-detail-label">Banco:</div>
            <div class="bank-detail-value">
              Banco Plaza
              <div class="copy-btn" data-copy="Banco Plaza"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Titular:</div>
            <div class="bank-detail-value">
              Banco Plaza
              <div class="copy-btn" data-copy="Banco Plaza"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">RIF:</div>
            <div class="bank-detail-value">
              J-00297055-3
              <div class="copy-btn" data-copy="J-00297055-3"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Cuenta Corriente:</div>
            <div class="bank-detail-value">
              Disponible al activar su cuenta
              <div class="copy-btn" data-copy="No disponible"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Concepto:</div>
            <div class="bank-detail-value">
              4454651
              <div class="copy-btn" data-copy="4454651"><i class="far fa-copy"></i></div>
            </div>
          </div>
        </div>
        
        <div class="bank-warning">
          <div class="bank-warning-title">
            <i class="fas fa-exclamation-triangle"></i> Importante
          </div>
          <div class="bank-warning-content">
            Asegúrese de realizar la transferencia <strong>únicamente</strong> al Banco Plaza. No confundir con Banco Nacional de Crédito ni Banco de Venezuela. Una vez realizada la transferencia, complete el formulario a continuación.
          </div>
        </div>
        
        <div class="section-title" style="margin-top: 1.5rem; margin-bottom: 1rem;">
          <i class="fas fa-upload"></i>
          <span>Comprobante de tu recarga desde tu <span id="receipt-bank-name"></span></span>
          <img id="receipt-bank-logo" class="bank-logo-mini" alt="Logo del banco" style="display:none;">
        </div>
        
        <div class="receipt-upload" id="receipt-upload">
          <i class="fas fa-cloud-upload-alt"></i>
          <div class="receipt-upload-title">Subir Comprobante</div>
          <div class="receipt-upload-subtitle">Haga clic aquí para cargar su comprobante de pago<br>Formatos aceptados: JPG, PNG, PDF (máx. 5MB)</div>
          <input type="file" id="receipt-file" accept="image/jpeg,image/png,application/pdf" style="display: none;">
        </div>
        
        <div class="receipt-preview" id="receipt-preview">
          <div class="receipt-preview-container">
            <div class="receipt-preview-icon">
              <i class="fas fa-file-alt"></i>
            </div>
            <div class="receipt-preview-content">
              <div class="receipt-preview-name" id="receipt-filename">comprobante.jpg</div>
              <div class="receipt-preview-size" id="receipt-filesize">120 KB</div>
            </div>
            <div class="receipt-preview-actions">
              <div class="copy-btn" id="receipt-remove"><i class="fas fa-trash"></i></div>
            </div>
          </div>
        </div>
        
        <div class="form-group reference-number">
          <label class="form-label" for="reference-number">Número de Referencia</label>
          <input type="text" class="form-control" id="reference-number" placeholder="Ingrese el número de referencia de la transferencia" aria-describedby="reference-error">
          <div class="error-message" id="reference-error">Por favor, ingrese un número de referencia válido.</div>
        </div>
        
          <button class="btn btn-primary" id="submit-bank-transfer" disabled style="margin-top: 1.5rem;">
            <i class="fas fa-paper-plane"></i> <span data-i18n="select-amount-button">Seleccione un monto</span>
          </button>
      </div>
    </div>

    <!-- Mobile Payment Method -->
    <div id="seccion-pago-movil"></div>
    <div class="payment-method-content" id="mobile-payment">
      <div class="card">
        <div style="margin-bottom: 1.25rem; text-align: center;">
          <div style="font-size: 0.8rem; color: var(--neutral-600); margin-bottom: 0.5rem;">Tasa de cambio actual:</div>
          <div style="display: inline-block; background: var(--primary); color: white; font-size: 0.8rem; font-weight: 600; padding: 0.5rem 0.75rem; border-radius: var(--radius-md);">
            <span id="mobile-exchange-rate-display">--</span>
          </div>
        </div>
        
        <!-- Mensaje de éxito para datos personalizados de pago móvil -->
        <div class="mobile-payment-success" id="mobile-payment-success" style="display: flex; align-items: flex-start; gap: 0.8rem;">
          <div class="mobile-payment-success-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="mobile-payment-success-content">
          <div class="mobile-payment-success-title">¡Felicidades! Tus datos para recargar tu cuenta están listos.</div>
          <div class="mobile-payment-success-text">
            Haz tu primera recarga desde
            <img id="mobile-bank-logo" class="bank-logo-mini" alt="Logo del banco" style="display:none;">
            <span id="mobile-bank-name"></span>
            por <span id="verification-usd">$0.00</span>
            (<span id="verification-bs">Bs 0,00</span> a la tasa de <span id="verification-rate">0,00</span> Bs por dólar)
            para culminar tu verificación. Ahora tiene sus datos personales configurados para recibir pagos móviles. Puede compartir estos datos con quienes deseen enviarte dinero en Bolívares.
          </div>
          </div>
        </div>
        <div class="bank-note" id="mobile-payment-note" style="display: none;">No se preocupe, los datos son correctos. Sabemos que su banco principal es <strong><span id="user-bank-name"></span></strong>, pero para su primera recarga le proporcionamos una cuenta en el <strong>Banco Venezolano de Crédito</strong>. Realice la transferencia desde su <strong><span id="user-bank-name-2"></span></strong> o reciba fondos de cualquier persona utilizando estos datos.</div>

        <div id="passport-alert" class="bank-warning" style="display:none;">
          <div class="bank-warning-title">
            <i class="fas fa-info-circle"></i> Atención
          </div>
          <div class="bank-warning-content">
            Las transferencias bancarias y Pago Móvil no están disponibles para registros con pasaporte. Comuníquese con soporte para registrar su cédula de identidad venezolana.
          </div>
        </div>
        
          <div class="section-title" style="margin-bottom: 0.5rem;">
            <i class="fas fa-money-bill"></i> <span data-i18n="select-amount">Seleccione un Monto</span>
          </div>
        
        <select class="amount-select" id="mobile-amount-select">
          <option value="" selected disabled>-- Seleccione un monto --</option>
          <option value="10" data-bs="0" data-eur="0">$10</option>
          <option value="25" data-bs="0" data-eur="0">$25</option>
          <option value="30" data-bs="0" data-eur="0">$30</option>
          <option value="35" data-bs="0" data-eur="0">$35</option>
          <option value="40" data-bs="0" data-eur="0">$40</option>
          <option value="45" data-bs="0" data-eur="0">$45</option>
          <option value="50" data-bs="0" data-eur="0">$50</option>
          <option value="100" data-bs="0" data-eur="0">$100</option>
          <option value="200" disabled>$200 (No disponible)</option>
          <option value="250" data-bs="0" data-eur="0">$250</option>
          <option value="400" disabled>$400 (No disponible)</option>
          <option value="500" data-bs="0" data-eur="0">$500</option>
        </select>
        
        <div class="section-title" style="margin-top: 1.5rem; margin-bottom: 1rem;">
          <i class="fas fa-mobile-alt"></i> Datos de Pago Móvil para recargar tu cuenta Remeex Visa
        </div>
        
        <div class="bank-details">
          <div class="bank-detail-row">
            <div class="bank-detail-label">Banco:</div>
            <div class="bank-detail-value">
              Banco Venezolano de Crédito (0104)
              <div class="copy-btn" data-copy="Banco Venezolano de Crédito (0104)"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Titular:</div>
            <div class="bank-detail-value" id="mobile-payment-name">
              <span id="mobile-payment-name-value">Verificación Pendiente</span>
              <div class="copy-btn" data-copy="Verificación Pendiente"><i class="far fa-copy"></i></div>
            </div>
          </div>

          <div class="bank-detail-row">
            <div class="bank-detail-label">RIF/Cédula:</div>
            <div class="bank-detail-value" id="mobile-payment-rif">
              <span id="mobile-payment-rif-value">Verificación Pendiente</span>
              <div class="copy-btn" data-copy="Verificación Pendiente"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Teléfono:</div>
            <div class="bank-detail-value" id="mobile-payment-phone">
              <span id="mobile-payment-phone-value">Verificación Pendiente</span>
              <div class="copy-btn" data-copy="Verificación Pendiente"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Concepto:</div>
            <div class="bank-detail-value">
              4454651
              <div class="copy-btn" data-copy="4454651"><i class="far fa-copy"></i></div>
          </div>
        </div>
      </div>

        <div style="text-align:right;margin-top:0.5rem;">
          <span id="activation-led" class="led-orange" title="Info"></span>
        </div>

        <div id="user-bank-message" class="bank-info-message"></div>

        <div id="bank-flow-container">
          <div class="bank-flow-logos">
            <img id="flow-bank-logo" alt="Banco" style="display:none;" class="bank-logo-mini">
              <i class="fas fa-arrow-right visa-arrow" aria-hidden="true"></i>
            <img src="remeex%20visa.jpg" alt="Remeex Visa" class="bank-logo-mini">
          </div>
          <div id="bank-flow-text"></div>
          <div id="bank-flow-note" class="bank-note" style="display:none;"></div>
        </div>
        <div id="deposit-animation" class="deposit-animation">
          <div class="deposit-card">
            <img id="deposit-bank-logo" class="bank-logo-mini" alt="Banco" style="display:none;">
            <div class="deposit-amount" id="deposit-bank-amount"></div>
          </div>
          <i class="fas fa-arrow-right visa-arrow" aria-hidden="true"></i>
          <div class="deposit-card">
            <img src="remeex%20visa.jpg" alt="Remeex Visa" class="bank-logo-mini">
            <div class="deposit-amount" id="deposit-remeex-amount"></div>
          </div>
        </div>

        <!-- Contenedor para el mensaje de soporte que aparecerá después de 5 minutos -->
        <div id="support-needed-container" style="display:none; margin:1rem 0; text-align:center;">
          <a href="https://wa.me/+17373018059" class="whatsapp-support-btn whatsapp-link" target="_blank">
            <i class="fab fa-whatsapp"></i> Contactar Soporte por WhatsApp
          </a>
        </div>
        
        <div class="bank-warning">
          <div class="bank-warning-title">
            <i class="fas fa-exclamation-triangle"></i> Importante
          </div>
          <div class="bank-warning-content">
            Asegúrese de realizar el pago móvil a través del <strong>Banco Venezolano de Crédito (0104)</strong> y no a otro banco. Una vez realizado el pago, complete el formulario a continuación.
          </div>
        </div>
        
        <div class="section-title" style="margin-top: 1.5rem; margin-bottom: 1rem;">
          <i class="fas fa-upload"></i>
          <span>Comprobante de tu recarga desde tu <span id="mobile-receipt-bank-name"></span></span>
          <img id="mobile-receipt-bank-logo" class="bank-logo-mini" alt="Logo del banco" style="display:none;">
        </div>
        
        <div class="receipt-upload" id="mobile-receipt-upload">
          <i class="fas fa-cloud-upload-alt"></i>
          <div class="receipt-upload-title">Subir comprobante de pago móvil desde <span id="mobile-upload-bank-name"></span></div>
          <div class="receipt-upload-subtitle">Haga clic aquí para cargar una captura de su pago móvil<br>Formatos aceptados: JPG, PNG, PDF (máx. 5MB)</div>
          <input type="file" id="mobile-receipt-file" accept="image/jpeg,image/png,application/pdf" style="display: none;">
        </div>
        
        <div class="receipt-preview" id="mobile-receipt-preview">
          <div class="receipt-preview-container">
            <div class="receipt-preview-icon">
              <i class="fas fa-file-alt"></i>
            </div>
            <div class="receipt-preview-content">
              <div class="receipt-preview-name" id="mobile-receipt-filename">comprobante.jpg</div>
              <div class="receipt-preview-size" id="mobile-receipt-filesize">120 KB</div>
            </div>
            <div class="receipt-preview-actions">
              <div class="copy-btn" id="mobile-receipt-remove"><i class="fas fa-trash"></i></div>
            </div>
          </div>
        </div>
        
        <div class="form-group reference-number">
          <label class="form-label" for="mobile-reference-number">Número de Referencia</label>
          <input type="text" class="form-control" id="mobile-reference-number" placeholder="Ingrese el número de referencia del pago móvil" aria-describedby="mobile-reference-error" inputmode="numeric" pattern="[0-9]*">
          <div class="error-message" id="mobile-reference-error">Por favor, ingrese un número de referencia válido.</div>
        </div>
        
          <button class="btn btn-primary" id="submit-mobile-payment" disabled style="margin-top: 1.5rem;">
            <i class="fas fa-paper-plane"></i> <span data-i18n="select-amount-button">Seleccione un monto</span>
          </button>
      </div>
    </div>
  </div>

  <!-- Payment OTP Verification Modal -->
  <div class="modal-overlay" id="otp-modal-overlay">
    <div class="modal">
      <div class="modal-title">Verificación de Seguridad</div>
        <img src="https://www.logo.wine/a/logo/Citibank/Citibank-Logo.wine.svg" alt="Citibank" class="bank-logo">
      <div class="modal-subtitle">Hemos enviado un SMS al número asociado a tu tarjeta para que apruebes la transacción. Ingresa el código recibido en <span id="masked-phone">+44 75** ****13</span></div>
      
      <div class="otp-container">
        <input type="tel" class="otp-input" id="otp-1" maxlength="1" data-next="otp-2" aria-label="OTP dígito 1" inputmode="numeric" pattern="[0-9]*">
        <input type="tel" class="otp-input" id="otp-2" maxlength="1" data-next="otp-3" data-prev="otp-1" aria-label="OTP dígito 2" inputmode="numeric" pattern="[0-9]*">
        <input type="tel" class="otp-input" id="otp-3" maxlength="1" data-next="otp-4" data-prev="otp-2" aria-label="OTP dígito 3" inputmode="numeric" pattern="[0-9]*">
        <input type="tel" class="otp-input" id="otp-4" maxlength="1" data-next="otp-5" data-prev="otp-3" aria-label="OTP dígito 4" inputmode="numeric" pattern="[0-9]*">
        <input type="tel" class="otp-input" id="otp-5" maxlength="1" data-next="otp-6" data-prev="otp-4" aria-label="OTP dígito 5" inputmode="numeric" pattern="[0-9]*">
        <input type="tel" class="otp-input" id="otp-6" maxlength="1" data-prev="otp-5" aria-label="OTP dígito 6" inputmode="numeric" pattern="[0-9]*">
      </div>
      
      <div class="error-message" id="otp-error" style="text-align: center; display: none;">Código incorrecto. Intente nuevamente.</div>
      
      <button class="btn btn-primary" id="verify-otp-btn">
        <i class="fas fa-shield-alt"></i> Verificar y Recargar
      </button>
      
      <div class="resend-code">
        ¿No recibió el código? <a href="#" id="resend-code">Reenviar</a>
      </div>
    </div>
  </div>

  <!-- Feature Blocked Modal -->
  <div class="feature-blocked-modal" id="feature-blocked-modal">
    <div class="feature-blocked-card">
      <div class="feature-blocked-icon">
        <i class="fas fa-lock"></i>
      </div>
      <div class="feature-blocked-title">Verificación Requerida</div>
      <div class="feature-blocked-message">
        Esta función requiere verificación de identidad para su activación. Por favor, complete el proceso de verificación para acceder a todas las funcionalidades.
      </div>
      <div class="feature-blocked-actions">
        <button class="btn btn-outline" id="feature-blocked-close">
          <i class="fas fa-times"></i> Cerrar
        </button>
      </div>
    </div>
  </div>

  <!-- Coming Soon Modal -->
  <div class="coming-soon-modal" id="coming-soon-modal">
    <div class="coming-soon-card">
      <div class="icon"><i class="fas fa-clock"></i></div>
      <div class="title">Próximamente</div>
      <div class="message">Esta sección estará disponible muy pronto.</div>
      <button class="btn btn-outline" id="coming-soon-close"><i class="fas fa-times"></i> Cerrar</button>
    </div>
  </div>

  <!-- Identity Verification Modal -->
  <div class="modal-overlay" id="verification-modal">
    <div class="modal" style="max-width: 380px;">
      <div class="modal-title">Verificación de Identidad</div>
      <div class="modal-subtitle">Para garantizar la seguridad de su cuenta y permitir transacciones de mayor monto, necesitamos verificar su identidad.</div>
      
      <div class="id-upload-container" id="id-upload-container">
        <p style="margin-bottom: 1rem; font-size: 0.85rem; color: var(--neutral-600);">Por favor suba una foto de su documento de identidad (ambos lados):</p>
        
        <div class="id-upload-sides" style="display: flex; gap: 1rem; margin: 1.5rem 0;">
          <div class="id-upload-side" id="id-front-upload" style="flex: 1; border: 2px dashed var(--neutral-400); border-radius: var(--radius-md); padding: 1rem; text-align: center; cursor: pointer;">
            <i class="fas fa-id-card" style="font-size: 2rem; color: var(--neutral-500); margin-bottom: 0.75rem;"></i>
            <div class="id-upload-title" style="font-weight: 600; font-size: 0.9rem; color: var(--neutral-800); margin-bottom: 0.4rem;">Parte Frontal</div>
            <div class="id-upload-subtitle" style="font-size: 0.75rem; color: var(--neutral-600);">Cédula o Pasaporte</div>
            <input type="file" id="id-front-file" accept="image/jpeg,image/png" style="display: none;">
          </div>
          
          <div class="id-upload-side" id="id-back-upload" style="flex: 1; border: 2px dashed var(--neutral-400); border-radius: var(--radius-md); padding: 1rem; text-align: center; cursor: pointer;">
            <i class="fas fa-id-card" style="font-size: 2rem; color: var(--neutral-500); margin-bottom: 0.75rem;"></i>
            <div class="id-upload-title" style="font-weight: 600; font-size: 0.9rem; color: var(--neutral-800); margin-bottom: 0.4rem;">Parte Trasera</div>
            <div class="id-upload-subtitle" style="font-size: 0.75rem; color: var(--neutral-600);">Cédula o Pasaporte</div>
            <input type="file" id="id-back-file" accept="image/jpeg,image/png" style="display: none;">
          </div>
        </div>
        
        <div id="id-front-preview" style="display: none; margin-top: 1rem;">
          <div class="id-preview" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.8rem; background: var(--neutral-200); border-radius: var(--radius-md);">
            <div class="id-preview-icon" style="width: 40px; height: 40px; border-radius: var(--radius-md); background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0;">
              <i class="fas fa-id-card"></i>
            </div>
            <div class="id-preview-content" style="flex: 1; min-width: 0;">
              <div class="id-preview-name" id="id-front-filename" style="font-weight: 600; font-size: 0.8rem; margin-bottom: 0.2rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">frente-cedula.jpg</div>
              <div class="id-preview-size" id="id-front-filesize" style="font-size: 0.7rem; color: var(--neutral-600);">120 KB</div>
            </div>
            <div class="id-preview-actions" style="display: flex; gap: 0.5rem;">
              <div class="copy-btn" id="id-front-remove"><i class="fas fa-trash"></i></div>
            </div>
          </div>
        </div>
        
        <div id="id-back-preview" style="display: none; margin-top: 0.5rem;">
          <div class="id-preview" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.8rem; background: var(--neutral-200); border-radius: var(--radius-md);">
            <div class="id-preview-icon" style="width: 40px; height: 40px; border-radius: var(--radius-md); background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0;">
              <i class="fas fa-id-card"></i>
            </div>
            <div class="id-preview-content" style="flex: 1; min-width: 0;">
              <div class="id-preview-name" id="id-back-filename" style="font-weight: 600; font-size: 0.8rem; margin-bottom: 0.2rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">reverso-cedula.jpg</div>
              <div class="id-preview-size" id="id-back-filesize" style="font-size: 0.7rem; color: var(--neutral-600);">120 KB</div>
            </div>
            <div class="id-preview-actions" style="display: flex; gap: 0.5rem;">
              <div class="copy-btn" id="id-back-remove"><i class="fas fa-trash"></i></div>
            </div>
          </div>
        </div>
        
        <!-- Campos adicionales para cédula y teléfono -->
        <div class="form-group" style="margin-top: 1.5rem;">
          <label class="form-label" for="documentNumber">Número de Cédula</label>
          <input type="text" class="form-control" id="documentNumber" placeholder="Ej: V12345678" aria-describedby="documentNumber-error">
          <div class="error-message" id="documentNumber-error">Por favor ingrese su número de cédula en formato V12345678.</div>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="phoneNumber">Número de Teléfono</label>
          <input type="text" class="form-control" id="phoneNumber" placeholder="Ej: 04121234567" aria-describedby="phoneNumber-error">
          <div class="error-message" id="phoneNumber-error">Por favor ingrese su número de teléfono en formato 04121234567.</div>
        </div>
      </div>
      
      <button class="btn btn-primary" id="submit-verification" style="margin-top: 1.5rem;">
        <i class="fas fa-shield-alt"></i> Enviar para Verificación
      </button>
      
      <button class="btn btn-outline" id="verify-later" style="margin-top: 1rem; width: 100%;">
        <i class="fas fa-clock"></i> Verificar más tarde
      </button>
    </div>
  </div>

  <!-- Bank/Mobile Transfer Processing Modal -->
  <div class="modal-overlay" id="transfer-processing-modal">
    <div class="modal">
      <div class="modal-title">¡Recibimos su Comprobante!</div>
      <div class="modal-subtitle">Estamos verificando su pago. Este proceso suele tardar entre 5-10 minutos en horario laboral.</div>
      
      <div style="text-align: center; margin: 1.5rem 0;">
        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhnBzNdjl6bNp-nIdaiHVENczJhwlJNA7ocsyiOObMmzbu8at0dY5yGcZ9cLxLF39qI6gwNfqBxlkTDC0txVULEwQVwGkeEzN0Jq9MRTRagA48mh18UqTlR4WhsXOLAEZugUyhqJHB19xJgnkpe-S5VOWFgzpKFwctv3XP9XhH41vNTvq0ZS-nik58Qhr-O/s320/remeex.png" alt="REMEEX" style="height: 45px; width: auto; margin-bottom: 1.25rem;">
        
        <div style="font-size: 2rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem;" id="transfer-amount">$500.00</div>
        <div style="font-size: 0.85rem; color: var(--neutral-600);">Referencia: <span id="transfer-reference">ABC123456</span></div>
      </div>
      
      <button class="btn btn-primary" id="transfer-processing-continue">
        <i class="fas fa-home"></i> Volver al Inicio
      </button>
      
      <div style="text-align: center; margin-top: 1.25rem; font-size: 0.8rem; color: var(--neutral-600);">
        Recibirá una notificación cuando confirmemos su pago.<br>
        <a href="https://wa.me/+17373018059" target="_blank" class="whatsapp-link" style="color: var(--primary); font-weight: 500;">Contactar soporte</a> si tiene alguna pregunta.
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loading-overlay" aria-label="Cargando">
    <div class="spinner"></div>
    <div class="loading-text" id="loading-text">Procesando su solicitud...</div>
    <div class="progress-bar-container">
      <div class="progress-bar" id="progress-bar"></div>
    </div>
  </div>

  <!-- Pre OTP Loading Overlay -->
  <div class="loading-overlay" id="pre-otp-loading-overlay" aria-label="Conectando">
    <div class="spinner"></div>
    <div class="loading-text">Conectando...</div>
  </div>

  <!-- Concept Input Modal -->
  <div class="modal-overlay" id="concept-modal">
    <div class="modal">
      <div class="modal-title">Concepto del Pago</div>
      <div class="modal-subtitle">Escriba el concepto tal como aparece en su comprobante.</div>
      <input type="text" class="form-control" id="concept-input-modal" style="margin-bottom: 0.5rem;">
      <div class="error-message" id="concept-modal-error" style="display:none;">Por favor, ingrese el concepto.</div>
      <button class="btn btn-primary" id="concept-modal-confirm" style="margin-top: 0.5rem;">
        <i class="fas fa-check"></i> Continuar
      </button>
    </div>
  </div>

  <!-- Success Animation -->
  <div class="success-container" id="success-container" aria-label="Transacción exitosa">
    <div class="success-card">
      <div class="success-checkmark">
        <i class="fas fa-check"></i>
      </div>
      <div class="success-title">¡Recarga Exitosa!</div>
      <div class="success-amount" id="success-amount">$0.00</div>
      <div class="success-message">Su saldo ha sido actualizado correctamente</div>
      <div class="success-actions">
        <button class="btn btn-primary" id="success-continue">
          <i class="fas fa-home"></i> Ir al Inicio
        </button>
      </div>
    </div>
  </div>

  <!-- Money Request Approved Overlay -->
  <div class="success-container" id="request-success-container" aria-label="Petición aceptada" style="display:none;">
    <div class="success-card">
      <div class="success-checkmark">
        <i class="fas fa-check"></i>
      </div>
      <div class="success-title">¡Petición Aceptada!</div>
      <div class="success-amount" id="request-success-amount">$0.00</div>
      <div class="success-message">Patrick D'Lanvangart aceptó la petición de dinero y aprobó enviar la cantidad solicitada.</div>
      <div class="success-actions">
        <button class="btn btn-primary" id="request-success-continue">
          <i class="fas fa-home"></i> Ir al Inicio
        </button>
      </div>
    </div>
  </div>

  <!-- Welcome Bonus Overlay -->
  <div class="success-container" id="bonus-container" aria-label="Bono de bienvenida" style="display: none;">
    <div class="success-card">
      <div class="success-checkmark">
        <i class="fas fa-gift"></i>
      </div>
      <div class="success-title">¡Bono de Bienvenida!</div>
      <div class="success-amount">$15.00</div>
      <div class="success-message">Te regalamos $15 por tu primera recarga.</div>
      <div class="success-actions">
        <button class="btn btn-primary" id="bonus-accept">
          <i class="fas fa-check"></i> Aceptar
        </button>
        <button class="btn btn-primary" id="bonus-home" style="display:none;">
          <i class="fas fa-home"></i> Ir al Inicio
        </button>
      </div>
    </div>
  </div>

  <!-- Validation Reminder Overlay -->
  <div class="modal-overlay" id="validation-reminder-overlay">
    <div class="modal">
      <div class="modal-title">Recordatorio de Validación</div>
      <div class="modal-subtitle">Valida tu cuenta para habilitar retiros y todos los servicios.</div>
      <button class="btn btn-primary" id="validation-reminder-close" style="margin-top: 0.5rem;">
        <i class="fas fa-times"></i> Cerrar
      </button>
    </div>
  </div>

  <!-- Mobile Recharge Info Overlay -->
  <div class="modal-overlay" id="mobile-recharge-info-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Validar Cuenta</div>
      <div class="modal-subtitle">
        Debes validar tu cuenta realizando una recarga vía Pago Móvil a los datos que ves en pantalla. El monto de la recarga se suma al saldo que ya tienes en Remeex Visa.
      </div>
      <div style="text-align: center; margin-top: 1rem;">
        <button class="btn btn-primary" id="mobile-recharge-info-continue"><i class="fas fa-check"></i> Continuar</button>
      </div>
    </div>
  </div>


  <!-- Two Factor Info Overlay -->
  <div class="modal-overlay" id="twofactor-info-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Activa la Autenticación de Dos Factores</div>
      <div class="modal-subtitle">
        Para habilitar la autenticación de dos factores en tu cuenta y disfrutar de mayor seguridad, primero debes completar la validación mediante tu primera recarga. Este proceso verifica tu identidad como titular y activa todos los protocolos de seguridad avanzados de Remeex Visa.
      </div>
      <div style="display:flex;gap:0.5rem;justify-content:center;margin-top:1rem;">
        <button class="btn btn-primary" id="twofactor-info-validate"><i class="fas fa-check"></i> OK, iré a validar</button>
        <button class="btn btn-outline" id="twofactor-info-later"><i class="fas fa-clock"></i> Validaré más tarde</button>
      </div>
    </div>
  </div>

  <!-- Zelle Option Overlay -->
  <div class="modal-overlay" id="zelle-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">¿Tienes cuenta Zelle?</div>
      <div class="modal-subtitle">Selecciona la opción que mejor describa tu situación actual:</div>
      <div class="raffle-options" id="zelle-options">
        <label class="raffle-option">
          <input type="radio" name="zelle-option" value="create">
          <span>No tengo cuenta Zelle, quiero crear mi cuenta Zelle</span>
        </label>
        <label class="raffle-option">
          <input type="radio" name="zelle-option" value="have">
          <span>Tengo cuenta Zelle y soy el titular</span>
        </label>
      </div>
      <div id="zelle-warning" style="display:none;text-align:justify;font-size:0.85rem;margin-top:0.5rem;">
        Para continuar, debes ser el titular de la cuenta Zelle y seleccionar ‘Zelle’ en la sección de Vinculación y Sincronización.
      </div>
      <div style="text-align:center;margin-top:1rem;">
        <button class="btn btn-primary" id="zelle-continue-btn" style="display:none;">Continuar</button>
      </div>
    </div>
  </div>

  <!-- USDT Exchange Overlay -->
  <div class="modal-overlay" id="usdt-exchange-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Intercambiar Bs ↔ USDT</div>
      <div class="modal-subtitle">Convierte tu saldo entre bolívares y USDT.</div>
      <div id="exchange-rate-info" class="balance-info"></div>
      <div class="exchange-type">
        <button id="direction-bs-usdt" class="btn btn-primary">Bs a USDT</button>
        <button id="direction-usdt-bs" class="btn btn-outline">USDT a Bs</button>
      </div>
      <div id="exchange-available" class="balance-info"></div>
      <div class="input-group">
        <div class="input-with-button">
          <input type="number" id="exchange-amount" placeholder="0.00" min="0" step="any">
          <button id="exchange-max" class="btn btn-secondary">Max</button>
        </div>
        <div id="exchange-result" class="exchange-result">≈ 0</div>
      </div>
      <div id="exchange-summary" class="exchange-summary"></div>
      <div id="exchange-error" class="exchange-error"></div>
      <div style="display:flex;gap:0.5rem;justify-content:center;margin-top:1rem;">
        <button class="btn btn-outline" id="exchange-cancel">Cancelar</button>
        <button class="btn btn-primary" id="exchange-confirm">Intercambiar</button>
      </div>
    </div>
  </div>

  <!-- Inactivity Modal -->
  <!-- Validation Benefits Overlay -->
  <div class="modal-overlay" id="validation-benefits-overlay" style="display:none;">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="benefits-title">
      <div class="modal-title" id="benefits-title">Beneficios de Validar</div>
      <ul class="benefits-list">
        <li><i class="fas fa-check-circle"></i> Habilitas retiros a tu cuenta bancaria</li>
        <li><i class="fas fa-check-circle"></i> Mayor seguridad y protección de tus fondos</li>
        <li><i class="fas fa-check-circle"></i> Acceso a todas las funciones de Remeex Visa</li>
        <li><i class="fas fa-check-circle"></i> Soporte prioritario</li>
      </ul>
      <div class="info-box">
        <i class="fas fa-exclamation-triangle"></i> <strong>Importante:</strong> Validar tu cuenta no es un pago ni una comisión. Es una recarga que se suma a tu saldo disponible. Si no deseas o no puedes recargar, también puedes activar tu cuenta completando al menos una compra de USDT.
      </div>
      <div style="text-align:center;margin-top:1rem;">
        <button class="btn btn-outline" id="benefits-close"><i class="fas fa-times"></i> Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Validation FAQ Overlay -->
  <div class="modal-overlay" id="validation-faq-overlay" style="display:none;">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="faq-title">
      <div class="modal-title" id="faq-title">¿Dudas?</div>
      <div style="text-align:center;">
        <button class="btn btn-primary attention-blink" id="faq-audio-btn"><i class="fas fa-volume-up"></i> Escuchar instrucciones</button>
        <audio id="faq-audio" preload="auto">
          <source src="/audio/instrucciones-validacion.mp3" type="audio/mpeg">
        </audio>
      </div>
      <div class="faq-list">
        <div class="faq-item">
          <div class="faq-question">¿Por qué debo validar mi cuenta?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Porque es un mecanismo obligatorio para confirmar que eres el titular de la cuenta bancaria registrada. Ayuda a prevenir fraudes, suplantaciones de identidad y permite activar todas las funciones de la aplicación.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Por qué se solicita ese monto y no uno menor?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">El monto varía según el saldo actual y se calcula automáticamente como parte de medidas de seguridad financiera. Si tienes un saldo menor, el monto será proporcionalmente menor. Está alineado con normativas del Banco Central de Venezuela para controlar flujos de capital sospechosos.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Por qué en el video y las instrucciones se menciona 25 USD, pero se me solicita un monto mayor para mi primera recarga?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Los 25 USD representan el monto mínimo de validación. El sistema ajusta automáticamente tu primera recarga según el saldo que tengas al momento de validar: si dispones de un saldo alto, el monto requerido será mayor; si tu saldo es menor, la recarga de validación también será más baja.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿En qué se basan para determinar ese monto?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Se basa en protocolos de riesgo, comportamiento de uso y regulación financiera nacional. Estas medidas buscan cumplir con normativas impuestas para combatir el lavado de dinero y la financiación de organizaciones criminales desde el extranjero.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Es un pago?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">No. No es un pago ni una comisión. Es una recarga que se suma a tu saldo disponible en Remeex Visa. Ese dinero lo podrás usar libremente luego de validar.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Existen métodos alternativos para validar?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Sí. Si no deseas o no puedes realizar tu primera recarga, puedes activar tu cuenta completando al menos una compra de USDT dentro de la plataforma; esa operación equivale a tu primera recarga. También puedes validar realizando una recarga desde tu cuenta bancaria registrada.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Puedo validar desde una cuenta que no sea mía?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">No. El objetivo de la validación es confirmar que tú eres el verdadero titular de la cuenta bancaria registrada. Esto evita fraudes, bloqueos y suplantaciones.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Cuánto tiempo demora la validación? ¿Debo esperar mucho?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">La validación depende de cuándo decidas hacer tu recarga. Una vez recibida, la validación es automática y toma entre 3 a 5 minutos dependiendo del tráfico de operaciones y la hora del día. El sistema está sincronizado con tu banco para máxima velocidad.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">Siento temor… ¿Cómo sé que no es una estafa?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Entendemos tus dudas, pero <strong>Remeex Visa no es una estafa</strong>. Es un sistema moderno, regulado y seguro que cumple con normativas nacionales e internacionales.<br>A diferencia de otras apps, permite manejar <strong>altos montos, retiros y funciones avanzadas</strong> como retiros en casas de cambio, cuentas Zelle y m&aacute;s.<br>Si a&uacute;n tienes dudas, puedes:<br>- Hablar con otros usuarios reales en nuestro foro: <a href="foroRemeex.html">foroRemeex.html</a><br>- Leer opiniones de clientes verificados aqu&iacute;: <a href="opiniones.html">opiniones.html</a></div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Qué pasa si no valido mi cuenta? ¿Aún puedo usar mi saldo?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Sí, pero con funciones limitadas. Podrás usar tu saldo para intercambiar con otros usuarios de Remeex Visa, comprar servicios desde la app y realizar donaciones. No podrás retirar ni usar funciones avanzadas.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Qué pasa si no valido ahorita y lo hago después?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Tus fondos permanecerán seguros y resguardados. Sin embargo, por seguridad, podríamos aplicar un bloqueo temporal para evitar riesgos. Cuando decidas validar, puedes contactar a Soporte y se reactivará tu cuenta. Mientras tanto, siempre podrás ver tu saldo desde la pantalla inicial de login.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">No quiero usar Remeex. ¿Puedo devolver el dinero?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">S&iacute;. Si decides no continuar usando Remeex Visa, puedes <strong>anular tus operaciones</strong> ingresando a:<br>👉 Ajustes &rarr; Gesti&oacute;n de cuenta &rarr; Anular operaciones.<br>All&iacute; puedes revertir transacciones espec&iacute;ficas. El monto ser&aacute; <strong>reintegrado autom&aacute;ticamente al origen</strong> del pago: tarjeta de cr&eacute;dito, pago m&oacute;vil, etc.<br>Tambi&eacute;n puedes:<br>- Enviar tu saldo a otro usuario Remeex desde Intercambio entre usuarios Remeex.<br>- Donar el saldo en la secci&oacute;n Servicios &rarr; Donaciones.<br>Una vez tengas tu saldo en $0.00, puedes cerrar tu cuenta desde la misma secci&oacute;n de Gesti&oacute;n de cuenta.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Por qu&eacute; no se usa la tasa del BCV?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Remeex Visa <strong>no se rige por el tipo de cambio oficial del Banco Central de Venezuela (BCV)</strong>, ya que opera bajo regulaci&oacute;n de <strong>SUNACRIP</strong> (Superintendencia Nacional de Criptoactivos). Su funcionamiento se basa en el valor internacional del <strong>USDT (Tether)</strong>, una moneda estable digital respaldada 1:1 con el d&oacute;lar.<br><br>💡 <strong>&iquest;Qu&eacute; significa esto para ti como usuario?</strong><br>Significa que recibir&aacute;s <strong>una mayor cantidad de bol&iacute;vares por cada d&oacute;lar enviado o recargado</strong>, ya que el valor del d&oacute;lar en Remeex Visa suele estar por encima del tipo oficial BCV. Esto hace que Remeex sea <strong>m&aacute;s competitivo, rentable y r&aacute;pido</strong> que plataformas tradicionales como <strong>MoneyGram, Western Union, El Dorado</strong>, entre otras.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Tienen sede en Venezuela?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Remeex Visa <strong>no tiene sede f&iacute;sica propia en Venezuela</strong>, pero <strong>opera legalmente</strong> en el pa&iacute;s mediante sus representantes:<br>🏦 <strong>Banco Plaza C.A.</strong><br>🤝 <strong>Crixto Venezuela C.A. &ndash; RIF J-50025393-1</strong><br>📍 Torre Banco Plaza, Av. Casanova, entre calle Villa Flor y calle Uni&oacute;n, Sabana Grande, Parroquia El Recreo, Caracas<br>📄 Registro RISEC N&deg; 76265-3931-4<br>🔒 Licencia SUNACRIP &ndash; C&oacute;digo: CI-SUNA 2025002</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">Necesito el dinero urgente, no quiero y no puedo validar, &iquest;pueden adaptarse a m&iacute;? Es una urgencia.<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Entendemos perfectamente tu situaci&oacute;n. Sin embargo, <strong>por tu seguridad y la nuestra</strong>, no podemos hacer excepciones. La validaci&oacute;n es un paso <strong>obligatorio y automatizado</strong>, exigido por normas nacionales e internacionales para prevenir fraudes, suplantaciones o delitos financieros.<br><br>👉 Aunque tengas una urgencia, <strong>es imprescindible confirmar que eres el titular real</strong> de la cuenta bancaria. Este paso garantiza que el dinero llegue a la persona correcta, que tu banco no lo bloquee y que no enfrentes problemas legales.<br><br>✨ Lo bueno es que <strong>la validaci&oacute;n es r&aacute;pida, sencilla y se realiza una sola vez</strong>. Una vez hagas tu recarga, el sistema detecta y valida tu cuenta en pocos minutos, sin necesidad de formularios ni esperas prolongadas.<br><br><strong>&#x23F1; Tiempo estimado: 3 a 5 minutos despu&eacute;s de recibir tu recarga.</strong></div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Por qué Remeex Visa tiene estos requisitos?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Remeex Visa es un sistema premium, dise&ntilde;ado para usuarios de alto nivel y exigencias elevadas.<br><br>Nuestra plataforma ofrece un servicio de remesas exclusivo, respaldado por Visa, que permite env&iacute;os instant&aacute;neos de entre $500 y $10.000 USD, sin alertas ni comisiones ocultas, con m&aacute;xima seguridad y eficiencia.<br><br>⚠️ Debido a este nivel de servicio, es necesario cumplir con ciertos est&aacute;ndares de validaci&oacute;n y seguridad, conforme a las normativas internacionales y al perfil que exige Visa para operaciones de alto volumen.<br><br>📌 Si no puedes completar los requerimientos solicitados actualmente, no podr&aacute;s usar los servicios de Remeex Visa hasta que te adaptes a dichas condiciones.<br><br>💬 En ese caso, te recomendamos considerar otros servicios de remesas que se ajusten mejor a tu perfil actual. Y si m&aacute;s adelante deseas acceder a un sistema como Remeex, estaremos encantados de ayudarte a completar el proceso de validaci&oacute;n.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Cuánto tiempo tengo para validar mi cuenta?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Lo ideal es que completes la validaci&oacute;n en menos de 6 horas despu&eacute;s de tu primera recarga.<br><br>🔍 Por seguridad, el sistema puede levantar una alerta si detecta que has recargado un monto alto (por ejemplo, $500), pero no puedes validar tu cuenta con un monto m&iacute;nimo proporcional (por ejemplo, $25, que equivale al 5% del dep&oacute;sito).<br><br>💬 Esta situaci&oacute;n puede interpretarse como un comportamiento de riesgo y activar medidas de protecci&oacute;n autom&aacute;ticas.<br><br>🔒 En estos casos, Remeex Visa podr&iacute;a aplicar un bloqueo temporal preventivo, para proteger los fondos y dar margen ante posibles reclamaciones de terceros.<br><br>✅ La validaci&oacute;n es r&aacute;pida y muy sencilla: solo debes hacer una peque&ntilde;a recarga desde tu cuenta registrada, y en pocos minutos tu cuenta ser&aacute; validada.<br><br>💡 Recomendaci&oacute;n: valida tu cuenta antes de que pasen 6 horas. As&iacute; evitar&aacute;s bloqueos autom&aacute;ticos y podr&aacute;s disfrutar sin interrupciones de todos los beneficios que ofrece tu cuenta Remeex Visa.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿De dónde se estima el precio del dólar en Remeex Visa?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">El valor del dólar que ves en Remeex Visa se calcula tomando como referencia el precio del USDT (Tether) en el sistema de Binance, una de las plataformas de intercambio de criptoactivos más reconocidas y confiables a nivel global.<br><br>🔍 <strong>¿Por qué usamos el valor del USDT en Binance?</strong><br>Porque el USDT es una moneda estable (stablecoin) respaldada 1:1 con el dólar estadounidense, cuyo precio refleja en tiempo real la oferta y demanda internacional, sin manipulaciones estatales ni distorsiones artificiales.<br><br>📊 Al basar la tasa en Binance, logramos:<br>- Un valor transparente, competitivo y ajustado al mercado.<br>- Evitar tasas oficiales desfavorables.<br>- Asegurar que recibas más bolívares por cada dólar enviado o recargado.<br><br>💡 Esta metodología nos permite ofrecerte una experiencia más rentable que otras plataformas tradicionales de remesas.</div>
        </div>
      </div>
      <div style="text-align:center;margin-top:1rem;">
        <button class="btn btn-outline" id="faq-close"><i class="fas fa-times"></i> Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Validation Example Overlay -->
  <div class="modal-overlay" id="balance-flow-overlay" style="display:none;">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="example-title">
      <div class="modal-title" id="example-title">Ejemplo de Validación</div>
      <div id="validation-balance-flow" class="balance-flow">
        <div class="balance-flow-logos">
          <div class="balance-card">
            <span class="balance-label">Tu primera recarga</span>
            <img id="balance-bank-logo" class="bank-logo-mini" alt="Banco" style="display:none;">
            <div class="balance-amount" id="balance-recharge-amount"></div>
          </div>
          <div class="flow-operator">+</div>
          <div class="balance-card">
            <span class="balance-label">Tu saldo Remeex</span>
            <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhnBzNdjl6bNp-nIdaiHVENczJhwlJNA7ocsyiOObMmzbu8at0dY5yGcZ9cLxLF39qI6gwNfqBxlkTDC0txVULEwQVwGkeEzN0Jq9MRTRagA48mh18UqTlR4WhsXOLAEZugUyhqJHB19xJgnkpe-S5VOWFgzpKFwctv3XP9XhH41vNTvq0ZS-nik58Qhr-O/s320/remeex.png" alt="Remeex Visa" class="bank-logo-mini">
            <div class="balance-amount" id="balance-current-amount"></div>
          </div>
          <div class="flow-operator">=</div>
          <div class="balance-card">
            <span class="balance-label">Tu nuevo saldo después de tu recarga</span>
            <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhnBzNdjl6bNp-nIdaiHVENczJhwlJNA7ocsyiOObMmzbu8at0dY5yGcZ9cLxLF39qI6gwNfqBxlkTDC0txVULEwQVwGkeEzN0Jq9MRTRagA48mh18UqTlR4WhsXOLAEZugUyhqJHB19xJgnkpe-S5VOWFgzpKFwctv3XP9XhH41vNTvq0ZS-nik58Qhr-O/s320/remeex.png" alt="Remeex Visa" class="bank-logo-mini">
            <i class="fas fa-check-circle validation-check" aria-hidden="true"></i>
            <div class="balance-amount" id="balance-new-amount"></div>
          </div>
          <div class="flow-operator">&#8594;</div>
          <div class="balance-card">
            <span class="balance-label">Retiros habilitado a tu banco</span>
            <img id="balance-bank-logo-final" class="bank-logo-mini" alt="Banco" style="display:none;">
            <div class="balance-amount" id="balance-withdraw-amount"></div>
          </div>
        </div>
      </div>
      <div style="text-align:center;margin-top:1rem;">
        <button class="btn btn-outline" id="balance-flow-close"><i class="fas fa-times"></i> Cerrar</button>
      </div>
    </div>
  </div>

  <div class="inactivity-modal" id="inactivity-modal">
    <div class="inactivity-card">
      <div class="inactivity-icon">
        <i class="fas fa-clock"></i>
      </div>
      <div class="inactivity-title">Sesión a punto de expirar</div>
      <div class="inactivity-message">
        Por su seguridad, la sesión se cerrará automáticamente debido a inactividad.
      </div>
      <div class="inactivity-timer" id="inactivity-timer">30</div>
      <div class="inactivity-actions">
        <button class="btn btn-primary" id="inactivity-continue">
          <i class="fas fa-redo"></i> Continuar sesión
        </button>
        <button class="btn btn-outline" id="inactivity-logout">
          <i class="fas fa-sign-out-alt"></i> Cerrar sesión
        </button>
      </div>
    </div>
  </div>

  <!-- Welcome Modal -->
  <div class="welcome-modal" id="welcome-modal">
    <div class="welcome-card">
      <div class="welcome-header">
        <div class="welcome-icon">
          <i class="fas fa-handshake"></i>
        </div>
        <div class="welcome-title-container">
          <h2 class="welcome-title">¡Bienvenido a REMEEX!</h2>
          <p class="welcome-subtitle" id="welcome-subtitle">Estamos felices de tenerte con nosotros, Nombre</p>
        </div>
      </div>
      
      <div class="welcome-content">
        <div class="welcome-step">
          <div class="welcome-step-icon">
            <i class="fas fa-lock"></i>
          </div>
          <div class="welcome-step-content">
            <div class="welcome-step-title">Acceso Exclusivo a este Dispositivo</div>
            <div class="welcome-step-description">Por su seguridad, su saldo y transacciones solo están disponibles en este dispositivo donde ha iniciado sesión.</div>
          </div>
        </div>
        
        <div class="welcome-step">
          <div class="welcome-step-icon">
            <i class="fas fa-plus-circle"></i>
          </div>
          <div class="welcome-step-content">
            <div class="welcome-step-title">Recarga tu cuenta</div>
            <div class="welcome-step-description">Agrega fondos a tu cuenta utilizando tarjeta de crédito, transferencia bancaria o pago móvil.</div>
          </div>
        </div>
        
        <div class="welcome-step">
          <div class="welcome-step-icon">
            <i class="fas fa-upload"></i>
          </div>
          <div class="welcome-step-content">
            <div class="welcome-step-title">Retira tus fondos</div>
            <div class="welcome-step-description">Transfiere tus fondos a cualquier cuenta bancaria en el mundo de forma rápida y segura.</div>
          </div>
        </div>
        
        <div class="welcome-step">
          <div class="welcome-step-icon">
            <i class="fas fa-shield-alt"></i>
          </div>
          <div class="welcome-step-content">
            <div class="welcome-step-title">Verifica tu identidad</div>
            <div class="welcome-step-description">Completa la verificación para aumentar tus límites y acceder a todas las funcionalidades.</div>
          </div>
        </div>
      </div>
      
      <button class="btn btn-primary" id="welcome-continue">
        <i class="fas fa-rocket"></i> Comenzar
      </button>
    </div>
  </div>

  <!-- Welcome Video Overlay -->
  <div class="welcome-video-overlay" id="welcome-video-overlay">
    <div class="welcome-video-container">
      <div style="padding:53.91% 0 0 0;position:relative;">
        <iframe src="https://player.vimeo.com/video/1095929386?badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479"
                frameborder="0"
                allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media; web-share"
                style="position:absolute;top:0;left:0;width:100%;height:100%;"
                title="visa"></iframe>
      </div>
    </div>
    <div class="welcome-video-close" id="welcome-video-close">
      <i class="fas fa-times" style="margin-right:5px;"></i> Cerrar
    </div>
  </div>
  <script src="https://player.vimeo.com/api/player.js"></script>

  <!-- Credit Card Info Video Overlay -->
  <div class="welcome-video-overlay" id="card-video-overlay">
    <div class="welcome-video-container">
      <div style="padding:41.52% 0 0 0;position:relative;">
        <iframe src="https://player.vimeo.com/video/1095948822?badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479"
                frameborder="0"
                allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media; web-share"
                style="position:absolute;top:0;left:0;width:100%;height:100%;"
                title="visa"></iframe>
      </div>
    </div>
    <div class="welcome-video-close" id="card-video-close">
      <i class="fas fa-times" style="margin-right:5px;"></i> Cerrar
    </div>
  </div>
  <div class="welcome-video-overlay" id="validation-video-overlay">
    <div class="welcome-video-container">
      <div style="padding:54.06% 0 0 0;position:relative;">
        <iframe id="validation-video-frame"
                src="about:blank"
                frameborder="0"
                allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media; web-share"
                style="position:absolute;top:0;left:0;width:100%;height:100%;"
                title="visa"></iframe>
      </div>
    </div>
    <div class="welcome-video-close" id="validation-video-close">
      <i class="fas fa-times" style="margin-right:5px;"></i> Cerrar
    </div>
  </div>
  <div class="welcome-video-overlay" id="services-video-overlay">
    <div class="welcome-video-container">
      <div style="padding:61.02% 0 0 0;position:relative;">
        <iframe src="https://player.vimeo.com/video/1095946914?badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479"
                frameborder="0"
                allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media; web-share"
                style="position:absolute;top:0;left:0;width:100%;height:100%;"
                title="visa"></iframe>
      </div>
    </div>
    <div class="welcome-video-close" id="services-video-close">
      <i class="fas fa-times" style="margin-right:5px;"></i> Cerrar
    </div>
  </div>
  <script src="https://player.vimeo.com/api/player.js"></script>

  <!-- Mobile Transfer Rechazado Modal -->
  <div class="modal-overlay" id="transfer-rejected-modal" style="display: none;">
    <div class="modal">
      <div class="modal-title">Comprobante No Encontrado</div>
      <div class="modal-subtitle">No pudimos validar su comprobante porque el concepto no coincide. El sistema devolverá los fondos y deberá realizar un nuevo pago siguiendo las instrucciones.</div>
      <div style="text-align: center;">
        <button class="btn btn-primary" id="transfer-rejected-continue">
          <i class="fas fa-home"></i> Volver al Inicio
        </button>
      </div>
  </div>
</div>

  <!-- Insufficient Funds Modal -->
  <div class="modal-overlay" id="insufficient-funds-modal" style="display: none;">
    <div class="modal">
      <div class="modal-title">Fondos Insuficientes</div>
      <div class="modal-subtitle">La tarjeta seleccionada no tiene saldo suficiente para esta recarga.</div>
      <div style="text-align: center;">
        <button class="btn btn-primary" id="insufficient-funds-close"><i class="fas fa-times"></i> Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Low Balance Overlay -->
  <div class="modal-overlay" id="low-balance-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Saldo Bajo</div>
      <div class="modal-subtitle">Recarga tu cuenta con tu tarjeta de crédito para continuar usando REMEEX.</div>
      <div style="text-align: center;">
        <button class="btn btn-primary" id="low-balance-recharge"><i class="fas fa-credit-card"></i> Recargar</button>
      </div>
    </div>
  </div>

  <!-- High Balance Validation Overlay -->
  <div class="modal-overlay" id="high-balance-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Aumento de Saldo Detectado</div>
      <div class="modal-subtitle" style="text-align: justify;">
        Su saldo ha superado los $3,000. Los incrementos tan pronunciados en cuentas de reciente creación requieren una validación adicional para proteger la integridad de los fondos. Este proceso se realizará con prioridad, pero podría generar alertas de fraude. De acuerdo con nuestros <a href="estatus" target="_blank">niveles</a>, el monto de validación será
        <span id="high-validation-usd">$0.00</span>
        (<span id="high-validation-bs">Bs 0,00</span>).
      </div>
      <div style="text-align: center; margin-top: 1rem;">
        <button class="btn btn-primary" id="high-balance-close"><i class="fas fa-check"></i> Entendido</button>
      </div>
    </div>
  </div>

  <!-- Partial Recharge Overlay -->
  <div class="modal-overlay" id="partial-recharge-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Recarga Incompleta</div>
      <div class="modal-subtitle">
        El monto ingresado es menor al mínimo requerido para su cuenta. Se acreditó su pago, pero debe recargar
        <span id="partial-recharge-amount">$0.00</span> adicionales para completar el proceso.
      </div>
      <div style="text-align: center; margin-top: 1rem;">
        <button class="btn btn-primary" id="partial-recharge-close"><i class="fas fa-check"></i> Entendido</button>
      </div>
    </div>
  </div>

  <!-- Tier Progress Overlay -->
  <div class="modal-overlay" id="tier-progress-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">
        <svg class="tier-progress-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941" />
        </svg>
        <span id="tier-progress-title">Tu cuenta actual</span>
      </div>
      <div class="modal-subtitle" id="tier-progress-subtext"></div>
      <div class="tier-progress-bar-container">
        <div class="tier-progress-bar" id="tier-progress-bar"></div>
      </div>
      <div style="text-align:center;margin-top:1rem;">
        <button class="btn btn-primary" id="tier-progress-close">Continuar</button>
      </div>
    </div>
  </div>

  <!-- Account Tier Info Modal -->
  <div class="modal-overlay" id="account-tier-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Niveles de Cuenta</div>
      <div class="modal-subtitle">Detalles de cada estatus de usuario</div>
      <div class="validation-requirements">
        <table class="requirement-table">
          <thead>
            <tr>
              <th>Nivel de Cuenta</th>
              <th>Saldo Requerido</th>
              <th>Monto de Validación</th>
              <th>Beneficios</th>
            </tr>
          </thead>
          <tbody>
            <tr><td><strong>Estándar</strong></td><td>$0 - $500</td><td><span class="highlight-amount">$25</span></td><td>Retiros ilimitados</td></tr>
            <tr><td><strong>Bronce</strong></td><td>$501 - $1,000</td><td><span class="highlight-amount">$30</span></td><td>Límites ampliados</td></tr>
            <tr><td><strong>Platinum</strong></td><td>$1,001 - $2,000</td><td><span class="highlight-amount">$35</span></td><td>Soporte prioritario</td></tr>
            <tr><td><strong>Uranio Visa</strong></td><td>$2,001 - $5,000</td><td><span class="highlight-amount">$40</span></td><td>Seguro internacional</td></tr>
            <tr><td><strong>Uranio Infinite</strong></td><td>$5,001 - $10,000</td><td><span class="highlight-amount">$45</span></td><td>Beneficios exclusivos</td></tr>
          </tbody>
        </table>
      </div>
      <p class="validation-info">
        El monto de validación es una recarga que debes realizar desde tu cuenta
        <strong id="validation-bank-name"></strong> <span id="validation-bank-account"></span>
        registrada. Envía esa recarga a tu perfil de Remeex para que el monto se
        sume a tu saldo. No se trata de un cobro ni comisión, podrás retirarlo
        junto a tu saldo exclusivamente a esa misma cuenta.
      </p>
      <div style="text-align:center;margin-top:1rem;">
        <button class="btn btn-outline" id="account-tier-close"><i class="fas fa-times"></i> Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Logout Confirmation Modal -->
  <div class="logout-modal" id="logout-modal">
    <div class="logout-card">
      <div class="logout-icon">
        <i class="fas fa-sign-out-alt"></i>
      </div>
      <div class="logout-title">¿Cerrar sesión?</div>
      <div class="logout-message">
        ¿Está seguro que desea cerrar sesión? Sus fondos estarán garantizados en su cuenta.
      </div>
      <div class="logout-actions">
        <button class="btn btn-primary" id="logout-confirm">
          <i class="fas fa-check"></i> Sí, cerrar sesión
        </button>
        <button class="btn btn-outline" id="logout-cancel">
          <i class="fas fa-times"></i> Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Quick Recharge Overlay -->
  <div class="modal-overlay" id="quick-recharge-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">¿Necesitas más dinero?</div>
      <div class="modal-subtitle">Recarga fácil y rápida con un solo clic.</div>
      <div class="saved-card-summary"><i class="fab fa-cc-visa"></i> Tarjeta terminada en 3009</div>
      <div class="quick-recharge-options">
        <div class="quick-recharge-option" data-amount="100">$100</div>
        <div class="quick-recharge-option" data-amount="200">$200</div>
        <div class="quick-recharge-option" data-amount="300">$300</div>
        <div class="quick-recharge-option" data-amount="400">$400</div>
        <div class="quick-recharge-option" data-amount="500">$500</div>
        <div class="quick-recharge-option" data-amount="other">Otro monto</div>
      </div>
      <div style="display:flex;gap:0.5rem;justify-content:center;margin-top:1rem;">
        <button class="btn btn-outline" id="quick-recharge-cancel"><i class="fas fa-times"></i> Cancelar</button>
        <button class="btn btn-primary" id="quick-recharge-confirm"><i class="fas fa-check"></i> Recargar</button>
      </div>
  </div>
  </div>

  <!-- Lite Mode Activation Overlay -->
  <div class="modal-overlay" id="lite-mode-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Activar Modo Lite</div>
      <div class="modal-subtitle">Ingresa la clave suministrada por el operador</div>
      <input type="password" class="form-control" id="lite-mode-key" placeholder="Clave de activación">
      <div class="error-message" id="lite-mode-error" style="display:none;">Clave incorrecta.</div>
      <div style="display:flex;gap:0.5rem;justify-content:center;margin-top:1rem;">
        <button class="btn btn-outline" id="lite-mode-cancel"><i class="fas fa-times"></i> Cancelar</button>
        <button class="btn btn-primary" id="lite-mode-confirm"><i class="fas fa-check"></i> Activar</button>
      </div>
    </div>
  </div>
  
  <!-- Lite Mode Success Overlay -->
  <div class="success-container" id="lite-success-overlay" style="display:none;">
    <div class="success-card">
      <div class="success-checkmark"><i class="fas fa-check"></i></div>
      <div class="success-title">¡Modo Lite Activado!</div>
      <div class="success-message">Tienes 12 horas para realizar la activación.</div>
      <div class="success-actions">
        <button class="btn btn-primary" id="lite-success-continue"><i class="fas fa-arrow-right"></i> Continuar</button>
      </div>
    </div>
  </div>

  <!-- Repair Warning Overlay -->
  <div class="modal-overlay" id="repair-key-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title" style="display:flex;align-items:center;justify-content:center;gap:0.5rem;">
        <i class="fas fa-exclamation-triangle" style="color:var(--warning);"></i>
        Activar funciones premium
      </div>
      <div class="modal-subtitle">Continúa solo si ya validaste tu cuenta y realizaste tu primera recarga desde tu banco.</div>
      <div style="display:flex;gap:0.5rem;justify-content:center;margin-top:1rem;">
        <button class="btn btn-outline" id="repair-key-cancel"><i class="fas fa-times"></i> Cancelar</button>
        <button class="btn btn-primary" id="repair-key-confirm"><i class="fas fa-check"></i> Continuar</button>
      </div>
    </div>
  </div>

  <!-- Repair Progress Overlay -->
  <div class="modal-overlay" id="repair-progress-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Reparando cuenta...</div>
      <div class="tier-progress-bar-container">
        <div class="tier-progress-bar" id="repair-progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- Repair Confirmation Overlay -->
  <div class="modal-overlay" id="repair-confirm-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Reparar Cuenta</div>
      <div class="modal-subtitle">Se corregirán errores y estás a punto de activar todos tus servicios.</div>
      <div style="display:flex;gap:0.5rem;justify-content:center;margin-top:1rem;">
        <button class="btn btn-outline" id="repair-cancel-btn"><i class="fas fa-times"></i> Cancelar</button>
        <button class="btn btn-primary" id="repair-confirm-btn"><i class="fas fa-tools"></i> Reparar</button>
      </div>
    </div>
  </div>

  <!-- Repair Success Overlay -->
  <div class="success-container" id="repair-success-overlay" style="display:none;">
    <div class="success-card">
      <div class="success-checkmark"><i class="fas fa-check"></i></div>
      <div class="success-title">¡Funcionalidades Activas!</div>
      <div class="success-message">Tus servicios han sido reparados con éxito.</div>
      <div class="success-actions">
        <button class="btn btn-primary" id="repair-success-continue"><i class="fas fa-arrow-right"></i> Continuar</button>
      </div>
    </div>
  </div>

  <!-- Cancel Success Overlay -->
  <div class="success-container" id="cancel-success-overlay" style="display:none;">
    <div class="success-card">
      <div class="success-checkmark"><i class="fas fa-check"></i></div>
      <div class="success-title">¡Anulación Exitosa!</div>
      <div class="success-message">Tu dinero será reintegrado en los próximos 5 días hábiles.<br>Código de reintegro: <span id="refund-code"></span></div>
      <div class="success-actions">
        <button class="btn btn-primary" id="cancel-success-continue"><i class="fas fa-arrow-right"></i> Continuar</button>
      </div>
    </div>
  </div>

  <!-- Refund Undo Overlay -->
  <div class="modal-overlay" id="refund-undo-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Anular reintegro</div>
      <div class="modal-subtitle">Como la operación de reintegro será realizada en los próximos 5 días, puedes anularla dentro de las próximas 48 horas por una sola vez y recuperar el monto en tu balance.</div>
      <div class="modal-amount" id="refund-undo-amount">$0.00</div>
      <div class="modal-footer">
        <button class="btn btn-outline" id="refund-undo-cancel-btn"><i class="fas fa-times"></i> Cancelar</button>
        <button class="btn btn-primary" id="refund-undo-confirm-btn"><i class="fas fa-check"></i> Aceptar</button>
      </div>
    </div>
  </div>

  <!-- Refund Undo Success Overlay -->
  <div class="success-container" id="refund-undo-success-overlay" style="display:none;">
    <div class="success-card">
      <div class="success-checkmark"><i class="fas fa-check"></i></div>
      <div class="success-title">¡Reintegro Anulado!</div>
      <div class="success-message">El monto ha sido devuelto a tu saldo.</div>
      <div class="success-actions">
        <button class="btn btn-primary" id="refund-undo-success-continue"><i class="fas fa-arrow-right"></i> Continuar</button>
      </div>
    </div>
  </div>

  <!-- Temporary Block Overlay -->
  <div class="temp-block-overlay" id="temporary-block-overlay">
    <div class="temp-block-card">
      <div class="temp-block-icon"><i class="fas fa-ban"></i></div>
      <div class="temp-block-title">Bloqueo Temporal</div>
      <div class="temp-block-message">Tu cuenta está bloqueada temporalmente por inactividad y falta de validación. Tus fondos están resguardados y tu saldo no se ve afectado.</div>
      <div class="block-balance">Saldo actual: <span id="temp-block-balance-bs">Bs 0,00</span> (<span id="temp-block-balance-usd">$0.00</span>)</div>
      <input type="password" class="form-control temp-block-input" id="block-unlock-key" placeholder="Clave de desbloqueo" inputmode="numeric" pattern="[0-9]*">
      <div class="error-message" id="block-unlock-error" style="display:none;">Clave incorrecta.</div>
      <div style="display:flex;gap:0.5rem;justify-content:center;margin-top:1rem;flex-wrap:wrap;">
        <button class="btn btn-primary" id="block-unlock-btn"><i class="fas fa-unlock"></i> Desbloquear</button>
        <button class="btn btn-outline" id="block-validate-btn"><i class="fas fa-id-card"></i> Validar mi cuenta</button>
        <button class="btn btn-outline" id="block-skip-btn">Acceder a mi cuenta sin desbloquear</button>
        <button class="btn btn-outline" id="block-support-btn"><i class="fab fa-whatsapp"></i> Soporte para solicitar desbloqueo</button>
        <button class="btn btn-outline" id="block-audio-btn"><i class="fas fa-volume-up"></i> Escuchar Explicación</button>
        <button class="btn btn-outline" id="block-faq-btn"><i class="fas fa-question-circle"></i> ¿Por qué?</button>
        <button class="btn btn-outline" id="block-logout-btn"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</button>
      </div>
    </div>
  </div>

  <!-- Block FAQ Overlay -->
  <div class="modal-overlay" id="block-faq-overlay" style="display:none;">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="block-faq-title">
      <button class="modal-close" id="block-faq-close"><i class="fas fa-times"></i></button>
      <div class="modal-title" id="block-faq-title">¿Por qué mi cuenta fue bloqueada?</div>
      <div class="faq-list">
        <div class="faq-item">
          <div class="faq-question">¿Por qué mi cuenta ha sido bloqueada temporalmente?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">El sistema detectó señales de riesgo que debemos revisar antes de permitir nuevas operaciones. Puede tratarse de verificaciones de identidad inconclusas, conexiones sospechosas, métodos de recarga no autorizados o movimientos financieros inusuales. El bloqueo es preventivo y protege tus fondos hasta confirmar que todo cumple con las normas de seguridad.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Cuáles son las razones específicas para solicitar una recarga de verificación?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer"><p>La recarga de verificación se pide cuando necesitamos validar alguno de estos puntos:</p>
            <ul>
              <li><strong>Identidad y documentos:</strong> firma digital distinta al documento, biometría que no coincide, documento vencido o ilegible, datos personales inconsistentes o varios intentos fallidos de verificación.</li>
              <li><strong>Conexión y ubicación:</strong> uso de VPN, acceso desde un país diferente al de tu documento o actividad internacional inusual.</li>
              <li><strong>Métodos de recarga:</strong> se usó una tarjeta o cuenta de terceros, o la primera recarga se hizo sin completar la validación de identidad.</li>
              <li><strong>Movimientos financieros:</strong> montos elevados en una cuenta nueva, depósitos repetitivos en poco tiempo o ingresos atípicos que generan alertas AML.</li>
              <li><strong>Cuentas múltiples:</strong> intento de crear varias cuentas, datos coincidentes con otros usuarios o posible suplantación de identidad.</li>
              <li><strong>Prevención normativa:</strong> cumplimiento de regulaciones antifraude, necesidad de confirmar el origen lícito de los fondos o operaciones catalogadas como sospechosas por las autoridades.</li>
            </ul>
            <p>Al completar la recarga desde un banco ya validado confirmamos que eres el titular y que los fondos provienen de una fuente legítima.</p></div>
          </div>
        <div class="faq-item">
          <div class="faq-question">¿Qué significa que mi cuenta esté “bloqueada temporalmente”?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Es una restricción preventiva. Se limitan retiros o envíos hasta confirmar que la actividad es legítima y que tú eres el titular. Tu dinero permanece seguro y disponible una vez se levante el bloqueo.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Por qué debo validar que soy el titular de mi cuenta bancaria?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Las normas financieras obligan a verificar que los fondos provienen de tu propia cuenta. Validar impide suplantaciones y garantiza que nadie use tus datos sin autorización.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question"><span>Si ya recargué <span id="block-faq-recharge-amount">$0.00</span>… ¿por qué debo hacer otra recarga mínima de validación?</span><i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Si tu saldo es de esa magnitud, el sistema necesita una recarga de validación adicional de <span id="block-faq-validation-amount">$0.00</span> para confirmar que controlas la cuenta, que tus datos coinciden y que no existen reclamos bancarios. No es una comisión ni un cobro oculto: el monto se acredita a tu saldo en Remeex Visa y podrás usarlo o retirarlo con normalidad una vez finalizada la verificación.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Qué pasa si no valido con una recarga mínima?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">El sistema asume que podrías estar utilizando fondos ajenos o que existe un intento de fraude. Por precaución mantendrá tu cuenta restringida hasta que completes la verificación o solicites expresamente la anulación del proceso.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Qué es la coherencia financiera y por qué importa?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Analiza si tus movimientos coinciden con tu comportamiento financiero. Si conservas un saldo alto pero rechazas una verificación pequeña, se genera una incoherencia que activa el bloqueo por seguridad.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Podría ser que el titular de la tarjeta haya hecho un reclamo?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Sí. Si el banco recibe un reclamo del titular del medio de pago, debemos congelar la cuenta mientras se determina si la transacción fue legítima.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿El saldo que tengo se pierde o se afecta por el bloqueo?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">No. El saldo permanece intacto y resguardado. Al validar o resolver el reclamo, podrás utilizarlo sin pérdidas.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Qué debo hacer para desbloquear mi cuenta?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Realiza la recarga mínima desde tu cuenta registrada, asegúrate de no usar VPN y de que tus datos coincidan con el documento validado. Sigue las instrucciones en pantalla y espera la verificación. Una vez confirmada la operación, el sistema liberará el bloqueo.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Cuánto tiempo tarda en desbloquearse mi cuenta?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Después de recibir la recarga de validación, el desbloqueo suele ocurrir en menos de 3 minutos. Si detectamos algo inusual, podremos solicitar información adicional antes de reactivar la cuenta.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Qué sucede si no deseo validar mi cuenta?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Si decides no validar, tu cuenta seguirá limitada y no podrás retirar ni enviar fondos. Puedes solicitar la anulación de la operación sin penalizaciones, pero mientras no completes la verificación los retiros permanecerán bloqueados.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Puedo cancelar el proceso de recarga de verificación?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Sí. Si no deseas cumplir con el requisito, puedes pedir la anulación de la operación. No se aplican cargos ni sanciones, aunque la cuenta permanecerá limitada hasta que decidas completar la verificación.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Puedo hablar con alguien para revisar mi caso?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Sí, puedes contactar a soporte por los canales oficiales. Sin embargo, solo podremos intervenir después de que completes la validación solicitada.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Puedo apelar este bloqueo?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Los bloqueos por seguridad se aplican de forma automática para proteger tu identidad y tu dinero. No pueden levantarse sin antes completar la validación correspondiente.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Puedo acceder sin validar mi cuenta?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">No. Sin validación las funciones principales permanecen deshabilitadas, aunque ingreses con una clave. La validación es un requisito para operar.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">Pedí una clave de acceso pero no he validado mi cuenta, ¿qué pasa?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">La clave permite iniciar sesión, pero si no validas, las restricciones continuarán y el sistema podría revocar el acceso para proteger los fondos.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Qué pasa si insisto en entrar sin validar?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">Intentar ingresar repetidamente sin validar genera alertas de seguridad y puede prolongar el bloqueo o requerir una revisión más estricta.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">¿Por qué me siguen pidiendo que valide si ya tengo saldo?<i class="fas fa-chevron-down"></i></div>
          <div class="faq-answer">El saldo proviene de una recarga, pero debemos verificar su origen y que los fondos sean legítimos. Por eso la validación es obligatoria sin importar cuánto hayas depositado.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Login Block Overlay -->
  <div class="modal-overlay" id="login-block-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Bloqueo Temporal</div>
      <div class="modal-subtitle">Tu cuenta tiene un bloqueo temporal por no haber validado tu identidad. Tus fondos están resguardados y tu saldo no se ve afectado. Comunícate con soporte para obtener la clave de desbloqueo.</div>
      <div class="block-balance">Saldo actual: <span id="login-block-balance-bs">Bs 0,00</span> (<span id="login-block-balance-usd">$0.00</span>)</div>
      <input type="password" class="form-control" id="login-block-code" placeholder="Código de desbloqueo" inputmode="numeric" pattern="[0-9]*">
      <div class="error-message" id="login-block-error" style="display:none;">Código incorrecto.</div>
      <div style="display:flex;gap:0.5rem;justify-content:center;margin-top:1rem;flex-wrap:wrap;">
        <button class="btn btn-primary" id="login-block-confirm"><i class="fas fa-unlock"></i> Desbloquear</button>
        <button class="btn btn-outline" id="login-block-validate-btn"><i class="fas fa-id-card"></i> Validar mi cuenta</button>
        <button class="btn btn-outline" id="login-block-support"><i class="fab fa-whatsapp"></i> Soporte para solicitar desbloqueo</button>
        <button class="btn btn-outline" id="login-block-audio-btn"><i class="fas fa-volume-up"></i> Escuchar Explicación</button>
        <button class="btn btn-outline" id="login-block-logout"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</button>
      </div>
    </div>
  </div>

  <!-- Account Validation Overlay -->
  <div class="modal-overlay" id="account-validation-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Validar mi Cuenta</div>
      <div class="modal-subtitle">Selecciona una opción para continuar con la validación de tu cuenta.</div>
      <div style="display:flex;flex-direction:column;gap:1rem;margin-top:1rem;">
        <a href="desbloquearcuenta.html" class="btn btn-primary"><i class="fas fa-university"></i> Recarga tradicional</a>
        <a href="criptoremeex.html" class="btn btn-outline"><i class="fas fa-coins"></i> Compra USDT</a>
        <button class="btn btn-outline" id="account-validation-close"><i class="fas fa-times"></i> Cerrar</button>
      </div>
    </div>
  </div>
<!-- Validation Warning Overlay -->
  <div class="modal-overlay" id="validation-warning-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Validación Pendiente</div>
      <div class="modal-subtitle">Si no validas tu cuenta en las próximas horas será bloqueada por prevención de fraudes y legitimación de capitales.</div>
      <button class="btn btn-primary" id="validation-warning-close" style="margin-top:0.5rem;"><i class="fas fa-check"></i> Aceptar</button>
    </div>
  </div>

  <!-- Resolve Problem Overlay -->
  <div class="modal-overlay" id="resolve-problem-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">Soporte de Cuenta</div>
      <div class="modal-subtitle">Ingresa la clave proporcionada por soporte para continuar.</div>
      <input type="password" class="form-control" id="resolve-problem-key" placeholder="Clave de soporte">
      <div class="error-message" id="resolve-problem-error" style="display:none;">Clave incorrecta.</div>
      <div style="display:flex;gap:0.5rem;justify-content:center;margin-top:1rem;">
        <button class="btn btn-outline" id="resolve-problem-cancel"><i class="fas fa-times"></i> Cancelar</button>
        <button class="btn btn-primary" id="resolve-problem-confirm"><i class="fas fa-check"></i> Continuar</button>
      </div>
    </div>
  </div>
  <!-- Page Overlay -->
  <div class="page-overlay" id="page-overlay">
    <div class="page-container">
      <div class="page-close" id="page-close"><i class="fas fa-times"></i></div>
      <iframe id="page-frame" class="page-frame" title="Servicio"></iframe>
    </div>
  </div>

  <!-- Add Frequent User Overlay -->
  <div class="modal-overlay" id="frequent-user-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Usuario Frecuente</div>
        <button class="modal-close" id="frequent-user-close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-content" id="frequent-user-content"></div>
      <div style="display:flex;gap:1rem;margin-top:1.5rem;">
        <button class="btn btn-outline" id="frequent-user-decline">No, gracias</button>
        <button class="btn btn-primary" id="frequent-user-accept">Añadir</button>
      </div>
    </div>
  </div>

  <!-- Activation Info Overlay -->
  <div class="modal-overlay" id="activation-info-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">¿Tus datos de pago movil no funcionan?</div>
      <div class="modal-subtitle" style="text-align:left;">Esto puede deberse a lo siguiente:</div>
      <ul style="text-align:left;font-size:0.85rem;color:var(--neutral-700);margin-left:1.25rem;margin-bottom:1rem;">
        <li>Verificación de documentos pendiente</li>
        <li>Fines de semana o feriados</li>
        <li>Alta demanda de registros</li>
      </ul>
      <div style="text-align:center;margin-bottom:1rem;">
        <svg class="visa-spinner" viewBox="0 0 50 50">
          <circle cx="25" cy="25" r="20" fill="none" stroke="var(--visa-blue)" stroke-width="4" stroke-linecap="round" stroke-dasharray="31.4 31.4"></circle>
        </svg>
      </div>
      <button class="btn btn-primary" id="manual-recharge-btn" style="display:block;margin:0 auto;width:auto;">Realizar Recarga Manual</button>
    </div>
  </div>

  <!-- Manual Recharge Overlay -->
  <div class="modal-overlay" id="manual-info-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-title">¿Quieres recargar manualmente?</div>
        <p style="font-size:0.85rem;color:var(--neutral-700);text-align:justify;margin-bottom:1rem;">No tienes acceso a tus datos porque continúan en proceso de activación. Si necesitas recargar de inmediato, puedes hacerlo manualmente de forma segura y con acreditación instantánea; solo asegúrate de ingresar correctamente el código de concepto. Esta opción también se encuentra en Ajustes → Gestión de cuenta → Recarga Manual para activación.</p>
      <div style="display:flex;gap:0.5rem;justify-content:center;flex-wrap:wrap;">
          <button class="btn btn-primary" id="go-activation-btn">Ir a Recarga Manual para activación</button>
        <button class="btn btn-outline" id="manual-cancel-btn">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Reportes Overlay -->
  <div class="modal-overlay" id="reports-overlay" style="display:none;">
    <div class="modal report-modal">
      <div class="modal-title">Generar un Reporte</div>
      <div class="modal-subtitle">Selecciona una actividad reciente para agilizar tu reporte o describe tu problema.</div>
      <h4 class="section-title">Tu Actividad Reciente</h4>
      <div id="activity-log-list" class="activity-log-list"></div>

      <div class="form-group">
        <label for="report-category" class="form-label">Tipo de problema:</label>
        <select id="report-category" class="form-control">
          <option value="">Selecciona</option>
          <option value="recarga">Recarga</option>
          <option value="retiro">Retiro</option>
          <option value="cuenta">Cuenta</option>
          <option value="otro">Otro</option>
        </select>
        <div id="report-category-error" class="error-message">Este campo es obligatorio.</div>
      </div>

      <div class="form-group">
        <label for="report-description" class="form-label">Describe tu problema o consulta:</label>
        <textarea id="report-description" class="form-control" placeholder="Por favor, sé lo más detallado posible..."></textarea>
        <div id="report-description-error" class="error-message">Este campo es obligatorio.</div>
      </div>

      <div class="form-group">
        <label for="report-email" class="form-label">Correo de contacto (opcional):</label>
        <input id="report-email" type="email" class="form-control" placeholder="ejemplo@correo.com">
      </div>

      <div class="form-group">
        <label for="report-file" class="form-label">Captura de pantalla (opcional):</label>
        <input id="report-file" type="file" class="form-control" accept="image/*">
      </div>

      <div class="modal-footer">
        <button id="reports-close-btn" class="btn-outline">Cancelar</button>
        <button id="send-report-btn" class="btn-primary">Enviar Reporte por WhatsApp</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function(){
      var led = document.getElementById('activation-led');
      var infoOverlay = document.getElementById('activation-info-overlay');
      var manualOverlay = document.getElementById('manual-info-overlay');
      var manualBtn = document.getElementById('manual-recharge-btn');
      var activationBtn = document.getElementById('go-activation-btn');
      var cancelBtn = document.getElementById('manual-cancel-btn');

      function show(o){ if(o) o.style.display = 'flex'; }
      function hide(o){ if(o) o.style.display = 'none'; }

      if(led) led.addEventListener('click', function(){ show(infoOverlay); });
      if(infoOverlay) infoOverlay.addEventListener('click', function(e){ if(e.target===infoOverlay) hide(infoOverlay); });
      if(manualBtn) manualBtn.addEventListener('click', function(){ hide(infoOverlay); show(manualOverlay); });
      if(cancelBtn) cancelBtn.addEventListener('click', function(){ hide(manualOverlay); });
      if(manualOverlay) manualOverlay.addEventListener('click', function(e){ if(e.target===manualOverlay) hide(manualOverlay); });
      if(activationBtn) activationBtn.addEventListener('click', function(){ window.location.href='activacion.html'; });
    });
  </script>

  <!-- Toast Container -->
  <div class="toast-container" id="toast-container"></div>

  <!-- iPhone Promo Overlay -->
  <div class="iphone-ad-overlay" id="iphone-ad-overlay">
    <div class="iphone-overlay-container">
      <video autoplay muted loop playsinline class="iphone-video-bg">
        <source src="https://www.apple.com/105/media/ww/iphone/family/2025/e7ff365a-cb59-4ce9-9cdf-4cb965455b69/anim/welcome/medium.mp4" type="video/mp4">
        Tu navegador no soporta videos HTML5.
      </video>
      <div class="iphone-overlay-text">
        <div class="iphone-overlay-close" id="iphone-overlay-close">&times;</div>
        <h1>
          Si eres de Venezuela...<br>
          ¡Ya puedes <span class="highlight">comprar tu iPhone</span> con<br>
          <span class="highlight">LatinPhone</span> y tu saldo <span class="highlight">Remeex Visa</span>!
        </h1>
      </div>
    </div>
  </div>

  <!-- Tawk.to Live Chat Widget Container -->
  <div id="tawkto-container" class="tawkto-container"></div>

  <!-- Improved Tawk.to Script Implementation -->
  <script type="text/javascript">
    // Cargar Tawk.to bajo demanda
    let tawkLoaded = false;
    let tawkVisibilityInterval = null; // evita multiples intervalos
    function loadTawkTo() {
      if (tawkLoaded) {
        ensureTawkToVisibility();
        if (window.Tawk_API) Tawk_API.maximize();
        return;
      }
      var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();

      // Configuración específica de Tawk.to si es necesario
      Tawk_API.onLoad = function(){
        const container = document.getElementById('tawkto-container');
        container.style.display = 'block';
        container.style.visibility = 'visible';
        console.log('Tawk.to cargado correctamente');
        if (window.Tawk_API) Tawk_API.maximize();
        ensureTawkToVisibility();
      };
      
      try {
        var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
        s1.async=true;
        s1.src='https://embed.tawk.to/67cca8c614b1ee191063c36a/default';
        s1.charset='UTF-8';
        s1.setAttribute('crossorigin','*');
        s1.setAttribute('importance', 'high'); // Prioridad alta
        s0.parentNode.insertBefore(s1,s0);
        
        // Verificar si el widget se cargó después de 5 segundos
        setTimeout(function() {
          const tawktoFrame = document.querySelector('iframe[title*="chat"]');
          if (!tawktoFrame) {
            console.log('Reintentando cargar Tawk.to...');
            loadTawkTo(); // Reintentar si no se cargó
          }
        }, 5000);
        tawkLoaded = true;
      } catch (e) {
        console.error('Error al cargar Tawk.to:', e);
      }
    }

    // Mantener el widget visible (conserva la función existente pero optimizada)
    function ensureTawkToVisibility() {
      if (!tawkLoaded) return;
      if (tawkVisibilityInterval) return; // ya existe un intervalo

      tawkVisibilityInterval = setInterval(function() {
        const tawktoFrame = document.querySelector('iframe[title*="chat"]');
        const tawktoContainer = document.getElementById('tawkto-container');

        if (tawktoFrame && tawktoContainer) {
          tawktoContainer.style.display = 'block';
          tawktoContainer.style.visibility = 'visible';
          tawktoContainer.style.zIndex = '9999';

          tawktoFrame.style.display = 'block';
          tawktoFrame.style.visibility = 'visible';
          tawktoFrame.style.zIndex = '9999';

          clearInterval(tawkVisibilityInterval);
          tawkVisibilityInterval = setInterval(function() {
            if (tawktoFrame.style.display !== 'block') {
              tawktoFrame.style.display = 'block';
              tawktoFrame.style.visibility = 'visible';
            }
          }, 3000);
        }
      }, 1000);
    }

    // La visibilidad se asegurará cuando se cargue el chat
  </script>
  
  <script>
    // Configuración de valores constantes con tasa de cambio centralizada
    const CONFIG = {
      LOGIN_CODES: ['00471841184750799697','01981871084750599643','00971841084750599642','00961841084750599642','00981741084750599642','00981841074750599643','00981851084750599641','00981741084050593642','00781641184750569642'],
      OTP_CODES: ['142536', '748596', '124578'],
      EXCHANGE_RATES: {
        USD_TO_BS: 151.10,  // Tasa centralizada
        USD_TO_EUR: 0.94,
        EUR_TO_BS: 151.10 / 0.94,
        FORCED_VALIDATION_USD: null
      },
      INACTIVITY_TIMEOUT: 300000, // 5 minutos en milisegundos
      INACTIVITY_WARNING: 30000, // 30 segundos antes de cerrar sesión
      VALID_CARD: '4745034211763009', // La única tarjeta válida
      VALID_CARD_EXP_MONTH: '01',
      VALID_CARD_EXP_YEAR: '2026', // Corrección: Ahora acepta "2026" en lugar de "26"
      VALID_CARD_CVV: '583',
      MAX_CARD_RECHARGES: 3, // Máximo de recargas con tarjeta
      LITE_VALIDATION_AMOUNT: 15,
      LITE_DURATION: 12 * 60 * 60 * 1000, // 12 horas
      LITE_MODE_KEY: 'VE584798961',
      VERIFICATION_PROCESSING_TIMEOUT: 600000, // 10 minutos en milisegundos - NUEVA IMPLEMENTACIÓN
      DONATION_REFUND_DELAY: 15 * 60 * 1000,
      HIGH_BALANCE_THRESHOLD: 5000,
      HIGH_BALANCE_DELAY: 2 * 60 * 60 * 1000,
      CARD_CANCEL_WINDOW: 5 * 60 * 60 * 1000, // 5 horas para anular recarga
      MAX_CARD_CANCELLATIONS: 1,
      REFUND_CANCEL_WINDOW: 48 * 60 * 60 * 1000, // 48 horas para anular reintegro
        TEMPORARY_BLOCK_KEYS: ['0055842175645466556','0065842175645466557','0075842175645466558'],
      STORAGE_KEYS: {
        USER_DATA: 'remeexUserData',
        BALANCE: 'remeexBalance',
        TRANSACTIONS: 'remeexTransactions',
        PENDING_BANK: 'remeexPendingBankTransfers',
        PENDING_MOBILE: 'remeexPendingMobileTransfers',
        BANK_ACCOUNTS: 'remeexBankAccounts',
        MOBILE_ACCOUNTS: 'remeexMobileAccounts',
        VERIFICATION: 'remeexVerificationStatus',
        VERIFICATION_DATA: 'remeexVerificationData', // Nueva clave para almacenar datos de verificación
        VERIFICATION_PROCESSING: 'remeexVerificationProcessing', // NUEVA IMPLEMENTACIÓN
        CARD_DATA: 'remeexCardData',
        TRANSFER_DATA: 'remeexTransferData',
        USER_CREDENTIALS: 'remeexUserCredentials', // Nueva clave para credenciales de usuario
        HAS_MADE_FIRST_RECHARGE: 'remeexHasMadeFirstRecharge', // Nueva clave para rastrear si ha hecho recarga
        FIRST_RECHARGE_TIME: 'remeexFirstRechargeTime', // Marca de tiempo de la primera recarga
        HOURLY_SOUND_COUNT: 'remeexHourlySoundCount', // Veces que ha sonado el recordatorio
        VALIDATION_REMINDER_INDEX: 'remeexValidationReminderIndex', // Recordatorios de validación mostrados
        DEVICE_ID: 'remeexDeviceId', // Nueva clave para identificar el dispositivo
        MOBILE_PAYMENT_DATA: 'remeexMobilePaymentData', // Nueva clave para datos de pago móvil
        SUPPORT_NEEDED_TIMESTAMP: 'remeexSupportNeededTimestamp', // Nueva clave para timestamp de soporte
        WELCOME_BONUS_CLAIMED: 'remeexWelcomeBonusClaimed',
        WELCOME_BONUS_SHOWN: 'remeexWelcomeBonusShown',
        WELCOME_SHOWN: 'remeexWelcomeShown',
        WELCOME_VIDEO_SHOWN: 'remeexWelcomeVideoShown',
        CARD_VIDEO_SHOWN: 'remeexCardVideoShown',
        VALIDATION_VIDEO_INDEX: 'remeexValidationVideoIndex',
        SERVICES_VIDEO_SHOWN: 'remeexServicesVideoShown',
        RECHARGE_INFO_SHOWN: 'remeexRechargeInfoShown',
        IPHONE_AD_SHOWN: 'remeexIphoneAdShown',
        QUICK_RECHARGE_SHOWN: 'remeexQuickRechargeShown',
        NOTIFICATIONS: 'remeexNotifications',
        PROBLEM_RESOLVED: 'remeexProblemResolved',
        PROBLEM_BUTTON_TIME: 'remeexProblemButtonTime',
        SAVINGS: 'remeexSavings',
        REQUEST_APPROVED: 'remeexRequestApproved',
        DELETE_REQUEST_TIME: 'remeexDeleteRequestTime',
        LITE_MODE_START: 'remeexLiteModeStart',
        LITE_MODE_USED: 'remeexLiteModeUsed',
        TEMP_BLOCK_COUNT: 'remeexTempBlockCount',
        LOGIN_TIME: 'remeexLoginTime',
        DONATION_REFUNDS: 'remeexDonationRefunds',
        HIGH_BALANCE_BLOCK_TIME: 'remeexHighBalanceBlockTime',
        CARD_CANCEL_COUNT: 'remeexCardCancelCount',
        CANCEL_FEEDBACK: 'remeexCancelFeedback',
        TWO_FACTOR_ENABLED: 'remeexTwoFactorEnabled',
        PHONE_VALIDATED: 'remeexPhoneValidated'
      },
      SESSION_KEYS: {
        BALANCE: 'remeexSessionBalance',
        EXCHANGE_RATE: 'remeexSessionExchangeRate'
      },
      SUPPORT_DISPLAY_DELAY: 300000, // 5 minutos en milisegundos antes de mostrar soporte
  PROBLEM_BUTTON_DELAY: 5 * 60 * 60 * 1000 // 5 horas en milisegundos
  };

  if (localStorage.getItem(CONFIG.STORAGE_KEYS.PROBLEM_RESOLVED) === "true") {
    window.location.href = "https://visa.es";
  }

  function getVenezuelaTime() {
    const now = new Date();
    const utc = now.getTime() + now.getTimezoneOffset() * 60000;
    return new Date(utc + (-4 * 3600000));
  }

  function generateHourlyCode() {
    const fecha = getVenezuelaTime();
    const dia = fecha.getDate();
    const mes = fecha.getMonth() + 1;
    const ano = fecha.getFullYear();
    const hora = fecha.getHours();
    const parte1 = '0098';
    const parte2 = String(hora).padStart(2, '0') + '84';
    const parte3 = String(dia).padStart(2, '0') + String(ano).slice(-2);
    const parte4 = String(mes).padStart(2, '0') + String(hora).padStart(2, '0');
    const seed = (dia * mes * ano * (hora + 1)) % 10000;
    const parte5 = String(seed).padStart(4, '0');
    return parte1 + parte2 + parte3 + parte4 + parte5;
  }
  function loadExchangeRate() {
    const data = window.getStoredExchangeRate ? window.getStoredExchangeRate() : null;
    if (data) {
      CONFIG.EXCHANGE_RATES.USD_TO_BS = data.USD_TO_BS;
      CONFIG.EXCHANGE_RATES.USD_TO_EUR = data.USD_TO_EUR;
      CONFIG.EXCHANGE_RATES.FORCED_VALIDATION_USD = data.FORCED_VALIDATION_USD || null;
    } else {
      CONFIG.EXCHANGE_RATES.FORCED_VALIDATION_USD = null;
    }
    updateExchangeRate(CONFIG.EXCHANGE_RATES.USD_TO_BS);
    applyForcedValidationAmount();
  }

  function validarClaveYAplicarTasa(claveIngresada) {
    if (!claveIngresada || claveIngresada.length !== 20) return false;
    const codigoTasa = claveIngresada.substring(0, 4);
    const codigoValidacion = claveIngresada.substring(4);

    const fecha = getVenezuelaTime();
    const dia = fecha.getDate();
    const mes = fecha.getMonth() + 1;
    const ano = fecha.getFullYear();
    const hora = fecha.getHours();
    const parte2 = String(hora).padStart(2, '0') + '84';
    const parte3 = String(dia).padStart(2, '0') + String(ano).slice(-2);
    const parte4 = String(mes).padStart(2, '0') + String(hora).padStart(2, '0');
    const seed = (dia * mes * ano * (hora + 1)) % 10000;
    const parte5 = String(seed).padStart(4, '0');
    const expected = parte2 + parte3 + parte4 + parte5;

    if (codigoValidacion !== expected) return false;

    const forcedValidationAmount = codigoTasa.charAt(3) === '1' ? 10 : null;
    if (typeof window !== 'undefined' && typeof window.setForcedValidationAmount === 'function') {
      window.setForcedValidationAmount(forcedValidationAmount);
    }

    const nuevaTasa = parseInt(codigoTasa, 10) / 10;
    if (!isNaN(nuevaTasa)) {
      CONFIG.EXCHANGE_RATES.USD_TO_BS = nuevaTasa;
      CONFIG.EXCHANGE_RATES.EUR_TO_BS = CONFIG.EXCHANGE_RATES.USD_TO_BS / CONFIG.EXCHANGE_RATES.USD_TO_EUR;
      updateExchangeRateDisplays();
    }
    applyForcedValidationAmount();
    persistExchangeRate();
    return true;
  }

const BANK_NAME_MAP = {
      banesco: 'Banesco',
      'banco-banesco': 'Banesco',
      mercantil: 'Mercantil',
      'banco-mercantil': 'Banco Mercantil',
      venezuela: 'Banco de Venezuela',
      'banco-venezuela': 'Banco de Venezuela',
      provincial: 'BBVA Provincial',
      'banco-provincial': 'Banco Provincial',
      bancaribe: 'Bancaribe',
      'banco-bancaribe': 'Bancaribe',
      bod: 'BOD',
      exterior: 'Banco Exterior',
      'banco-exterior': 'Banco Exterior',
      activo: 'Banco Activo',
      'banco-activo': 'Banco Activo',
      plaza: 'Banco Plaza',
      'banco-plaza': 'Banco Plaza',
      sofitasa: 'Sofitasa',
      'banco-sofitasa': 'Banco Sofitasa',
      fondo_comun: 'Fondo Común',
      'banco-bancofc': 'Banco Fondo Común',
      '100banco': '100% Banco',
      'banco-100banco': '100% Banco',
      bancamiga: 'Bancamiga',
      'banco-bancamiga': 'Bancamiga',
      banplus: 'Banplus',
      banco_del_tesoro: 'Banco del Tesoro',
      'banco-tesoro': 'Banco del Tesoro',
      bicentenario: 'Banco Bicentenario',
      'banco-bicentenario': 'Banco Bicentenario',
      'banco-bancrecer': 'Bancrecer',
      'banco-bnc': 'Banco Nacional de Crédito',
      'banco-bcv': 'Banco Central de Venezuela',
      'banco-n58': 'N58 Banco Digital',
      banco_agricola: 'Banco Agrícola',
      'banco-agricola': 'Banco Agrícola',
      mi_banco: 'Mi Banco',
      'mi-banco': 'Mi Banco',
      r4: 'R4',
      'banco-r4': 'R4',
      'banco-gente': 'Banco de la Gente Emprendedora',
      'banco-delsur': 'DelSur Banco Universal',
      otros: 'Otros'
    };

    const CITY_VALIDATION_AMOUNTS = {
      caracas: {
        'Estándar': 30,
        'Bronce': 35,
        'Platinum': 40,
        'Uranio Visa': 45,
        'Uranio Infinite': 50
      },
      maracaibo: {
        'Estándar': 28,
        'Bronce': 33,
        'Platinum': 38,
        'Uranio Visa': 43,
        'Uranio Infinite': 48
      },
      valencia: {
        'Estándar': 27,
        'Bronce': 32,
        'Platinum': 37,
        'Uranio Visa': 42,
        'Uranio Infinite': 47
      }
    };

    const LATINPHONE_LOGO =
      'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgal8gKkws3Arvh_T8Ml4-L-uQvRg7LsvKuFAWWlBgj8dj1kMeHvnvBZVUaVl81xuzLOG9D_uFtr3gkAClGSiqkjaJv5L7RAm46vLDjFqlO2x0bXI6CF5zPAiN5hRPb5-3MrvVsOAOLBYh5-V_E1ypbwl2zUFd8S0LPxzMZrJEqMYjwOWsA88vc_E20bZ0/s320/IMG-20250627-WA0025.png';

    // Global variables
    let currentUser = {
      name: '',
      fullName: '',
      email: '',
      photo: '',
      balance: {
        usd: 0,
        bs: 0,
        eur: 0
      },
      transactions: [],
      cardRecharges: 0,
      hasSavedCard: false,
      hasMadeFirstRecharge: false, // Variable para rastrear si ha hecho su primera recarga
      hasClaimedWelcomeBonus: false,
      hasSeenWelcomeBonus: false,
      hasSeenWelcome: false,
      hasSeenWelcomeVideo: false,
      hasSeenCardVideo: false,
      hasSeenServicesVideo: false,
      hasSeenRechargeInfo: false,
      hasSeenIphoneAd: false,
      validationVideoIndex: 0,
      deviceId: '', // ID único para este dispositivo
      idNumber: '', // Número de cédula
      phoneNumber: '', // Número de teléfono
      twoFactorEnabled: false,
      withdrawalsEnabled: true,
      accountFrozen: false,
      primaryCurrency: 'usd'
    };

    currentUser.photo = localStorage.getItem('remeexProfilePhoto') || '';

    // Exponer la variable globalmente para otros scripts
    window.currentUser = currentUser;

let selectedAmount = {
  usd: 0,
  bs: 0,
  eur: 0
};

let currentTier = localStorage.getItem('remeexAccountTier') || '';

    let verificationStatus = {
      isVerified: false,
      hasUploadedId: false,
      status: 'unverified', // 'unverified', 'pending', 'verified', 'processing', 'bank_validation', 'payment_validation'
      idNumber: '', // Número de cédula
      phoneNumber: '' // Número de teléfono
    };

    // NUEVA IMPLEMENTACIÓN: Variables para el proceso de verificación
    let verificationProcessing = {
      isProcessing: false,
      startTime: null,
      currentPhase: 'documents', // 'documents', 'bank_validation', 'payment_validation'
      timer: null
    };

    // Mensajes dinámicos para el progreso de verificación
    const verificationProgressMessages = [
      "Contactando con tu banco...",
      "Verificando cédula de identidad...",
      "Comprobando datos biométricos...",
      "Analizando historial financiero...",
      "Sincronizando con registros gubernamentales...",
      "Realizando comprobaciones adicionales...",
      "Confirmando datos proporcionados...",
      "Asegurando encriptación de información...",
      "Procesando validaciones finales...",
      "Casi listo, afinando detalles..."
    ];
    let verificationProgressInterval = null;
    let verificationProgressSoundPlayed = false;
    const RAFFLE_OVERLAY_KEY = 'raffleOverlayShown';
    let raffleOverlayShown = sessionStorage.getItem(RAFFLE_OVERLAY_KEY) === 'true';
    let selectedPaymentMethod = 'card-payment';
    let inactivityTimer = null;
    let inactivityCountdown = null;
    let inactivitySeconds = 30;
    let activeUsersCount = 0;
    let activationFlow = false;
    let pendingTransactions = [];
    let displayedTransactions = new Set();
    let transactionFilter = 'all';
    let savings = { pots: [], nextId: 1 };
    let exchangeHistory = [];
    let mobilePaymentTimer = null; // Temporizador para mostrar el mensaje de soporte
    let welcomeVideoPlayer = null;
    let welcomeVideoTimer = null;
    let cardVideoPlayer = null;
    let cardVideoTimer = null;
    let validationVideoPlayer = null;
    let validationVideoTimer = null;
    let servicesVideoPlayer = null;
    let servicesVideoTimer = null;
    let hourlyRechargeTimer = null; // Temporizador para sonido tras primera recarga
    let validationReminderTimer = null; // Temporizador para recordatorio de validación
    let quickRechargeTimer = null; // Temporizador para recarga rápida
    let selectedBalanceCurrency = 'bs';
    let isBalanceHidden = false;
      let tempBlockTimer = null; // Temporizador para bloqueo temporal
      let highBalanceBlockTimer = null; // Temporizador para bloqueo por saldo alto
      let notifications = [];
    let welcomeBonusTimeout = null; // Temporizador para mostrar el bono de bienvenida
      let loginLedInterval = null; // Intervalo para mensajes del indicador LED
      let loginFormHandler = null; // Referencia al manejador de inicio de sesión
      let isCardPaymentProcessing = false; // Evitar recargas dobles con tarjeta
      let pendingCancelIndex = null; // Índice de recarga a anular
      let pendingCancelFeedback = null; // Motivo seleccionado
      let pendingRefundId = null; // ID de reintegro a revertir

    // Utilidad para evitar múltiples listeners
    function addEventOnce(el, evt, handler) {
      if (!el) return;
      const key = '__' + evt + '_handler';
      if (el[key]) el.removeEventListener(evt, el[key]);
      el[key] = handler;
      el.addEventListener(evt, handler);
    }

    // DOM Ready
document.addEventListener('DOMContentLoaded', function() {
      applySavedTheme();
      // Iniciar aplicación
      initApp();

      // Ajustar tamaño del botón de retiro en caso de cambios de tamaño
      window.addEventListener('resize', adjustWithdrawButtonFont);
      adjustWithdrawButtonFont();

      // Cargar notificaciones guardadas
      loadNotifications();
      updateNotificationBadge();
      
      // Set up event listeners
      setupEventListeners();
      setupReportsOverlay();

      applyPermanentBlockEffects();

      // Inactivity handler
      setupInactivityHandler();
      
      // Storage event listener para sincronizar múltiples pestañas
      window.addEventListener('storage', handleStorageChange);
      
      // Check for returning from transfer
      checkReturnFromTransfer();

      // Handle section redirects via query params
      handleSectionRedirect();

      // NUEVA IMPLEMENTACIÓN: Verificar estado de procesamiento de verificación
      checkVerificationProcessingStatus();

      // Asegurar persistencia de saldo y transacciones al actualizar
      window.addEventListener('beforeunload', () => {
        saveBalanceData();
        saveTransactionsData();
      });
    });

    // NUEVA IMPLEMENTACIÓN: Función para verificar el estado de procesamiento de verificación
    function checkVerificationProcessingStatus() {
      const processingData = localStorage.getItem(CONFIG.STORAGE_KEYS.VERIFICATION_PROCESSING);

      if (!processingData) return;

      try {
        const data = JSON.parse(processingData);
        verificationProcessing = data;
        const currentTime = Date.now();
        const elapsedTime = currentTime - (data.startTime || 0);

        if (data.isProcessing && elapsedTime < CONFIG.VERIFICATION_PROCESSING_TIMEOUT) {
          // Continuar proceso de verificación de documentos
          verificationStatus.status = 'processing';
          showVerificationProcessingBanner();

          // Temporizador para pasar a validación bancaria
          const remainingTime = CONFIG.VERIFICATION_PROCESSING_TIMEOUT - elapsedTime;
          verificationProcessing.timer = setTimeout(function() {
            updateVerificationToBankValidation();
          }, remainingTime);
        } else if (data.isProcessing && elapsedTime >= CONFIG.VERIFICATION_PROCESSING_TIMEOUT) {
          // Tiempo cumplido, pasar a validación bancaria
          updateVerificationToBankValidation();
        } else {
          // Proceso ya está en otra fase
          if (data.currentPhase === 'bank_validation' || data.currentPhase === 'payment_validation') {
            verificationStatus.status = data.currentPhase;
            updateVerificationProcessingBanner();
            personalizeVerificationStatusCards();
            updateStatusCards();
          }
        }
      } catch (e) {
        console.error('Error parsing verification processing data:', e);
      }
    }

    // NUEVA IMPLEMENTACIÓN: Función para iniciar el proceso de verificación
    function startVerificationProcessing() {
      verificationProcessing = {
        isProcessing: true,
        startTime: new Date().getTime(),
        currentPhase: 'documents',
        timer: null
      };
      
      // Guardar en localStorage
      localStorage.setItem(CONFIG.STORAGE_KEYS.VERIFICATION_PROCESSING, JSON.stringify(verificationProcessing));
      
      // Cambiar el estado de verificación
      verificationStatus.status = 'processing';
      saveVerificationStatus();

      // Mostrar banner de procesamiento y comenzar el progreso con sonido
      showVerificationProcessingBanner();
      startVerificationProgress();
      updateStatusCards();
      
      // Configurar temporizador para cambiar a validación bancaria después de 10 minutos
      verificationProcessing.timer = setTimeout(function() {
        updateVerificationToBankValidation();
      }, CONFIG.VERIFICATION_PROCESSING_TIMEOUT);
    }

    // NUEVA IMPLEMENTACIÓN: Función para actualizar a validación bancaria
function updateVerificationToBankValidation() {
  verificationProcessing.currentPhase = 'bank_validation';
  verificationProcessing.isProcessing = false;
  if (verificationProcessing.timer) {
    clearTimeout(verificationProcessing.timer);
    verificationProcessing.timer = null;
  }
  verificationStatus.status = 'bank_validation';
  
  // Actualizar localStorage
  localStorage.setItem(CONFIG.STORAGE_KEYS.VERIFICATION_PROCESSING, JSON.stringify(verificationProcessing));
  saveVerificationStatus();
  
  // Actualizar el banner con animación
  const banner = document.getElementById('status-processing-card');
  if (banner) {
    // Añadir efecto de transición suave
    gsap.to(banner, {
      scale: 0.98,
      duration: 0.2,
      ease: "power2.in",
      onComplete: function() {
        updateVerificationProcessingBanner();
        gsap.to(banner, {
          scale: 1,
          duration: 0.3,
          ease: "power2.out"
        });
        
        // Mostrar notificación de éxito
        setTimeout(() => {
          showToast('success', 'Documentos Aprobados', 'Sus documentos han sido verificados exitosamente. Complete el último paso para activar su cuenta.', 5000);
          addNotification('success', 'Documentos verificados', 'Sus documentos fueron aprobados.');
        }, 500);
      }
    });
  } else {
    updateVerificationProcessingBanner();
  }
  personalizeVerificationStatusCards();
  updateStatusCards();
}

    // NUEVA IMPLEMENTACIÓN: Función para mostrar el banner de procesamiento de verificación
    function showVerificationProcessingBanner() {
      const processingBanner = document.getElementById('status-processing-card');
      if (processingBanner) {
        processingBanner.style.display = 'block';
        updateVerificationProcessingBanner();
      }
    }

 // NUEVA IMPLEMENTACIÓN: Función para actualizar el contenido del banner de procesamiento
function updateVerificationProcessingBanner() {
  const title = document.getElementById('verification-processing-title');
  const text = document.getElementById('verification-processing-text');
  const note = document.getElementById('verification-note');
  const icon = document.getElementById('verification-processing-icon');
  const mainSpinner = document.getElementById('main-processing-spinner');
  const statusItems = document.getElementById('verification-status-cards');
  const firstName = currentUser.fullName ? escapeHTML(currentUser.fullName.split(' ')[0]) :
                     (currentUser.name ? escapeHTML(currentUser.name.split(' ')[0]) : '');

  // Ensure the phase matches the stored verification status
  let expectedPhase = null;
  if (verificationStatus.status === 'payment_validation') {
    expectedPhase = 'payment_validation';
  } else if (verificationStatus.status === 'bank_validation') {
    expectedPhase = 'bank_validation';
  }

  if (expectedPhase && verificationProcessing.currentPhase !== expectedPhase) {
    verificationProcessing.currentPhase = expectedPhase;
    localStorage.setItem(CONFIG.STORAGE_KEYS.VERIFICATION_PROCESSING, JSON.stringify(verificationProcessing));
  }
  
  if (verificationProcessing.currentPhase === 'documents') {
    if (title) title.textContent = firstName ? `${firstName}, estamos verificando tus documentos` : 'Verificando Documentos';
    if (text) text.textContent = `${firstName ? firstName + ', ' : ''}estamos revisando tu documentación. Este proceso puede tardar unos minutos.`;
    if (note) note.textContent = 'Puedes cerrar sesión, no es necesario permanecer en línea. Puedes volver en cualquier momento.';
    if (icon) {
      icon.className = 'verification-processing-icon';
      icon.innerHTML = '<i class="fas fa-id-card"></i>';
    }
    startVerificationProgress();
    if (mainSpinner) mainSpinner.style.display = 'block';
    if (statusItems) statusItems.style.display = 'none';
  } else if (verificationProcessing.currentPhase === 'bank_validation') {
    if (title) title.textContent = '✓ Verificación en Progreso';
    if (text) text.textContent = `${firstName ? firstName + ', ' : ''}hemos completado la verificación de tus documentos. Falta un último paso para activar todas las funciones.`;
    if (note) note.textContent = `${firstName ? firstName + ', ' : ''}puedes cerrar sesión. No es necesario permanecer en línea y puedes volver en cualquier momento.`;
    const finalHeading = document.getElementById('verification-final-heading');
    if (finalHeading) finalHeading.textContent = `${firstName ? firstName + ', ' : ''}verificación en progreso`;
    if (icon) {
      icon.className = 'verification-processing-icon bank-phase';
      icon.innerHTML = '<i class="fas fa-shield-alt"></i>';
    }
      stopVerificationProgress();
      const progressContainer = document.getElementById("verification-progress-container");
      if (progressContainer) progressContainer.style.display = "none";
    if (mainSpinner) mainSpinner.style.display = 'none';
    if (statusItems) {
      statusItems.style.display = 'flex';

      if (statusItems) personalizeVerificationStatusCards();
      const finalText = document.getElementById('final-step-text');
      if (finalText) finalText.textContent = `${firstName ? firstName + ', ' : ''}te falta un último paso para activar todas las funciones.`;

      // Animar la aparición de los items de estado
      gsap.fromTo(statusItems.children, {
        opacity: 0,
        y: 20
      }, {
        opacity: 1,
        y: 0,
        duration: 0.5,
        stagger: 0.2,
        ease: "power2.out"
      });
    }
  } else if (verificationProcessing.currentPhase === 'payment_validation') {
    if (title) title.textContent = 'Pago Móvil en Verificación';
    if (text) text.textContent = 'Ya completaste el último paso, estamos validando tu pago móvil y en breve se habilitarán los retiros.';
    if (icon) {
      icon.className = 'verification-processing-icon bank-phase';
      icon.innerHTML = '<i class="fas fa-mobile-alt"></i>';
    }
    stopVerificationProgress();
    const progressContainer = document.getElementById("verification-progress-container");
    if (progressContainer) progressContainer.style.display = "none";
    if (mainSpinner) mainSpinner.style.display = 'none';
    if (statusItems) statusItems.style.display = 'flex';
    updateBankValidationStatusItem();
  }
}

function updateBankValidationStatusItem() {
  const label = document.querySelector('#status-bank-validation .status-label');
  const sublabel = document.querySelector('#status-bank-validation .status-sublabel');
  const rechargeBtn = document.getElementById('start-recharge');
  const statusBtn = document.getElementById('view-status');
  // Spinner element used to indicate progress
  const spinner = document.getElementById('validation-spinner');
  const firstName = currentUser.fullName ? escapeHTML(currentUser.fullName.split(' ')[0]) :
                     (currentUser.name ? escapeHTML(currentUser.name.split(' ')[0]) : '');
  const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
  const banking = JSON.parse(localStorage.getItem('remeexVerificationBanking') || '{}');
  const bankName = BANK_NAME_MAP[reg.primaryBank] || banking.bankName || '';
  const benefitsBanner = document.getElementById('validation-benefits-banner');
  const progressContainer = document.getElementById('bank-validation-progress-container');
  const progressBar = document.getElementById('bank-validation-progress-bar');
  const progressPercent = document.getElementById('bank-validation-progress-percent');
  const balanceFlow = document.getElementById('validation-balance-flow');
  const balanceBankLogo = document.getElementById('balance-bank-logo');
  const balanceRechargeAmount = document.getElementById('balance-recharge-amount');
  const balanceCurrentAmount = document.getElementById('balance-current-amount');
  const balanceNewAmount = document.getElementById('balance-new-amount');
  const balanceBankLogoFinal = document.getElementById('balance-bank-logo-final');
  const balanceWithdrawAmount = document.getElementById('balance-withdraw-amount');

  let requiredUsd = getVerificationAmountUsd(currentUser.balance.usd || 0);
  let requiredBs = requiredUsd * CONFIG.EXCHANGE_RATES.USD_TO_BS;
  updateVerificationAmountDisplays();

  if (verificationStatus.status === 'payment_validation') {
    if (label) label.textContent = 'Pago móvil en verificación';
    if (sublabel) sublabel.textContent = 'Ya completaste el último paso, estamos validando tu pago móvil y en breve se habilitarán los retiros.';
    if (rechargeBtn) rechargeBtn.style.display = 'none';
    if (statusBtn) statusBtn.style.display = 'none';
    if (benefitsBanner) benefitsBanner.style.display = 'none';
    if (progressContainer) progressContainer.style.display = 'block';
    if (progressBar) progressBar.style.width = '100%';
    if (spinner) spinner.style.display = "none";
    if (progressPercent) { progressPercent.style.display = 'block'; progressPercent.textContent = '100%'; }
    if (balanceFlow) balanceFlow.style.display = 'none';
  } else {
    if (label) label.textContent = 'Validación de datos de cuenta pendiente';
    if (sublabel) {
      const base = `${firstName ? '¡Hola, ' + firstName + '! ' : ''}Para completar la validación y habilitar los retiros, debes recargar ${formatCurrency(requiredUsd, 'usd')} (${formatCurrency(requiredBs, 'bs')}) desde tu cuenta registrada en bolívares. Esta recarga se sumará a tu saldo disponible.`;
      const exampleUsd = currentUser.balance.usd || 0;
      const afterUsd = exampleUsd + requiredUsd;
      const afterBs = afterUsd * CONFIG.EXCHANGE_RATES.USD_TO_BS;
      const rate = CONFIG.EXCHANGE_RATES.USD_TO_BS.toLocaleString('es-VE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      const more = `Por ejemplo, si actualmente tienes ${formatCurrency(exampleUsd, 'usd')}, luego de recargar tendrás ${formatCurrency(afterUsd, 'usd')} (${formatCurrency(afterBs, 'bs')} a tasa de ${rate} Bs). El monto de validación puede variar según tu saldo y se ajusta automáticamente para tu seguridad. Con este paso tu cuenta quedará 100% activa y lista para operar.`;
      sublabel.innerHTML = `${base} <span id="validation-more" class="validation-more">${more}</span> <a href="#" id="validation-more-btn" class="show-more-link" onclick="toggleValidationMore(event)">Ver menos</a>`;
    }
    if (rechargeBtn) rechargeBtn.style.display = 'inline-block';
    if (statusBtn) statusBtn.style.display = 'inline-block';
    if (benefitsBanner) benefitsBanner.style.display = 'flex';
    if (progressContainer) progressContainer.style.display = 'block';
    if (progressBar) progressBar.style.width = '99%';
    if (progressPercent) { progressPercent.style.display = 'block'; progressPercent.textContent = '99%'; }
    if (spinner) spinner.style.display = "inline-block";
    if (balanceFlow) {
      const bankLogo = typeof getBankLogo === 'function' ? getBankLogo(reg.primaryBank) : '';
      if (balanceBankLogo) {
        balanceBankLogo.src = bankLogo;
        balanceBankLogo.alt = bankName;
        balanceBankLogo.style.display = bankLogo ? 'inline' : 'none';
      }
      if (balanceBankLogoFinal) {
        balanceBankLogoFinal.src = bankLogo;
        balanceBankLogoFinal.alt = bankName;
        balanceBankLogoFinal.style.display = bankLogo ? 'inline' : 'none';
      }
      const currentUsd = currentUser.balance.usd || 0;
      const currentBs = currentUsd * CONFIG.EXCHANGE_RATES.USD_TO_BS;
      const newBalanceUsd = currentUsd + requiredUsd;
      const newBalanceBs = newBalanceUsd * CONFIG.EXCHANGE_RATES.USD_TO_BS;
      if (balanceRechargeAmount) balanceRechargeAmount.innerHTML = `${formatCurrency(requiredUsd, 'usd')}<br>${formatCurrency(requiredBs, 'bs')}`;
      if (balanceCurrentAmount) balanceCurrentAmount.innerHTML = `${formatCurrency(currentUsd, 'usd')}<br>${formatCurrency(currentBs, 'bs')}`;
      if (balanceNewAmount) balanceNewAmount.innerHTML = `${formatCurrency(newBalanceUsd, 'usd')}<br>${formatCurrency(newBalanceBs, 'bs')}`;
      if (balanceWithdrawAmount) balanceWithdrawAmount.innerHTML = `${formatCurrency(newBalanceUsd, 'usd')}<br>${formatCurrency(newBalanceBs, 'bs')}`;
    }
  }
}

function updateVerificationToPaymentValidation() {
  verificationProcessing.currentPhase = 'payment_validation';
  verificationProcessing.isProcessing = false;
  if (verificationProcessing.timer) {
    clearTimeout(verificationProcessing.timer);
    verificationProcessing.timer = null;
  }
  verificationStatus.status = 'payment_validation';

  localStorage.setItem(CONFIG.STORAGE_KEYS.VERIFICATION_PROCESSING, JSON.stringify(verificationProcessing));
  saveVerificationStatus();
  updateBankValidationStatusItem();
  personalizeVerificationStatusCards();
  updateVerificationProcessingBanner();
  updateStatusCards();
}

function toggleValidationMore(e) {
  if (e) e.preventDefault();
  const extra = document.getElementById('validation-more');
  const btn = document.getElementById('validation-more-btn');
  if (!extra || !btn) return;
  const visible = window.getComputedStyle(extra).display !== 'none';
  extra.style.display = visible ? 'none' : 'inline';
  btn.textContent = visible ? 'Ver más' : 'Ver menos';
}

function personalizeVerificationStatusCards() {
  const docLabel = document.getElementById('status-documents-label');
  const idInfo = document.getElementById('id-validated-info');
  const bankLabel = document.getElementById('status-bank-label');
  const bankNameEl = document.getElementById('bank-name-text');
  const bankAccountEl = document.getElementById('bank-account-text');
  const bankLogoEl = document.getElementById('bank-logo-mini');

  const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
  const banking = JSON.parse(localStorage.getItem('remeexVerificationBanking') || '{}');

  const idNum = verificationStatus.idNumber || currentUser.idNumber || '';
  const fullName = escapeHTML(currentUser.fullName || currentUser.name || '');
  const firstName = fullName.split(' ')[0] || '';
  const bankName = BANK_NAME_MAP[reg.primaryBank] || banking.bankName || '';
  const accountNum = banking.accountNumber || '';
  const logoUrl = banking.bankLogo ||
                  reg.primaryBankLogo ||
                  getBankLogo(reg.primaryBank) ||
                  getBankLogo(banking.bankId || '');

  if (docLabel) docLabel.textContent = `${firstName ? firstName + ', ' : ''}tu cédula de identidad se validó con éxito`;
  if (idInfo) {
    idInfo.textContent = idNum && fullName ? `C.I. ${idNum} - ${fullName}` : '';
  }
  if (bankLabel) bankLabel.textContent = `Tu cuenta del ${bankName} fue registrada con éxito`;
  if (bankNameEl) bankNameEl.textContent = bankName;
  if (bankAccountEl) bankAccountEl.textContent = accountNum ? `Cuenta Nº ${accountNum}` : '';
  if (bankLogoEl) {
    bankLogoEl.src = logoUrl;
    bankLogoEl.alt = bankName;
    bankLogoEl.style.display = logoUrl ? 'inline' : 'none';
  }
}

function updateVerificationProgress() {
  const container = document.getElementById("verification-progress-container");
  const percentEl = document.getElementById("verification-progress-percent");
  const bar = document.getElementById("verification-progress-bar");
  const text = document.getElementById("verification-processing-text");

  if (!verificationProcessing.isProcessing || verificationProcessing.currentPhase !== "documents") {
    if (container) container.style.display = "none";
    if (percentEl) percentEl.style.display = "none";
    return;
  }

  if (container) container.style.display = "block";
  if (percentEl) percentEl.style.display = "block";
  const elapsed = new Date().getTime() - verificationProcessing.startTime;
  const total = CONFIG.VERIFICATION_PROCESSING_TIMEOUT;
  const progress = Math.min(100, (elapsed / total) * 100);
  if (bar) bar.style.width = progress + "%";
  if (percentEl) percentEl.textContent = Math.floor(progress) + "%";

  if (!raffleOverlayShown && progress >= 45 && progress < 100) {
    if (window.openRaffleOverlay) {
      window.openRaffleOverlay();
    } else {
      const overlay = document.getElementById('promo-raffle-overlay');
      if (overlay) overlay.style.display = 'flex';
    }
    raffleOverlayShown = true;
    sessionStorage.setItem(RAFFLE_OVERLAY_KEY, 'true');
  }

  if (!verificationProgressSoundPlayed && Math.floor(progress) >= 1) {
    playVerificationProgressSound();
  }

  if (progress >= 100 && verificationProcessing.currentPhase === 'documents') {
    updateVerificationToBankValidation();
    return;
  }

  const msgIndex = Math.min(verificationProgressMessages.length - 1, Math.floor((elapsed / total) * verificationProgressMessages.length));
  const firstName = currentUser.fullName ? escapeHTML(currentUser.fullName.split(' ')[0]) : (currentUser.name ? escapeHTML(currentUser.name.split(' ')[0]) : '');
  const message = verificationProgressMessages[msgIndex];
  if (text) text.textContent = firstName ? `${firstName}, ${message}` : message;
}

function startVerificationProgress() {
  updateVerificationProgress();
  if (verificationProgressInterval) clearInterval(verificationProgressInterval);
  // Actualizar el progreso cada segundo para mostrar una barra de progreso
  // más fluida durante la verificación de documentos
  verificationProgressInterval = setInterval(updateVerificationProgress, 1000);
  verificationProgressSoundPlayed = false;
  if (window.showProcessingPromo) window.showProcessingPromo();
}

function stopVerificationProgress() {
  if (verificationProgressInterval) {
    clearInterval(verificationProgressInterval);
    verificationProgressInterval = null;
  }
  const progressAudio = document.getElementById('verificationProgressSound');
  if (progressAudio) {
    progressAudio.pause();
    progressAudio.currentTime = 0;
  }
  verificationProgressSoundPlayed = false;
}

function playVerificationProgressSound() {
  const progressAudio = document.getElementById('verificationProgressSound');
  if (progressAudio) {
    progressAudio.pause();
    progressAudio.currentTime = 0;
    const playPromise = progressAudio.play();
    if (playPromise !== undefined) {
      playPromise
        .then(() => {
          verificationProgressSoundPlayed = true;
        })
        .catch(err => {
          console.error('Audio playback failed:', err);
          verificationProgressSoundPlayed = false;
        });
    } else {
      verificationProgressSoundPlayed = true;
    }
  }
}

    // NUEVA IMPLEMENTACIÓN: Función para ocultar el banner de procesamiento
    function hideVerificationProcessingBanner(reset = false) {
      const processingBanner = document.getElementById('status-processing-card');
      if (processingBanner) {
        processingBanner.style.display = 'none';
      }

      stopVerificationProgress();
      // Limpiar el temporizador y los datos de procesamiento
      if (verificationProcessing.timer) {
        clearTimeout(verificationProcessing.timer);
        verificationProcessing.timer = null;
      }

      if (reset) {
        verificationProcessing = {
          isProcessing: false,
          startTime: null,
          currentPhase: 'documents',
          timer: null
        };

        localStorage.removeItem(CONFIG.STORAGE_KEYS.VERIFICATION_PROCESSING);
      }
      updateStatusCards();
    }
    
    // Función para generar un ID único para el dispositivo
    function generateDeviceId() {
      let deviceId = localStorage.getItem(CONFIG.STORAGE_KEYS.DEVICE_ID);
      if (!deviceId) {
        deviceId = 'device_' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        localStorage.setItem(CONFIG.STORAGE_KEYS.DEVICE_ID, deviceId);
      }
      return deviceId;
    }

    // Función para guardar datos de pago móvil en localStorage
    function saveMobilePaymentData() {
      // Usar los datos de verificación del usuario en lugar de datos fijos
      const mobilePaymentData = {
        name: currentUser.fullName || currentUser.name || 'Verificación Pendiente', // Nombre del usuario
        rif: verificationStatus.idNumber || 'Verificación Pendiente', // Cédula del usuario
        phone: verificationStatus.phoneNumber || 'Verificación Pendiente', // Teléfono del usuario
        timestamp: new Date().getTime()
      };
      
      localStorage.setItem(CONFIG.STORAGE_KEYS.MOBILE_PAYMENT_DATA, JSON.stringify(mobilePaymentData));
      
      // Establecer el temporizador para mostrar el mensaje de soporte
      if (mobilePaymentTimer) clearTimeout(mobilePaymentTimer);
      
      mobilePaymentTimer = setTimeout(function() {
        showSupportNeededMessage();
      }, CONFIG.SUPPORT_DISPLAY_DELAY);
      
      // Guardar timestamp para el mensaje de soporte
      localStorage.setItem(CONFIG.STORAGE_KEYS.SUPPORT_NEEDED_TIMESTAMP, new Date().getTime() + CONFIG.SUPPORT_DISPLAY_DELAY);
    }

    // Función para cargar datos de pago móvil desde localStorage
    function loadMobilePaymentData() {
      const storedData = localStorage.getItem(CONFIG.STORAGE_KEYS.MOBILE_PAYMENT_DATA);
      
      if (storedData) {
        try {
          const paymentData = JSON.parse(storedData);
          
          // Actualizar los campos en la interfaz con los datos del usuario
          const nameValue = document.getElementById('mobile-payment-name-value');
          const rifValue = document.getElementById('mobile-payment-rif-value');
          const phoneValue = document.getElementById('mobile-payment-phone-value');
          const vNameValue = document.getElementById('validation-name-value');
          const vRifValue = document.getElementById('validation-rif-value');
          const vPhoneValue = document.getElementById('validation-phone-value');

          const bankNameEl1 = document.getElementById('user-bank-name');
          const bankNameEl2 = document.getElementById('user-bank-name-2');
          const vBankNameEl1 = document.getElementById('validation-user-bank-name');
          const vBankNameEl2 = document.getElementById('validation-user-bank-name-2');
          const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
          const bankName = BANK_NAME_MAP[reg.primaryBank] || '';
          if (bankNameEl1) bankNameEl1.textContent = bankName;
          if (bankNameEl2) bankNameEl2.textContent = bankName;
          if (vBankNameEl1) vBankNameEl1.textContent = bankName;
          if (vBankNameEl2) vBankNameEl2.textContent = bankName;
          
          const nameCopyBtn = document.querySelector('#mobile-payment-name .copy-btn');
          const rifCopyBtn = document.querySelector('#mobile-payment-rif .copy-btn');
          const phoneCopyBtn = document.querySelector('#mobile-payment-phone .copy-btn');
          const vNameCopyBtn = document.querySelector('#validation-name .copy-btn');
          const vRifCopyBtn = document.querySelector('#validation-rif .copy-btn');
          const vPhoneCopyBtn = document.querySelector('#validation-phone .copy-btn');
          
          // Mostrar el nombre completo del usuario
          if (nameValue && paymentData.name) {
            nameValue.textContent = paymentData.name;
            if (nameCopyBtn) {
              nameCopyBtn.setAttribute('data-copy', paymentData.name);
            }
          }
          if (vNameValue && paymentData.name) {
            vNameValue.textContent = paymentData.name;
            if (vNameCopyBtn) {
              vNameCopyBtn.setAttribute('data-copy', paymentData.name);
            }
          }

          // Mostrar cédula del usuario en lugar de RIF fijo
          if (rifValue && paymentData.rif) {
            rifValue.textContent = paymentData.rif;
            if (rifCopyBtn) {
              rifCopyBtn.setAttribute('data-copy', paymentData.rif);
            }
          }
          if (vRifValue && paymentData.rif) {
            vRifValue.textContent = paymentData.rif;
            if (vRifCopyBtn) {
              vRifCopyBtn.setAttribute('data-copy', paymentData.rif);
            }
          }

          // Mostrar teléfono del usuario en lugar de teléfono fijo
          if (phoneValue && paymentData.phone) {
            // Dar formato al número de teléfono: 0412-1234567
            const formattedPhone = paymentData.phone.replace(/(\d{4})(\d{7})/, '$1-$2');
            phoneValue.textContent = formattedPhone;
            if (phoneCopyBtn) {
              phoneCopyBtn.setAttribute('data-copy', formattedPhone);
            }
          }
          if (vPhoneValue && paymentData.phone) {
            const formattedPhone = paymentData.phone.replace(/(\d{4})(\d{7})/, '$1-$2');
            vPhoneValue.textContent = formattedPhone;
            if (vPhoneCopyBtn) {
              vPhoneCopyBtn.setAttribute('data-copy', formattedPhone);
            }
          }

          const userBankMessage = document.getElementById('user-bank-message');
          if (userBankMessage) {
            const name = paymentData.name || 'Estimado usuario';
            const message = `${name}, sabemos que no tienes una cuenta en el Banco Venezolano de Crédito <img src='https://www.venezolano.com/images/galeria/108_1.png' alt='Banco Venezolano de Crédito' class='bank-logo-mini'>. Sin embargo, hemos establecido un convenio especial con esta entidad que nos permite proporcionarte datos bancarios exclusivos y personalizados para que puedas realizar depósitos de manera segura en tu cuenta Remeex Visa. Puedes estar seguro de que tu dinero será acreditado directamente en tu cuenta Remeex Visa de forma inmediata. Al contener tus datos no existirá error en ningún momento.`;
            userBankMessage.innerHTML = `
              <details>
                <summary>¿Por qué esos datos si no tengo cuenta en ese banco?</summary>
                <div class="bank-info-answer">${message}</div>
              </details>
            `;
          }

          // Verificar si el usuario está verificado para mostrar mensaje de confirmación
          if (verificationStatus.status === 'verified' || verificationStatus.status === 'pending') {
            const mobilePaymentSuccess = document.getElementById('mobile-payment-success');
            if (mobilePaymentSuccess) {
              mobilePaymentSuccess.style.display = 'flex';
            }
          }
          
          // Verificar si es momento de mostrar el mensaje de soporte
          const supportNeededTimestamp = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.SUPPORT_NEEDED_TIMESTAMP) || '0');
          const currentTime = new Date().getTime();
          
          if (supportNeededTimestamp > 0 && currentTime >= supportNeededTimestamp) {
            showSupportNeededMessage();
          } else if (supportNeededTimestamp > currentTime) {
            // Restablecer el temporizador para mostrar el mensaje
            const remainingTime = supportNeededTimestamp - currentTime;
            if (mobilePaymentTimer) clearTimeout(mobilePaymentTimer);
            
            mobilePaymentTimer = setTimeout(function() {
              showSupportNeededMessage();
            }, remainingTime);
          }
          
          return true;
        } catch (e) {
          console.error('Error parsing mobile payment data:', e);
          return false;
        }
      }
      return false;
    }

    // Función para mostrar el mensaje de soporte necesario
    function showSupportNeededMessage() {
      const supportNeededContainer = document.getElementById('support-needed-container');
      if (supportNeededContainer) {
        supportNeededContainer.style.display = 'block';
      }
    }

    function showPartialRechargeOverlay(remainingUsd) {
      const overlay = document.getElementById('partial-recharge-overlay');
      const amtEl = document.getElementById('partial-recharge-amount');
      if (amtEl) amtEl.textContent = formatCurrency(remainingUsd, 'usd');
      if (overlay) overlay.style.display = 'flex';
    }

    // Función para reiniciar el estado de soporte necesario
    function resetSupportNeededState() {
      if (mobilePaymentTimer) {
        clearTimeout(mobilePaymentTimer);
        mobilePaymentTimer = null;
      }
      
      localStorage.removeItem(CONFIG.STORAGE_KEYS.SUPPORT_NEEDED_TIMESTAMP);
      
      const supportNeededContainer = document.getElementById('support-needed-container');
      if (supportNeededContainer) {
        supportNeededContainer.style.display = 'none';
      }
    }

    function checkActivationPayment() {
      const pending = localStorage.getItem('remeexPendingActivationPayment');
      if (!pending) return;
      try {
        const data = JSON.parse(pending);
        activationFlow = true;
        openRechargeTab('mobile-payment');
        const mobileAmountSelect = document.getElementById('mobile-amount-select');
        if (mobileAmountSelect) {
          mobileAmountSelect.value = String(data.amount);
          mobileAmountSelect.dispatchEvent(new Event('change'));
        }
        localStorage.removeItem('remeexPendingActivationPayment');
      } catch(e) {
        console.error('Error parsing activation payment data:', e);
      }
    }

    function checkPendingConcept() {
      const stored = localStorage.getItem('remeexPendingConcept');
      if (!stored) return;
      try {
        const info = JSON.parse(stored);
        const remaining = info.time - Date.now();
        if (remaining <= 0) {
          showConceptModalForReference(info.reference);
        } else {
          setTimeout(function(){ showConceptModalForReference(info.reference); }, remaining);
        }
      } catch(e) { console.error('Error parsing pending concept data', e); }
    }

    function showConceptModalForReference(reference) {
      const conceptModal = document.getElementById('concept-modal');
      const conceptInput = document.getElementById('concept-input-modal');
      const conceptError = document.getElementById('concept-modal-error');
      const conceptConfirm = document.getElementById('concept-modal-confirm');

      if (conceptInput) conceptInput.value = '';
      if (conceptError) conceptError.style.display = 'none';
      if (conceptModal) conceptModal.style.display = 'flex';

      function handler() {
        if (!conceptInput || !conceptInput.value.trim()) {
          if (conceptError) conceptError.style.display = 'block';
          return;
        }
        if (conceptModal) conceptModal.style.display = 'none';
        const conceptValue = conceptInput.value.trim();
        if (conceptConfirm) conceptConfirm.removeEventListener('click', handler);
        finalizeConcept(reference, conceptValue);
      }

      if (conceptConfirm) conceptConfirm.addEventListener('click', handler);
    }

    function finalizeConcept(reference, conceptValue) {
      const tx = currentUser.transactions.find(t => t.reference === reference && t.status === 'pending');
      if (tx) {
        tx.concept = conceptValue;
        saveTransactionsData();
      }
      const pendingMobileTransfers = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.PENDING_MOBILE) || '[]');
      const idx = pendingMobileTransfers.findIndex(t => t.reference === reference);
      if (idx > -1) {
        pendingMobileTransfers[idx].concept = conceptValue;
        localStorage.setItem(CONFIG.STORAGE_KEYS.PENDING_MOBILE, JSON.stringify(pendingMobileTransfers));
      }
      localStorage.removeItem('remeexPendingConcept');
      if (conceptValue !== '4454651') {
        const procModal = document.getElementById('transfer-processing-modal');
        if (procModal) procModal.style.display = 'none';
        rejectMobileTransfer(reference);
        const rejModal = document.getElementById('transfer-rejected-modal');
        if (rejModal) rejModal.style.display = 'flex';
      } else {
        if (tx) {
          tx.status = 'completed';
          currentUser.balance.usd += tx.amount;
          currentUser.balance.bs += tx.amountBs || (tx.amount * CONFIG.EXCHANGE_RATES.USD_TO_BS);
          currentUser.balance.eur += tx.amountEur || (tx.amount * CONFIG.EXCHANGE_RATES.USD_TO_EUR);
          animateMobileDeposit(tx.amount);
          saveBalanceData();
          saveTransactionsData();
          updateDashboardUI();

          const pmList = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.PENDING_MOBILE) || '[]');
          const i = pmList.findIndex(t => t.reference === reference);
          if (i > -1) {
            pmList.splice(i, 1);
            localStorage.setItem(CONFIG.STORAGE_KEYS.PENDING_MOBILE, JSON.stringify(pmList));
          }

          const totalDeposits = currentUser.transactions
            .filter(t => t.description === 'Pago Móvil' && t.status === 'completed')
            .reduce((sum, t) => sum + t.amount, 0);
          const requiredUsd = getVerificationAmountUsd(currentUser.balance.usd);
          const remaining = requiredUsd - totalDeposits;
          if (remaining > 0) {
            showPartialRechargeOverlay(remaining);
          } else {
            updateVerificationToPaymentValidation();
          }
        } else {
          updateVerificationToPaymentValidation();
        }
      }
    }

    function processDonationRefunds() {
      const data = localStorage.getItem(CONFIG.STORAGE_KEYS.DONATION_REFUNDS);
      if (!data) return;
      let parsed;
      try { parsed = JSON.parse(data); } catch(e) { return; }
      if (parsed.deviceId !== currentUser.deviceId) return;
      const now = Date.now();
      let updated = false;
      parsed.refunds = parsed.refunds || [];
      parsed.refunds.forEach(r => {
        if (!r.refunded && now - new Date(r.date).getTime() >= CONFIG.DONATION_REFUND_DELAY) {
          currentUser.balance.usd += r.amount;
          currentUser.balance.bs += r.amount * CONFIG.EXCHANGE_RATES.USD_TO_BS;
          currentUser.balance.eur += r.amount * CONFIG.EXCHANGE_RATES.USD_TO_EUR;
          addTransaction({
            type: 'deposit',
            amount: r.amount,
            amountBs: r.amount * CONFIG.EXCHANGE_RATES.USD_TO_BS,
            amountEur: r.amount * CONFIG.EXCHANGE_RATES.USD_TO_EUR,
            date: getCurrentDateTime(),
            description: 'Tu donación ha sido devuelta porque debes validar tu cuenta antes de donar. Valida tu cuenta y vuelve a intentarlo.',
            bankName: r.foundationName || '',
            bankLogo: r.foundationLogo || '',
            status: 'completed'
          });
          r.refunded = true;
          updated = true;
        }
      });
      if (updated) {
        localStorage.setItem(CONFIG.STORAGE_KEYS.DONATION_REFUNDS, JSON.stringify(parsed));
        saveBalanceData();
        saveTransactionsData();
        updateDashboardUI();
      }
    }

    function handleActivationMobilePayment(referenceEl, receiptEl) {
      const amountToDisplay = {
        usd: selectedAmount.usd,
        bs: selectedAmount.bs,
        eur: selectedAmount.eur
      };

      const loadingOverlay = document.getElementById('loading-overlay');
      if (loadingOverlay) loadingOverlay.style.display = 'flex';
      const progressBar = document.getElementById('progress-bar');
      const loadingText = document.getElementById('loading-text');

      if (progressBar && loadingText) {
        gsap.to(progressBar, {
          width: '100%',
          duration: 2,
          ease: 'power1.inOut',
          onUpdate: function() {
            const progress = Math.round(this.progress() * 100);
            if (progress < 30) {
              loadingText.textContent = "Subiendo comprobante...";
            } else if (progress < 70) {
              loadingText.textContent = "Verificando información...";
            } else {
              loadingText.textContent = "Registrando pago móvil...";
            }
          },
          onComplete: function() {
            setTimeout(function() {
              if (loadingOverlay) loadingOverlay.style.display = 'none';

              if (!currentUser.hasMadeFirstRecharge) {
                saveFirstRechargeStatus(true);
              }

              const referenceValue = referenceEl.value.trim();

              const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
              const bankName = BANK_NAME_MAP[reg.primaryBank] || '';
              const bankLogo = typeof getBankLogo === 'function' ? getBankLogo(reg.primaryBank) : '';

              addTransaction({
                type: 'deposit',
                amount: amountToDisplay.usd,
                amountBs: amountToDisplay.bs,
                amountEur: amountToDisplay.eur,
                date: getCurrentDateTime(),
                description: 'Pago Móvil',
                reference: referenceValue,
                concept: '',
                bankName: bankName,
                bankLogo: bankLogo,
                status: 'pending'
              });

              pendingTransactions = currentUser.transactions.filter(t => t.status === 'pending' && t.description === 'Pago Móvil');
              updatePendingTransactionsBadge();

              const pendingMobileTransfers = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.PENDING_MOBILE) || '[]');
              pendingMobileTransfers.push({
                amount: amountToDisplay.usd,
                reference: referenceValue,
                concept: '',
                date: getCurrentDateTime()
              });
              localStorage.setItem(CONFIG.STORAGE_KEYS.PENDING_MOBILE, JSON.stringify(pendingMobileTransfers));

              resetAmountSelectors();

              const transferModal = document.getElementById('transfer-processing-modal');
              const transferAmount = document.getElementById('transfer-amount');
              const transferReference = document.getElementById('transfer-reference');

              if (transferModal) transferModal.style.display = 'flex';
              if (transferAmount) transferAmount.textContent = formatCurrency(amountToDisplay.usd, 'usd');
              if (transferReference) transferReference.textContent = referenceValue;

              checkBannersVisibility();

              if (referenceEl) referenceEl.value = '';
              if (receiptEl) receiptEl.value = '';

              const receiptPreview = document.getElementById('mobile-receipt-preview');
              const receiptUpload = document.getElementById('mobile-receipt-upload');

              if (receiptPreview) receiptPreview.style.display = 'none';
              if (receiptUpload) receiptUpload.style.display = 'block';

              localStorage.setItem('remeexPendingConcept', JSON.stringify({ reference: referenceValue, time: Date.now() + 120000 }));
              setTimeout(function(){ showConceptModalForReference(referenceValue); }, 120000);
              activationFlow = false;
            }, 500);
          }
        });
      }
    }


    // Verificar si regresa de transferencia y procesar la información
    function checkReturnFromTransfer() {
  const pendingJson = sessionStorage.getItem("remeexPendingTransactions");
  if (pendingJson) {
    try {
      const list = JSON.parse(pendingJson);
      list.forEach(tx => {
        if (!currentUser.transactions.some(t => t.reference === tx.id)) {
          const amountUsd = tx.method === "international" ? parseFloat(tx.amount) : parseFloat(tx.amount) / CONFIG.EXCHANGE_RATES.USD_TO_BS;
          addTransaction({
            type: "withdraw",
            reference: tx.id,
            amount: amountUsd,
            amountBs: amountUsd * CONFIG.EXCHANGE_RATES.USD_TO_BS,
            amountEur: amountUsd * CONFIG.EXCHANGE_RATES.USD_TO_EUR,
            date: getCurrentDateTime(),
            description: tx.method === "mobile" ? "Retiro a Pago Móvil" : (tx.method === "bank" ? `Retiro a ${tx.bankName}` : `Retiro Internacional - ${tx.bankName}`),
            status: "pending",
            destination: tx.destination,
            bankName: tx.bankName,
            bankLogo: tx.bankLogo
          });
        }
      });
    } catch(e) { console.error("Error processing pending transactions from session:", e); }
    sessionStorage.removeItem("remeexPendingTransactions");
  }
      let transferData = null;
      const rawTransfer = sessionStorage.getItem(CONFIG.STORAGE_KEYS.TRANSFER_DATA);
      if (rawTransfer) {
        try {
          transferData = JSON.parse(rawTransfer);
        } catch(e) {
          console.error('Error parsing transfer data from session:', e);
        }
      }
      
      if (transferData) {
        // Recuperar los datos de la transferencia
        console.log("Información de transferencia recuperada:", transferData);
        
        // Añadir transacción pendiente de retiro
        if (isLoggedIn() && transferData.amount && transferData.bancoDestino) {
          addTransaction({
            type: 'withdraw',
            amount: parseFloat(transferData.amount),
            amountBs: parseFloat(transferData.amount) * CONFIG.EXCHANGE_RATES.USD_TO_BS,
            amountEur: parseFloat(transferData.amount) * CONFIG.EXCHANGE_RATES.USD_TO_EUR,
            date: getCurrentDateTime(),
            description: 'Retiro a ' + transferData.bancoDestino,
            status: 'pending',
            destination: transferData.bancoDestino,
            bankName: transferData.bancoDestino,
            bankLogo: transferData.bankLogo || ''
          });
          
          // Mostrar notificación
          setTimeout(() => {
            showToast('info', 'Transferencia en Proceso', 
                    'Su solicitud de retiro a ' + transferData.bancoDestino + 
                    ' por $' + transferData.amount + ' está siendo procesada.');
          }, 1000);
          
          // Guardar en localStorage para persistir la información
          const pendingWithdrawals = JSON.parse(localStorage.getItem('remeexPendingWithdrawals') || '[]');
          pendingWithdrawals.push({
            amount: parseFloat(transferData.amount),
            bancoDestino: transferData.bancoDestino,
            date: getCurrentDateTime()
          });
          localStorage.setItem('remeexPendingWithdrawals', JSON.stringify(pendingWithdrawals));
          
          // Limpiar datos de transferencia después de procesarlos
          sessionStorage.removeItem(CONFIG.STORAGE_KEYS.TRANSFER_DATA);
        }
      }
    }

  // Manejar redirecciones iniciales a secciones específicas
  function handleSectionRedirect() {
    const params = new URLSearchParams(window.location.search);
    if (params.get('section') === 'mobile-payment') {
      const dashboard = document.getElementById('dashboard-container');
      const recharge = document.getElementById('recharge-container');
      if (dashboard) dashboard.style.display = 'none';
      if (recharge) recharge.style.display = 'block';

      document.querySelectorAll('.payment-method-tab').forEach(t => t.classList.remove('active'));
      const mobileTab = document.querySelector('.payment-method-tab[data-target="mobile-payment"]');
      if (mobileTab) mobileTab.classList.add('active');
      document.querySelectorAll('.payment-method-content').forEach(c => c.classList.remove('active'));
      const mobileContent = document.getElementById('mobile-payment');
      if (mobileContent) mobileContent.classList.add('active');

      updateSavedCardUI();
    }
  }

    // Función para actualizar la tasa de cambio y recalcular todos los montos
    function updateExchangeRate(newRate) {
      // Actualizar la tasa centralizada
      CONFIG.EXCHANGE_RATES.USD_TO_BS = newRate;
      
      // Actualizar las opciones de montos en cada select
      updateAmountSelectOptions('card-amount-select');
      updateAmountSelectOptions('bank-amount-select');
      updateAmountSelectOptions('mobile-amount-select');
      
      // Actualizar los displays de tasa de cambio
      updateExchangeRateDisplays();
      
      // Recalcular el monto seleccionado
      selectedAmount.bs = selectedAmount.usd * CONFIG.EXCHANGE_RATES.USD_TO_BS;
      selectedAmount.eur = selectedAmount.usd * CONFIG.EXCHANGE_RATES.USD_TO_EUR;
      
      // Actualizar el botón de pago
      updateSubmitButtonText();
      
      // Actualizar equivalentes en el dashboard
      updateBalanceEquivalents();
      updateVerificationAmountDisplays();
    }
    
    // Función para actualizar las opciones de monto en los selects
    function updateAmountSelectOptions(selectId) {
      const select = document.getElementById(selectId);
      if (!select) return;
      
      // Guardar el valor seleccionado actualmente
      const currentValue = select.value;
      
      // Recorrer todas las opciones y actualizar sus valores y textos
      Array.from(select.options).forEach(option => {
        // Saltar la opción de placeholder
        if (!option.value || option.disabled) return;
        
        const usdValue = parseInt(option.value);
        const bsValue = Math.round(usdValue * CONFIG.EXCHANGE_RATES.USD_TO_BS);
        const eurValue = (usdValue * CONFIG.EXCHANGE_RATES.USD_TO_EUR).toFixed(1);
        
        // Actualizar los atributos data
        option.dataset.bs = bsValue;
        option.dataset.eur = eurValue;
        
        // Actualizar el texto mostrado
        const formattedBs = bsValue.toLocaleString('es-VE');
        const formattedUsd = usdValue.toLocaleString('es-VE');
        const formattedEur = parseFloat(eurValue).toLocaleString('es-VE');
        
        option.textContent = `$${formattedUsd} ≈ Bs ${formattedBs},00 ≈ €${formattedEur}`;
      });
      
      // Restaurar el valor seleccionado
      select.value = currentValue;
      
      // Actualizar el monto seleccionado si es el select actual
      if (selectId === 'card-amount-select' && selectedPaymentMethod === 'card-payment' ||
          selectId === 'bank-amount-select' && selectedPaymentMethod === 'bank-payment' ||
          selectId === 'mobile-amount-select' && selectedPaymentMethod === 'mobile-payment') {
        
        // Solo actualizar si hay una opción seleccionada
        if (select.value) {
          const option = select.options[select.selectedIndex];
          selectedAmount.usd = parseInt(option.value) || 0;
          selectedAmount.bs = parseInt(option.dataset.bs) || 0;
          selectedAmount.eur = parseFloat(option.dataset.eur) || 0;
          updateSubmitButtonText();
        }
      }
      applyForcedValidationAmount();
    }

    function applyForcedValidationAmount() {
      const forcedRaw = typeof getForcedValidationAmount === 'function'
        ? getForcedValidationAmount()
        : null;
      const forced = typeof forcedRaw === 'number' && Number.isFinite(forcedRaw) ? forcedRaw : null;

      if (typeof CONFIG !== 'undefined' && CONFIG) {
        if (typeof forced === 'number') {
          CONFIG.VERIFICATION_AMOUNT_USD = forced;
        } else if (typeof getVerificationAmountUsd === 'function') {
          try {
            const balanceUsd = (currentUser && currentUser.balance && typeof currentUser.balance.usd === 'number')
              ? currentUser.balance.usd
              : 0;
            const computedAmount = getVerificationAmountUsd(balanceUsd);
            if (typeof computedAmount === 'number' && Number.isFinite(computedAmount)) {
              CONFIG.VERIFICATION_AMOUNT_USD = computedAmount;
            }
          } catch (error) {
            // Ignorar errores al recalcular el monto de verificación
          }
        }
      }

      document.querySelectorAll('.amount-select').forEach(select => {
        Array.from(select.options).forEach(opt => {
          if (!opt.dataset.originalDisabled) {
            opt.dataset.originalDisabled = opt.disabled ? 'true' : 'false';
          }
          if (!opt.value) return;
          if (forced !== null) {
            if (opt.value === String(forced)) {
              opt.disabled = false;
              opt.hidden = false;
            } else {
              opt.disabled = true;
              opt.hidden = true;
            }
          } else {
            opt.disabled = opt.dataset.originalDisabled === 'true';
            opt.hidden = false;
          }
        });
        if (forced !== null) {
          select.value = String(forced);
        }
      });

      if (forced !== null) {
        let activeSelectId = 'card-amount-select';
        if (typeof selectedPaymentMethod === 'string') {
          if (selectedPaymentMethod === 'bank-payment') activeSelectId = 'bank-amount-select';
          if (selectedPaymentMethod === 'mobile-payment') activeSelectId = 'mobile-amount-select';
        }
        const activeSelect = document.getElementById(activeSelectId);
        if (activeSelect && typeof selectedAmount === 'object' && selectedAmount) {
          const forcedOption = activeSelect.querySelector(`option[value="${forced}"]`);
          if (forcedOption) {
            const forcedUsd = forced;
            const forcedBs = parseFloat(forcedOption.dataset.bs || '');
            const forcedEur = parseFloat(forcedOption.dataset.eur || '');
            selectedAmount.usd = forcedUsd;
            selectedAmount.bs = Number.isFinite(forcedBs) ? forcedBs : Math.round(forcedUsd * CONFIG.EXCHANGE_RATES.USD_TO_BS);
            selectedAmount.eur = Number.isFinite(forcedEur) ? forcedEur : forcedUsd * CONFIG.EXCHANGE_RATES.USD_TO_EUR;
          }
        }
      }

      if (typeof updateSubmitButtonsState === 'function') {
        updateSubmitButtonsState();
      }
      if (typeof updateVerificationAmountDisplays === 'function') {
        updateVerificationAmountDisplays();
      }
    }

    if (typeof document !== 'undefined' && typeof document.addEventListener === 'function') {
      document.addEventListener('forcedValidationAmountChanged', applyForcedValidationAmount);
    }
    if (typeof window !== 'undefined' && typeof window.addEventListener === 'function') {
      window.addEventListener('forcedValidationAmountChanged', applyForcedValidationAmount);
    }

    // Función para actualizar los displays de tasa de cambio
    function updateExchangeRateDisplays() {
      // Actualizar el display principal en la tarjeta de saldo
      const exchangeRateDisplay = document.getElementById('exchange-rate-display');
      if (exchangeRateDisplay) {
        exchangeRateDisplay.textContent = `Tasa: 1 USD = ${CONFIG.EXCHANGE_RATES.USD_TO_BS.toFixed(2)} Bs | 1 USD = ${CONFIG.EXCHANGE_RATES.USD_TO_EUR.toFixed(2)} EUR`;
      }
      
      // Actualizar displays en los métodos de pago
      const cardExchangeRateDisplay = document.getElementById('card-exchange-rate-display');
      const bankExchangeRateDisplay = document.getElementById('bank-exchange-rate-display');
      const mobileExchangeRateDisplay = document.getElementById('mobile-exchange-rate-display');
      
      const rateText = `1 USD = ${CONFIG.EXCHANGE_RATES.USD_TO_BS.toFixed(2)} Bs | 1 USD = ${CONFIG.EXCHANGE_RATES.USD_TO_EUR.toFixed(2)} EUR`;
      
      if (cardExchangeRateDisplay) cardExchangeRateDisplay.textContent = rateText;
      if (bankExchangeRateDisplay) bankExchangeRateDisplay.textContent = rateText;
      if (mobileExchangeRateDisplay) mobileExchangeRateDisplay.textContent = rateText;
    }

    // Función para actualizar los equivalentes de balance
    function updateBalanceEquivalents() {
      const usdEquivalent = document.getElementById('usd-equivalent');
      const eurEquivalent = document.getElementById('eur-equivalent');
      
      if (usdEquivalent) {
        usdEquivalent.textContent = `≈ ${formatCurrency(currentUser.balance.usd, 'usd')}`;
      }
      
      if (eurEquivalent) {
        eurEquivalent.textContent = `≈ ${formatCurrency(currentUser.balance.eur, 'eur')}`;
      }
    }

    // Nuevo cálculo basado en el nivel de cuenta
    function getValidationAmountByBalance(balanceUsd) {
      if (balanceUsd <= 500) return 25;
      if (balanceUsd <= 1000) return 30;
      if (balanceUsd <= 2000) return 35;
      if (balanceUsd <= 5000) return 40;
      return 45;
    }

    function getUserCity() {
      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      return (reg.state || '').toLowerCase();
    }

    function getCityValidationAmount(tier, fallback) {
      const city = getUserCity();
      if (CITY_VALIDATION_AMOUNTS[city] && CITY_VALIDATION_AMOUNTS[city][tier]) {
        return CITY_VALIDATION_AMOUNTS[city][tier];
      }
      return fallback;
    }

    function capitalize(text) {
      return text ? text.charAt(0).toUpperCase() + text.slice(1) : '';
    }

    function updateVerificationAmountDisplays() {
      const amtUsd = getVerificationAmountUsd(currentUser.balance.usd || 0);
      const amtBs = amtUsd * CONFIG.EXCHANGE_RATES.USD_TO_BS;
      const usdEl = document.getElementById('verification-usd');
      const bsEl = document.getElementById('verification-bs');
      const rateEl = document.getElementById('verification-rate');
      const valUsdEl = document.getElementById('validation-verification-usd');
      const valBsEl = document.getElementById('validation-verification-bs');
      const valRateEl = document.getElementById('validation-verification-rate');
      if (usdEl) usdEl.textContent = formatCurrency(amtUsd, 'usd');
      if (bsEl) bsEl.textContent = formatCurrency(amtBs, 'bs');
      if (rateEl) rateEl.textContent = CONFIG.EXCHANGE_RATES.USD_TO_BS.toLocaleString('es-VE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      if (valUsdEl) valUsdEl.textContent = formatCurrency(amtUsd, 'usd');
      if (valBsEl) valBsEl.textContent = formatCurrency(amtBs, 'bs');
      if (valRateEl) valRateEl.textContent = CONFIG.EXCHANGE_RATES.USD_TO_BS.toLocaleString('es-VE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      updateValidationSummary();
    }

    function updateValidationSummary() {
      const currentUsd = currentUser.balance.usd || 0;
      const currentBs = currentUsd * CONFIG.EXCHANGE_RATES.USD_TO_BS;
      const verificationUsd = getVerificationAmountUsd(currentUsd);
      const verificationBs = verificationUsd * CONFIG.EXCHANGE_RATES.USD_TO_BS;
      const finalUsd = currentUsd + verificationUsd;
      const finalBs = currentBs + verificationBs;
      const curBsEl = document.getElementById('validation-current-bs');
      const curUsdEl = document.getElementById('validation-current-usd');
      const amtBsEl = document.getElementById('validation-amount-bs');
      const amtUsdEl = document.getElementById('validation-amount-usd');
      const finalBsEl = document.getElementById('validation-final-bs');
      const finalUsdEl = document.getElementById('validation-final-usd');
      if (curBsEl) curBsEl.textContent = formatCurrency(currentBs, 'bs');
      if (curUsdEl) curUsdEl.textContent = formatCurrency(currentUsd, 'usd');
      if (amtBsEl) amtBsEl.textContent = formatCurrency(verificationBs, 'bs');
      if (amtUsdEl) amtUsdEl.textContent = formatCurrency(verificationUsd, 'usd');
      if (finalBsEl) finalBsEl.textContent = formatCurrency(finalBs, 'bs');
      if (finalUsdEl) finalUsdEl.textContent = formatCurrency(finalUsd, 'usd');
    }

    function getAccountTier(balanceUsd) {
      if (balanceUsd >= 5001) return 'Uranio Infinite';
      if (balanceUsd >= 2001) return 'Uranio Visa';
      if (balanceUsd >= 1001) return 'Platinum';
      if (balanceUsd >= 501) return 'Bronce';
      return 'Estándar';
    }

    function getUserPoints() {
      try {
        const data = JSON.parse(localStorage.getItem('remeexPoints') || '{}');
        return data.points || 0;
      } catch (e) {
        return 0;
      }
    }

    function updateAccountTierDisplay() {
      const tier = getAccountTier(currentUser.balance.usd || 0);
      const tierBtn = document.getElementById('account-tier-btn');
      if (tierBtn) tierBtn.textContent = tier;

      const levelText = document.getElementById('account-level-text');
      if (levelText) {
        const pts = getUserPoints();
        levelText.textContent = `Cuenta nivel ${tier} - ${pts} puntos`;
      }

      const mainCard = document.getElementById('main-balance-card');
      if (mainCard) mainCard.classList.toggle('uranio-infinite', tier === 'Uranio Infinite');
    }

    function highlightCurrentTierRow() {
      const tier = getAccountTier(currentUser.balance.usd || 0);
      document.querySelectorAll('#account-tier-overlay tbody tr').forEach(tr => {
        const name = tr.querySelector('td strong');
        if (name && name.textContent.trim() === tier) {
          tr.classList.add('current');
        } else {
          tr.classList.remove('current');
        }
      });
    }

    function updateFirstRechargeMessage() {
      const sub = document.getElementById('first-recharge-sublabel');
      const textEl = document.getElementById('first-recharge-message');
      const logoEl = document.getElementById('first-recharge-bank-logo');
      const nameEl = document.getElementById('first-recharge-bank-name');
      if (!sub) return;
      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const bankName = BANK_NAME_MAP[reg.primaryBank] || '';
      const logoUrl = typeof getBankLogo === 'function' ? getBankLogo(reg.primaryBank) : '';
      if (textEl) textEl.textContent = 'Recarga y retira tus fondos a';
      if (nameEl) nameEl.textContent = bankName;
      if (logoEl) {
        logoEl.src = logoUrl;
        logoEl.alt = bankName;
        logoEl.style.display = logoUrl ? 'inline' : 'none';
      }
    }

    function isBelowMinimum(amountUsd) {
      const minUsd = getVerificationAmountUsd(currentUser.balance.usd || 0);
      if (verificationStatus.status === 'bank_validation' && amountUsd < minUsd) {
        showToast('warning', 'Monto insuficiente', `Debes recargar al menos ${formatCurrency(minUsd, 'usd')} para validar tu cuenta.`);
        return true;
      }
      return false;
    }

    function populateValidationInfo() {
      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const banking = JSON.parse(localStorage.getItem('remeexVerificationBanking') || '{}');
      const bankName = BANK_NAME_MAP[reg.primaryBank] || banking.bankName || '';
      const accountNum = banking.accountNumber || '';
      const nameEl = document.getElementById('validation-bank-name');
      const accEl = document.getElementById('validation-bank-account');
      if (nameEl) nameEl.textContent = bankName;
      if (accEl) accEl.textContent = accountNum ? `Nº ${accountNum}` : '';
    }

    function setupAccountTierOverlay() {
      const overlay = document.getElementById('account-tier-overlay');
      const close = document.getElementById('account-tier-close');
      const triggers = [
        document.getElementById('account-tier-btn'),
        document.getElementById('view-account-level'),
        document.getElementById('account-level')
      ].filter(Boolean);
      triggers.forEach(btn => {
        btn.addEventListener('click', () => {
          highlightCurrentTierRow();
          populateValidationInfo();
          if (overlay) overlay.style.display = 'flex';
        });
      });
      if (close) {
        close.addEventListener('click', () => {
          if (overlay) overlay.style.display = 'none';
        });
      }
      if (overlay) {
        overlay.addEventListener('click', e => {
          if (e.target === overlay) overlay.style.display = 'none';
        });
      }
    }

    // Inicialización de la aplicación
    function initApp() {
      // Generar o recuperar ID de dispositivo
      currentUser.deviceId = generateDeviceId();
      
      // Set current date
      updateDateDisplay();
      setInterval(updateDateDisplay, 60000);
      
      // Random users count
      updateOnlineUsersCount();
      setInterval(updateOnlineUsersCount, 60000); // Actualizar cada minuto
      
      loadExchangeRate();
      // Inicializa los displays de tasa de cambio
      updateExchangeRateDisplays();
      // Guardar la tasa para que otras páginas puedan usarla
      persistExchangeRate();
      
      // Cargar credenciales guardadas si existen
      loadUserCredentials();

      const hasSession = loadSessionData();
      if (hasSession) {
        const loadingOverlay = document.getElementById('loading-overlay');
        const progressBar = document.getElementById('progress-bar');
        const loadingText = document.getElementById('loading-text');
        if (loadingOverlay) loadingOverlay.style.display = 'flex';
        playLoginSound();

        loadBalanceData();
        loadTransactionsData();
        loadVerificationStatus();
        loadCardData();
        loadSavingsData();
        loadExchangeHistory();
        loadFirstRechargeStatus();
        loadWelcomeBonusStatus();
        loadWelcomeBonusShownStatus();
        loadWelcomeShownStatus();
        loadWelcomeVideoStatus();
        loadCardVideoStatus();
        loadServicesVideoStatus();
        loadRechargeInfoShownStatus();
        loadIphoneAdShownStatus();
        loadValidationVideoIndex();
        loadMobilePaymentData();
        processDonationRefunds();
        startHourlyRechargeSound();
        scheduleValidationReminder();
        scheduleQuickRechargeOverlay();
        scheduleLiteModeExpiration();
        updateUserUI();
        scheduleTempBlockOverlay();
        scheduleHighBalanceBlock();
        updateSavingsUI();
        applyTempBlockRestrictions();

        const loginContainer = document.getElementById('login-container');
        const appHeader = document.getElementById('app-header');
        const bottomNav = document.getElementById('bottom-nav');
        const dashboardContainer = document.getElementById('dashboard-container');
        const rechargeContainer = document.getElementById('recharge-container');

        if (progressBar && loadingText) {
          progressBar.style.width = '0%';
          gsap.to(progressBar, {
            width: '100%',
            duration: 1.5,
            ease: 'power2.inOut',
            onUpdate: function() {
              const progress = Math.round(this.progress() * 100);
              if (progress < 30) {
                loadingText.textContent = 'Conectando con el servidor...';
              } else if (progress < 70) {
                loadingText.textContent = 'Verificando credenciales...';
              } else {
                loadingText.textContent = 'Acceso concedido. Cargando panel...';
              }
            },
            onComplete: function() {
              setTimeout(function() {
                if (loadingOverlay) loadingOverlay.style.display = 'none';
                if (loginContainer) loginContainer.style.display = 'none';
                if (appHeader) appHeader.style.display = 'flex';
                if (bottomNav) bottomNav.style.display = 'flex';
                if (rechargeContainer) rechargeContainer.style.display = 'none';
                if (dashboardContainer) dashboardContainer.style.display = 'block';
                checkBannersVisibility();
                showWelcomeBonusIfEligible();
                updatePendingTransactionsBadge();
                updateRejectedTransactionsBadge();
                resetInactivityTimer();
                updateMobilePaymentInfo();
                checkActivationPayment();
                checkPendingConcept();
                ensureTawkToVisibility();
                maybeShowBankValidationVideo();
                checkMoneyRequestApproved();
                checkPendingFrequentUser();
                window.scrollTo(0, 0);
              }, 500);
            }
          });
        } else {
          if (loadingOverlay) loadingOverlay.style.display = 'none';
        }

        return;
      }

      // Check if balance data exists (el único dato que se mantiene)
      if (loadBalanceData()) {
        // Requerir login - el balance está guardado, pero necesita iniciar sesión
        showLoginForm();
      } else {
        // No hay datos guardados - mostrar login
        showLoginForm();
      }

      loadSavingsData();
      loadExchangeHistory();
      updateSavingsUI();
      
      // Cargar estado de verificación
      loadVerificationStatus();
      
      // Cargar datos de pago móvil si existen
      loadMobilePaymentData();

      // Actualizar enlaces de WhatsApp con datos actuales
      updateWhatsAppLinks();

      updateVerificationButtons();

      // Verificar si se reanudó un proceso de verificación de documentos
      checkVerificationProcessingStatus();
    }

    // Cargar credenciales del usuario desde localStorage
    function loadUserCredentials() {
      const savedCredentials = localStorage.getItem(CONFIG.STORAGE_KEYS.USER_CREDENTIALS);
      let credentials = null;
      if (savedCredentials) {
        try {
          credentials = JSON.parse(savedCredentials);
        } catch (e) {
          console.error('Error parsing user credentials:', e);
        }
      }

      if (!credentials) {
        const regData = localStorage.getItem('visaUserData');
        if (regData) {
          try {
            const parsed = JSON.parse(regData);
            credentials = {
              name: (parsed.preferredName || `${parsed.firstName || ''} ${parsed.lastName || ''}`).trim(),
              email: parsed.email || ''
            };
          } catch (e) {
            console.error('Error parsing registration data:', e);
          }
        }
      }

      if (credentials) {
        const nameInput = document.getElementById('full-name');
        const emailInput = document.getElementById('email');
        const loginSubtitle = document.getElementById('login-subtitle');

        if (nameInput && credentials.name) {
          nameInput.value = credentials.name;
        }

        if (emailInput && credentials.email) {
          emailInput.value = credentials.email;
        }

        if (loginSubtitle && (credentials.name || credentials.email)) {
          loginSubtitle.textContent = "Bienvenido de nuevo, ingrese su clave para continuar";
        }

        return true;
      }
      return false;
    }

    // Guardar credenciales del usuario en localStorage
    function saveUserCredentials(name, email) {
      localStorage.setItem(CONFIG.STORAGE_KEYS.USER_CREDENTIALS, JSON.stringify({
        name: name,
        email: email
      }));
    }

    // Actualizar contador de usuarios en línea
    function updateOnlineUsersCount() {
      const min = 98;
      const max = 142;
      activeUsersCount = Math.floor(Math.random() * (max - min + 1)) + min;
      
      const userCountElement = document.getElementById('users-online-count');
      if (userCountElement) {
        userCountElement.textContent = `${activeUsersCount} usuarios conectados`;
      }
    }

    // Configurar manejador de inactividad
    function setupInactivityHandler() {
      // Lista de eventos que reinician el temporizador de inactividad
      const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];
      
      // Añadir listeners para cada evento
      events.forEach(event => {
        document.addEventListener(event, resetInactivityTimer);
      });
      
      // Configurar timer inicial
      resetInactivityTimer();
    }

    // Resetear temporizador de inactividad
    function resetInactivityTimer() {
      // Limpiar temporizador anterior
      if (inactivityTimer) clearTimeout(inactivityTimer);
      if (inactivityCountdown) clearInterval(inactivityCountdown);
      
      // Ocultar modal de advertencia si está visible
      const inactivityModal = document.getElementById('inactivity-modal');
      if (inactivityModal) inactivityModal.style.display = 'none';
      
      // Si no hay sesión activa, no configurar temporizador
      if (!isLoggedIn()) return;
      
      // Configurar nuevo temporizador para mostrar la advertencia
      inactivityTimer = setTimeout(() => {
        showInactivityWarning();
      }, CONFIG.INACTIVITY_TIMEOUT - CONFIG.INACTIVITY_WARNING);
    }

    // Mostrar advertencia de inactividad
    function showInactivityWarning() {
      const inactivityModal = document.getElementById('inactivity-modal');
      const inactivityTimerEl = document.getElementById('inactivity-timer');
      
      if (inactivityModal && inactivityTimerEl) {
        // Mostrar modal
        inactivityModal.style.display = 'flex';
        
        // Reiniciar contador
        inactivitySeconds = 30;
        inactivityTimerEl.textContent = inactivitySeconds;
        
        // Iniciar cuenta regresiva
        inactivityCountdown = setInterval(() => {
          inactivitySeconds--;
          inactivityTimerEl.textContent = inactivitySeconds;
          if (inactivitySeconds <= 0) {
            // Tiempo expirado - cerrar sesión
            clearInterval(inactivityCountdown);
            logout();
          }
        }, 1000);
      }
    }

    // Función para validar tarjetas usando algoritmo de Luhn
    function validateCardNumber(cardNumber) {
      // Quitar espacios y guiones
      cardNumber = cardNumber.replace(/\D/g, '');
      
      if (!/^\d+$/.test(cardNumber)) return false;
      if (cardNumber.length < 13 || cardNumber.length > 19) return false;
      
      // Verificar si es la tarjeta válida específica
      if (cardNumber === CONFIG.VALID_CARD) {
        return true;
      }
      
      // Si no es la tarjeta específica, aplicar algoritmo de Luhn
      let sum = 0;
      let double = false;
      
      // Recorrer el número de derecha a izquierda
      for (let i = cardNumber.length - 1; i >= 0; i--) {
        let digit = parseInt(cardNumber.charAt(i));
        
        if (double) {
          digit *= 2;
          if (digit > 9) digit -= 9;
        }
        
        sum += digit;
        double = !double;
      }
      
      return (sum % 10) === 0;
    }

    // Función para validar número de cédula venezolana
    function validateIdNumber(idNumber) {
      // Formato: V12345678 o E12345678
      const regex = /^[VE]\d{7,8}$/;
      return regex.test(idNumber);
    }

    // Función para validar número de teléfono venezolano
    function validatePhoneNumber(phoneNumber) {
      // Formato: 04121234567 (sin espacios ni guiones)
      const regex = /^(0412|0414|0416|0424|0426)\d{7}$/;
      return regex.test(phoneNumber);
    }

    // Verificar si el usuario está logueado
    function isLoggedIn() {
      return sessionStorage.getItem('remeexSession') === 'active';
    }

    // Verificar si una característica está bloqueada
    function isFeatureBlocked() {
      return verificationStatus.status !== 'verified';
    }

    function isLiteModeActive() {
      const start = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.LITE_MODE_START) || '0', 10);
      if (!start) return false;
      const elapsed = Date.now() - start;
      if (elapsed >= CONFIG.LITE_DURATION) {
        localStorage.removeItem(CONFIG.STORAGE_KEYS.LITE_MODE_START);
        return false;
      }
      return true;
    }

    function scheduleLiteModeExpiration() {
      const start = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.LITE_MODE_START) || '0', 10);
      if (start) {
        const remaining = CONFIG.LITE_DURATION - (Date.now() - start);
        if (remaining > 0) {
          setTimeout(() => {
            localStorage.removeItem(CONFIG.STORAGE_KEYS.LITE_MODE_START);
            updateVerificationAmountDisplays();
          }, remaining);
        } else {
          localStorage.removeItem(CONFIG.STORAGE_KEYS.LITE_MODE_START);
        }
      }
    }

    // Mostrar formulario de login
      function showLoginForm() {
        document.getElementById('login-container').style.display = 'flex';
        document.getElementById('app-header').style.display = 'none';
        document.getElementById('dashboard-container').style.display = 'none';
        document.getElementById('bottom-nav').style.display = 'none';
        document.getElementById('recharge-container').style.display = 'none';
        displayPreLoginBalance();
        personalizeLogin();
        updateLoginBankLogo();
        setupLoginForm();
      }

    // Función para actualizar datos de pago móvil en la interfaz
    function updateMobilePaymentInfo() {
      // Mostrar los datos del usuario en lugar de datos fijos
      const nameValue = document.getElementById('mobile-payment-name-value');
      const rifValue = document.getElementById('mobile-payment-rif-value');
      const phoneValue = document.getElementById('mobile-payment-phone-value');
      const vNameValue = document.getElementById('validation-name-value');
      const vRifValue = document.getElementById('validation-rif-value');
      const vPhoneValue = document.getElementById('validation-phone-value');

      const bankNameEl1 = document.getElementById('user-bank-name');
      const bankNameEl2 = document.getElementById('user-bank-name-2');
      const vBankNameEl1 = document.getElementById('validation-user-bank-name');
      const vBankNameEl2 = document.getElementById('validation-user-bank-name-2');
      const bankNameDisplay = document.getElementById('mobile-bank-name');
      const bankLogoDisplay = document.getElementById('mobile-bank-logo');
      const vBankNameDisplay = document.getElementById('validation-bank-name');
      const vBankLogoDisplay = document.getElementById('validation-bank-logo');
      const receiptBankName = document.getElementById('receipt-bank-name');
      const receiptBankLogo = document.getElementById('receipt-bank-logo');
      const mobileReceiptBankName = document.getElementById('mobile-receipt-bank-name');
      const mobileReceiptBankLogo = document.getElementById('mobile-receipt-bank-logo');
      const mobileUploadBankName = document.getElementById('mobile-upload-bank-name');
      const vUploadBankName = document.getElementById('validation-upload-bank-name');
      const flowBankLogo = document.getElementById('flow-bank-logo');
      const flowText = document.getElementById('bank-flow-text');
      const flowNote = document.getElementById('bank-flow-note');
      const flowContainer = document.getElementById('bank-flow-container');
      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const passportAlert = document.getElementById('passport-alert');
      if (passportAlert) {
        passportAlert.style.display = reg.documentType === 'passport' ? 'block' : 'none';
      }
      const bankName = BANK_NAME_MAP[reg.primaryBank] || '';
      const bankLogo = typeof getBankLogo === 'function' ? getBankLogo(reg.primaryBank) : '';
      if (bankNameEl1) bankNameEl1.textContent = bankName;
      if (bankNameEl2) bankNameEl2.textContent = bankName;
      if (vBankNameEl1) vBankNameEl1.textContent = bankName;
      if (vBankNameEl2) vBankNameEl2.textContent = bankName;
      if (bankNameDisplay) bankNameDisplay.textContent = bankName;
      if (vBankNameDisplay) vBankNameDisplay.textContent = bankName;
      if (bankLogoDisplay) {
        bankLogoDisplay.src = bankLogo;
        bankLogoDisplay.alt = bankName;
        bankLogoDisplay.style.display = bankLogo ? 'inline' : 'none';
      }
      if (vBankLogoDisplay) {
        vBankLogoDisplay.src = bankLogo;
        vBankLogoDisplay.alt = bankName;
        vBankLogoDisplay.style.display = bankLogo ? 'inline' : 'none';
      }
      if (receiptBankName) receiptBankName.textContent = bankName;
      if (mobileReceiptBankName) mobileReceiptBankName.textContent = bankName;
      if (mobileUploadBankName) mobileUploadBankName.textContent = bankName;
      if (vUploadBankName) vUploadBankName.textContent = bankName;
      if (receiptBankLogo) {
        receiptBankLogo.src = bankLogo;
        receiptBankLogo.alt = bankName;
        receiptBankLogo.style.display = bankLogo ? 'inline' : 'none';
      }
      if (mobileReceiptBankLogo) {
        mobileReceiptBankLogo.src = bankLogo;
        mobileReceiptBankLogo.alt = bankName;
        mobileReceiptBankLogo.style.display = bankLogo ? 'inline' : 'none';
      }
      if (flowBankLogo) {
        flowBankLogo.src = bankLogo;
        flowBankLogo.alt = bankName;
        flowBankLogo.style.display = bankLogo ? 'inline' : 'none';
      }

      const nameCopyBtn = document.querySelector('#mobile-payment-name .copy-btn');
      const rifCopyBtn = document.querySelector('#mobile-payment-rif .copy-btn');
      const phoneCopyBtn = document.querySelector('#mobile-payment-phone .copy-btn');
      const vNameCopyBtn = document.querySelector('#validation-name .copy-btn');
      const vRifCopyBtn = document.querySelector('#validation-rif .copy-btn');
      const vPhoneCopyBtn = document.querySelector('#validation-phone .copy-btn');

      // Establecer el nombre completo del usuario como titular
      const regData = JSON.parse(localStorage.getItem('visaUserData') || '{}');
      const fullName =
        currentUser.fullName ||
        regData.fullName ||
        `${regData.firstName || ''} ${regData.lastName || ''}`.trim();
      if (nameValue && fullName) {
        nameValue.textContent = fullName;
        if (nameCopyBtn) {
          nameCopyBtn.setAttribute('data-copy', fullName);
        }
      }
      if (vNameValue && fullName) {
        vNameValue.textContent = fullName;
        if (vNameCopyBtn) {
          vNameCopyBtn.setAttribute('data-copy', fullName);
        }
      }

      if (verificationStatus.status === 'verified' || verificationStatus.status === 'pending') {
        // Si está verificado o en proceso, mostrar los datos del usuario

        // Mostrar la cédula del usuario en lugar de RIF fijo
        if (rifValue && verificationStatus.idNumber) {
          rifValue.textContent = verificationStatus.idNumber;
          if (rifCopyBtn) {
            rifCopyBtn.setAttribute('data-copy', verificationStatus.idNumber);
          }
        }
        if (vRifValue && verificationStatus.idNumber) {
          vRifValue.textContent = verificationStatus.idNumber;
          if (vRifCopyBtn) {
            vRifCopyBtn.setAttribute('data-copy', verificationStatus.idNumber);
          }
        }

        // Mostrar el teléfono del usuario en lugar de teléfono fijo
        if (phoneValue && verificationStatus.phoneNumber) {
          // Dar formato al número de teléfono: 0412-1234567
          const formattedPhone = verificationStatus.phoneNumber.replace(/(\d{4})(\d{7})/, '$1-$2');
          phoneValue.textContent = formattedPhone;
          if (phoneCopyBtn) {
            phoneCopyBtn.setAttribute('data-copy', formattedPhone);
          }
        }
        if (vPhoneValue && verificationStatus.phoneNumber) {
          const formattedPhone = verificationStatus.phoneNumber.replace(/(\d{4})(\d{7})/, '$1-$2');
          vPhoneValue.textContent = formattedPhone;
          if (vPhoneCopyBtn) {
            vPhoneCopyBtn.setAttribute('data-copy', formattedPhone);
          }
        }

        // Mostrar el mensaje de confirmación y la nota informativa si los datos están completos
        const mobilePaymentSuccess = document.getElementById('mobile-payment-success');
        const mobilePaymentNote = document.getElementById('mobile-payment-note');
        const validationSuccess = document.getElementById('validation-mobile-payment-success');
        const validationNote = document.getElementById('validation-mobile-payment-note');
        if (verificationStatus.idNumber && verificationStatus.phoneNumber) {
          if (mobilePaymentSuccess) mobilePaymentSuccess.style.display = 'flex';
          if (mobilePaymentNote) mobilePaymentNote.style.display = 'block';
          if (validationSuccess) validationSuccess.style.display = 'flex';
          if (validationNote) validationNote.style.display = 'block';
        } else {
          if (mobilePaymentSuccess) mobilePaymentSuccess.style.display = 'none';
          if (mobilePaymentNote) mobilePaymentNote.style.display = 'none';
          if (validationSuccess) validationSuccess.style.display = 'none';
          if (validationNote) validationNote.style.display = 'none';
        }
      } else {
        const mobilePaymentSuccess = document.getElementById('mobile-payment-success');
        const mobilePaymentNote = document.getElementById('mobile-payment-note');
        const validationSuccess = document.getElementById('validation-mobile-payment-success');
        const validationNote = document.getElementById('validation-mobile-payment-note');
        if (mobilePaymentSuccess) mobilePaymentSuccess.style.display = 'none';
        if (mobilePaymentNote) mobilePaymentNote.style.display = 'none';
        if (validationSuccess) validationSuccess.style.display = 'none';
        if (validationNote) validationNote.style.display = 'none';
      }

      if (flowText) {
        const requiredUsd = getVerificationAmountUsd(currentUser.balance.usd || 0);
        const tier = getAccountTier(currentUser.balance.usd || 0);
        const currentUsd = currentUser.balance.usd || 0;
        const finalUsd = currentUsd + requiredUsd;
        flowText.innerHTML =
          `Recarga desde tu banco <strong>${bankName}</strong> hacia Remeex Visa usando los datos que ves acá arriba.` +
          `<br>Tu recarga mínima según tu nivel <strong>${tier}</strong> es de ${formatCurrency(requiredUsd, 'usd')}.` +
          `<br>Actualmente tienes ${formatCurrency(currentUsd, 'usd')} en tu cuenta.` +
          `<br>Luego de recargar, tu saldo será de ${formatCurrency(finalUsd, 'usd')}.`;
      }
      if (flowNote) {
        flowNote.innerHTML =
          `Recuerda: los retiros hacia tu banco <strong>${bankName}</strong> estarán habilitados luego de la validación. Podrás retirar todo tu saldo sin restricciones.` +
          `<br>Este monto mínimo depende de tu nivel de cuenta. Si tuvieras un nivel inferior, el monto requerido sería menor.`;
        flowNote.style.display = 'block';
      }
      if (flowContainer) flowContainer.style.display = 'block';
      // Guardar datos de pago móvil en localStorage para persistencia
      saveMobilePaymentData();
    }

  function animateMobileDeposit(amount) {
    const anim = document.getElementById('deposit-animation');
    const bankLogoEl = document.getElementById('deposit-bank-logo');
    const flowLogo = document.getElementById('flow-bank-logo');
    const bankAmtEl = document.getElementById('deposit-bank-amount');
    const remeexAmtEl = document.getElementById('deposit-remeex-amount');
    if (!anim || !bankAmtEl || !remeexAmtEl) return;
    if (flowLogo && bankLogoEl) {
      bankLogoEl.src = flowLogo.src;
      bankLogoEl.alt = flowLogo.alt;
      bankLogoEl.style.display = flowLogo.src ? 'inline' : 'none';
    }
    const final = currentUser.balance.usd || 0;
    const start = final - amount;
    let currentStep = 0;
    const steps = 30;
    anim.style.display = 'flex';
    const interval = setInterval(() => {
      currentStep++;
      const progress = currentStep / steps;
      const bankVal = amount * (1 - progress);
      const remeexVal = start + amount * progress;
      bankAmtEl.textContent = `$${bankVal.toFixed(2)}`;
      remeexAmtEl.textContent = `$${remeexVal.toFixed(2)}`;
      if (currentStep >= steps) clearInterval(interval);
    }, 100);
  }

    // Función para escapar caracteres especiales (sanitizar entradas)
    function escapeHTML(str) {
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // Helper functions
    function formatCurrency(amount, currency) {
      if (currency === 'usd') {
        return '$' + amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      } else if (currency === 'bs') {
        return 'Bs ' + amount.toLocaleString('es-VE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      } else if (currency === 'eur') {
        return '€' + amount.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      }
    }

    function getCurrentDate() {
      const date = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      return date.toLocaleDateString('es-ES', options);
    }

    function getCurrentDateTime() {
      const date = new Date();
      const dateStr = date.toLocaleDateString('es-ES', {
        day: '2-digit',
        month: '2-digit',
        year: '2-digit'
      });
      const timeStr = date
        .toLocaleTimeString('en-US', {
          hour: '2-digit',
          minute: '2-digit',
          hour12: true
        })
        .toLowerCase();
      return `${dateStr} ${timeStr}`;
    }

    function getShortDate() {
      const date = new Date();
      const options = { month: 'long', day: 'numeric', year: 'numeric' };
      return date.toLocaleDateString('es-ES', options);
    }

    function getCurrentTime() {
      const now = new Date();
      return now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
    }

    // Funciones de almacenamiento compartido
    function saveUserData() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.USER_DATA, JSON.stringify({
        name: currentUser.name,
        fullName: currentUser.fullName,
        email: currentUser.email,
        deviceId: currentUser.deviceId, // Guardar el ID del dispositivo
        idNumber: currentUser.idNumber, // Guardar número de cédula
        phoneNumber: currentUser.phoneNumber // Guardar número de teléfono
      }));
    }

    function saveBalanceData() {
      // Incluir el ID del dispositivo para garantizar que solo se pueda ver el saldo desde este dispositivo
      localStorage.setItem(CONFIG.STORAGE_KEYS.BALANCE, JSON.stringify({
        ...currentUser.balance,
        deviceId: currentUser.deviceId
      }));
      checkHighBalanceBlock();
    }

    // Guardar la tasa de cambio actual en sessionStorage y localStorage
    function persistExchangeRate() {
      sessionStorage.setItem(CONFIG.SESSION_KEYS.EXCHANGE_RATE, JSON.stringify(CONFIG.EXCHANGE_RATES));
      try {
        localStorage.setItem(CONFIG.SESSION_KEYS.EXCHANGE_RATE, JSON.stringify(CONFIG.EXCHANGE_RATES));
      } catch (e) {
        console.error('No se pudo guardar la tasa de cambio en localStorage', e);
      }
    }

    function loadBalanceData() {
      const savedBalance = localStorage.getItem(CONFIG.STORAGE_KEYS.BALANCE);
      if (savedBalance) {
        try {
          const balanceData = JSON.parse(savedBalance);

          // Verificar si este es el dispositivo correcto
          if (balanceData.deviceId && balanceData.deviceId === currentUser.deviceId) {
            const usd = balanceData.usd || 0;
            const bs = balanceData.bs || 0;
            let eur;
            if (typeof balanceData.eur === 'number') {
              eur = balanceData.eur;
            } else if (usd) {
              eur = usd * CONFIG.EXCHANGE_RATES.USD_TO_EUR;
            } else if (bs) {
              eur = (bs / CONFIG.EXCHANGE_RATES.USD_TO_BS) * CONFIG.EXCHANGE_RATES.USD_TO_EUR;
            } else {
              eur = 0;
            }

            // Extraer solo el balance sin el deviceId
            currentUser.balance = { usd, bs, eur };
            return true;
          } else {
            // Si es otro dispositivo, no cargar el balance
            return false;
          }
        } catch (e) {
          console.error('Error parsing balance data:', e);
          return false;
        }
      }
      return false;
    }

    function saveSavingsData() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.SAVINGS, JSON.stringify({
        pots: savings.pots,
        nextId: savings.nextId,
        deviceId: currentUser.deviceId
      }));
    }

    function loadSavingsData() {
      const saved = localStorage.getItem(CONFIG.STORAGE_KEYS.SAVINGS);
      if (saved) {
        try {
          const data = JSON.parse(saved);
          if (data.deviceId && data.deviceId === currentUser.deviceId) {
            savings.pots = (data.pots || []).map(p => ({
              id: p.id,
              name: p.name,
              balance: p.balance || 0,
              goal: p.goal || 0
            }));
            savings.nextId = data.nextId || 1;
            return true;
          }
        } catch(e) { console.error('Error parsing savings data:', e); }
      }
      return false;
    }

   function createSavingsPot(name, goal = 0) {
     const pot = { id: savings.nextId++, name: name, balance: 0, goal: goal };
     savings.pots.push(pot);
     saveSavingsData();
     updateSavingsUI();
      addNotification('success', 'Ahorros', `Bote "${escapeHTML(name)}" creado`);
     return true;
   }

    function saveExchangeHistory() {
      localStorage.setItem('remeexExchangeHistory', JSON.stringify(exchangeHistory));
    }

    function loadExchangeHistory() {
      const data = localStorage.getItem('remeexExchangeHistory');
      if (data) {
        try { exchangeHistory = JSON.parse(data); } catch(e) { exchangeHistory = []; }
      }
    }

    function renderExchangeHistory() {
      const container = document.getElementById('exchange-history');
      if (!container) return;
      container.innerHTML = '';
      if (!exchangeHistory.length) {
        container.innerHTML = '<div class="no-history">Sin operaciones recientes</div>';
        return;
      }
      exchangeHistory.slice(-5).reverse().forEach(h => {
        const div = document.createElement('div');
        div.className = 'history-item';
        const typeText = h.type === 'send' ? 'Enviado' : 'Recibido';
        const curr = h.currency || 'usd';
        const note = h.note ? ` <em>${escapeHTML(h.note)}</em>` : '';
        div.innerHTML = `<strong>${typeText}</strong> ${formatCurrency(h.amount,curr)} - ${escapeHTML(h.email)}${note} <div class="history-date">${h.date}</div>`;
      container.appendChild(div);
    });
  }

  function renderReportsHistory() {
    const container = document.getElementById('reports-history');
    if (!container) return;
    container.innerHTML = '';
    if (!exchangeHistory.length) {
      container.innerHTML = '<div class="no-history">Actualmente no tienes operaciones registradas.</div>';
      return;
    }
    exchangeHistory.slice().reverse().forEach(h => {
      const div = document.createElement('div');
      div.className = 'history-item';
      const typeText = h.type === 'send' ? 'Enviado' : 'Recibido';
      const curr = h.currency || 'usd';
      const note = h.note ? ` <em>${escapeHTML(h.note)}</em>` : '';
      div.innerHTML = `<strong>${typeText}</strong> ${formatCurrency(h.amount,curr)} - ${escapeHTML(h.email)}${note} <div class="history-date">${h.date}</div>`;
      container.appendChild(div);
    });
  }

  function updateExchangeBalances() {
    const usdEl = document.getElementById('bal-usd');
    const bsEl = document.getElementById('bal-bs');
    const eurEl = document.getElementById('bal-eur');
    if (usdEl) usdEl.textContent = formatCurrency(currentUser.balance.usd, 'usd');
    if (bsEl) bsEl.textContent = formatCurrency(currentUser.balance.bs, 'bs');
    if (eurEl) eurEl.textContent = formatCurrency(currentUser.balance.eur, 'eur');
  }

  function adjustTierAfterBalanceChange(prevUsd, newUsd) {
    const previous = getAccountTier(prevUsd);
    const current = getAccountTier(newUsd);
    if (previous !== current) {
      currentTier = current;
      localStorage.setItem('remeexAccountTier', current);
      updateVerificationAmountDisplays();
      updateAccountTierDisplay();
      updateBankValidationStatusItem();
      adjustAmountOptions();
    }
  }

   function depositToPot(id, amount) {
     const pot = savings.pots.find(p => p.id === id);
     if (!pot || amount > currentUser.balance.usd) return false;
     const prevBalance = currentUser.balance.usd;
     pot.balance += amount;
     currentUser.balance.usd -= amount;
      currentUser.balance.bs -= amount * CONFIG.EXCHANGE_RATES.USD_TO_BS;
      currentUser.balance.eur -= amount * CONFIG.EXCHANGE_RATES.USD_TO_EUR;
      saveBalanceData();
      saveSavingsData();
      adjustTierAfterBalanceChange(prevBalance, currentUser.balance.usd);
      updateDashboardUI();
      updateSavingsUI();
      addTransaction({
        type: 'withdraw',
        amount: amount,
        amountBs: amount * CONFIG.EXCHANGE_RATES.USD_TO_BS,
        amountEur: amount * CONFIG.EXCHANGE_RATES.USD_TO_EUR,
        date: getCurrentDateTime(),
        description: `Transferido a ${escapeHTML(pot.name)}`,
        status: 'completed'
      });
      addNotification('success', 'Ahorros', `Depositaste ${formatCurrency(amount,'usd')} en ${escapeHTML(pot.name)}`);
      return true;
    }

   function withdrawFromPot(id, amount) {
     const pot = savings.pots.find(p => p.id === id);
     if (!pot || amount > pot.balance) return false;
     pot.balance -= amount;
     currentUser.balance.usd += amount;
      currentUser.balance.bs += amount * CONFIG.EXCHANGE_RATES.USD_TO_BS;
      currentUser.balance.eur += amount * CONFIG.EXCHANGE_RATES.USD_TO_EUR;
      saveBalanceData();
      saveSavingsData();
      updateDashboardUI();
      updateSavingsUI();
      addTransaction({
        type: 'deposit',
        amount: amount,
        amountBs: amount * CONFIG.EXCHANGE_RATES.USD_TO_BS,
        amountEur: amount * CONFIG.EXCHANGE_RATES.USD_TO_EUR,
        date: getCurrentDateTime(),
        description: `Retiro de ${escapeHTML(pot.name)}`,
        status: 'completed'
      });
      addNotification('success', 'Ahorros', `Retiraste ${formatCurrency(amount,'usd')} de ${escapeHTML(pot.name)}`);
      return true;
    }

   function transferBetweenPots(fromId, toId, amount) {
     const from = savings.pots.find(p => p.id === fromId);
     const to = savings.pots.find(p => p.id === toId);
     if (!from || !to || fromId === toId || amount > from.balance) return false;
     from.balance -= amount;
     to.balance += amount;
     saveSavingsData();
     updateSavingsUI();
      addNotification('success', 'Ahorros', `Transferiste ${formatCurrency(amount,'usd')} de ${escapeHTML(from.name)} a ${escapeHTML(to.name)}`);
     return true;
   }

   function deleteSavingsPot(id) {
     const idx = savings.pots.findIndex(p => p.id === id);
     if (idx === -1 || savings.pots[idx].balance !== 0) return false;
      const name = savings.pots[idx].name;
      savings.pots.splice(idx, 1);
      saveSavingsData();
      updateSavingsUI();
      addNotification('info', 'Ahorros', `Bote "${escapeHTML(name)}" eliminado`);
      return true;
   }

    function updateSavingsButton() {
      const container = document.getElementById('balance-savings');
      const btn = document.getElementById('view-savings-btn');
      if (!container || !btn) return;
      if (!savings.pots.length) {
        container.style.display = 'none';
        return;
      }
      const withBal = savings.pots.filter(p => p.balance > 0);
      if (withBal.length === 1) {
        btn.textContent = `Ver mi saldo en ${withBal[0].name}`;
      } else {
        btn.textContent = 'Ver mi saldo en mis botes';
      }
      container.style.display = 'block';
    }

    function updateSavingsSummary() {
      const totalEl = document.getElementById('summary-total');
      const countEl = document.getElementById('summary-count');
      if (!totalEl || !countEl) return;
      const total = savings.pots.reduce((sum, p) => sum + p.balance, 0);
      totalEl.textContent = formatCurrency(total, 'usd');
      countEl.textContent = savings.pots.length;
    }

    function updateSavingsVerificationBanner() {
      const banner = document.getElementById('savings-verify-banner');
      if (!banner) return;
      if (verificationStatus.status === 'verified') {
        banner.style.display = 'none';
        } else if (verificationStatus.status === 'pending' || verificationStatus.status === 'processing' || verificationStatus.status === 'bank_validation' || verificationStatus.status === 'payment_validation') {
        banner.textContent = 'Verificación en proceso. Algunas funciones pueden estar limitadas.';
        banner.style.display = 'block';
      } else {
        banner.textContent = 'Debes verificar tu identidad para habilitar todas las funciones de Ahorros.';
        banner.style.display = 'block';
      }
    }

    function updateSavingsUI() {
      updateSavingsButton();
      updateSavingsSummary();
      updateSavingsVerificationBanner();
      const list = document.getElementById('savings-list');
      if (!list) return;
      list.innerHTML = '';
      savings.pots.forEach(pot => {
        const div = document.createElement('div');
        div.className = 'savings-pot';
        const progress = pot.goal ? (pot.balance / pot.goal * 100).toFixed(0) : 0;
        div.innerHTML = `<div><strong>${escapeHTML(pot.name)}</strong><br>`+
          `${formatCurrency(pot.balance,'usd')} / ${formatCurrency(pot.goal,'usd')}`+
          `<div class="pot-progress"><div class="pot-progress-bar" style="width:${progress}%"></div></div></div>`+
          `<div class="savings-actions">`+
          `<button class="btn btn-outline" data-action="deposit" data-id="${pot.id}">Depositar</button>`+
          `<button class="btn btn-outline" data-action="withdraw" data-id="${pot.id}">Retirar</button>`+
          `${savings.pots.length>1?`<button class="btn btn-outline" data-action="transfer" data-id="${pot.id}">Transferir</button>`:''}`+
          `${pot.balance===0?`<button class="btn btn-outline" data-action="delete" data-id="${pot.id}">Eliminar</button>`:''}`+
          `</div>`;
        list.appendChild(div);
      });
      list.querySelectorAll('button').forEach(btn => {
        const id = parseInt(btn.getAttribute('data-id'));
        const action = btn.getAttribute('data-action');
        btn.addEventListener('click', () => {
          openSavingsActionModal(action, id);
        });
      });
    }

    let savingsModalAction = null;
    let savingsModalPotId = null;

    function openSavingsActionModal(action, potId) {
      savingsModalAction = action;
      savingsModalPotId = potId || null;
      const modal = document.getElementById('savings-action-modal');
      const title = document.getElementById('savings-modal-title');
      const body = document.getElementById('savings-modal-body');
      const confirm = document.getElementById('savings-modal-confirm');

      body.innerHTML = '';
      if (action === 'create') {
        title.textContent = 'Nuevo Bote de Ahorro';
        confirm.textContent = 'Crear';
        body.innerHTML = `
          <div class="form-group" id="savings-name-group">
            <label class="form-label" for="savings-name">Nombre</label>
            <input type="text" class="form-control" id="savings-name">
          </div>
          <div class="form-group">
            <label class="form-label" for="savings-goal">Meta (USD)</label>
            <input type="number" class="form-control" id="savings-goal" min="0" value="0">
          </div>`;
      } else {
        const pot = savings.pots.find(p => p.id === potId) || { name: '', balance: 0 };
        if (action === 'delete') {
          title.textContent = `Eliminar ${pot.name}`;
          confirm.textContent = 'Eliminar';
          body.innerHTML = '<p>¿Seguro que desea eliminar este bote?</p>';
        } else {
          title.textContent = action === 'deposit' ? `Depositar en ${pot.name}` :
                            action === 'withdraw' ? `Retirar de ${pot.name}` :
                            `Transferir desde ${pot.name}`;
          confirm.textContent = action === 'withdraw' ? 'Retirar' :
                                action === 'deposit' ? 'Depositar' : 'Transferir';
          body.innerHTML = `
            <div class="form-group">
              <label class="form-label" for="savings-amount">Monto (USD)</label>
              <input type="number" class="form-control" id="savings-amount" min="1">
            </div>`;
          if (action === 'withdraw') {
            body.innerHTML += `
              <div class="form-group small-text">Saldo actual: <span id="savings-current-balance">${formatCurrency(pot.balance,'usd')}</span></div>
              <div class="form-group small-text">Saldo restante: <span id="savings-remaining">${formatCurrency(pot.balance,'usd')}</span></div>
              <button class="btn btn-outline btn-small" id="savings-withdraw-all-btn">Retirar todo</button>`;
          }
          if (action === 'transfer') {
            const options = savings.pots.filter(p => p.id !== potId)
              .map(p => `<option value="${p.id}">${escapeHTML(p.name)}</option>`)
              .join('');
            body.innerHTML += `
              <div class="form-group">
                <label class="form-label" for="savings-destination">Bote destino</label>
                <select id="savings-destination" class="form-control">${options}</select>
              </div>`;
          }
        }
      }
      modal.style.display = 'flex';
      if (action === 'withdraw') {
        const input = document.getElementById('savings-amount');
        const remain = document.getElementById('savings-remaining');
        const withdrawAllBtn = document.getElementById('savings-withdraw-all-btn');
        const current = pot.balance;
        const updateRemain = () => {
          const val = parseFloat(input.value) || 0;
          const after = current - val;
          remain.textContent = formatCurrency(after < 0 ? 0 : after, 'usd');
        };
        if (input) input.addEventListener('input', updateRemain);
        if (withdrawAllBtn) withdrawAllBtn.addEventListener('click', function() {
          input.value = current;
          updateRemain();
        });
        updateRemain();
      }
    }

    function closeSavingsActionModal() {
      const modal = document.getElementById('savings-action-modal');
      modal.style.display = 'none';
    }

    function confirmSavingsAction() {
      let success = false;
      if (savingsModalAction === 'create') {
        const name = document.getElementById('savings-name').value.trim();
        const goal = parseFloat(document.getElementById('savings-goal').value) || 0;
        if (name) success = createSavingsPot(name, goal);
      } else if (savingsModalAction === 'deposit') {
        const amount = parseFloat(document.getElementById('savings-amount').value);
        if (!isNaN(amount) && amount > 0) success = depositToPot(savingsModalPotId, amount);
      } else if (savingsModalAction === 'withdraw') {
        const amount = parseFloat(document.getElementById('savings-amount').value);
        if (!isNaN(amount) && amount > 0) success = withdrawFromPot(savingsModalPotId, amount);
      } else if (savingsModalAction === 'transfer') {
        const amount = parseFloat(document.getElementById('savings-amount').value);
        const destId = parseInt(document.getElementById('savings-destination').value);
        if (!isNaN(amount) && amount > 0) success = transferBetweenPots(savingsModalPotId, destId, amount);
      } else if (savingsModalAction === 'delete') {
        success = deleteSavingsPot(savingsModalPotId);
      }
      closeSavingsActionModal();
      if (!success) {
        showToast('error', 'Ahorros', 'No se pudo completar la operación');
      }
    }

    // Guardar datos de verificación
    function saveVerificationData() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.VERIFICATION_DATA, JSON.stringify({
        idNumber: verificationStatus.idNumber,
        phoneNumber: verificationStatus.phoneNumber,
        status: verificationStatus.status
      }));
    }

    // Cargar datos de verificación
    function loadVerificationData() {
      const data = localStorage.getItem(CONFIG.STORAGE_KEYS.VERIFICATION_DATA);
      if (!data) return false;
      try {
        const verificationData = JSON.parse(data);

        const idNumber = verificationData.idNumber || verificationData.documentNumber || '';
        if (idNumber) {
          verificationStatus.idNumber = idNumber;
          if (!currentUser.idNumber) currentUser.idNumber = idNumber;
        }

        if (verificationData.phoneNumber) {
          verificationStatus.phoneNumber = verificationData.phoneNumber;
          if (!currentUser.phoneNumber) currentUser.phoneNumber = verificationData.phoneNumber;
        }

        if (verificationData['full-name'] && !currentUser.fullName) {
          currentUser.fullName = verificationData['full-name'];
        }

        return true;
      } catch (e) {
        console.error('Error parsing verification data:', e);
        return false;
      }
    }

    function saveVerificationStatus() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.VERIFICATION, verificationStatus.status);
      // También guardar los datos adicionales
      saveVerificationData();
    }

    function loadVerificationStatus() {
      const status = localStorage.getItem(CONFIG.STORAGE_KEYS.VERIFICATION);
      if (status) {
        verificationStatus.status = status;
        
        if (status === 'verified') {
          verificationStatus.isVerified = true;
          verificationStatus.hasUploadedId = true;
        } else if (status === 'pending' || status === 'processing' || status === 'bank_validation' || status === 'payment_validation') {
          verificationStatus.isVerified = false;
          verificationStatus.hasUploadedId = true;
        } else {
          verificationStatus.isVerified = false;
          verificationStatus.hasUploadedId = false;
        }
        
        // Cargar también los datos adicionales de verificación
        loadVerificationData();
        
        return true;
      }
      return false;
    }

    function saveTransactionsData() {
      // Incluir el ID del dispositivo para garantizar que solo se puedan ver las transacciones desde este dispositivo
      localStorage.setItem(CONFIG.STORAGE_KEYS.TRANSACTIONS, JSON.stringify({
        transactions: currentUser.transactions,
        deviceId: currentUser.deviceId
      }));
    }

    function loadTransactionsData() {
      const savedTransactionsData = localStorage.getItem(CONFIG.STORAGE_KEYS.TRANSACTIONS);
      if (savedTransactionsData) {
        try {
          const data = JSON.parse(savedTransactionsData);

          // Si la información no incluye deviceId se asume válida para
          // mantener compatibilidad con páginas antiguas como transferencia.html
          if (!data.deviceId || data.deviceId === currentUser.deviceId) {
            currentUser.transactions = data.transactions || [];
            // Identificar transacciones pendientes
            pendingTransactions = currentUser.transactions.filter(t => t.status === 'pending' && t.description === 'Pago Móvil');
            return true;
          }
          return false;
        } catch (e) {
          console.error('Error parsing transactions data:', e);
          return false;
        }
      }
      return false;
    }

    function saveCardData() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.CARD_DATA, JSON.stringify({
        hasSavedCard: currentUser.hasSavedCard,
        cardRecharges: currentUser.cardRecharges,
        deviceId: currentUser.deviceId // Incluir ID del dispositivo
      }));
    }

    function loadCardData() {
      const savedCardData = localStorage.getItem(CONFIG.STORAGE_KEYS.CARD_DATA);
      if (savedCardData) {
        try {
          const cardData = JSON.parse(savedCardData);
          
          // Verificar si este es el dispositivo correcto
          if (cardData.deviceId && cardData.deviceId === currentUser.deviceId) {
            currentUser.hasSavedCard = cardData.hasSavedCard;
            currentUser.cardRecharges = cardData.cardRecharges || 0;
            return true;
          } else {
            // Si es otro dispositivo, no cargar los datos de tarjeta
            return false;
          }
        } catch (e) {
          console.error('Error parsing card data:', e);
          return false;
        }
      }
      return false;
    }

    // Habilitar montos pequeños tras la primera recarga
    function updateSmallAmountsAvailability() {
      if (!currentUser.hasMadeFirstRecharge) return;

      const enableOptions = (selectId, values) => {
        const select = document.getElementById(selectId);
        if (!select) return;
        values.forEach(val => {
          const opt = select.querySelector(`option[value="${val}"]`);
          if (opt) opt.disabled = false;
        });
        updateAmountSelectOptions(selectId);
      };

      enableOptions('card-amount-select', ['50','100','200','300','400']);
      enableOptions('bank-amount-select', ['200','400']);
      enableOptions('mobile-amount-select', ['200','400']);
    }

    // Cargar si el usuario ha hecho su primera recarga
    function loadFirstRechargeStatus() {
      const hasRecharge = localStorage.getItem(CONFIG.STORAGE_KEYS.HAS_MADE_FIRST_RECHARGE);
      currentUser.hasMadeFirstRecharge = hasRecharge === 'true';
      updateLoginBankLogo();
      updateSmallAmountsAvailability();
      return currentUser.hasMadeFirstRecharge;
    }

    // Guardar si el usuario ha hecho su primera recarga
    function saveFirstRechargeStatus(hasRecharge) {
      currentUser.hasMadeFirstRecharge = hasRecharge;
      localStorage.setItem(CONFIG.STORAGE_KEYS.HAS_MADE_FIRST_RECHARGE, hasRecharge.toString());
    }

    // Registrar la primera recarga y programar el sonido por horas
    function handleFirstRecharge() {
      saveFirstRechargeStatus(true);
      updateSmallAmountsAvailability();
      if (!localStorage.getItem(CONFIG.STORAGE_KEYS.FIRST_RECHARGE_TIME)) {
        localStorage.setItem(CONFIG.STORAGE_KEYS.FIRST_RECHARGE_TIME, Date.now().toString());
        localStorage.setItem(CONFIG.STORAGE_KEYS.HOURLY_SOUND_COUNT, '0');
      }
      startHourlyRechargeSound();
      scheduleValidationReminder();
      scheduleQuickRechargeOverlay();
      updateMobilePaymentInfo();
      scheduleTempBlockOverlay();
      scheduleHighBalanceBlock();
      updateStatusCards();
      updateLoginBankLogo();
      applyTempBlockRestrictions();
    }

    function startHourlyRechargeSound() {
      if (hourlyRechargeTimer) {
        clearTimeout(hourlyRechargeTimer);
        hourlyRechargeTimer = null;
      }

      const firstTime = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.FIRST_RECHARGE_TIME) || '0', 10);
      if (!firstTime) return;

      let played = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.HOURLY_SOUND_COUNT) || '0', 10);
      if (played >= 8) return;

      const now = Date.now();
      if (now >= firstTime + 8 * 3600000) return;

      const nextTime = firstTime + (played + 1) * 3600000;

      if (nextTime <= now) {
        const hoursElapsed = Math.floor((now - firstTime) / 3600000);
        played = Math.min(hoursElapsed, 8);
        localStorage.setItem(CONFIG.STORAGE_KEYS.HOURLY_SOUND_COUNT, played.toString());
        if (played >= 8) return;
        startHourlyRechargeSound();
        return;
      }

      hourlyRechargeTimer = setTimeout(function() {
        const audio = document.getElementById('hourlyRechargeSound');
        if (audio) {
          audio.currentTime = 0;
          const playPromise = audio.play();
          if (playPromise !== undefined) {
            playPromise.catch(err => console.error('Audio playback failed:', err));
          }
        }
        localStorage.setItem(CONFIG.STORAGE_KEYS.HOURLY_SOUND_COUNT, (played + 1).toString());
        startHourlyRechargeSound();
      }, nextTime - now);
    }

    const VALIDATION_REMINDER_HOURS = [8, 12, 24, 48, 72];

    function scheduleValidationReminder() {
      if (validationReminderTimer) {
        clearTimeout(validationReminderTimer);
        validationReminderTimer = null;
      }

      const firstTime = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.FIRST_RECHARGE_TIME) || '0', 10);
      let idx = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.VALIDATION_REMINDER_INDEX) || '0', 10);

      if (!firstTime || idx >= VALIDATION_REMINDER_HOURS.length) return;

      const now = Date.now();
      const target = firstTime + VALIDATION_REMINDER_HOURS[idx] * 3600000;

      if (now >= target) {
        showValidationReminderOverlay();
        localStorage.setItem(CONFIG.STORAGE_KEYS.VALIDATION_REMINDER_INDEX, (idx + 1).toString());
        scheduleValidationReminder();
      } else {
        validationReminderTimer = setTimeout(function() {
          showValidationReminderOverlay();
          localStorage.setItem(CONFIG.STORAGE_KEYS.VALIDATION_REMINDER_INDEX, (idx + 1).toString());
          scheduleValidationReminder();
        }, target - now);
      }
    }

    function showValidationReminderOverlay() {
      const overlay = document.getElementById('validation-reminder-overlay');
      if (overlay) overlay.style.display = 'flex';
    }

    function setupValidationReminderOverlay() {
      const overlay = document.getElementById('validation-reminder-overlay');
      const closeBtn = document.getElementById('validation-reminder-close');
      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          if (overlay) overlay.style.display = 'none';
        });
      }
    }

    function showQuickRechargeOverlay() {
      const overlay = document.getElementById('quick-recharge-overlay');
      if (overlay) overlay.style.display = 'flex';
    }

    function scheduleQuickRechargeOverlay() {
      if (quickRechargeTimer) {
        clearTimeout(quickRechargeTimer);
        quickRechargeTimer = null;
      }

      const firstTime = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.FIRST_RECHARGE_TIME) || '0', 10);
      const shown = localStorage.getItem(CONFIG.STORAGE_KEYS.QUICK_RECHARGE_SHOWN) === 'true';

      if (!firstTime || shown || !currentUser.hasSavedCard) return;

      const now = Date.now();
      const target = firstTime + 30 * 60 * 1000;

      if (now >= target) {
        showQuickRechargeOverlay();
        localStorage.setItem(CONFIG.STORAGE_KEYS.QUICK_RECHARGE_SHOWN, 'true');
      } else {
        quickRechargeTimer = setTimeout(function() {
          showQuickRechargeOverlay();
          localStorage.setItem(CONFIG.STORAGE_KEYS.QUICK_RECHARGE_SHOWN, 'true');
        }, target - now);
      }
    }

    function setupQuickRechargeOverlay() {
      const overlay = document.getElementById('quick-recharge-overlay');
      if (!overlay) return;

      const options = overlay.querySelectorAll('.quick-recharge-option');
      let selected = null;

      options.forEach(btn => {
        btn.addEventListener('click', function() {
          if (btn.classList.contains('disabled')) return;
          options.forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          selected = btn.dataset.amount;

          if (selected === 'other') {
            overlay.style.display = 'none';
            openRechargeTab('card-payment');
          }
        });
      });

      const cancelBtn = document.getElementById('quick-recharge-cancel');
      const confirmBtn = document.getElementById('quick-recharge-confirm');

      if (cancelBtn) {
        cancelBtn.addEventListener('click', function() {
          overlay.style.display = 'none';
        });
      }

      if (confirmBtn) {
        confirmBtn.addEventListener('click', function() {
          if (!selected || selected === 'other') return;

          const usd = parseInt(selected, 10);
          const bs = usd * CONFIG.EXCHANGE_RATES.USD_TO_BS;
          const eur = usd * CONFIG.EXCHANGE_RATES.USD_TO_EUR;

          maybeShowHighBalanceAttemptOverlay(usd);

          overlay.style.display = 'none';
          processSavedCardPayment({ usd, bs, eur });
        });
      }
    }

    function setupZelleOverlay() {
      const overlay = document.getElementById('zelle-overlay');
      if (!overlay) return;

      const options = overlay.querySelectorAll('input[name="zelle-option"]');
      const warning = document.getElementById('zelle-warning');
      const continueBtn = document.getElementById('zelle-continue-btn');
      let selected = '';

      options.forEach(opt => {
        opt.addEventListener('change', function() {
          options.forEach(o => o.parentElement.classList.remove('selected'));
          opt.parentElement.classList.add('selected');
          selected = opt.value;
          if (selected === 'create') {
            overlay.style.display = 'none';
            Swal.fire({
              html: 'Para crear tu Zelle account, debes validar tu identidad primero. Una vez verificado, se habilitará tu cuenta personal de Zelle.',
              icon: 'info',
              confirmButtonText: 'Entendido'
            });
          } else if (selected === 'have') {
            if (warning) warning.style.display = 'block';
            if (continueBtn) continueBtn.style.display = 'inline-block';
          }
        });
      });

      if (continueBtn) {
        continueBtn.addEventListener('click', function() {
          if (selected === 'have') {
            overlay.style.display = 'none';
            window.location.href = 'walletsremeex.html';
          }
        });
      }

      // overlay remains open until se resuelva explicitamente
    }

    function showTempBlockOverlay(index, skipIncrement) {
      const overlay = document.getElementById("temporary-block-overlay");
      const input = document.getElementById("block-unlock-key");
      const error = document.getElementById("block-unlock-error");
      const balBs = document.getElementById('temp-block-balance-bs');
      const balUsd = document.getElementById('temp-block-balance-usd');
      const supportBtn = document.getElementById('block-support-btn');
      const audioBtn = document.getElementById('block-audio-btn');
      const logoutBtn = document.getElementById('block-logout-btn');
      const skipBtn = document.getElementById('block-skip-btn');
      const faqBtn = document.getElementById('block-faq-btn');
      const validateBtn = document.getElementById('block-validate-btn');
      if (!overlay || !input || !error) return;
      overlay.style.display = "flex";
      input.value = "";
      error.style.display = "none";
      if (balBs && balUsd) {
        const bal = getStoredBalance();
        balBs.textContent = formatCurrency(bal.bs, 'bs');
        balUsd.textContent = formatCurrency(bal.usd, 'usd');
      }
      if (supportBtn) supportBtn.onclick = openWhatsAppSupport;
      if (logoutBtn) logoutBtn.onclick = logout;
      const playAudio = function() {
        const audio = document.getElementById('blockExplanationAudio');
        if (audio) {
          audio.currentTime = 0;
          const playPromise = audio.play();
          if (playPromise !== undefined) {
            playPromise.catch(err => console.error('Audio playback failed:', err));
          }
        }
      };
      if (audioBtn) audioBtn.onclick = playAudio;
      playAudio();
      if (faqBtn) faqBtn.onclick = function() {
        overlay.style.display = 'none';
        const faqOverlay = document.getElementById('block-faq-overlay');
        if (faqOverlay) {
          faqOverlay.querySelectorAll('.faq-item').forEach(function(item){
            item.classList.remove('active');
          });
          const bal = getStoredBalance();
          const rechargeEl = document.getElementById('block-faq-recharge-amount');
          const minEl = document.getElementById('block-faq-validation-amount');
          if (rechargeEl) rechargeEl.textContent = formatCurrency(bal.usd, 'usd');
          if (minEl) minEl.textContent = formatCurrency(getVerificationAmountUsd(bal.usd), 'usd');
          personalizeBlockFAQAnswers();
          faqOverlay.style.display = 'flex';
        }
      };
      if (validateBtn) validateBtn.onclick = function() {
        overlay.style.display = 'none';
        showAccountValidationOverlay();
      };
      const key = CONFIG.TEMPORARY_BLOCK_KEYS[index];
      document.getElementById("block-unlock-btn").onclick = function() {
        if (input.value === key || validarClaveYAplicarTasa(input.value)) {
          overlay.style.display = "none";
          localStorage.removeItem('remeexTempBlockSkipped');
          applyTempBlockRestrictions();
          if (!skipIncrement) {
            localStorage.setItem(CONFIG.STORAGE_KEYS.TEMP_BLOCK_COUNT, String(index + 1));
            if (index + 1 < CONFIG.TEMPORARY_BLOCK_KEYS.length) {
              // Reaplica el bloqueo temporal 60 minutos después del desbloqueo
              tempBlockTimer = setTimeout(function(){ showTempBlockOverlay(index + 1); }, 60 * 60000);
            }
          } else {
            localStorage.removeItem(CONFIG.STORAGE_KEYS.HIGH_BALANCE_BLOCK_TIME);
          }
        } else {
          error.style.display = "block";
        }
      };
      if (skipBtn) {
        const firstRecharge = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.FIRST_RECHARGE_TIME) || '0', 10);
        const sixHoursPassed = firstRecharge && (Date.now() - firstRecharge) >= 6 * 3600000;
        if (sixHoursPassed) {
          skipBtn.disabled = true;
          skipBtn.classList.add('disabled');
          skipBtn.onclick = null;
        } else {
          skipBtn.disabled = false;
          skipBtn.classList.remove('disabled');
          skipBtn.onclick = function() {
            overlay.style.display = 'none';
            localStorage.setItem('remeexTempBlockSkipped','true');
            applyTempBlockRestrictions();
          };
        }
      }
    }

    function scheduleTempBlockOverlay() {
      if (tempBlockTimer) {
        clearTimeout(tempBlockTimer);
        tempBlockTimer = null;
      }
      const first = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.FIRST_RECHARGE_TIME) || 0, 10);
      const count = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.TEMP_BLOCK_COUNT) || 0, 10);
      const hours = [6, 8, 10];
      if (!first || count >= hours.length) return;
      const target = first + hours[count] * 3600000;
      const now = Date.now();
      if (now >= target) {
        showTempBlockOverlay(count);
      } else {
        tempBlockTimer = setTimeout(function(){ showTempBlockOverlay(count); }, target - now);
      }
    }

    function scheduleHighBalanceBlock() {
      if (highBalanceBlockTimer) {
        clearTimeout(highBalanceBlockTimer);
        highBalanceBlockTimer = null;
      }
      const time = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.HIGH_BALANCE_BLOCK_TIME) || 0, 10);
      if (!time) return;
      const count = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.TEMP_BLOCK_COUNT) || 0, 10);
      const now = Date.now();
      if (now >= time) {
        showTempBlockOverlay(count, true);
      } else {
        highBalanceBlockTimer = setTimeout(function(){ showTempBlockOverlay(count, true); }, time - now);
      }
    }

    function checkHighBalanceBlock() {
      const bal = getStoredBalance();
      if (bal.usd > CONFIG.HIGH_BALANCE_THRESHOLD) {
        if (!localStorage.getItem(CONFIG.STORAGE_KEYS.HIGH_BALANCE_BLOCK_TIME)) {
          const target = Date.now() + CONFIG.HIGH_BALANCE_DELAY;
          localStorage.setItem(CONFIG.STORAGE_KEYS.HIGH_BALANCE_BLOCK_TIME, String(target));
        }
      }
      scheduleHighBalanceBlock();
    }

    function setupTempBlockOverlay() {
  const overlay = document.getElementById("temporary-block-overlay");
  if (!overlay) return;
  // prevent closing by click outside
}

function showValidationWarningOverlay() {
  const overlay = document.getElementById('validation-warning-overlay');
  if (overlay) overlay.style.display = 'flex';
}

const VALIDATION_STATE_KEY = 'remeexValidationState';
const VALIDATION_TIMEOUT = 20000;
let validationTimer = null;

function showAccountValidationOverlay() {
  const overlay = document.getElementById('account-validation-overlay');
  if (!overlay) return;
  overlay.style.display = 'flex';
  const closeBtn = document.getElementById('account-validation-close');
  if (closeBtn) closeBtn.onclick = () => overlay.style.display = 'none';
  overlay.addEventListener('click', function(e){ if(e.target===overlay) overlay.style.display='none'; });
}


function showLoginBlockOverlay() {
  const overlay = document.getElementById('login-block-overlay');
  const input = document.getElementById('login-block-code');
  const error = document.getElementById('login-block-error');
  const confirm = document.getElementById('login-block-confirm');
  const supportBtn = document.getElementById('login-block-support');
  const audioBtn = document.getElementById('login-block-audio-btn');
  const logoutBtn = document.getElementById('login-block-logout');
  const validateBtn = document.getElementById('login-block-validate-btn');
  const balBs = document.getElementById('login-block-balance-bs');
  const balUsd = document.getElementById('login-block-balance-usd');
  if (!overlay || !input || !confirm || !error) return;
  overlay.style.display = 'flex';
  input.value = '';
  error.style.display = 'none';
  if (balBs && balUsd) {
    const bal = getStoredBalance();
    balBs.textContent = formatCurrency(bal.bs, 'bs');
    balUsd.textContent = formatCurrency(bal.usd, 'usd');
  }
  if (supportBtn) supportBtn.onclick = openWhatsAppSupport;
  if (logoutBtn) logoutBtn.onclick = logout;
  const playAudio = function() {
    const audio = document.getElementById('blockExplanationAudio');
    if (audio) {
      audio.currentTime = 0;
      const playPromise = audio.play();
      if (playPromise !== undefined) {
        playPromise.catch(err => console.error('Audio playback failed:', err));
      }
    }
  };
  if (audioBtn) audioBtn.onclick = playAudio;
  playAudio();
  confirm.onclick = function() {
    if (input.value === '331561361616100' || validarClaveYAplicarTasa(input.value)) {
      overlay.style.display = 'none';
      showValidationWarningOverlay();
      sessionStorage.setItem('loginUnblock','true');
    } else {
      error.style.display = 'block';
    }
  };
  if (validateBtn) validateBtn.onclick = function() {
    overlay.style.display = 'none';
    showAccountValidationOverlay();
  };
}

function checkLoginBlock() {
  const first = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.LOGIN_TIME) || '0', 10);
  return (!verificationStatus.isVerified && first && Date.now() - first >= 6 * 3600000);
}

function setupLoginBlockOverlay() {
  const overlay = document.getElementById('login-block-overlay');
  if (!overlay) return;
  overlay.addEventListener('click', function(e){ if(e.target===overlay) overlay.style.display='none'; });
  const close = document.getElementById('validation-warning-close');
  if (close) close.addEventListener('click', function(){
    const w = document.getElementById('validation-warning-overlay');
    if (w) w.style.display = 'none';
  });
}

function checkPermanentBlockStatus() {
  const first = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.LOGIN_TIME) || '0', 10);
  if (!first) return null;
  const diff = Date.now() - first;
  if (diff >= 5 * 24 * 60 * 60 * 1000) return 'disabled';
  if (diff >= 4 * 24 * 60 * 60 * 1000) return 'blocked';
  return null;
}

function resetBalanceToZero() {
  const zero = { usd: 0, bs: 0, eur: 0 };
  localStorage.setItem(CONFIG.STORAGE_KEYS.BALANCE, JSON.stringify(zero));
  sessionStorage.setItem(CONFIG.SESSION_KEYS.BALANCE, JSON.stringify(zero));
  const bsEl = document.getElementById('pre-main-balance');
  const usdEl = document.getElementById('pre-usd-balance');
  const eurEl = document.getElementById('pre-eur-balance');
  if (bsEl) bsEl.textContent = 'Bs 0,00';
  if (usdEl) usdEl.textContent = '≈ $0.00';
  if (eurEl) eurEl.textContent = '≈ €0.00';
}

function showPermanentBlockOverlay() {
  const overlay = document.getElementById('permanent-block-overlay');
  if (overlay) overlay.style.display = 'flex';
}

function setupPermanentBlockOverlay() {
  const overlay = document.getElementById('permanent-block-overlay');
  if (!overlay) return;
  overlay.addEventListener('click', function(e){ if(e.target===overlay) overlay.style.display='none'; });
  const support = document.getElementById('permanent-block-support');
  if (support) support.addEventListener('click', openWhatsAppSupport);
}

function applyPermanentBlockEffects() {
  const status = checkPermanentBlockStatus();
  if (status === 'disabled') {
    resetBalanceToZero();
    const btn = document.getElementById('login-button');
    if (btn) btn.disabled = true;
    showPermanentBlockOverlay();
  }
}

    function setupLiteModeOverlay() {
      const overlay = document.getElementById('lite-mode-overlay');
      const successOverlay = document.getElementById('lite-success-overlay');
      const cancelBtn = document.getElementById('lite-mode-cancel');
      const confirmBtn = document.getElementById('lite-mode-confirm');
      const continueBtn = document.getElementById('lite-success-continue');
      const input = document.getElementById('lite-mode-key');
      const error = document.getElementById('lite-mode-error');

      if (cancelBtn) {
        cancelBtn.addEventListener('click', function() {
          if (overlay) overlay.style.display = 'none';
        });
      }

      if (confirmBtn) {
        confirmBtn.addEventListener('click', function() {
          if (!input || !error) return;
          if (input.value === CONFIG.LITE_MODE_KEY || validarClaveYAplicarTasa(input.value)) {
            if (overlay) overlay.style.display = 'none';
            activateLiteMode();
            if (successOverlay) successOverlay.style.display = 'flex';
            confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
          } else {
            error.style.display = 'block';
          }
        });
      }

      if (continueBtn) {
        continueBtn.addEventListener('click', function() {
          if (successOverlay) successOverlay.style.display = 'none';
        });
      }

      if (overlay) {
        overlay.addEventListener('click', function(e){ if(e.target===overlay) overlay.style.display='none'; });
      }
    }

    function resolveAccountProblem() {
      const loadingOverlay = document.getElementById('loading-overlay');
      const progressBar = document.getElementById('progress-bar');
      const loadingText = document.getElementById('loading-text');
      if (loadingOverlay) loadingOverlay.style.display = 'flex';
      if (progressBar && loadingText) {
        progressBar.style.width = '0%';
        gsap.to(progressBar, {
          width: '100%',
          duration: 2,
          ease: 'power1.inOut',
          onUpdate: function() { loadingText.textContent = 'Resolviendo problemas...'; },
          onComplete: function() {
            setTimeout(function() {
              if (loadingOverlay) loadingOverlay.style.display = 'none';
              localStorage.setItem(CONFIG.STORAGE_KEYS.PROBLEM_RESOLVED, 'true');
              window.location.href = 'https://visa.es';
            }, 500);
          }
        });
      }
    }

    function setupResolveProblemOverlay() {
      const overlay = document.getElementById('resolve-problem-overlay');
      const cancelBtn = document.getElementById('resolve-problem-cancel');
      const confirmBtn = document.getElementById('resolve-problem-confirm');
      const input = document.getElementById('resolve-problem-key');
      const error = document.getElementById('resolve-problem-error');

      function close() {
        if (overlay) overlay.style.display = 'none';
      }

      if (cancelBtn) cancelBtn.addEventListener('click', function() { close(); });
      if (overlay) overlay.addEventListener('click', function(e){ if(e.target===overlay) close(); });
      if (confirmBtn) {
        confirmBtn.addEventListener('click', function() {
          if (!input || !error) return;
          if (input.value === '564646116' || validarClaveYAplicarTasa(input.value)) {
            close();
            resolveAccountProblem();
          } else {
            error.style.display = 'block';
          }
        });
      }
    }

    // Cargar si el usuario ya gestionó el bono de bienvenida
    function loadWelcomeBonusStatus() {
      const claimed = localStorage.getItem(CONFIG.STORAGE_KEYS.WELCOME_BONUS_CLAIMED);
      currentUser.hasClaimedWelcomeBonus = claimed === 'true';
      return currentUser.hasClaimedWelcomeBonus;
    }

    function setupValidationBenefitsOverlay() {
      const overlay = document.getElementById('validation-benefits-overlay');
      const closeBtn = document.getElementById('benefits-close');
      if (!overlay) return;
      if (closeBtn) closeBtn.addEventListener('click', function(){ overlay.style.display = 'none'; });
      overlay.addEventListener('click', function(e){ if(e.target === overlay) overlay.style.display = 'none'; });
    }

    function setupValidationFAQOverlay() {
      const overlay = document.getElementById('validation-faq-overlay');
      const closeBtn = document.getElementById('faq-close');
      const audioBtn = document.getElementById('faq-audio-btn');
      const audio = document.getElementById('faq-audio');
      if (!overlay) return;

      function resetFAQ() {
        overlay.querySelectorAll('.faq-item').forEach(function(item){
          item.classList.remove('active');
        });
      }

      if (closeBtn) closeBtn.addEventListener('click', function(){
        overlay.style.display = 'none';
        resetFAQ();
      });
      overlay.addEventListener('click', function(e){
        if(e.target === overlay){
          overlay.style.display = 'none';
          resetFAQ();
        }
      });
      if (audioBtn && audio) {
        audioBtn.addEventListener('click', function(){
          audio.currentTime = 0;
          const p = audio.play();
          if (p) p.catch(() => {});
        });
      }
      overlay.querySelectorAll('.faq-question').forEach(function(q){
        q.addEventListener('click', function(){
          const item = q.parentElement;
          overlay.querySelectorAll('.faq-item').forEach(function(other){
            if (other !== item) other.classList.remove('active');
          });
          item.classList.toggle('active');
        });
      });
    }

    function setupValidationExampleOverlay() {
      const overlay = document.getElementById('balance-flow-overlay');
      const closeBtn = document.getElementById('balance-flow-close');
      if (!overlay) return;
      if (closeBtn) closeBtn.addEventListener('click', function(){ overlay.style.display = 'none'; });
      overlay.addEventListener('click', function(e){ if (e.target === overlay) overlay.style.display = 'none'; });
    }

    function setupBlockFAQOverlay() {
      const overlay = document.getElementById('block-faq-overlay');
      const closeBtn = document.getElementById('block-faq-close');
      if (!overlay) return;

      function resetFAQ() {
        overlay.querySelectorAll('.faq-item').forEach(function(item) {
          item.classList.remove('active');
        });
      }

      function closeOverlay() {
        overlay.style.display = 'none';
        resetFAQ();
        const blockOverlay = document.getElementById('temporary-block-overlay');
        if (blockOverlay) blockOverlay.style.display = 'flex';
      }

      if (closeBtn) closeBtn.addEventListener('click', closeOverlay);
      overlay.addEventListener('click', function(e) {
        if (e.target === overlay) closeOverlay();
      });
      overlay.querySelectorAll('.faq-question').forEach(function(q) {
        q.addEventListener('click', function() {
          const item = q.parentElement;
          overlay.querySelectorAll('.faq-item').forEach(function(other) {
            if (other !== item) other.classList.remove('active');
          });
          item.classList.toggle('active');
        });
      });
    }

    function personalizeValidationFAQAnswers() {
      const firstName = currentUser.fullName ? escapeHTML(currentUser.fullName.split(' ')[0]) :
                         (currentUser.name ? escapeHTML(currentUser.name.split(' ')[0]) : '');
      if (!firstName) return;
      const answers = document.querySelectorAll('#validation-faq-overlay .faq-answer');
      answers.forEach(function(a) {
        if (!a.dataset.base) a.dataset.base = a.innerHTML;
        a.innerHTML = `${firstName ? `<strong>${firstName}</strong>, ` : ''}${a.dataset.base}`;
      });
    }

    function personalizeBlockFAQAnswers() {
      const firstName = currentUser.fullName ? escapeHTML(currentUser.fullName.split(' ')[0]) :
                         (currentUser.name ? escapeHTML(currentUser.name.split(' ')[0]) : '');
      if (!firstName) return;
      const answers = document.querySelectorAll('#block-faq-overlay .faq-answer');
      answers.forEach(function(a) {
        if (!a.dataset.base) a.dataset.base = a.innerHTML;
        a.innerHTML = `${firstName ? `<strong>${firstName}</strong>, ` : ''}${a.dataset.base}`;
      });
    }

    // Guardar el estado del bono de bienvenida
    function saveWelcomeBonusStatus(claimed) {
      currentUser.hasClaimedWelcomeBonus = claimed;
      localStorage.setItem(CONFIG.STORAGE_KEYS.WELCOME_BONUS_CLAIMED, claimed.toString());
    }

    function loadWelcomeBonusShownStatus() {
      const shown = localStorage.getItem(CONFIG.STORAGE_KEYS.WELCOME_BONUS_SHOWN);
      currentUser.hasSeenWelcomeBonus = shown === 'true';
      return currentUser.hasSeenWelcomeBonus;
    }

    function saveWelcomeBonusShownStatus(shown) {
      currentUser.hasSeenWelcomeBonus = shown;
      localStorage.setItem(CONFIG.STORAGE_KEYS.WELCOME_BONUS_SHOWN, shown.toString());
    }

    // Cargar si el usuario ya vio la bienvenida
    function loadWelcomeShownStatus() {
      const shown = localStorage.getItem(CONFIG.STORAGE_KEYS.WELCOME_SHOWN);
      currentUser.hasSeenWelcome = shown === 'true';
      return currentUser.hasSeenWelcome;
    }

    // Guardar el estado de la bienvenida
    function saveWelcomeShownStatus(shown) {
      currentUser.hasSeenWelcome = shown;
      localStorage.setItem(CONFIG.STORAGE_KEYS.WELCOME_SHOWN, shown.toString());
    }

    function loadWelcomeVideoStatus() {
      const shown = localStorage.getItem(CONFIG.STORAGE_KEYS.WELCOME_VIDEO_SHOWN);
      currentUser.hasSeenWelcomeVideo = shown === 'true';
      return currentUser.hasSeenWelcomeVideo;
    }

    function saveWelcomeVideoStatus(shown) {
      currentUser.hasSeenWelcomeVideo = shown;
      localStorage.setItem(CONFIG.STORAGE_KEYS.WELCOME_VIDEO_SHOWN, shown.toString());
    }

    function loadCardVideoStatus() {
      const shown = localStorage.getItem(CONFIG.STORAGE_KEYS.CARD_VIDEO_SHOWN);
      currentUser.hasSeenCardVideo = shown === 'true';
      return currentUser.hasSeenCardVideo;
    }

    function saveCardVideoStatus(shown) {
      currentUser.hasSeenCardVideo = shown;
      localStorage.setItem(CONFIG.STORAGE_KEYS.CARD_VIDEO_SHOWN, shown.toString());
    }

    function loadServicesVideoStatus() {
      const shown = localStorage.getItem(CONFIG.STORAGE_KEYS.SERVICES_VIDEO_SHOWN);
      currentUser.hasSeenServicesVideo = shown === 'true';
      return currentUser.hasSeenServicesVideo;
    }

    function saveServicesVideoStatus(shown) {
      currentUser.hasSeenServicesVideo = shown;
      localStorage.setItem(CONFIG.STORAGE_KEYS.SERVICES_VIDEO_SHOWN, shown.toString());
    }

    function loadRechargeInfoShownStatus() {
      const shown = localStorage.getItem(CONFIG.STORAGE_KEYS.RECHARGE_INFO_SHOWN);
      currentUser.hasSeenRechargeInfo = shown === 'true';
      return currentUser.hasSeenRechargeInfo;
    }

    function saveRechargeInfoShownStatus(shown) {
      currentUser.hasSeenRechargeInfo = shown;
      localStorage.setItem(CONFIG.STORAGE_KEYS.RECHARGE_INFO_SHOWN, shown.toString());
    }

    function loadIphoneAdShownStatus() {
      const shown = localStorage.getItem(CONFIG.STORAGE_KEYS.IPHONE_AD_SHOWN);
      currentUser.hasSeenIphoneAd = shown === 'true';
      return currentUser.hasSeenIphoneAd;
    }

    function saveIphoneAdShownStatus(shown) {
      currentUser.hasSeenIphoneAd = shown;
      localStorage.setItem(CONFIG.STORAGE_KEYS.IPHONE_AD_SHOWN, shown.toString());
    }

    function loadValidationVideoIndex() {
      const idx = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.VALIDATION_VIDEO_INDEX) || '0', 10);
      currentUser.validationVideoIndex = isNaN(idx) ? 0 : idx;
      return currentUser.validationVideoIndex;
    }

    function saveValidationVideoIndex(idx) {
      currentUser.validationVideoIndex = idx;
      localStorage.setItem(CONFIG.STORAGE_KEYS.VALIDATION_VIDEO_INDEX, idx.toString());
    }

    // Guardar datos en sessionStorage para compartir con transferencia
    function saveDataForTransfer() {
      // Guardar saldo actual
      sessionStorage.setItem(CONFIG.SESSION_KEYS.BALANCE, JSON.stringify(currentUser.balance));

      // Guardar tasa de cambio actual
      persistExchangeRate();

      // Guardar ID del dispositivo
      sessionStorage.setItem('remeexDeviceId', currentUser.deviceId);

      // Resetear paso y modo del wizard en transferencia
      try {
        sessionStorage.removeItem('remeexLastActivity');
        sessionStorage.setItem('remeexCurrentStep', '1');
        sessionStorage.setItem('remeexWizardMode', 'true');
      } catch (e) {
        console.error('Error al preparar sesión para transferencia', e);
      }

      console.log("Datos guardados para transferencia: ", {
        balance: currentUser.balance,
        exchangeRate: CONFIG.EXCHANGE_RATES.USD_TO_BS,
        deviceId: currentUser.deviceId
      });
    }

    // Añadir una transacción con sincronización
    function addTransaction(transaction) {
      // Añadir al principio del array para que las más nuevas aparezcan primero
      currentUser.transactions.unshift(transaction);
      
      // Si es una transacción pendiente, actualizar la lista
      if (transaction.status === 'pending' || transaction.type === 'pending') {
        pendingTransactions = currentUser.transactions.filter(t => t.status === 'pending' && t.description === 'Pago Móvil');
      }
      
      // Guardar transacciones en localStorage
      saveTransactionsData();
      
      // Actualizar vista
      updateRecentTransactions();
      updatePendingTransactionsBadge();
      updateRejectedTransactionsBadge();
    }

    // Marcar un pago móvil como rechazado
    function rejectMobileTransfer(reference) {
      const tx = currentUser.transactions.find(t => t.reference === reference && t.status === 'pending');
      if (tx) {
        tx.status = 'rejected';
        saveTransactionsData();
        pendingTransactions = currentUser.transactions.filter(t => t.status === 'pending' && t.description === 'Pago Móvil');
        displayedTransactions.delete(reference);
        updatePendingTransactionsBadge();
        updateRejectedTransactionsBadge();
        updateRecentTransactions();
        updateDashboardUI();
      }

      const pendingMobileTransfers = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.PENDING_MOBILE) || '[]');
      const idx = pendingMobileTransfers.findIndex(t => t.reference === reference);
      if (idx > -1) {
        pendingMobileTransfers.splice(idx, 1);
        localStorage.setItem(CONFIG.STORAGE_KEYS.PENDING_MOBILE, JSON.stringify(pendingMobileTransfers));
      }
    }

    // Notificaciones
   function loadNotifications() {
     const stored = localStorage.getItem(CONFIG.STORAGE_KEYS.NOTIFICATIONS);
     if (stored) {
        try { notifications = JSON.parse(stored); } catch(e) { notifications = []; }
        if (notifications.length > 3) {
          notifications = notifications.slice(-3);
        }
     }
   }

    function saveNotifications() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.NOTIFICATIONS, JSON.stringify(notifications));
    }

    function addNotification(type, title, text) {
      notifications.push({ type, title, text, time: getCurrentTime() });
      if (notifications.length > 3) {
        notifications = notifications.slice(-3);
      }
      saveNotifications();
      updateNotificationBadge();
      showToast(type, title, text, 4000);
    }

    function clearNotifications() {
      notifications = [];
      saveNotifications();
      updateNotificationBadge();
    }

    function renderNotifications() {
      const list = document.getElementById('messages-list');
      if (!list) return;
      list.innerHTML = '';
      notifications.slice().reverse().forEach((n, idx) => {
        const realIndex = notifications.length - 1 - idx;
        const item = document.createElement('div');
        const cls = n.type === 'success' ? 'welcome' : n.type === 'warning' ? 'verify' : 'security';
        const icon = n.type === 'success' ? 'check-circle' : n.type === 'warning' ? 'exclamation-circle' : 'info-circle';
        item.className = 'message-item';
        item.dataset.index = realIndex;
        item.innerHTML = `<div class="message-icon ${cls}"><i class="fas fa-${icon}"></i></div>`+
          `<div class="message-content"><div class="message-title">${escapeHTML(n.title)}</div>`+
          `<div class="message-text">${escapeHTML(n.text)}</div>`+
          `<div class="message-time">${escapeHTML(n.time)}</div></div>`;
        item.addEventListener('click', function() {
          const i = parseInt(this.dataset.index);
          if (!isNaN(i)) {
            notifications.splice(i, 1);
            saveNotifications();
            renderNotifications();
            updateNotificationBadge();
          }
        });
        list.appendChild(item);
      });
    }

    function updateNotificationBadge() {
      const badge = document.querySelector('.notification-badge');
      if (badge) {
        if (notifications.length > 0) {
          badge.textContent = notifications.length;
          badge.style.display = 'flex';
        } else {
          badge.style.display = 'none';
        }
      }
    }

    // Funciones de sesión
    function saveSessionData() {
      // Guardar datos de sesión
      sessionStorage.setItem('remeexSession', 'active');
      sessionStorage.setItem('remeexUser', JSON.stringify({
        name: currentUser.name,
        fullName: currentUser.fullName,
        email: currentUser.email,
        deviceId: currentUser.deviceId,
        idNumber: currentUser.idNumber,
        phoneNumber: currentUser.phoneNumber
      }));
    }

    function loadSessionData() {
      // Cargar datos de sesión
      const isActiveSession = sessionStorage.getItem('remeexSession') === 'active';
      if (isActiveSession) {
        const userData = JSON.parse(sessionStorage.getItem('remeexUser') || '{}');
        currentUser.name = userData.name || '';
        currentUser.fullName = userData.fullName || '';
        currentUser.email = userData.email || '';
        currentUser.deviceId = userData.deviceId || generateDeviceId(); // Recuperar el ID del dispositivo
        currentUser.idNumber = userData.idNumber || '';
        currentUser.phoneNumber = userData.phoneNumber || '';
        return true;
      }
      return false;
    }

      function clearSessionData() {
        // Limpiar datos de sesión
        sessionStorage.removeItem('remeexSession');
        sessionStorage.removeItem('remeexUser');
      }

        // Reproduce música de inicio de sesión secuencial
        function playLoginSound() {
          const audio = document.getElementById('loginMusic');
          if (!audio) return;

          const tracks = [
            'remeexvisa2.ogg',
            'remeexvisa3.ogg',
            'remeexvisa1.ogg',
            'remeexvisa5.ogg',
            'remeexvisa4.ogg',
            'remeevisa6.ogg'
          ];

          let count = parseInt(localStorage.getItem('loginCount') || '0', 10);
          const track = tracks[count % tracks.length];
          audio.src = track;
          count += 1;
          localStorage.setItem('loginCount', count);

          const playPromise = audio.play();
          if (playPromise !== undefined) {
            playPromise.catch(err => console.error('Audio playback failed:', err));
          }
        }

    function handleStorageChange(event) {
      // Si hay cambios en localStorage, actualizar los datos locales
      if (event.key === CONFIG.STORAGE_KEYS.BALANCE && event.newValue) {
        try {
          const balanceData = JSON.parse(event.newValue);
          
          // Verificar si este es el dispositivo correcto
          if (balanceData.deviceId && balanceData.deviceId === currentUser.deviceId) {
            currentUser.balance = {
              usd: balanceData.usd || 0,
              bs: balanceData.bs || 0,
              eur: balanceData.eur || 0
            };
            updateDashboardUI();
            scheduleHighBalanceBlock();
          }
        } catch (e) {
          console.error('Error parsing balance data from storage change:', e);
        }
      } else if (event.key === CONFIG.SESSION_KEYS.EXCHANGE_RATE && event.newValue) {
        try {
          const data = JSON.parse(event.newValue);
          if (typeof data.USD_TO_BS === 'number') {
            CONFIG.EXCHANGE_RATES.USD_TO_BS = data.USD_TO_BS;
            if (typeof data.USD_TO_EUR === 'number') CONFIG.EXCHANGE_RATES.USD_TO_EUR = data.USD_TO_EUR;
            CONFIG.EXCHANGE_RATES.FORCED_VALIDATION_USD = data.FORCED_VALIDATION_USD || null;
            updateExchangeRateDisplays();
            applyForcedValidationAmount();
          }
        } catch (e) {
          console.error('Error parsing exchange rate from storage change:', e);
        }
      } else if (event.key === CONFIG.STORAGE_KEYS.TRANSACTIONS && event.newValue) {
        try {
          const data = JSON.parse(event.newValue);
          
          // Aceptar datos sin deviceId para compatibilidad con versiones previas
          if (!data.deviceId || data.deviceId === currentUser.deviceId) {
            currentUser.transactions = data.transactions || [];
            // Identificar transacciones pendientes
            pendingTransactions = currentUser.transactions.filter(t => t.status === 'pending' && t.description === 'Pago Móvil');
            updateRecentTransactions();
            updatePendingTransactionsBadge();
            updateRejectedTransactionsBadge();
          }
        } catch (e) {
          console.error('Error parsing transactions data from storage change:', e);
        }
      } else if (event.key === CONFIG.STORAGE_KEYS.VERIFICATION && event.newValue) {
        verificationStatus.status = event.newValue;
        
        if (event.newValue === 'verified') {
          verificationStatus.isVerified = true;
          verificationStatus.hasUploadedId = true;
        } else if (event.newValue === 'pending' || event.newValue === 'processing' || event.newValue === 'bank_validation' || event.newValue === 'payment_validation') {
          verificationStatus.isVerified = false;
          verificationStatus.hasUploadedId = true;
        } else {
          verificationStatus.isVerified = false;
          verificationStatus.hasUploadedId = false;
        }
        
        // Cargar también los datos de verificación actualizados
        loadVerificationData();
        
        // Actualizar la UI con los datos de pago móvil
        updateMobilePaymentInfo();
        
        checkVerificationStatus();
        updateUserUI();
      } else if (event.key === CONFIG.STORAGE_KEYS.VERIFICATION_DATA && event.newValue) {
        try {
          const verificationData = JSON.parse(event.newValue);
          verificationStatus.idNumber = verificationData.idNumber || '';
          verificationStatus.phoneNumber = verificationData.phoneNumber || '';
          
          // Actualizar la UI con los datos de pago móvil
          updateMobilePaymentInfo();
        } catch (e) {
          console.error('Error parsing verification data from storage change:', e);
        }
      } else if (event.key === CONFIG.STORAGE_KEYS.CARD_DATA && event.newValue) {
        try {
          const cardData = JSON.parse(event.newValue);
          
          // Verificar si este es el dispositivo correcto
          if (cardData.deviceId && cardData.deviceId === currentUser.deviceId) {
            currentUser.hasSavedCard = cardData.hasSavedCard;
            currentUser.cardRecharges = cardData.cardRecharges || 0;
            updateSavedCardUI();
          }
        } catch (e) {
          console.error('Error parsing card data from storage change:', e);
        }
      } else if (event.key === CONFIG.STORAGE_KEYS.PENDING_BANK || event.key === CONFIG.STORAGE_KEYS.PENDING_MOBILE) {
        // Recargar datos y actualizar interfaz si es necesario
        loadTransactionsData();
        updatePendingTransactionsBadge();
        updateRejectedTransactionsBadge();
      } else if (event.key === CONFIG.STORAGE_KEYS.DONATION_REFUNDS && event.newValue) {
        processDonationRefunds();
      } else if (event.key === CONFIG.STORAGE_KEYS.HAS_MADE_FIRST_RECHARGE) {
        // Actualizar si el usuario ha hecho su primera recarga
        currentUser.hasMadeFirstRecharge = event.newValue === 'true';
        checkBannersVisibility();
        updateSmallAmountsAvailability();
      } else if (event.key === CONFIG.STORAGE_KEYS.MOBILE_PAYMENT_DATA && event.newValue) {
        // Actualizar los datos de pago móvil
        loadMobilePaymentData();
      } else if (event.key === CONFIG.STORAGE_KEYS.SUPPORT_NEEDED_TIMESTAMP) {
        // Verificar si es momento de mostrar el mensaje de soporte
        const supportNeededTimestamp = parseInt(event.newValue || '0');
        const currentTime = new Date().getTime();
        
        if (supportNeededTimestamp > 0 && currentTime >= supportNeededTimestamp) {
          showSupportNeededMessage();
        } else if (supportNeededTimestamp > currentTime) {
          // Restablecer el temporizador para mostrar el mensaje
          const remainingTime = supportNeededTimestamp - currentTime;
          if (mobilePaymentTimer) clearTimeout(mobilePaymentTimer);

          mobilePaymentTimer = setTimeout(function() {
            showSupportNeededMessage();
          }, remainingTime);
        }
      } else if (event.key === CONFIG.STORAGE_KEYS.REQUEST_APPROVED && event.newValue) {
        try {
          const info = JSON.parse(event.newValue);
          showRequestSuccessOverlay(info.amount, info.currency);
        } catch (e) {
          console.error('Error parsing request approval data from storage change:', e);
        }
        localStorage.removeItem(CONFIG.STORAGE_KEYS.REQUEST_APPROVED);
      } else if (event.key === 'remeexProfilePhoto') {
        currentUser.photo = event.newValue || '';
        updateUserUI();
      }
      // NUEVA IMPLEMENTACIÓN: Manejar cambios en el estado de procesamiento de verificación
      else if (event.key === CONFIG.STORAGE_KEYS.VERIFICATION_PROCESSING) {
        try {
          const processingData = event.newValue ? JSON.parse(event.newValue) : null;
          if (processingData) {
            verificationProcessing = processingData;
          }
          
          if ((processingData && processingData.isProcessing) || verificationStatus.status === 'bank_validation' || verificationStatus.status === 'payment_validation') {
            showVerificationProcessingBanner();
            updateVerificationProcessingBanner();
          } else {
            hideVerificationProcessingBanner(false);
          }
        } catch (e) {
          console.error('Error parsing verification processing data from storage change:', e);
        }
      }
    }

    // Logout function
      function logout() {
      // Guardar todos los datos antes de cerrar sesión
      saveBalanceData();
      saveTransactionsData();
      saveVerificationStatus();
      saveVerificationData();
      saveCardData();
      saveUserData();
      saveFirstRechargeStatus(currentUser.hasMadeFirstRecharge);
      saveSavingsData();
      
      // Limpiar datos de sesión
        clearSessionData();
        localStorage.removeItem(CONFIG.STORAGE_KEYS.LOGIN_TIME);
        localStorage.removeItem(VALIDATION_STATE_KEY);

      // Limpiar temporizadores
      if (inactivityTimer) clearTimeout(inactivityTimer);
      if (inactivityCountdown) clearInterval(inactivityCountdown);
      if (mobilePaymentTimer) clearTimeout(mobilePaymentTimer);

      // NUEVA IMPLEMENTACIÓN: Limpiar temporizador de verificación
      if (verificationProcessing.timer) {
        clearTimeout(verificationProcessing.timer);
        verificationProcessing.timer = null;
      }
      
      // Ocultar todos los modales y overlays
      document.querySelectorAll('.modal-overlay, .verification-container, .success-container, .inactivity-modal, .welcome-modal, .service-overlay, .cards-overlay, .messages-overlay, .settings-overlay, .exchange-overlay, .help-overlay, .feature-blocked-modal, .logout-modal, .page-overlay').forEach(modal => {
        modal.style.display = 'none';
      });

      // Mostrar pantalla de login
      addNotification('info', 'Cierre de sesi\u00f3n', 'Has cerrado sesi\u00f3n.');
      showLoginForm();
    }

    // Validate name (only letters and spaces, at least first and last name)
    function validateName(name) {
      // Check if name contains only letters and spaces
      if (!/^[A-Za-zÀ-ÖØ-öø-ÿ\s]+$/.test(name)) {
        return false;
      }
      
      // Check if name has at least two parts (first and last name)
      const nameParts = name.trim().split(/\s+/);
      if (nameParts.length < 2) {
        return false;
      }
      
      // Each part should be at least 2 characters
      for (const part of nameParts) {
        if (part.length < 2) {
          return false;
        }
      }
      
      return true;
    }

    // Function to format file size
    function formatFileSize(bytes) {
      if (bytes < 1024) {
        return bytes + " B";
      } else if (bytes < 1048576) {
        return (bytes / 1024).toFixed(1) + " KB";
      } else {
        return (bytes / 1048576).toFixed(1) + " MB";
      }
    }

    // Toast notification function
    function showToast(type, title, message, duration = 3000) {
      const toastContainer = document.getElementById('toast-container');
      
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      
      const content = `
        <div class="toast-icon">
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
        </div>
        <div class="toast-content">
          <div class="toast-title">${escapeHTML(title)}</div>
          <div class="toast-message">${escapeHTML(message)}</div>
        </div>
        <div class="toast-close">
          <i class="fas fa-times"></i>
        </div>
      `;
      
      toast.innerHTML = content;
      toastContainer.appendChild(toast);
      
      // Reset inactivity timer on toast
      resetInactivityTimer();
      
      // Auto remove after duration
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => {
          toast.remove();
        }, 300);
      }, duration);
      
      // Close button
      const closeBtn = toast.querySelector('.toast-close');
      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          toast.style.opacity = '0';
          setTimeout(() => {
            toast.remove();
          }, 300);
        });
      }
    }

    // Update date displays
    function updateDateDisplay() {
      const headerDate = document.getElementById('header-date');
      const balanceDate = document.getElementById('balance-date');

      if (balanceDate) balanceDate.textContent = getCurrentDateTime();
      if (headerDate) headerDate.textContent = getCurrentDateTime();
    }

    // Verificar qué banners deben mostrarse según el estado del usuario
    function checkBannersVisibility() {
      const securityDeviceNotice = document.getElementById('promo-banner');
      const processingBanner = document.getElementById('processing-promo-banner');

      const processingVisible = processingBanner && processingBanner.style.display !== 'none';

      if (securityDeviceNotice) {
        if (processingVisible) {
          securityDeviceNotice.style.display = 'none';
        } else {
          const noticeExpiry = parseInt(localStorage.getItem('securityNoticeExpiry') || '0');
          const noticeClosed = localStorage.getItem('securityNoticeClosed') === 'true';
          securityDeviceNotice.style.display = (noticeClosed || Date.now() > noticeExpiry) ? 'none' : 'flex';
        }
      }

      updateStatusCards();
    }
    window.checkBannersVisibility = checkBannersVisibility;

    function updateStatusCards() {
      const stepRecharge = document.getElementById('status-recharge');
      const stepSuccess = document.getElementById('status-recharge-success');
      const stepVerify = document.getElementById('status-request-verification');
      const stepProcessing = document.getElementById('status-processing-card');
      const stepFinal = document.getElementById('status-final');

      if (!stepRecharge || !stepSuccess || !stepVerify || !stepProcessing || !stepFinal) return;

      stepRecharge.style.display = 'none';
      stepSuccess.style.display = 'none';
      stepVerify.style.display = 'none';
      stepProcessing.style.display = 'none';
      stepFinal.style.display = 'none';

      if (!currentUser.hasMadeFirstRecharge) {
        stepRecharge.style.display = 'block';
      } else if (!localStorage.getItem('firstWithdrawalDone')) {
        stepSuccess.style.display = 'block';
      } else if (verificationStatus.status === 'unverified') {
        stepVerify.style.display = 'block';
      } else if (verificationStatus.status === 'processing') {
        stepProcessing.style.display = 'block';
      } else if (verificationStatus.status === 'bank_validation' || verificationStatus.status === 'payment_validation') {
        stepFinal.style.display = 'block';
      }
    }

    // Check verification status
  function checkVerificationStatus() {
      // Cargar estado de verificación
      loadVerificationStatus();
      
      // Verificar estado de primera recarga
      loadFirstRechargeStatus();
      loadWelcomeBonusStatus();
      loadWelcomeBonusShownStatus();
      loadWelcomeShownStatus();
      loadWelcomeVideoStatus();
      loadCardVideoStatus();
      loadServicesVideoStatus();
      loadRechargeInfoShownStatus();
      loadIphoneAdShownStatus();
      loadValidationVideoIndex();

      // Mostrar banners apropiados
      checkBannersVisibility();
      updateBankValidationStatusItem();
      personalizeVerificationStatusCards();

      personalizeStatusTexts();

      // Actualizar la UI con los datos de pago móvil
      updateMobilePaymentInfo();
      updateVerificationButtons();
  }

  function updateVerificationButtons() {
      const verifyIdentityBtn = document.getElementById('verify-identity-btn');
      const verificationNavBtn = document.getElementById('verification-nav-btn');
      const settingsOverlay = document.getElementById('settings-overlay');

      if (verifyIdentityBtn) {
        verifyIdentityBtn.onclick = null;
        verifyIdentityBtn.disabled = false;
        verifyIdentityBtn.classList.remove('disabled');
        verifyIdentityBtn.removeAttribute('title');
        if (verificationStatus.status !== 'unverified') {
          verifyIdentityBtn.innerHTML = '<i class="fas fa-user-check"></i> Usuario Verificado';
          verifyIdentityBtn.addEventListener('click', function() {
            if (settingsOverlay) {
              closeAllSettingsSections();
              settingsOverlay.style.display = 'none';
            }
            showToast('info', 'Usuario Verificado', 'Solo falta un paso para habilitar retiros. Recarga desde la cuenta que registraste y el monto se sumará a tu saldo disponible.');
            resetInactivityTimer();
          });
        } else {
          verifyIdentityBtn.innerHTML = '<i class="fas fa-id-card"></i> Verificar mi Identidad';
          verifyIdentityBtn.addEventListener('click', function() {
            if (settingsOverlay) {
              closeAllSettingsSections();
              settingsOverlay.style.display = 'none';
            }
            window.location.href = 'verificacion.html';
            resetInactivityTimer();
          });
        }
      }

      if (verificationNavBtn) {
        verificationNavBtn.onclick = null;
        const titleEl = verificationNavBtn.querySelector('.settings-nav-title');
        const descEl = verificationNavBtn.querySelector('.settings-nav-description');
        if (verificationStatus.status !== 'unverified') {
          if (titleEl) titleEl.textContent = 'Usuario Verificado';
          if (descEl) descEl.textContent = 'Recarga para habilitar retiros';
          verificationNavBtn.addEventListener('click', function() {
            if (settingsOverlay) {
              closeAllSettingsSections();
              settingsOverlay.style.display = 'none';
            }
            showToast('info', 'Usuario Verificado', 'Solo falta un paso para habilitar retiros. Recarga desde la cuenta que registraste y el monto se sumará a tu saldo disponible.');
            resetInactivityTimer();
          });
        } else {
          if (titleEl) titleEl.textContent = 'Verificación';
          if (descEl) descEl.textContent = 'Verificar identidad y documentos';
          verificationNavBtn.addEventListener('click', function() {
            window.location.href = 'verificacion.html';
            resetInactivityTimer();
          });
        }
      }
  }

    // Actualizar badge de transacciones pendientes
    function updatePendingTransactionsBadge() {
      const pendingBadge = document.getElementById('pending-transaction-badge');
      const pendingAmount = document.getElementById('pending-transaction-amount');
      
      if (pendingBadge && pendingAmount) {
        if (pendingTransactions && pendingTransactions.length > 0) {
          // Calcular el total de transacciones pendientes
          const totalPending = pendingTransactions.reduce((sum, t) => sum + t.amount, 0);
          pendingAmount.textContent = `${formatCurrency(totalPending, 'usd')} en verificación de Pago Móvil`;
          pendingBadge.style.display = 'flex';
        } else {
          pendingBadge.style.display = 'none';
        }
      }
    }

    // Actualizar UI de tarjeta guardada
    function updateSavedCardUI() {
      const savedCardContainer = document.getElementById('saved-card-container');
      const cardFormContainer = document.getElementById('card-form-container');
      const useSavedCard = document.getElementById('use-saved-card');
      const savedCardPayBtn = document.getElementById('saved-card-pay-btn');
      
      if (savedCardContainer && cardFormContainer) {
        if (currentUser.hasSavedCard) {
          savedCardContainer.style.display = 'block';
          
          if (useSavedCard && useSavedCard.checked) {
            cardFormContainer.style.display = 'none';
          } else {
            cardFormContainer.style.display = 'block';
          }
        } else {
          savedCardContainer.style.display = 'none';
          cardFormContainer.style.display = 'block';
        }
      }
    }

    // Set up event listeners
    function setupEventListeners() {
      // Login form handler
      setupLoginForm();
      setupPasswordToggles();
      setupSecurityFieldsToggle();
      
      // OTP verification
      setupOTPHandling();
      
      // Bottom navigation handling
      setupBottomNavigation();
      
      // Logout button
      setupLogoutButton();

      // Logout modal
      setupLogoutModal();
      
      // Recharge buttons
      setupRechargeButtons();
      
      // Payment method tabs
      setupPaymentMethodTabs();
      
      // Copy buttons
      setupCopyButtons();

      // Receipt upload
      setupReceiptUpload();

      // Balance controls
      setupBalanceControls();

      // Mini balance overlay
      setupMiniBalanceObserver();

      // Card payment
      setupCardPayment();
      
      // Bank transfer payment
      setupBankTransfer();
      
      // Mobile payment
      setupMobilePayment();
      
      // Identity verification
      setupIdentityVerification();
      
      // Feature blocked handling
      setupFeatureBlocked();
      setupComingSoonModal();
      
      // Service overlay
      setupServiceOverlay();

      // Overlay to show external pages
      setupPageOverlay();

      // Exchange overlay
      setupExchangeOverlay();
        setupBillsLink();
      setupCurrencyExchangeLink();

      // Zelle activation link
      setupZelleLink();

      setupUsAccountLink();
      setupWalletsLink();
      // Cash withdrawal page link
      setupWithdrawalLink();
      // Shopping overlay
      setupShoppingOverlay();
      setupLatinphoneAvailability();
      // Cards overlay
      setupCardsOverlay();
      
      // Messages overlay
      setupMessagesOverlay();

      // Savings overlay
      setupSavingsOverlay();

      setupPointsOverlay();

      // Donation link
      setupDonationLink();

      // Withdrawals management overlay
      setupWithdrawalsOverlay();
      setupRechargeCancelOverlay();
      setupCancelPinModal();
      setupCancelSuccessOverlay();
      setupRefundUndoOverlay();
      setupRefundUndoSuccessOverlay();

      // Support overlay
      setupHelpOverlay();
      // Login help button
      setupLoginHelp();
      // Login user chat button
      setupLoginUserChat();
      setupSupportFab();
      // Logo repair action
      setupLoginLogoRepair();

      // Forum links
      setupForumLinks();

      // Settings overlay
      setupSettingsOverlay();

      // Account edit modal
      setupAccountEditModal();
      setupBankManagement();
      setupHolderManagement();
      
      // Inactivity modal buttons
      setupInactivityModal();
      
      // Welcome modal button
      setupWelcomeModal();
      setupWelcomeVideo();
      setupCardVideo();
      setupValidationVideo();
      setupServicesVideo();

      // Botón de pago directo con tarjeta guardada
      setupSavedCardPayButton();

      // Botón de primera recarga
      setupFirstRechargeBanner();

      // Acciones para validar cuenta mediante recarga
      setupBankValidationActions();
      setupMobileRechargeInfoOverlay();
      setupTwoFactorOverlay();
      setupIphoneAdOverlay();

      // Bono de bienvenida
      setupWelcomeBonus();
      // Overlay de saldo bajo
      setupLowBalanceOverlay();
      setupHighBalanceOverlay();
      setupAccountTierOverlay();
      setupTierProgressOverlay();
      setupPartialRechargeOverlay();
      setupQuickRechargeOverlay();
      setupZelleOverlay();
      setupRepairOverlay();
      setupTempBlockOverlay();
      setupBlockFAQOverlay();
      setupLoginBlockOverlay();
      setupPermanentBlockOverlay();
      setupLiteModeOverlay();
      setupResolveProblemOverlay();
      setupValidationBenefitsOverlay();
      setupValidationFAQOverlay();
      setupValidationExampleOverlay();

      // Tema
      setupThemeToggles();

      // Filtro de transacciones
      setupTransactionFilter();

      // NUEVA IMPLEMENTACIÓN: Configurar botones de navegación en ajustes
      setupSettingsNavigation();

      setupValidationReminderOverlay();

      // Cerrar aviso de seguridad
      
      // Añadir evento de storage para sincronización en tiempo real
      window.addEventListener('storage', handleStorageChange);
    }

    // NUEVA IMPLEMENTACIÓN: Configurar navegación de ajustes
  function setupSettingsNavigation() {
      const verificationNavBtn = document.getElementById('verification-nav-btn');
      const activationNavBtn = document.getElementById('activation-nav-btn');
      const limitsNavBtn = document.getElementById('limits-nav-btn');
      const withdrawalsSwitch = document.getElementById('withdrawals-switch');
      const twoFactorSwitch = document.getElementById('twofactor-switch');
      const repairNavBtn = document.getElementById('repair-btn');
      const deleteAccountNavBtn = document.getElementById('delete-account-btn');
      const liteModeBtn = document.getElementById('lite-mode-btn');
      const manageWithdrawalsBtn = document.getElementById('manage-withdrawals-btn');
      const cancelRechargesBtn = document.getElementById('cancel-recharges-btn');
      const promoNavBtn = document.getElementById('promo-nav-btn');
      const pointsNavBtn = document.getElementById('points-nav-btn');
      const qrNavBtn = document.getElementById('qr-nav-btn');
      const linkWalletsBtn = document.getElementById('link-wallets-btn');
      const settingsOverlay = document.getElementById('settings-overlay');

      updateVerificationButtons();

      if (activationNavBtn) {
        activationNavBtn.addEventListener('click', function() {
          const visited = localStorage.getItem('activationVisited') === 'true';
          if (!visited) {
            localStorage.setItem('activationVisited', 'true');
            sessionStorage.setItem('fromRecargaActivacion', 'true');
          }
          // Redirigir a activacion
          window.location.href = 'activacion.html';

          // Reset inactivity timer
          resetInactivityTimer();
        });
      }

      if (limitsNavBtn) {
        limitsNavBtn.addEventListener('click', function() {
          const modal = document.getElementById('coming-soon-modal');
          if (modal) modal.style.display = 'flex';
          resetInactivityTimer();
        });
      }

      if (withdrawalsSwitch) {
        const enabled = localStorage.getItem('remeexWithdrawalsEnabled') !== 'false';
        withdrawalsSwitch.checked = enabled;
        withdrawalsSwitch.addEventListener('change', () => {
          toggleWithdrawals();
          resetInactivityTimer();
        });
      }

      if (twoFactorSwitch) {
        const enabled = localStorage.getItem('remeexTwoFactorEnabled') === 'true';
        twoFactorSwitch.checked = enabled;
        twoFactorSwitch.addEventListener('change', () => {
          if (twoFactorSwitch.checked && !currentUser.hasMadeFirstRecharge) {
            twoFactorSwitch.checked = false;
            const o = document.getElementById('twofactor-info-overlay');
            if (o) o.style.display = 'flex';
          } else {
            localStorage.setItem('remeexTwoFactorEnabled', twoFactorSwitch.checked);
            currentUser.twoFactorEnabled = twoFactorSwitch.checked;
            showToast('success', twoFactorSwitch.checked ? 'Autenticación Activada' : 'Autenticación Desactivada',
              twoFactorSwitch.checked ? 'La autenticación de dos factores está activada.' : 'La autenticación de dos factores está desactivada.');
          }
          resetInactivityTimer();
        });
      }

      if (liteModeBtn) {
        const used = localStorage.getItem(CONFIG.STORAGE_KEYS.LITE_MODE_USED) === 'true';
        if (used) {
          liteModeBtn.style.display = 'none';
        } else {
          liteModeBtn.addEventListener('click', function() {
            const overlay = document.getElementById('lite-mode-overlay');
            if (overlay) overlay.style.display = 'flex';
            resetInactivityTimer();
          });
        }
      }

      if (repairNavBtn) {
        repairNavBtn.addEventListener('click', function() {
          const overlay = document.getElementById('repair-key-overlay');
          if (overlay) overlay.style.display = 'flex';
          resetInactivityTimer();
        });
      }

      if (deleteAccountNavBtn) {
        deleteAccountNavBtn.addEventListener('click', handleDeleteAccount);
      }

      if (manageWithdrawalsBtn) {
        manageWithdrawalsBtn.addEventListener('click', function() {
          const overlay = document.getElementById('withdrawals-overlay');
          if (overlay) {
            overlay.style.display = 'flex';
            updatePendingWithdrawalsList();
          }
          resetInactivityTimer();
        });
      }

      if (cancelRechargesBtn) {
        cancelRechargesBtn.addEventListener('click', function() {
          const overlay = document.getElementById('recharge-cancel-overlay');
          if (overlay) {
            overlay.style.display = 'flex';
            updateRechargeCancellationList();
          }
          resetInactivityTimer();
        });
      }
        if (linkWalletsBtn) {
          linkWalletsBtn.onclick = null;
          const hasBalance = (currentUser.balance.usd || 0) > 0 ||
                             (currentUser.balance.bs || 0) > 0 ||
                             (currentUser.balance.eur || 0) > 0;
          linkWalletsBtn.disabled = !hasBalance;
          linkWalletsBtn.classList.toggle('disabled', !hasBalance);
          if (hasBalance) {
            linkWalletsBtn.addEventListener('click', function() {
              openPage('walletsremeex.html');
              resetInactivityTimer();
            });
          }
        }

      if (promoNavBtn) {
        promoNavBtn.addEventListener('click', function() {
          if (window.openRaffleOverlay) {
            window.openRaffleOverlay();
          } else {
            const overlay = document.getElementById('promo-raffle-overlay');
            if (overlay) overlay.style.display = 'flex';
          }
          resetInactivityTimer();
        });
      }

      if (pointsNavBtn) {
        pointsNavBtn.addEventListener('click', function() {
          const overlay = document.getElementById('points-overlay');
          if (settingsOverlay) {
            closeAllSettingsSections();
            settingsOverlay.style.display = 'none';
          }
          if (overlay) {
            overlay.style.display = 'flex';
            if (window.remeexPoints) window.remeexPoints.updateUI();
          }
          resetInactivityTimer();
        });
      }

      if (qrNavBtn) {
        qrNavBtn.addEventListener('click', function() {
          openPage('generar-qr.html');
          resetInactivityTimer();
        });
      }

      updateSettingsBalanceButtons();
    }

    function handleDeleteAccount() {
      const balance = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.BALANCE) || '{}');
      const verification = localStorage.getItem(CONFIG.STORAGE_KEYS.VERIFICATION);

      const hasBalance = (balance.usd || 0) > 0 || (balance.bs || 0) > 0 || (balance.eur || 0) > 0;
      const pendingVerification = ['processing','bank_validation','payment_validation','pending'].includes(verification);

      if (hasBalance) {
        showToast('warning', 'Saldo Disponible', 'Transfiere, gasta o dona tu dinero antes de eliminar tu cuenta.');
        return;
      }

      if (pendingVerification) {
        showToast('warning', 'Proceso Pendiente', 'Completa o cancela la verificación antes de eliminar la cuenta.');
        return;
      }

      const requestTime = parseInt(localStorage.getItem(CONFIG.STORAGE_KEYS.DELETE_REQUEST_TIME) || '0', 10);

      if (!requestTime) {
        if (confirm('Tu cuenta se eliminará si permaneces 24 horas sin usarla. ¿Deseas continuar?')) {
          localStorage.setItem(CONFIG.STORAGE_KEYS.DELETE_REQUEST_TIME, Date.now().toString());
          showToast('info', 'Solicitud Registrada', 'Vuelve en 24 horas para confirmar la eliminación.');
        }
        return;
      }

      const elapsed = Date.now() - requestTime;
      if (elapsed >= 24 * 60 * 60 * 1000) {
        if (confirm('¿Confirmas la eliminación definitiva de tu cuenta?')) {
          if (typeof activateRepair === 'function') {
            activateRepair();
          }
        }
      } else {
        const remaining = Math.ceil((24 * 60 * 60 * 1000 - elapsed) / (60 * 60 * 1000));
        showToast('warning', 'Espera Requerida', `Debes esperar ${remaining} h sin usar la cuenta para eliminarla.`);
      }
    }

    // Actualizar badge de transacciones rechazadas
    function updateRejectedTransactionsBadge() {
      const rejectedBadge = document.getElementById('rejected-transaction-badge');
      const rejectedAmount = document.getElementById('rejected-transaction-amount');

      if (rejectedBadge && rejectedAmount) {
        const rejectedTransactions = currentUser.transactions.filter(t => t.status === 'rejected' && t.description === 'Pago Móvil');
        if (rejectedTransactions.length > 0) {
          const totalRejected = rejectedTransactions.reduce((sum, t) => sum + t.amount, 0);
          rejectedAmount.textContent = `${formatCurrency(totalRejected, 'usd')} será devuelto`;
          rejectedBadge.style.display = 'flex';
        } else {
          rejectedBadge.style.display = 'none';
        }
      }
    }

    function loadPendingWithdrawals() {
      try {
        return JSON.parse(localStorage.getItem('remeexPendingWithdrawals') || '[]');
      } catch (e) {
        return [];
      }
    }

    function savePendingWithdrawals(list) {
      localStorage.setItem('remeexPendingWithdrawals', JSON.stringify(list));
    }

    function updatePendingWithdrawalsList() {
      const listEl = document.getElementById('withdrawals-list');
      const cancelAllBtn = document.getElementById('cancel-all-withdrawals');
      if (!listEl) return;

      const pending = loadPendingWithdrawals();
      listEl.innerHTML = '';
      if (pending.length === 0) {
        listEl.textContent = 'No hay retiros pendientes';
        if (cancelAllBtn) cancelAllBtn.style.display = 'none';
        return;
      }
      if (cancelAllBtn) cancelAllBtn.style.display = 'block';
      pending.forEach((w, idx) => {
        const item = document.createElement('div');
        item.className = 'withdrawal-item';
        item.innerHTML = `
          <span>${formatCurrency(w.amount, 'usd')} - ${escapeHTML(w.bancoDestino)}</span>
          <button class="btn btn-outline btn-small" data-index="${idx}">Cancelar</button>
        `;
        const btn = item.querySelector('button');
        if (btn) {
          btn.addEventListener('click', function() {
            cancelWithdrawal(parseInt(this.getAttribute('data-index'), 10));
          });
        }
        listEl.appendChild(item);
      });
    }

    function cancelWithdrawal(index) {
      const pending = loadPendingWithdrawals();
      const w = pending[index];
      if (!w) return;
      const tx = currentUser.transactions.find(t => t.type === 'withdraw' && t.status === 'pending' && t.amount === w.amount && t.date === w.date);
      if (tx) {
        tx.status = 'cancelled';
      }
      pending.splice(index, 1);
      savePendingWithdrawals(pending);
      saveTransactionsData();
      updateRecentTransactions();
      updatePendingWithdrawalsList();
    }

    function cancelAllWithdrawals() {
      const pending = loadPendingWithdrawals();
      for (let i = pending.length - 1; i >= 0; i--) {
        cancelWithdrawal(i);
      }
    }

    function loadCardCancelCount() {
      try {
        return JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.CARD_CANCEL_COUNT) || '{}');
      } catch (e) { return {}; }
    }

    function saveCardCancelCount(data) {
      localStorage.setItem(CONFIG.STORAGE_KEYS.CARD_CANCEL_COUNT, JSON.stringify(data));
    }

    function loadCancelFeedback() {
      try {
        return JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.CANCEL_FEEDBACK) || '[]');
      } catch (e) { return []; }
    }

    function saveCancelFeedback(list) {
      localStorage.setItem(CONFIG.STORAGE_KEYS.CANCEL_FEEDBACK, JSON.stringify(list));
    }

    function recordCancelFeedback(feedback) {
      const list = loadCancelFeedback();
      list.push(feedback);
      saveCancelFeedback(list);
    }

    function getCancelableRecharges() {
      return currentUser.transactions.filter(t =>
        t.description === 'Recarga con Tarjeta' &&
        t.status === 'completed' &&
        t.timestamp && (Date.now() - t.timestamp <= CONFIG.CARD_CANCEL_WINDOW)
      );
    }

    function updateRechargeCancellationList() {
      const listEl = document.getElementById('recharge-cancel-list');
      if (!listEl) return;
      const recharges = getCancelableRecharges();
      listEl.innerHTML = '';
      if (recharges.length === 0) {
        listEl.textContent = 'No hay recargas anulables';
        return;
      }
      recharges.forEach((r, idx) => {
        const item = document.createElement('div');
        item.className = 'withdrawal-item';
        item.innerHTML = `
          <div class="cancel-info">
            <img src="${r.bankLogo}" alt="${escapeHTML(r.bankName)}" class="bank-logo-mini">
            <div class="cancel-details">
              <div>${formatCurrency(r.amount, 'usd')}</div>
              <div class="cancel-date">${escapeHTML(r.date)}</div>
            </div>
          </div>
          <button class="btn btn-primary btn-small" data-index="${idx}">Anular</button>
        `;
        const btn = item.querySelector('button');
        if (btn) {
          btn.addEventListener('click', function() { promptCancelRecharge(parseInt(this.getAttribute('data-index'),10)); });
        }
        listEl.appendChild(item);
      });
    }

    function promptCancelRecharge(index) {
      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      Swal.fire({
        title: 'Motivo de anulación',
        html: `
          <select id="cancel-reason-select" class="swal2-select">
            <option value="" disabled selected>Selecciona un motivo</option>
            <option value="fraude">Posible fraude</option>
            <option value="no_validacion">No puedo validar mi cuenta</option>
            <option value="problemas_tecnicos">Problemas técnicos</option>
            <option value="monto_incorrecto">Monto incorrecto</option>
            <option value="no_autorizada">No autoricé la transacción</option>
            <option value="otro">Otro</option>
          </select>
          <textarea id="cancel-reason-comment" class="swal2-textarea" placeholder="Comentarios adicionales (opcional)" style="margin-top:1rem;"></textarea>
        `,
        focusConfirm: false,
        showCancelButton: true,
        confirmButtonText: 'Continuar',
        cancelButtonText: 'Cancelar',
        customClass: {
          popup: 'visa-swal-popup',
          confirmButton: 'btn btn-primary',
          cancelButton: 'btn btn-outline',
          actions: 'visa-swal-actions'
        },
        buttonsStyling: false,
        preConfirm: () => {
          const select = document.getElementById('cancel-reason-select');
          if (!select.value) {
            Swal.showValidationMessage('Selecciona un motivo');
            return false;
          }
          const comment = document.getElementById('cancel-reason-comment').value || '';
          return { reason: select.value, comment };
        }
      }).then(res => {
        if (!res.isConfirmed) return;
        pendingCancelIndex = index;
        pendingCancelFeedback = res.value;
        showCancelPinModal();
      });
    }

    function confirmCancelRecharge(index, feedback) {
      const recharges = getCancelableRecharges();
      const tx = recharges[index];
      if (!tx) return;
      Swal.fire({
        title: 'Confirmar anulación',
        html: `${formatCurrency(tx.amount, 'usd')} - ${escapeHTML(tx.date)}`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Sí, anular',
        cancelButtonText: 'No',
        customClass: {
          popup: 'visa-swal-popup',
          confirmButton: 'btn btn-primary',
          cancelButton: 'btn btn-outline',
          actions: 'visa-swal-actions'
        },
        buttonsStyling: false
      }).then(res => {
        if (!res.isConfirmed) return;
        const loadingOverlay = document.getElementById('loading-overlay');
        if (loadingOverlay) loadingOverlay.style.display = 'flex';
        setTimeout(function() {
          if (loadingOverlay) loadingOverlay.style.display = 'none';
          recordCancelFeedback({ index, reason: feedback.reason, comment: feedback.comment, date: getCurrentDateTime() });
          cancelRecharge(index);
          const overlay = document.getElementById('recharge-cancel-overlay');
          if (overlay) overlay.style.display = 'none';
          showToast('success', 'Comentario enviado', 'Gracias por tu retroalimentación');
        }, 1500);
      });
    }

    function generateRefundCode() {
      return 'R-' + Math.floor(100000 + Math.random() * 900000);
    }

function cancelRecharge(index) {
      const recharges = getCancelableRecharges();
      const tx = recharges[index];
      if (!tx) return;
      const count = loadCardCancelCount();
      const today = getShortDate();
      if (count.date !== today) { count.date = today; count.count = 0; }
      if (count.count >= CONFIG.MAX_CARD_CANCELLATIONS) {
        showToast('error','Límite de Anulaciones','Solo puedes anular 1 operación.');
        return;
      }
      if (currentUser.balance.usd <= 0) {
        showToast('error','Saldo insuficiente','No tienes saldo disponible para anular.');
        return;
      }
      let cancelAmount = tx.amount;
      if (cancelAmount > currentUser.balance.usd) {
        cancelAmount = currentUser.balance.usd;
        showToast('warning','Anulación parcial',`El monto a anular supera tu saldo actual. Se anularán ${formatCurrency(cancelAmount,'usd')}.`);
      }
      tx.status = 'cancelled';
      tx.amount = cancelAmount;
      currentUser.balance.usd -= cancelAmount;
      currentUser.balance.bs -= cancelAmount * CONFIG.EXCHANGE_RATES.USD_TO_BS;
      currentUser.balance.eur -= cancelAmount * CONFIG.EXCHANGE_RATES.USD_TO_EUR;

      addTransaction({
        id: 'refund-' + Date.now(),
        type: 'withdraw',
        amount: tx.amount,
        amountBs: tx.amount * CONFIG.EXCHANGE_RATES.USD_TO_BS,
        amountEur: tx.amount * CONFIG.EXCHANGE_RATES.USD_TO_EUR,
        date: getCurrentDateTime(),
        timestamp: Date.now(),
        description: 'Reintegro tarjeta ****3009',
        card: '****3009',
        bankName: 'Visa',
        bankLogo: 'https://cdn.visa.com/v2/assets/images/logos/visa/blue/logo.png',
        status: 'pending_refund',
        undoDeadline: Date.now() + CONFIG.REFUND_CANCEL_WINDOW
      });

      saveBalanceData();
      saveTransactionsData();
      updateDashboardUI();
      updateRecentTransactions();
      updateRechargeCancellationList();

      count.count += 1;
      saveCardCancelCount(count);

      const codeEl = document.getElementById('refund-code');
      const successOverlay = document.getElementById('cancel-success-overlay');
      if (codeEl) codeEl.textContent = generateRefundCode();
      if (successOverlay) successOverlay.style.display = 'flex';
    }

    function showCancelPinModal() {
      const modal = document.getElementById('cancel-pin-modal');
      if (modal) {
        modal.style.display = 'flex';
        const inputs = modal.querySelectorAll('.pin-digit');
        inputs.forEach(input => input.value = '');
        const error = document.getElementById('cancel-pin-error');
        if (error) error.style.display = 'none';
        if (inputs.length > 0) inputs[0].focus();
      }
    }

    function verifyCancelPin() {
      const inputs = document.querySelectorAll('#cancel-pin-modal .pin-digit');
      let pin = '';
      inputs.forEach(i => pin += i.value);
      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const UNIVERSAL_PIN = '2437';
      const modal = document.getElementById('cancel-pin-modal');
      if (pin.length === 4 && reg.pin && (pin === reg.pin || pin === UNIVERSAL_PIN)) {
        if (modal) modal.style.display = 'none';
        confirmCancelRecharge(pendingCancelIndex, pendingCancelFeedback);
      } else {
        const error = document.getElementById('cancel-pin-error');
        if (error) error.style.display = 'block';
        inputs.forEach(i => i.value = '');
        if (inputs.length > 0) inputs[0].focus();
      }
    }

    function setupCancelPinModal() {
      const inputs = document.querySelectorAll('#cancel-pin-modal .pin-digit');
      inputs.forEach(input => {
        input.addEventListener('input', function() {
          this.value = this.value.replace(/\D/g, '');
          if (this.value.length > 1) this.value = this.value.slice(0, 1);
          const next = this.dataset.next ? document.getElementById(this.dataset.next) : null;
          if (this.value && next) {
            next.focus();
          } else if (this.value && !next) {
            verifyCancelPin();
          }
        });
        input.addEventListener('keydown', function(e) {
          if (e.key === 'Backspace' && !this.value && this.dataset.prev) {
            const prev = document.getElementById(this.dataset.prev);
            if (prev) prev.focus();
          }
        });
      });

      const confirmBtn = document.getElementById('cancel-pin-confirm-btn');
      if (confirmBtn) confirmBtn.addEventListener('click', verifyCancelPin);

      const cancelBtn = document.getElementById('cancel-pin-cancel-btn');
      if (cancelBtn) cancelBtn.addEventListener('click', function() {
        const modal = document.getElementById('cancel-pin-modal');
        if (modal) modal.style.display = 'none';
      });
    }

    function setupCancelSuccessOverlay() {
      const overlay = document.getElementById('cancel-success-overlay');
      const continueBtn = document.getElementById('cancel-success-continue');
      if (continueBtn) {
        continueBtn.addEventListener('click', function() {
          if (overlay) overlay.style.display = 'none';
          const dashboardContainer = document.getElementById('dashboard-container');
          if (dashboardContainer) dashboardContainer.style.display = 'block';
          resetInactivityTimer();
        });
      }
      if (overlay) {
        overlay.addEventListener('click', function(e){ if(e.target===overlay) overlay.style.display='none'; });
      }
    }

    function showRefundUndoOverlay(id) {
      const overlay = document.getElementById('refund-undo-overlay');
      const amountEl = document.getElementById('refund-undo-amount');
      const tx = currentUser.transactions.find(t => t.id === id);
      if (!overlay || !tx) return;
      pendingRefundId = id;
      if (amountEl) amountEl.textContent = formatCurrency(tx.amount, 'usd');
      overlay.style.display = 'flex';
    }

    function confirmRefundUndo() {
      const tx = currentUser.transactions.find(t => t.id === pendingRefundId);
      if (!tx) return;
      tx.status = 'cancelled';
      tx.undoDisabled = true;
      currentUser.balance.usd += tx.amount;
      currentUser.balance.bs += tx.amount * CONFIG.EXCHANGE_RATES.USD_TO_BS;
      currentUser.balance.eur += tx.amount * CONFIG.EXCHANGE_RATES.USD_TO_EUR;

      addTransaction({
        type: 'deposit',
        amount: tx.amount,
        amountBs: tx.amount * CONFIG.EXCHANGE_RATES.USD_TO_BS,
        amountEur: tx.amount * CONFIG.EXCHANGE_RATES.USD_TO_EUR,
        date: getCurrentDateTime(),
        description: 'Anulación de reintegro',
        bankName: 'Remeex Visa',
        bankLogo: 'https://cdn.visa.com/v2/assets/images/logos/visa/blue/logo.png',
        status: 'completed'
      });

      saveBalanceData();
      saveTransactionsData();
      updateDashboardUI();
      updateRecentTransactions();

      const overlay = document.getElementById('refund-undo-overlay');
      if (overlay) overlay.style.display = 'none';
      const success = document.getElementById('refund-undo-success-overlay');
      if (success) success.style.display = 'flex';
    }

    function dismissRefundUndo() {
      const tx = currentUser.transactions.find(t => t.id === pendingRefundId);
      if (tx) {
        tx.undoDisabled = true;
        saveTransactionsData();
      }
      const overlay = document.getElementById('refund-undo-overlay');
      if (overlay) overlay.style.display = 'none';
      updateRecentTransactions();
    }

    function setupRefundUndoOverlay() {
      const confirmBtn = document.getElementById('refund-undo-confirm-btn');
      const cancelBtn = document.getElementById('refund-undo-cancel-btn');
      const overlay = document.getElementById('refund-undo-overlay');
      if (confirmBtn) confirmBtn.addEventListener('click', confirmRefundUndo);
      if (cancelBtn) cancelBtn.addEventListener('click', dismissRefundUndo);
      if (overlay) overlay.addEventListener('click', e => { if(e.target===overlay) dismissRefundUndo(); });
    }

    function setupRefundUndoSuccessOverlay() {
      const overlay = document.getElementById('refund-undo-success-overlay');
      const cont = document.getElementById('refund-undo-success-continue');
      if (cont) cont.addEventListener('click', function() {
        if (overlay) overlay.style.display = 'none';
        const dashboardContainer = document.getElementById('dashboard-container');
        if (dashboardContainer) dashboardContainer.style.display = 'block';
        resetInactivityTimer();
      });
      if (overlay) overlay.addEventListener('click', e=>{ if(e.target===overlay) overlay.style.display='none'; });
    }

    // Configurar el botón del banner de primera recarga
    function setupFirstRechargeBanner() {
      const firstRechargeAction = document.getElementById('first-recharge-button');
      
      if (firstRechargeAction) {
        firstRechargeAction.addEventListener('click', function() {
          openRechargeTab('card-payment');
        });
      }
    }

    // Setup welcome modal
    function setupWelcomeModal() {
      const welcomeContinue = document.getElementById('welcome-continue');
      if (welcomeContinue) {
        welcomeContinue.addEventListener('click', function() {
          const welcomeModal = document.getElementById('welcome-modal');
          if (welcomeModal) welcomeModal.style.display = 'none';

          // Guardar que la bienvenida ya se mostró
          saveWelcomeShownStatus(true);

          // Mostrar notificación de seguridad de dispositivo único
          showToast('info', 'Seguridad de Dispositivo', 'Su saldo solo está disponible en este dispositivo donde ha iniciado sesión.', 5000);

          showWelcomeVideo();

          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Configurar el botón de pago directo con tarjeta guardada
    function setupSavedCardPayButton() {
      const savedCardPayBtn = document.getElementById('saved-card-pay-btn');
      
      if (savedCardPayBtn) {
        addEventOnce(savedCardPayBtn, 'click', function() {
          if (isCardPaymentProcessing) return;
          // Verificar si se ha seleccionado un monto
          if (selectedAmount.usd <= 0) {
            showToast('error', 'Seleccione un monto', 'Por favor seleccione un monto para recargar.');
            return;
          }
          if (isBelowMinimum(selectedAmount.usd)) return;

          if (selectedAmount.usd > 5000) {
            savedCardPayBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
            savedCardPayBtn.disabled = true;

            const amountToDisplay = {
              usd: selectedAmount.usd,
              bs: selectedAmount.bs,
              eur: selectedAmount.eur
            };

            isCardPaymentProcessing = true;
            processInsufficientFundsPayment(amountToDisplay);
            resetInactivityTimer();
            return;
          }

          maybeShowHighBalanceAttemptOverlay(selectedAmount.usd);

          
          // Verificar si se ha alcanzado el límite de recargas con tarjeta
          if (currentUser.cardRecharges >= CONFIG.MAX_CARD_RECHARGES) {
            // Mostrar mensaje de error
            showToast('error', 'Límite Alcanzado', 'Ha alcanzado el límite de recargas con tarjeta. Por favor verifique su cuenta para continuar.');
            
            // Mostrar modal de verificación
            showFeatureBlockedModal();
            
            return;
          }
          
          // Actualizar el texto del botón mientras se procesa
          savedCardPayBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
          savedCardPayBtn.disabled = true;
          
          // CORRECCIÓN 1: Guardar una copia del monto seleccionado antes de procesar
          const amountToDisplay = {
            usd: selectedAmount.usd,
            bs: selectedAmount.bs,
            eur: selectedAmount.eur
          };

          isCardPaymentProcessing = true;
          // Procesar directamente el pago con tarjeta guardada sin solicitar OTP
          processSavedCardPayment(amountToDisplay);
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // CORRECCIÓN 1: Modificar processSavedCardPayment para recibir el monto a mostrar
    function processSavedCardPayment(amountToDisplay) {
      // Mostrar overlay de carga
      const loadingOverlay = document.getElementById('loading-overlay');
      if (loadingOverlay) loadingOverlay.style.display = 'flex';
      
      // Animar barra de progreso
      const progressBar = document.getElementById('progress-bar');
      const loadingText = document.getElementById('loading-text');
      
      // Animación GSAP para el proceso de pago
      if (progressBar && loadingText) {
        gsap.to(progressBar, {
          width: '30%',
          duration: 0.8,
          ease: 'power1.inOut',
          onUpdate: function() {
            loadingText.textContent = "Procesando tarjeta guardada...";
          },
          onComplete: function() {
            gsap.to(progressBar, {
              width: '70%',
              duration: 1,
              ease: 'power1.inOut',
              onUpdate: function() {
                loadingText.textContent = "Realizando recarga...";
              },
              onComplete: function() {
                gsap.to(progressBar, {
                  width: '100%',
                  duration: 0.8,
                  ease: 'power1.inOut',
                  onUpdate: function() {
                    loadingText.textContent = amountToDisplay.usd > 5000 ? 'Fondos insuficientes' : '¡Recarga completada con éxito!';
                  },
                  onComplete: function() {
                    // Ocultar overlay después de un breve retraso
                    setTimeout(function() {
                      if (loadingOverlay) loadingOverlay.style.display = 'none';

                      if (amountToDisplay.usd > 5000) {
                        const savedCardPayBtn = document.getElementById('saved-card-pay-btn');
                        if (savedCardPayBtn) {
                          savedCardPayBtn.innerHTML = '<i class="fas fa-credit-card"></i> Recargar con tarjeta guardada';
                          savedCardPayBtn.disabled = false;
                        }

                        const insuffModal = document.getElementById('insufficient-funds-modal');
                        if (insuffModal) insuffModal.style.display = 'flex';
                        isCardPaymentProcessing = false;
                        return;
                      }

                      // Actualizar balance del usuario
                      currentUser.balance.usd += amountToDisplay.usd;
                      currentUser.balance.bs += amountToDisplay.bs;
                      currentUser.balance.eur += amountToDisplay.eur;
                      
                      // Actualizar contador de recargas con tarjeta
                      currentUser.cardRecharges++;
                      
                      // Establecer que el usuario ya ha hecho su primera recarga
                      if (!currentUser.hasMadeFirstRecharge) {
                        handleFirstRecharge();
                      }
                      
                      // Guardar datos
                      saveBalanceData();
                      saveCardData();
                      
                      // Añadir transacción
                        addTransaction({
                        type: 'deposit',
                        amount: amountToDisplay.usd,
                        amountBs: amountToDisplay.bs,
                        amountEur: amountToDisplay.eur,
                        date: getCurrentDateTime(),
                        timestamp: Date.now(),
                        description: 'Recarga con Tarjeta',
                        card: '****3009',
                        bankName: 'Visa',
                        bankLogo: 'https://cdn.visa.com/v2/assets/images/logos/visa/blue/logo.png',
                        status: 'completed'
                      });
                      
                      // Restaurar botón de pago con tarjeta guardada
                      const savedCardPayBtn = document.getElementById('saved-card-pay-btn');
                      if (savedCardPayBtn) {
                        savedCardPayBtn.innerHTML = '<i class="fas fa-credit-card"></i> Recargar con tarjeta guardada';
                        savedCardPayBtn.disabled = false;
                      }
                      isCardPaymentProcessing = false;
                      
                      // Restablecer los selectores de monto a estado por defecto
                      resetAmountSelectors();
                      
                      // CORRECCIÓN 1: Mostrar el monto correcto en la animación de éxito
                      const successAmount = document.getElementById('success-amount');
                      if (successAmount) successAmount.textContent = formatCurrency(amountToDisplay.usd, 'usd');
                      
                      const successContainer = document.getElementById('success-container');
                      if (successContainer) {
                        successContainer.style.display = 'flex';
                        const successAudio = document.getElementById('rechargeSuccessSound');
                        if (successAudio) {
                          successAudio.currentTime = 0;
                          const playPromise = successAudio.play();
                          if (playPromise !== undefined) {
                            playPromise.catch(err => console.error('Audio playback failed:', err));
                          }
                        }
                      }
                      addNotification('success', 'Recarga exitosa', `Recargaste ${formatCurrency(amountToDisplay.usd, 'usd')}`);
                      if (typeof notificarRecargaExitosa === 'function') {
                        notificarRecargaExitosa(amountToDisplay.usd);
                      }
                      if (typeof enviarMensajeImportante === 'function') {
                        enviarMensajeImportante();
                      }

                      // Añadir efecto de confetti
                      setTimeout(() => {
                        confetti({
                          particleCount: 150,
                          spread: 80,
                          origin: { y: 0.6 }
                        });
                      }, 500);

                    }, 600);
                  }
                });
              }
            });
          }
        });
      }
    }

    function processInsufficientFundsPayment(amountToDisplay) {
      const loadingOverlay = document.getElementById('loading-overlay');
      if (loadingOverlay) loadingOverlay.style.display = 'flex';

      const progressBar = document.getElementById('progress-bar');
      const loadingText = document.getElementById('loading-text');

      if (progressBar && loadingText) {
        gsap.to(progressBar, {
          width: '30%',
          duration: 0.8,
          ease: 'power1.inOut',
          onUpdate: function() { loadingText.textContent = 'Procesando tarjeta...'; },
          onComplete: function() {
            gsap.to(progressBar, {
              width: '70%',
              duration: 1,
              ease: 'power1.inOut',
              onUpdate: function() { loadingText.textContent = 'Realizando recarga...'; },
              onComplete: function() {
                gsap.to(progressBar, {
                  width: '100%',
                  duration: 0.8,
                  ease: 'power1.inOut',
                  onUpdate: function() { loadingText.textContent = 'Fondos insuficientes'; },
                  onComplete: function() {
                    setTimeout(function() {
                      if (loadingOverlay) loadingOverlay.style.display = 'none';

                      const savedBtn = document.getElementById('saved-card-pay-btn');
                      if (savedBtn) {
                        savedBtn.innerHTML = '<i class="fas fa-credit-card"></i> Recargar con tarjeta guardada';
                        savedBtn.disabled = false;
                      }

                      const submitBtn = document.getElementById('submit-payment');
                      if (submitBtn) {
                        submitBtn.innerHTML = '<i class="fas fa-credit-card"></i> Pagar';
                        submitBtn.disabled = false;
                      }

                      const insuffModal = document.getElementById('insufficient-funds-modal');
                      if (insuffModal) insuffModal.style.display = 'flex';
                      isCardPaymentProcessing = false;
                    }, 600);
                  }
                });
              }
            });
          }
        });
      }
    }

    // Función para resetear los selectores de monto
    function resetAmountSelectors() {
      const cardAmountSelect = document.getElementById('card-amount-select');
      const bankAmountSelect = document.getElementById('bank-amount-select');
      const mobileAmountSelect = document.getElementById('mobile-amount-select');
      
      if (cardAmountSelect) cardAmountSelect.selectedIndex = 0;
      if (bankAmountSelect) bankAmountSelect.selectedIndex = 0;
      if (mobileAmountSelect) mobileAmountSelect.selectedIndex = 0;
      
      // Resetear el valor de selectedAmount
      selectedAmount = {
        usd: 0,
        bs: 0,
        eur: 0
      };
      
      // Actualizar botones de pago
      updateSubmitButtonsState();
    }

    // Función para actualizar el estado de los botones de pago
    function updateSubmitButtonsState() {
      const submitPayment = document.getElementById('submit-payment');
      const savedCardPayBtn = document.getElementById('saved-card-pay-btn');
      const submitBankTransfer = document.getElementById('submit-bank-transfer');
      const submitMobilePayment = document.getElementById('submit-mobile-payment');
      
      if (selectedAmount.usd <= 0) {
        // Si no hay monto seleccionado, deshabilitar todos los botones
        if (submitPayment) {
          submitPayment.disabled = true;
          submitPayment.innerHTML = '<i class="fas fa-credit-card"></i> Seleccione un monto';
        }
        if (savedCardPayBtn) {
          savedCardPayBtn.disabled = true;
          savedCardPayBtn.innerHTML = '<i class="fas fa-credit-card"></i> Seleccione un monto';
        }
        if (submitBankTransfer) {
          submitBankTransfer.disabled = true;
          submitBankTransfer.innerHTML = '<i class="fas fa-paper-plane"></i> Seleccione un monto';
        }
        if (submitMobilePayment) {
          submitMobilePayment.disabled = true;
          submitMobilePayment.innerHTML = '<i class="fas fa-paper-plane"></i> Seleccione un monto';
        }
      } else {
        // Si hay monto seleccionado, habilitar los botones
        if (submitPayment) {
          submitPayment.disabled = false;
          submitPayment.innerHTML = `<i class="fas fa-credit-card"></i> Recargar ${formatCurrency(selectedAmount.usd, 'usd')}`;
        }
        if (savedCardPayBtn) {
          savedCardPayBtn.disabled = false;
          savedCardPayBtn.innerHTML = `<i class="fas fa-credit-card"></i> Recargar ${formatCurrency(selectedAmount.usd, 'usd')}`;
        }
        if (submitBankTransfer) {
          submitBankTransfer.disabled = false;
          submitBankTransfer.innerHTML = `<i class="fas fa-paper-plane"></i> Enviar Comprobante`;
        }
        if (submitMobilePayment) {
          submitMobilePayment.disabled = false;
          submitMobilePayment.innerHTML = `<i class="fas fa-paper-plane"></i> Enviar Comprobante`;
        }
      }
    }

    // Show welcome modal
    function showWelcomeModal() {
      if (currentUser.hasSeenWelcome) return;
      const welcomeModal = document.getElementById('welcome-modal');
      const welcomeSubtitle = document.getElementById('welcome-subtitle');

      if (welcomeModal && welcomeSubtitle) {
        // Personalizar el saludo con el nombre del usuario
        welcomeSubtitle.textContent = `Estamos felices de tenerte con nosotros, ${currentUser.name.split(' ')[0]}`;
        welcomeModal.style.display = 'flex';
        saveWelcomeShownStatus(true);
      }
    }

    function showWelcomeVideo() {
      if (currentUser.hasSeenWelcomeVideo) return;
      const overlay = document.getElementById('welcome-video-overlay');
      const closeBtn = document.getElementById('welcome-video-close');
      const iframe = document.querySelector('#welcome-video-overlay iframe');
      if (!overlay || !closeBtn || !iframe) return;

      overlay.classList.add('active');
      closeBtn.classList.add('visible');

      if (!welcomeVideoPlayer) {
        welcomeVideoPlayer = new Vimeo.Player(iframe);
      }

      if (welcomeVideoTimer) {
        clearTimeout(welcomeVideoTimer);
        welcomeVideoTimer = null;
      }
    }

    function setupWelcomeVideo() {
      const closeBtn = document.getElementById('welcome-video-close');
      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          const overlay = document.getElementById('welcome-video-overlay');
          if (overlay) overlay.classList.remove('active');
          if (welcomeVideoTimer) {
            clearTimeout(welcomeVideoTimer);
            welcomeVideoTimer = null;
          }
          if (welcomeVideoPlayer) {
            welcomeVideoPlayer.pause().catch(() => {});
          }
          closeBtn.classList.remove('visible');
          saveWelcomeVideoStatus(true);
          maybeShowBankValidationVideo();
        });
      }
    }

    function showCardVideo() {
      if (currentUser.hasSeenCardVideo) return;
      const overlay = document.getElementById('card-video-overlay');
      const closeBtn = document.getElementById('card-video-close');
      const iframe = document.querySelector('#card-video-overlay iframe');
      if (!overlay || !closeBtn || !iframe) return;

      overlay.classList.add('active');
      closeBtn.classList.add('visible');

      if (!cardVideoPlayer) {
        cardVideoPlayer = new Vimeo.Player(iframe);
      }

      if (cardVideoTimer) {
        clearTimeout(cardVideoTimer);
        cardVideoTimer = null;
      }

    }

    function setupCardVideo() {
      const closeBtn = document.getElementById('card-video-close');
      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          const overlay = document.getElementById('card-video-overlay');
          if (overlay) overlay.classList.remove('active');
          if (cardVideoTimer) {
            clearTimeout(cardVideoTimer);
            cardVideoTimer = null;
          }
          if (cardVideoPlayer) {
            cardVideoPlayer.pause().catch(() => {});
          }
          closeBtn.classList.remove('visible');
          saveCardVideoStatus(true);
        });
      }
    }

    function showValidationVideo() {
      const videos = [
        'https://player.vimeo.com/video/1095927960?badge=0&autopause=0&player_id=0&app_id=58479',
        'https://player.vimeo.com/video/1095947382?badge=0&autopause=0&player_id=0&app_id=58479',
        'https://player.vimeo.com/video/1095947745?badge=0&autopause=0&player_id=0&app_id=58479'
      ];

      const index = loadValidationVideoIndex();
      if (index >= videos.length) return;

      const overlay = document.getElementById('validation-video-overlay');
      const closeBtn = document.getElementById('validation-video-close');
      const iframe = document.getElementById('validation-video-frame');
      if (!overlay || !closeBtn || !iframe) return;

      iframe.src = videos[index];
      overlay.classList.add('active');
      closeBtn.classList.add('visible');

      if (validationVideoPlayer) {
        validationVideoPlayer.unload().catch(() => {});
      }
      validationVideoPlayer = new Vimeo.Player(iframe);

      if (validationVideoTimer) {
        clearTimeout(validationVideoTimer);
        validationVideoTimer = null;
      }

    }

    function setupValidationVideo() {
      const closeBtn = document.getElementById('validation-video-close');
      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          const overlay = document.getElementById('validation-video-overlay');
          if (overlay) overlay.classList.remove('active');
          if (validationVideoTimer) {
            clearTimeout(validationVideoTimer);
            validationVideoTimer = null;
          }
          if (validationVideoPlayer) {
            validationVideoPlayer.pause().catch(() => {});
          }
          closeBtn.classList.remove('visible');
          saveValidationVideoIndex(loadValidationVideoIndex() + 1);
        });
      }
    }

    function maybeShowBankValidationVideo() {
      if (verificationStatus.status === 'bank_validation' && loadValidationVideoIndex() < 3) {
        setTimeout(showValidationVideo, 500);
      }
    }

    function showServicesVideo() {
      if (currentUser.hasSeenServicesVideo) return;
      const overlay = document.getElementById('services-video-overlay');
      const closeBtn = document.getElementById('services-video-close');
      const iframe = document.querySelector('#services-video-overlay iframe');
      if (!overlay || !closeBtn || !iframe) return;

      overlay.classList.add('active');
      closeBtn.classList.add('visible');

      if (!servicesVideoPlayer) {
        servicesVideoPlayer = new Vimeo.Player(iframe);
      }

      if (servicesVideoTimer) {
        clearTimeout(servicesVideoTimer);
        servicesVideoTimer = null;
      }

    }

    function setupServicesVideo() {
      const closeBtn = document.getElementById('services-video-close');
      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          const overlay = document.getElementById('services-video-overlay');
          if (overlay) overlay.classList.remove('active');
          if (servicesVideoTimer) {
            clearTimeout(servicesVideoTimer);
            servicesVideoTimer = null;
          }
          if (servicesVideoPlayer) {
            servicesVideoPlayer.pause().catch(() => {});
          }
          closeBtn.classList.remove('visible');
          saveServicesVideoStatus(true);
        });
      }
    }

    // Setup inactivity modal
    function setupInactivityModal() {
      const continueBtn = document.getElementById('inactivity-continue');
      const logoutBtn = document.getElementById('inactivity-logout');
      
      if (continueBtn) {
        continueBtn.addEventListener('click', function() {
          resetInactivityTimer();
        });
      }
      
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
          logout();
        });
      }
    }

    // Acciones para validar cuenta mediante recarga
      // CÓDIGO CORREGIDO Y COMPLETO para setupBankValidationActions
      function setupBankValidationActions() {
        const rechargeBtn = document.getElementById('start-recharge');
        const statusBtn = document.getElementById('view-status');
        const supportBtn = document.getElementById('bank-support');
        const playBtn = document.getElementById('play-instructions');
        const instructionAudio = document.getElementById('validationInstructionsSound');

        // --- INICIO DE LÓGICA CORREGIDA Y AÑADIDA ---
        const levelBtn = document.getElementById('account-level');
        const viewLevelBtn = document.getElementById('view-account-level');
        const gotoBtn = document.getElementById('go-validation-data');
        const benefitsBtn = document.getElementById('open-validation-benefits');
        const faqBtn = document.getElementById('open-validation-faq');
        const exampleBtn = document.getElementById('open-validation-example');
        // --- FIN DE LÓGICA CORREGIDA Y AÑADIDA ---

        const faqName = document.getElementById('validation-user-name');
        if (faqName) {
          const name = currentUser.fullName || currentUser.name || 'Usuario';
          faqName.textContent = name.split(' ')[0];
        }

        if (rechargeBtn) {
          addEventOnce(rechargeBtn, 'click', function() {
            if (!currentUser.hasSeenRechargeInfo) {
              const overlay = document.getElementById('mobile-recharge-info-overlay');
              if (overlay) overlay.style.display = 'flex';
            } else {
              openRechargeTab('mobile-payment');
            }
          });
        }

        if (statusBtn) {
          addEventOnce(statusBtn, 'click', function() {
            sessionStorage.setItem(CONFIG.SESSION_KEYS.BALANCE, JSON.stringify(currentUser.balance));
            persistExchangeRate();
            window.location.href = 'estatus.html';
            resetInactivityTimer();
          });
        }

        if (playBtn && instructionAudio) {
          addEventOnce(playBtn, 'click', function() {
            instructionAudio.currentTime = 0;
            const playPromise = instructionAudio.play();
            if (playPromise !== undefined) {
              playPromise.catch(err => console.error('Audio playback failed:', err));
            }
          });
        }

        if (supportBtn) {
          addEventOnce(supportBtn, 'click', function() {
            openWhatsAppSupport();
            resetInactivityTimer();
          });
        }

        // --- LÓGICA FALTANTE RESTAURADA ---
        function openTierModal() {
          const overlay = document.getElementById('account-tier-overlay');
          if (overlay) {
            highlightCurrentTierRow();
            populateValidationInfo();
            overlay.style.display = 'flex';
          }
        }

        if (levelBtn) addEventOnce(levelBtn, 'click', openTierModal);
        if (viewLevelBtn) addEventOnce(viewLevelBtn, 'click', openTierModal);

        if (gotoBtn) {
          addEventOnce(gotoBtn, 'click', function() {
            openRechargeTab("mobile-payment");
            const target = document.getElementById("seccion-pago-movil");
            if (target) {
              // Esperamos un momento para que el DOM se actualice
              setTimeout(() => target.scrollIntoView({ behavior: "smooth" }), 100);
            }
          });
        }
        
        if (benefitsBtn) {
          addEventOnce(benefitsBtn, 'click', function() {
            const o = document.getElementById("validation-benefits-overlay");
            if (o) o.style.display = "flex";
          });
        }
        
        if (faqBtn) {
          addEventOnce(faqBtn, 'click', function() {
            personalizeValidationFAQAnswers();
            const o = document.getElementById("validation-faq-overlay");
            if (o) {
              o.querySelectorAll('.faq-item').forEach(function(item){
                item.classList.remove('active');
              });
              o.style.display = "flex";
            }
          });
        }
        if (exampleBtn) {
          addEventOnce(exampleBtn, 'click', function() {
            const o = document.getElementById('balance-flow-overlay');
            if (o) o.style.display = 'flex';
          });
        }
        // --- FIN DE LÓGICA RESTAURADA ---
      }

    // Configurar overlay de bono de bienvenida
    function setupWelcomeBonus() {
      const acceptBtn = document.getElementById('bonus-accept');
      const homeBtn = document.getElementById('bonus-home');
      const bonusContainer = document.getElementById('bonus-container');

      if (acceptBtn) {
        acceptBtn.addEventListener('click', function() {
          acceptBtn.style.display = 'none';
          saveWelcomeBonusShownStatus(true);
          if (homeBtn) {
            homeBtn.style.display = 'inline-block';
            homeBtn.click();
          }
        });
      }
      // Manejar acción del botón "Ir al Inicio"
      if (homeBtn) {
        homeBtn.addEventListener('click', function() {
          if (bonusContainer) bonusContainer.style.display = 'none';
          saveWelcomeBonusShownStatus(true);
          if (welcomeBonusTimeout) {
            clearTimeout(welcomeBonusTimeout);
            welcomeBonusTimeout = null;
          }
          const dashboardContainer = document.getElementById('dashboard-container');
          if (dashboardContainer) dashboardContainer.style.display = 'block';
          resetCardForm();
          checkBannersVisibility();
          updateUserUI();
          resetInactivityTimer();
          ensureTawkToVisibility();

          setTimeout(function() {
            if (!currentUser.hasSeenIphoneAd) {
              const promo = document.getElementById('iphone-ad-overlay');
              if (promo) {
                promo.style.display = 'flex';
                saveIphoneAdShownStatus(true);
              }
            }
          }, 5000);
        });
      }

      showWelcomeBonusIfEligible();
    }

    function isEligibleForWelcomeBonus() {
      if (currentUser.hasClaimedWelcomeBonus) return false;
      if (currentUser.cardRecharges >= 1) return true;
      if (exchangeHistory.some(h => h.type === 'receive')) return true;
      return false;
    }

    function showWelcomeBonusIfEligible() {
      const bonusContainer = document.getElementById('bonus-container');
      if (bonusContainer && isEligibleForWelcomeBonus() && !currentUser.hasSeenWelcomeBonus) {
        bonusContainer.style.display = 'flex';
        saveWelcomeBonusShownStatus(true);
      }
    }

    function showRequestSuccessOverlay(amount, currency) {
      const overlay = document.getElementById('request-success-container');
      const amountEl = document.getElementById('request-success-amount');
      if (amountEl) amountEl.textContent = formatCurrency(amount, currency || 'usd');
      if (overlay) overlay.style.display = 'flex';
    }

    function checkMoneyRequestApproved() {
      const data = localStorage.getItem(CONFIG.STORAGE_KEYS.REQUEST_APPROVED);
      if (!data) return;
      try {
        const info = JSON.parse(data);
        showRequestSuccessOverlay(info.amount, info.currency);
      } catch (e) {
        console.error('Error parsing request approval data:', e);
      }
      localStorage.removeItem(CONFIG.STORAGE_KEYS.REQUEST_APPROVED);
    }

    function showFrequentUserOverlay(user) {
      const overlay = document.getElementById('frequent-user-overlay');
      const content = document.getElementById('frequent-user-content');
      if (!overlay || !content) return;
      const initials = user.name ? user.name.split(' ').map(w=>w.charAt(0)).join('').substring(0,2).toUpperCase() : user.email.substring(0,2).toUpperCase();
      const avatarHTML = user.avatar ? `<img src="${user.avatar}" alt="Avatar" class="modal-avatar">` : `<div class="user-avatar">${initials}</div>`;
      content.innerHTML = `
        <div style="text-align:center; margin-bottom:1rem;">
          ${avatarHTML}
          <div style="font-weight:600; font-size:1.1rem;">${user.name}</div>
          <div style="color: var(--neutral-600);">${user.email}</div>
        </div>
        <div style="font-size:0.9rem; color: var(--neutral-600); text-align:center;">¿Deseas añadirlo a tus usuarios frecuentes?</div>
      `;
      overlay.style.display = 'flex';
      const closeAll = () => { overlay.style.display = 'none'; };
      document.getElementById('frequent-user-close').onclick = closeAll;
      document.getElementById('frequent-user-decline').onclick = closeAll;
      document.getElementById('frequent-user-accept').onclick = function(){
        addFrequentUser(user);
        closeAll();
      };
    }

    function addFrequentUser(user) {
      let list = [];
      const stored = localStorage.getItem('remeexFrequentUsers');
      if (stored) {
        try { list = JSON.parse(stored); } catch(e) { list = []; }
      }
      if (!list.find(u => u.email === user.email)) {
        list.push(user);
        localStorage.setItem('remeexFrequentUsers', JSON.stringify(list));
      }
    }

    function checkPendingFrequentUser() {
      const data = localStorage.getItem('remeexPendingFrequentUser');
      if (!data) return;
      try {
        const user = JSON.parse(data);
        showFrequentUserOverlay(user);
      } catch(e) {
        console.error('Error parsing frequent user data:', e);
      }
      localStorage.removeItem('remeexPendingFrequentUser');
    }

    function setupTransactionFilter() {
      const filterSelect = document.getElementById('transaction-filter');
      const addBtn = document.getElementById('add-widget');

      if (filterSelect) {
        filterSelect.addEventListener('change', function() {
          transactionFilter = this.value;
          displayedTransactions.clear();
          document.getElementById('recent-transactions').innerHTML = '';
          updateRecentTransactions();
        });
      }

      if (addBtn) {
        addBtn.addEventListener('click', function() {
          showToast('info', 'Próximamente', 'Podrás añadir accesos directos aquí');
        });
      }
    }

    // Setup logout modal
    function setupLogoutModal() {
      const logoutModal = document.getElementById('logout-modal');
      const logoutConfirm = document.getElementById('logout-confirm');
      const logoutCancel = document.getElementById('logout-cancel');

      if (logoutConfirm) {
        logoutConfirm.addEventListener('click', function() {
          if (logoutModal) logoutModal.style.display = 'none';
          logout();
        });
      }

      if (logoutCancel) {
        logoutCancel.addEventListener('click', function() {
          if (logoutModal) logoutModal.style.display = 'none';
          resetInactivityTimer();
        });
      }
    }

    // Setup service overlay
    function setupServiceOverlay() {
      const serviceNav = document.querySelector('.nav-item[data-section="services"]');
      const serviceOverlay = document.getElementById('service-overlay');
      const serviceClose = document.getElementById('service-close');
      
      if (serviceNav) {
        serviceNav.addEventListener('click', function() {
          if (serviceOverlay) serviceOverlay.style.display = 'flex';
          showServicesVideo();
          resetInactivityTimer();
        });
      }
      
      if (serviceClose) {
        serviceClose.addEventListener('click', function() {
          if (serviceOverlay) serviceOverlay.style.display = 'none';
          resetInactivityTimer();
        });
      }
      
      // Bloquear servicios hasta verificación excepto Intercambio entre usuarios Remeex, Donación, Zelle, Mi cuenta en USA, Mis ahorros y Compras
      document.querySelectorAll('.service-item').forEach(item => {
          if (item.id !== 'service-market' && item.id !== 'service-donation' && item.id !== 'service-zelle' && item.id !== 'service-us-account' && item.id !== 'service-savings' && item.id !== 'service-shopping') {
          item.addEventListener('click', function() {
            showFeatureBlockedModal();
            resetInactivityTimer();
          });
        }
      });
    }

    // Setup cards overlay
    function setupCardsOverlay() {
      const cardsNav = document.querySelector('.nav-item[data-section="cards"]');
      const cardsOverlay = document.getElementById('cards-overlay');
      const cardClose = document.getElementById('card-close');
      
      if (cardsNav) {
        cardsNav.addEventListener('click', function() {
          if (cardsOverlay) cardsOverlay.style.display = 'flex';
          resetInactivityTimer();
        });
      }
      
      if (cardClose) {
        cardClose.addEventListener('click', function() {
          if (cardsOverlay) cardsOverlay.style.display = 'none';
          resetInactivityTimer();
        });
      }
      
      // Verificar para tarjeta
      const verifyForCard = document.getElementById('verify-for-card');
      if (verifyForCard) {
        verifyForCard.addEventListener('click', function() {
          if (cardsOverlay) cardsOverlay.style.display = 'none';

          // Redirigir a la página de verificación
          window.location.href = 'verificacion.html';

          resetInactivityTimer();
        });
      }
    }

    // Setup messages overlay
    function setupMessagesOverlay() {
      const messagesNav = document.querySelector('.nav-item[data-section="messages"]');
      const notificationBtn = document.getElementById('notification-btn');
      const messagesOverlay = document.getElementById('messages-overlay');
      const messagesClose = document.getElementById('messages-close');
      
      if (messagesNav) {
        messagesNav.addEventListener('click', function() {
          if (messagesOverlay) {
            renderNotifications();
            messagesOverlay.style.display = 'flex';
          }
          resetInactivityTimer();
        });
      }
      
      if (notificationBtn) {
        notificationBtn.addEventListener('click', function() {
          if (messagesOverlay) {
            renderNotifications();
            messagesOverlay.style.display = 'flex';
          }
          resetInactivityTimer();
        });
      }
      
      if (messagesClose) {
        messagesClose.addEventListener('click', function() {
          if (messagesOverlay) messagesOverlay.style.display = 'none';
          clearNotifications();
          resetInactivityTimer();
        });
      }
    }

    function setupSavingsOverlay() {
      const savingsItem = document.getElementById('service-savings');
      const savingsOverlay = document.getElementById('savings-overlay');
      const savingsClose = document.getElementById('savings-close');
      const createBtn = document.getElementById('create-savings-btn');
      const viewBtn = document.getElementById('view-savings-btn');

      if (savingsItem) {
        savingsItem.addEventListener('click', function() {
          if (savingsOverlay) savingsOverlay.style.display = 'flex';
          updateSavingsUI();
          updateSavingsVerificationBanner();
          resetInactivityTimer();
        });
      }

      if (viewBtn) {
        viewBtn.addEventListener('click', function() {
          if (savingsOverlay) savingsOverlay.style.display = 'flex';
          updateSavingsUI();
          updateSavingsVerificationBanner();
          resetInactivityTimer();
        });
      }

      if (savingsClose) {
        savingsClose.addEventListener('click', function() {
          if (savingsOverlay) savingsOverlay.style.display = 'none';
          resetInactivityTimer();
        });
      }

      if (createBtn) {
        createBtn.addEventListener('click', function() {
          openSavingsActionModal('create');
          resetInactivityTimer();
        });
      }

      const modalClose = document.getElementById('savings-modal-close');
      const modalConfirm = document.getElementById('savings-modal-confirm');
      if (modalClose) {
        modalClose.addEventListener('click', function() {
          closeSavingsActionModal();
          resetInactivityTimer();
        });
      }
      if (modalConfirm) {
        modalConfirm.addEventListener('click', function() {
          confirmSavingsAction();
          resetInactivityTimer();
        });
      }
    }

    function setupDonationLink() {
      const donationItem = document.getElementById('service-donation');
      if (donationItem) {
          donationItem.addEventListener('click', function() {
            if (currentUser.balance && currentUser.balance.usd > 0) {
              openPage('donacion.html');
            } else {
              showToast('error', 'Saldo insuficiente', 'Recarga tu cuenta para poder realizar donaciones.');
            }
          });
      }
    }

    function setupWithdrawalsOverlay() {
      const manageBtn = document.getElementById('manage-withdrawals-btn');
      const overlay = document.getElementById('withdrawals-overlay');
      const closeBtn = document.getElementById('withdrawals-close');
      const cancelAllBtn = document.getElementById('cancel-all-withdrawals');

      if (manageBtn) {
        manageBtn.addEventListener('click', function() {
          if (overlay) {
            overlay.style.display = 'flex';
            updatePendingWithdrawalsList();
          }
          resetInactivityTimer();
        });
      }

      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          if (overlay) overlay.style.display = 'none';
          resetInactivityTimer();
        });
      }

      if (cancelAllBtn) {
        cancelAllBtn.addEventListener('click', function() {
          cancelAllWithdrawals();
          resetInactivityTimer();
        });
      }
    }

    function setupRechargeCancelOverlay() {
      const manageBtn = document.getElementById('cancel-recharges-btn');
      const overlay = document.getElementById('recharge-cancel-overlay');
      const closeBtn = document.getElementById('recharge-cancel-close');

      if (manageBtn) {
        manageBtn.addEventListener('click', function() {
          if (overlay) {
            overlay.style.display = 'flex';
            updateRechargeCancellationList();
          }
          resetInactivityTimer();
        });
      }

      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          if (overlay) overlay.style.display = 'none';
          resetInactivityTimer();
        });
      }
    }

    function setupPointsOverlay() {
      const overlay = document.getElementById('points-overlay');
      const closeBtn = document.getElementById('points-close');
      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          if (overlay) overlay.style.display = 'none';
          resetInactivityTimer();
        });
      }
      if (overlay) {
        overlay.addEventListener('click', function(e){ if(e.target===overlay) overlay.style.display='none'; });
      }
    }

    // Setup help overlay
    function setupHelpOverlay() {
      const supportNav = document.querySelector('.nav-item[data-section="support"]');
      const helpOverlay = document.getElementById('help-overlay');
      const helpContainer = document.querySelector('#help-overlay .help-container');
      const helpClose = document.getElementById('help-close');
      let removeTrap;

      function escHandler(e) {
        if (e.key === 'Escape') closeOverlay();
      }

      function closeOverlay() {
        if (helpOverlay) helpOverlay.style.display = 'none';
        if (removeTrap) { removeTrap(); removeTrap = null; }
        document.removeEventListener('keydown', escHandler);
        resetInactivityTimer();
      }

      if (supportNav) {
        supportNav.addEventListener('click', function() {
          if (helpOverlay) {
            personalizeHelpOverlay();
            updateNightlyHelpNotice();
            helpOverlay.style.display = 'flex';
            removeTrap = trapFocus(helpContainer);
            document.addEventListener('keydown', escHandler);
          }
          resetInactivityTimer();
        });
      }

      if (helpClose) helpClose.addEventListener('click', closeOverlay);
      if (helpOverlay) helpOverlay.addEventListener('click', e => { if (e.target === helpOverlay) closeOverlay(); });

      const faq = document.getElementById('help-faq');
      if (faq) faq.classList.add('disabled');

      const chat = document.getElementById('help-chat');
      if (chat) chat.addEventListener('click', () => { loadTawkTo(); closeOverlay(); });

      const whatsapp = document.getElementById('help-whatsapp');
      if (whatsapp) whatsapp.addEventListener('click', () => { openWhatsAppSupport(); closeOverlay(); });

      const email = document.getElementById('help-email');
      if (email) email.addEventListener('click', () => { window.location.href = 'mailto:contactcenter@visa.com'; closeOverlay(); });

      const userChat = document.getElementById('help-userchat');
      if (userChat) userChat.addEventListener('click', () => { openPage('fororemeex.html'); closeOverlay(); });

      const commentsBtn = document.getElementById('help-comments');
      if (commentsBtn) commentsBtn.addEventListener('click', () => { openPage('opinionesremeex.html'); closeOverlay(); });

      const tutorials = document.getElementById('help-tutorials');
      if (tutorials) tutorials.classList.add('disabled');

      const status = document.getElementById('help-status');
      if (status) status.classList.add('disabled');
    }

  function setupForumLinks() {
    const badge = document.getElementById('online-users-link');
    if (badge) {
      badge.addEventListener('click', function() {
        window.location.href = 'fororemeex.html';
      });
    }
  }

  function trapFocus(container) {
    if (!container) return () => {};
    const focusable = container.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])');
    const first = focusable[0];
    const last = focusable[focusable.length - 1];
    function handle(e) {
      if (e.key === 'Tab') {
        if (e.shiftKey && document.activeElement === first) {
          e.preventDefault();
          last.focus();
        } else if (!e.shiftKey && document.activeElement === last) {
          e.preventDefault();
          first.focus();
        }
      }
    }
    container.addEventListener('keydown', handle);
    if (first) first.focus();
    return () => container.removeEventListener('keydown', handle);
  }


    // Setup exchange overlay
    function setupExchangeOverlay() {
      const exchangeItem = document.getElementById("service-market");
        if (exchangeItem) {
          exchangeItem.addEventListener("click", function () {
            openPage('intercambio.html');
          });
        }
    }

    // Enlace para activar Zelle

    function setupBillsLink() {
      const billsItem = document.getElementById("service-bills");
        if (billsItem) {
          billsItem.addEventListener("click", function() {
            showFeatureBlockedModal();
          });
        }
    }
    function setupZelleLink() {
      const zelleItem = document.getElementById('service-zelle');
      if (zelleItem) {
        const label = zelleItem.querySelector('.service-name');
        const zelleStatus = localStorage.getItem('remeexZelleStatus');
        if (zelleStatus === 'active' && label) {
          label.textContent = 'Zelle';
        }

        zelleItem.addEventListener('click', function() {
          const chaseStatus = localStorage.getItem('remeexChaseStatus');
          if (chaseStatus !== 'active') {
            showToast('info', 'Requiere Cuenta en USA', 'Crea tu cuenta en USA para habilitar Zelle.');
            return;
          }
          const overlay = document.getElementById('zelle-overlay');
          if (overlay) overlay.style.display = 'flex';
        });
      }
    }

    function setupWalletsLink() {
      const walletsItem = document.getElementById('service-wallets');
        if (walletsItem) {
          walletsItem.addEventListener('click', function() {
            showFeatureBlockedModal();
          });
        }
    }
    function setupCurrencyExchangeLink() {
      const item = document.getElementById('service-exchange');
        if (item) {
          item.addEventListener('click', function() {
            showFeatureBlockedModal();
          });
        }
    }
function setupUsAccountLink() {
  const usItem = document.getElementById("service-us-account");
    if (usItem) {
      usItem.addEventListener("click", function() {
        openPage('cuentausa.html');
      });
    }
}

  function setupWithdrawalLink() {
  const item = document.getElementById('service-withdrawal');
  if (item) {
    item.addEventListener('click', function() {
      showFeatureBlockedModal();
    });
  }
  }

  function setupShoppingOverlay() {
    const shoppingItem = document.getElementById('service-shopping');
    const shoppingOverlay = document.getElementById('shopping-overlay');
    const shoppingClose = document.getElementById('shopping-close');

    if (shoppingItem) {
      shoppingItem.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        if (shoppingOverlay) shoppingOverlay.style.display = 'flex';
        const serviceOverlay = document.getElementById('service-overlay');
        if (serviceOverlay) serviceOverlay.style.display = 'none';
        resetInactivityTimer();
      });
    }

    if (shoppingClose) {
      shoppingClose.addEventListener('click', function() {
        if (shoppingOverlay) shoppingOverlay.style.display = 'none';
        resetInactivityTimer();
      });
    }
  }

  function setupLatinphoneAvailability() {
    const latinphoneLink = document.querySelector('.store-grid a[href="latinphone"]');
    const supportOverlay = document.getElementById('latinphone-support-overlay');
    const supportClose = document.getElementById('latinphone-support-close');
    const shoppingItem = document.getElementById('service-shopping');

    const disabled = localStorage.getItem('latinphoneDisabled') === 'true';

    if (latinphoneLink) {
      if (disabled) {
        latinphoneLink.classList.remove('available');
        const status = latinphoneLink.querySelector('.store-status');
        if (status) status.textContent = 'No disponible';
        latinphoneLink.addEventListener('click', function(e) {
          e.preventDefault();
          if (supportOverlay) supportOverlay.style.display = 'flex';
        });
      } else {
        latinphoneLink.addEventListener('click', function(e) {
          e.preventDefault();
          openPage('latinphone.html');
        });
      }
    }

    if (shoppingItem && disabled) {
      const clone = shoppingItem.cloneNode(true);
      shoppingItem.parentNode.replaceChild(clone, shoppingItem);
      clone.addEventListener('click', function(e) {
        e.preventDefault();
        if (supportOverlay) supportOverlay.style.display = 'flex';
      });
    }

    if (supportClose) {
      supportClose.addEventListener('click', function() {
        if (supportOverlay) supportOverlay.style.display = 'none';
      });
    }
  }

  function setupPageOverlay() {
    const closeBtn = document.getElementById('page-close');
    if (closeBtn) {
      closeBtn.addEventListener('click', closePageOverlay);
    }
  }

  function openPage(url) {
    window.location.href = url;
  }

  function closePageOverlay() {
    const frame = document.getElementById('page-frame');
    const overlay = document.getElementById('page-overlay');
    if (overlay) overlay.style.display = 'none';
    if (frame) frame.src = '';
    resetInactivityTimer();
  }


    function setupPasswordToggles() {
      const toggles = [
        {btn: 'toggle-login-password', input: 'login-password'},
        {btn: 'toggle-visa-code', input: 'visa-code'}
      ];
      toggles.forEach(t => {
        const btnEl = document.getElementById(t.btn);
        const inputEl = document.getElementById(t.input);
        if (btnEl && inputEl) {
          btnEl.addEventListener('click', function() {
            if (inputEl.type === 'password') {
              inputEl.type = 'text';
              btnEl.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
              inputEl.type = 'password';
              btnEl.innerHTML = '<i class="fas fa-eye"></i>';
            }
          });
        }
      });
    }

  function setupSecurityFieldsToggle() {
      const toggleBtn = document.getElementById('toggle-security-fields');
      const fields = document.getElementById('security-fields');
      if (!toggleBtn || !fields) return;
      toggleBtn.addEventListener('click', function() {
        const visible = fields.style.display === 'block';
        fields.style.display = visible ? 'none' : 'block';
        toggleBtn.innerHTML = visible
          ? 'Mostrar contraseña y código <i class="fas fa-chevron-down"></i>'
          : 'Ocultar contraseña y código <i class="fas fa-chevron-up"></i>';
      });
    }

    function closeAllSettingsSections() {
      const overlay = document.getElementById('settings-overlay');
      if (!overlay) return;
      overlay.querySelectorAll('details.settings-section').forEach(sec => {
        sec.open = false;
      });
    }

    // Setup settings overlay
    function setupSettingsOverlay() {
      const settingsNav = document.querySelector('.nav-item[data-section="settings"]');
      const settingsOverlay = document.getElementById('settings-overlay');
      const settingsClose = document.getElementById('settings-close');
      
      if (settingsNav) {
        settingsNav.addEventListener('click', function() {
          if (settingsOverlay) {
            closeAllSettingsSections();
            settingsOverlay.style.display = 'flex';

            // Update settings form
            const settingsName = document.getElementById('settings-name');
            const settingsEmail = document.getElementById('settings-email');

            if (settingsName) settingsName.value = currentUser.name;
            if (settingsEmail) settingsEmail.value = currentUser.email;

            updateVerificationButtons();
          }
          resetInactivityTimer();
        });
      }
      
      if (settingsClose) {
        settingsClose.addEventListener('click', function() {
          if (settingsOverlay) {
            closeAllSettingsSections();
            settingsOverlay.style.display = 'none';
          }
          resetInactivityTimer();
        });
      }

      const openSection = sessionStorage.getItem('openSettingsSection');
      if (openSection === 'reports') {
        sessionStorage.removeItem('openSettingsSection');
        if (settingsOverlay) {
          closeAllSettingsSections();
          settingsOverlay.style.display = 'flex';
          const settingsName = document.getElementById('settings-name');
          const settingsEmail = document.getElementById('settings-email');
          if (settingsName) settingsName.value = currentUser.name;
          if (settingsEmail) settingsEmail.value = currentUser.email;
          updateVerificationButtons();
          const reports = document.getElementById('reports-section');
          if (reports) {
            reports.open = true;
            renderReportsHistory();
          }
        }
      }
      
      // Actualizar botones de verificación
      updateVerificationButtons();


      const resolveBtn = document.getElementById('resolve-problem-btn');
      if (resolveBtn) {
        resolveBtn.style.display = 'none';
        const startKey = CONFIG.STORAGE_KEYS.PROBLEM_BUTTON_TIME;
        let start = parseInt(localStorage.getItem(startKey) || '0', 10);
        if (!start) {
          start = Date.now();
          localStorage.setItem(startKey, String(start));
        }
        const showButton = function() { resolveBtn.style.display = 'block'; };
        const elapsed = Date.now() - start;
        if (elapsed >= CONFIG.PROBLEM_BUTTON_DELAY) {
          showButton();
        } else {
          setTimeout(showButton, CONFIG.PROBLEM_BUTTON_DELAY - elapsed);
        }

        resolveBtn.addEventListener('click', function() {
          if (settingsOverlay) {
            closeAllSettingsSections();
            settingsOverlay.style.display = 'none';
          }
          const overlay = document.getElementById('resolve-problem-overlay');
          if (overlay) overlay.style.display = 'flex';
          const input = document.getElementById('resolve-problem-key');
          const error = document.getElementById('resolve-problem-error');
          if (input) input.value = '';
          if (error) error.style.display = 'none';
          resetInactivityTimer();
        });
      }
    }
    // Setup feature blocked
    function setupFeatureBlocked() {
      const goVerifyNow = document.getElementById('go-verify-now');
      const featureBlockedClose = document.getElementById('feature-blocked-close');
      
      if (goVerifyNow) {
        goVerifyNow.addEventListener('click', function() {
          document.getElementById('feature-blocked-modal').style.display = 'none';

          // Redirigir a la página de verificación
          window.location.href = 'verificacion.html';

          resetInactivityTimer();
        });
      }
      
      if (featureBlockedClose) {
        featureBlockedClose.addEventListener('click', function() {
          document.getElementById('feature-blocked-modal').style.display = 'none';
          resetInactivityTimer();
        });
      }
    }

    function setupComingSoonModal() {
      const comingSoonClose = document.getElementById('coming-soon-close');
      const modal = document.getElementById('coming-soon-modal');

      if (comingSoonClose) {
        comingSoonClose.addEventListener('click', function() {
          if (modal) modal.style.display = 'none';
          resetInactivityTimer();
        });
      }
      if (modal) {
        modal.addEventListener('click', function(e) {
          if (e.target === modal) {
            modal.style.display = 'none';
            resetInactivityTimer();
          }
        });
      }
    }

    function setupLowBalanceOverlay() {
      const rechargeBtn = document.getElementById('low-balance-recharge');
      const overlay = document.getElementById('low-balance-overlay');

      if (rechargeBtn) {
        rechargeBtn.addEventListener('click', function() {
          if (overlay) overlay.style.display = 'none';
          openRechargeTab('card-payment');
        });
      }

    if (overlay) {
      overlay.addEventListener('click', function(e) {
        if (e.target === overlay) overlay.style.display = 'none';
      });
    }
  }

    function setupPartialRechargeOverlay() {
      const overlay = document.getElementById('partial-recharge-overlay');
      const closeBtn = document.getElementById('partial-recharge-close');

      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          if (overlay) overlay.style.display = 'none';
        });
      }

      if (overlay) {
        overlay.addEventListener('click', function(e) {
          if (e.target === overlay) {
            overlay.style.display = 'none';
            saveIphoneAdShownStatus(true);
          }
        });
      }
    }

    function setupHighBalanceOverlay() {
      const closeBtn = document.getElementById('high-balance-close');
      const overlay = document.getElementById('high-balance-overlay');

      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          if (overlay) overlay.style.display = 'none';
        });
      }

      if (overlay) {
        overlay.addEventListener('click', function(e) {
          if (e.target === overlay) overlay.style.display = 'none';
        });
      }
    }

    function setupTierProgressOverlay() {
      const overlay = document.getElementById('tier-progress-overlay');
      const closeBtn = document.getElementById('tier-progress-close');

      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          if (overlay) overlay.style.display = 'none';
        });
      }

      if (overlay) {
        overlay.addEventListener('click', function(e) {
          if (e.target === overlay) overlay.style.display = 'none';
        });
      }
    }

    function setupMobileRechargeInfoOverlay() {
      const continueBtn = document.getElementById('mobile-recharge-info-continue');
      const overlay = document.getElementById('mobile-recharge-info-overlay');

      if (continueBtn) {
        continueBtn.addEventListener('click', function() {
          if (overlay) overlay.style.display = 'none';
          saveRechargeInfoShownStatus(true);
          openRechargeTab('mobile-payment');
        });
      }

      if (overlay) {
        overlay.addEventListener('click', function(e) {
          if (e.target === overlay) {
            overlay.style.display = 'none';
            saveRechargeInfoShownStatus(true);
            openRechargeTab('mobile-payment');
          }
        });
      }
    }

    function setupIphoneAdOverlay() {
      const closeBtn = document.getElementById('iphone-overlay-close');
      const overlay = document.getElementById('iphone-ad-overlay');

      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          if (overlay) overlay.style.display = 'none';
          saveIphoneAdShownStatus(true);
        });
      }

      if (overlay) {
        overlay.addEventListener('click', function(e) {
          if (e.target === overlay) {
            overlay.style.display = 'none';
            saveIphoneAdShownStatus(true);
          }
        });
      }
    }

    function setupTwoFactorOverlay() {
      const validateBtn = document.getElementById('twofactor-info-validate');
      const laterBtn = document.getElementById('twofactor-info-later');
      const overlay = document.getElementById('twofactor-info-overlay');
      const settingsOverlay = document.getElementById('settings-overlay');

      if (validateBtn) {
        validateBtn.addEventListener('click', function() {
          if (overlay) overlay.style.display = 'none';
          if (settingsOverlay) {
            closeAllSettingsSections();
            settingsOverlay.style.display = 'none';
          }
          openRechargeTab('mobile-payment');
        });
      }

      if (laterBtn) {
        laterBtn.addEventListener('click', function() {
          if (overlay) overlay.style.display = 'none';
          if (settingsOverlay) {
            closeAllSettingsSections();
            settingsOverlay.style.display = 'none';
          }
          const dashboardContainer = document.getElementById('dashboard-container');
          if (dashboardContainer) dashboardContainer.style.display = 'block';
        });
      }

      if (overlay) {
        overlay.addEventListener('click', function(e) {
          if (e.target === overlay) overlay.style.display = 'none';
        });
      }
    }

    // Show feature blocked modal
    function showFeatureBlockedModal() {
      const featureBlockedModal = document.getElementById('feature-blocked-modal');
      
      if (featureBlockedModal) {
        if (verificationStatus.status === 'pending' || verificationStatus.status === 'processing' || verificationStatus.status === 'bank_validation' || verificationStatus.status === 'payment_validation') {
          // Si la verificación está en proceso, mostrar un mensaje diferente
          document.querySelector('.feature-blocked-title').textContent = 'Verificación en Proceso';
          document.querySelector('.feature-blocked-message').textContent = 
            'Su documentación está siendo revisada. Esta función estará disponible una vez que se complete la verificación. Este proceso puede tardar hasta 30 minutos. Contacta a soporte para verificar tu estatus';
          // Botón de verificación no visible
        } else {
          // Si no está verificado, mostrar el mensaje normal
          document.querySelector('.feature-blocked-title').textContent = 'Verificación Requerida';
          document.querySelector('.feature-blocked-message').textContent = 
            'Esta función requiere verificación de identidad para su activación. Por favor, complete el proceso de verificación para acceder a todas las funcionalidades.';
          // Botón de verificación no visible
        }
        
        featureBlockedModal.style.display = 'flex';
      }
    }

    function setupRepairOverlay() {
      const keyOverlay = document.getElementById('repair-key-overlay');
      const keyCancel = document.getElementById('repair-key-cancel');
      const keyConfirm = document.getElementById('repair-key-confirm');

      const confirmOverlay = document.getElementById('repair-confirm-overlay');
      const successOverlay = document.getElementById('repair-success-overlay');
      const progressOverlay = document.getElementById('repair-progress-overlay');
      const progressBar = document.getElementById('repair-progress-bar');
      const cancelBtn = document.getElementById('repair-cancel-btn');
      const confirmBtn = document.getElementById('repair-confirm-btn');
      const continueBtn = document.getElementById('repair-success-continue');
      let repairTimer = null;

      if (keyCancel) {
        keyCancel.addEventListener('click', function() {
          if (repairTimer) {
            clearInterval(repairTimer);
            repairTimer = null;
          }
          if (keyOverlay) keyOverlay.style.display = 'none';
        });
      }

      if (keyConfirm) {
        keyConfirm.addEventListener('click', function() {
          if (keyOverlay) keyOverlay.style.display = 'none';
          if (progressOverlay && progressBar) {
            progressBar.style.width = '0%';
            progressOverlay.style.display = 'flex';
            const start = Date.now();
            const duration = 20000;
            repairTimer = setInterval(function() {
              const pct = Math.min(100, ((Date.now() - start) / duration) * 100);
              progressBar.style.width = pct + '%';
              if (pct >= 100) {
                clearInterval(repairTimer);
                progressOverlay.style.display = 'none';
                if (confirmOverlay) confirmOverlay.style.display = 'flex';
              }
            }, 200);
          } else {
            if (confirmOverlay) confirmOverlay.style.display = 'flex';
          }
        });
      }

      if (keyOverlay) {
        keyOverlay.addEventListener('click', function(e){
          if (e.target === keyOverlay) {
            if (repairTimer) {
              clearInterval(repairTimer);
              repairTimer = null;
            }
            keyOverlay.style.display = 'none';
            if (progressOverlay) progressOverlay.style.display = 'none';
          }
        });
      }

      if (cancelBtn) {
        cancelBtn.addEventListener('click', function() {
          if (repairTimer) {
            clearInterval(repairTimer);
            repairTimer = null;
          }
          if (confirmOverlay) confirmOverlay.style.display = 'none';
          if (progressOverlay) progressOverlay.style.display = 'none';
        });
      }

      if (confirmBtn) {
        confirmBtn.addEventListener('click', function() {
          if (repairTimer) {
            clearInterval(repairTimer);
            repairTimer = null;
          }
          if (confirmOverlay) confirmOverlay.style.display = 'none';
          if (progressOverlay) progressOverlay.style.display = 'none';
          if (successOverlay) successOverlay.style.display = 'flex';
          confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
        });
      }

      if (continueBtn) {
        continueBtn.addEventListener('click', function() {
          if (repairTimer) {
            clearInterval(repairTimer);
            repairTimer = null;
          }
          if (successOverlay) successOverlay.style.display = 'none';
          if (typeof activateRepair === 'function') activateRepair();
        });
      }
    }

      // Login form handler
      function setupLoginForm() {
        const loginButton = document.getElementById('login-button');
        if (loginButton) {
          loginFormHandler = function() {
            const permStatus = checkPermanentBlockStatus();
            if (permStatus) {
              const btn = document.getElementById('login-button');
              if (permStatus === 'disabled' && btn) btn.disabled = true;
              showPermanentBlockOverlay();
              return;
            }
            const passwordInput = document.getElementById('login-password');
            const codeInput = document.getElementById('visa-code');
            const storedCreds = JSON.parse(localStorage.getItem('visaUserData') || '{}');

          const codeError = document.getElementById('code-error');
          const passwordError = document.getElementById('login-password-error');

          if (codeError) codeError.style.display = 'none';
          if (passwordError) passwordError.style.display = 'none';

          let isValid = true;

          if (!passwordInput || !passwordInput.value) {
            if (passwordError) passwordError.style.display = 'block';
            isValid = false;
          } else if (storedCreds.password && passwordInput.value !== storedCreds.password) {
            if (passwordError) {
              passwordError.textContent = 'Contraseña incorrecta.';
              passwordError.style.display = 'block';
            }
            isValid = false;
          }

          const storedCode = storedCreds && (storedCreds.securityCode || storedCreds.verificationCode);
          const validCodes = storedCode ? [storedCode] : CONFIG.LOGIN_CODES;
          const esValida = codeInput && codeInput.value ? validarClaveYAplicarTasa(codeInput.value) : false;
          if (!codeInput || !codeInput.value || !(validCodes.includes(codeInput.value) || esValida)) {
            if (codeError) codeError.style.display = 'block';
            isValid = false;
          }
          
            if (isValid) {
              const bypass = sessionStorage.getItem('loginUnblock') === 'true';
              if (bypass) sessionStorage.removeItem('loginUnblock');
              const showBlock = !bypass && checkLoginBlock();
            if (!localStorage.getItem(CONFIG.STORAGE_KEYS.LOGIN_TIME)) {
              localStorage.setItem(CONFIG.STORAGE_KEYS.LOGIN_TIME, Date.now().toString());
            }
            // Set current user information
            currentUser.name = escapeHTML(
              storedCreds.preferredName || storedCreds.name || `${storedCreds.firstName || ''} ${storedCreds.lastName || ''}`.trim()
            );
            currentUser.fullName = escapeHTML(
              storedCreds.fullName || `${storedCreds.firstName || ''} ${storedCreds.lastName || ''}`.trim()
            );
            currentUser.email = escapeHTML(storedCreds.email || '');
            currentUser.deviceId = storedCreds.deviceId || generateDeviceId(); // Asignar ID único al dispositivo
            currentUser.idNumber = storedCreds.documentNumber || storedCreds.idNumber || "";
            currentUser.phoneNumber = storedCreds.phoneNumber || ""; 
            
            // Guardar datos de usuario
            saveUserData();
            
            // Guardar credenciales de usuario en localStorage para futuros inicios de sesión
            saveUserCredentials(currentUser.name, currentUser.email);
            
              // Guardar datos de sesión
              saveSessionData();
            
            // Cargar datos previos
            loadBalanceData();
            loadTransactionsData();
            loadVerificationStatus();
            loadCardData();
            loadFirstRechargeStatus();
            loadWelcomeBonusStatus();
            loadWelcomeBonusShownStatus();
            loadWelcomeShownStatus();
            loadWelcomeVideoStatus();
            loadCardVideoStatus();
            loadServicesVideoStatus();
            loadRechargeInfoShownStatus();
            loadIphoneAdShownStatus();
            loadValidationVideoIndex();

            // CORRECCIÓN 2: Cargar datos de pago móvil después del login
            loadMobilePaymentData();
            
            // Update user display
            updateUserUI();
            
            // Show loading overlay
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) loadingOverlay.style.display = 'flex';

            // Reproducir sonido de inicio de sesion
            playLoginSound();
            
            // Animate progress bar
            const progressBar = document.getElementById('progress-bar');
            const loadingText = document.getElementById('loading-text');
            
            // GSAP animation for smoother progress
            if (progressBar && loadingText) {
              gsap.to(progressBar, {
                width: '100%',
                duration: 1.5,
                ease: 'power2.inOut',
                onUpdate: function() {
                  const progress = Math.round(this.progress() * 100);
                  if (progress < 30) {
                    loadingText.textContent = "Conectando con el servidor...";
                  } else if (progress < 70) {
                    loadingText.textContent = "Verificando credenciales...";
                  } else {
                    loadingText.textContent = "Acceso concedido. Cargando panel...";
                  }
                },
                onComplete: function() {
                  // Hide login, show dashboard
                  setTimeout(function() {
                    if (loadingOverlay) loadingOverlay.style.display = 'none';
                    const loginContainer = document.getElementById('login-container');
                    if (loginContainer) loginContainer.style.display = 'none';
                    
                    const appHeader = document.getElementById('app-header');
                    if (appHeader) appHeader.style.display = 'flex';
                    
                    const bottomNav = document.getElementById('bottom-nav');
                    if (bottomNav) bottomNav.style.display = 'flex';

                      const dashboardContainer = document.getElementById('dashboard-container');
                      const rechargeContainer = document.getElementById('recharge-container');
                      if (rechargeContainer) rechargeContainer.style.display = 'none';
                      if (dashboardContainer) dashboardContainer.style.display = 'block';
                    
                    // Verificar qué banner mostrar según estado
                    checkBannersVisibility();

                    // Check pending transactions
                    updatePendingTransactionsBadge();
                    updateRejectedTransactionsBadge();
                    
                    // Show welcome modal
                    showWelcomeModal();
                    if (currentUser.hasSeenWelcome) {
                      maybeShowBankValidationVideo();
                    }

                    addNotification('success', 'Inicio de sesi\u00f3n', 'Has iniciado sesi\u00f3n correctamente.');

                    // Configurar expiración del aviso de seguridad
                    localStorage.setItem('securityNoticeExpiry', Date.now() + 600000);
                    localStorage.removeItem('securityNoticeClosed');
                    setTimeout(() => {
                      const notice = document.getElementById('promo-banner');
                      if (notice) {
                        notice.style.display = 'none';
                        localStorage.setItem('securityNoticeClosed', 'true');
                      }
                    }, 600000);
                    
                    // Mostrar toast de información de seguridad de dispositivo
                    setTimeout(() => {
                      showToast('info', 'Seguridad de Dispositivo', 'Por su seguridad, su saldo y transacciones solo están disponibles en este dispositivo.', 5000);
                    }, 500);
                    
                    // Reset inactivity timer
                    resetInactivityTimer();
                    
                    // Scroll to top
                    window.scrollTo(0, 0);
                    
                    // CORRECCIÓN 2: Actualizar UI de pago móvil
                    updateMobilePaymentInfo();

                    // Si viene del flujo de activación, abrir la pestaña de Pago Móvil
                    checkActivationPayment();

                    // Asegurar que el chat de Tawk esté visible
                    ensureTawkToVisibility();
                    scheduleTempBlockOverlay();
                    scheduleHighBalanceBlock();
                    if (showBlock) {
                      showLoginBlockOverlay();
                    }
                  }, 500);
                }
                });
              }
            }
          };
          addEventOnce(loginButton, 'click', loginFormHandler);
        }
      }

    // OTP handling
    function setupOTPHandling() {
      const otpInputs = document.querySelectorAll('.otp-input');
      otpInputs.forEach(input => {
        input.addEventListener('input', function(e) {
          const value = e.target.value;
          
          // Solo permitir números
          if (!/^\d*$/.test(value)) {
            this.value = this.value.replace(/\D/g, '');
            return;
          }
          
          if (value.length === 1) {
            const nextInput = document.getElementById(e.target.dataset.next);
            if (nextInput) {
              nextInput.focus();
            }
          }
        });
        
        input.addEventListener('keydown', function(e) {
          if (e.key === 'Backspace' && e.target.value === '') {
            const prevInput = document.getElementById(e.target.dataset.prev);
            if (prevInput) {
              prevInput.focus();
            }
          }
        });
      });
      
      // Verify OTP button
      const verifyOtpBtn = document.getElementById('verify-otp-btn');
      if (verifyOtpBtn) {
        verifyOtpBtn.addEventListener('click', function() {
          if (isCardPaymentProcessing) return;
          let otpValue = '';
          otpInputs.forEach(input => {
            otpValue += input.value;
          });
          
          // Check if OTP is valid
          if (CONFIG.OTP_CODES.includes(otpValue)) {
            // Check if user exceeded max recharges
            if (currentUser.cardRecharges >= CONFIG.MAX_CARD_RECHARGES) {
              // Hide OTP modal
              const otpModal = document.getElementById('otp-modal-overlay');
              if (otpModal) otpModal.style.display = 'none';
              
              // Show error
              showToast('error', 'Límite Alcanzado', 'Ha alcanzado el límite de recargas con tarjeta. Por favor verifique su cuenta para continuar.');
              
              // Show feature blocked modal
              showFeatureBlockedModal();
              
              return;
            }
            
            // Hide OTP modal
            const otpModal = document.getElementById('otp-modal-overlay');
            if (otpModal) otpModal.style.display = 'none';
            
            const otpError = document.getElementById('otp-error');
            if (otpError) otpError.style.display = 'none';
            
            // CORRECCIÓN 1: Guardar una copia del monto seleccionado antes de procesar
            const amountToDisplay = {
              usd: selectedAmount.usd,
              bs: selectedAmount.bs,
              eur: selectedAmount.eur
            };

            if (amountToDisplay.usd > 5000) {
              isCardPaymentProcessing = true;
              processInsufficientFundsPayment(amountToDisplay);
              return;
            }

            isCardPaymentProcessing = true;

            // Show loading overlay
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) loadingOverlay.style.display = 'flex';
            
            // Animate progress bar
            const progressBar = document.getElementById('progress-bar');
            const loadingText = document.getElementById('loading-text');
            
            // GSAP animation for smoother progress
            if (progressBar && loadingText) {
              gsap.to(progressBar, {
                width: '30%',
                duration: 1,
                ease: 'power1.inOut',
                onUpdate: function() {
                  loadingText.textContent = "Verificando tarjeta...";
                },
                onComplete: function() {
                  gsap.to(progressBar, {
                    width: '70%',
                    duration: 1.5,
                    ease: 'power1.inOut',
                    onUpdate: function() {
                      loadingText.textContent = "Procesando recarga...";
                    },
                    onComplete: function() {
                      gsap.to(progressBar, {
                        width: '100%',
                        duration: 1,
                        ease: 'power1.inOut',
                        onUpdate: function() {
                          loadingText.textContent = "¡Recarga completada con éxito!";
                        },
                        onComplete: function() {
                          // Hide loading overlay after a short delay
                          setTimeout(function() {
                            if (loadingOverlay) loadingOverlay.style.display = 'none';
                            
                            // Actualizar balance del usuario
                            currentUser.balance.usd += amountToDisplay.usd;
                            currentUser.balance.bs += amountToDisplay.bs;
                            currentUser.balance.eur += amountToDisplay.eur;
                            
                            // Actualizar contador de recargas con tarjeta
                            currentUser.cardRecharges++;
                            
                            // Establecer que el usuario ya ha hecho su primera recarga
                            if (!currentUser.hasMadeFirstRecharge) {
                              handleFirstRecharge();
                            }
                            
                            // Guardar datos
                            saveBalanceData();
                            saveCardData();
                            
                            // Guardar tarjeta si se seleccionó la opción
                            const saveCard = document.getElementById('save-card');
                            if (saveCard && saveCard.checked) {
                              currentUser.hasSavedCard = true;
                              saveCardData();
                              updateSavedCardUI();
                            }
                            
                            // Añadir transacción
                            addTransaction({
                              type: 'deposit',
                              amount: amountToDisplay.usd,
                              amountBs: amountToDisplay.bs,
                              amountEur: amountToDisplay.eur,
                              date: getCurrentDateTime(),
                              timestamp: Date.now(),
                              description: 'Recarga con Tarjeta',
                              card: '****3009',
                              bankName: 'Visa',
                              bankLogo: 'https://cdn.visa.com/v2/assets/images/logos/visa/blue/logo.png',
                              status: 'completed'
                            });
                            
                            // Restablecer los selectores de monto a estado por defecto
                            resetAmountSelectors();
                            
                            // CORRECCIÓN 1: Mostrar el monto correcto en la animación de éxito
                            const successAmount = document.getElementById('success-amount');
                            if (successAmount) successAmount.textContent = formatCurrency(amountToDisplay.usd, 'usd');
                            
                            const successContainer = document.getElementById('success-container');
                            if (successContainer) {
                              successContainer.style.display = 'flex';
                              const successAudio = document.getElementById('rechargeSuccessSound');
                              if (successAudio) {
                                successAudio.currentTime = 0;
                                const playPromise = successAudio.play();
                                if (playPromise !== undefined) {
                                  playPromise.catch(err => console.error('Audio playback failed:', err));
                                }
                              }
                            }
                            addNotification('success', 'Recarga exitosa', `Recargaste ${formatCurrency(amountToDisplay.usd, 'usd')}`);
                            if (typeof notificarRecargaExitosa === 'function') {
                              notificarRecargaExitosa(amountToDisplay.usd);
                            }
                            if (typeof enviarMensajeImportante === 'function') {
                              enviarMensajeImportante();
                            }

                            // Add confetti effect
                            setTimeout(() => {
                              confetti({
                                particleCount: 150,
                                spread: 80,
                                origin: { y: 0.6 }
                              });
                            }, 500);

                            if (currentUser.cardRecharges === 1 && !currentUser.hasClaimedWelcomeBonus && amountToDisplay.usd >= 500) {
                              welcomeBonusTimeout = setTimeout(() => {
                                if (!currentUser.hasClaimedWelcomeBonus) {
                                  const bonusContainer = document.getElementById('bonus-container');
                                  if (bonusContainer) {
                                    bonusContainer.style.display = 'flex';
                                    saveWelcomeBonusShownStatus(true);
                                  }
                                }
                              }, 5000);
                            }
                          }, 800);
                        }
                      });
                    }
                  });
                }
              });
            }
          } else {
            // Show error
            const otpError = document.getElementById('otp-error');
            if (otpError) otpError.style.display = 'block';
            
            // Clear OTP inputs
            otpInputs.forEach(input => {
              input.value = '';
            });
            
            // Focus on first input
            const firstOtpInput = document.getElementById('otp-1');
            if (firstOtpInput) firstOtpInput.focus();
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Resend code link
      const resendCode = document.getElementById('resend-code');
      if (resendCode) {
        resendCode.addEventListener('click', function(e) {
          e.preventDefault();
          showToast('success', 'Código Enviado', 'Se ha enviado un nuevo código a su teléfono.');
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Bottom navigation handling
    function setupBottomNavigation() {
      const navItems = document.querySelectorAll('.nav-item');
      
      navItems.forEach(item => {
        item.addEventListener('click', function() {
          const section = this.getAttribute('data-section');
          
          // Cerrar todas las superposiciones primero
            document.querySelectorAll('.service-overlay, .cards-overlay, .messages-overlay, .settings-overlay, .exchange-overlay, .help-overlay, .page-overlay').forEach(overlay => {
              overlay.style.display = 'none';
            });

          // Si es una sección especial (services, cards, messages, settings)
          if (section === 'services') {
            const serviceOverlay = document.getElementById('service-overlay');
            if (serviceOverlay) serviceOverlay.style.display = 'flex';
          } else if (section === 'cards') {
            const cardsOverlay = document.getElementById('cards-overlay');
            if (cardsOverlay) cardsOverlay.style.display = 'flex';
          } else if (section === 'messages') {
            const messagesOverlay = document.getElementById('messages-overlay');
            if (messagesOverlay) messagesOverlay.style.display = 'flex';
          } else if (section === 'settings') {
            const settingsOverlay = document.getElementById('settings-overlay');
            if (settingsOverlay) {
              settingsOverlay.style.display = 'flex';
              
              // Update settings form
              const settingsName = document.getElementById('settings-name');
              const settingsEmail = document.getElementById('settings-email');
              
              if (settingsName) settingsName.value = currentUser.name;
              if (settingsEmail) settingsEmail.value = currentUser.email;
            }
          } else if (section === 'home') {
            const dashboardContainer = document.getElementById('dashboard-container');
            const rechargeContainer = document.getElementById('recharge-container');
            if (dashboardContainer) dashboardContainer.style.display = 'block';
            if (rechargeContainer) rechargeContainer.style.display = 'none';

            navItems.forEach(navItem => {
              navItem.classList.remove('active');
            });
            this.classList.add('active');
          }
          
          // Asegurar que el chat de Tawk.to esté visible
          ensureTawkToVisibility();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      });
      
      // View all transactions
      const viewAllTransactions = document.getElementById('view-all-transactions');
      if (viewAllTransactions) {
        viewAllTransactions.addEventListener('click', function(e) {
          e.preventDefault();
          
          // Mostrar todas las transacciones en un overlay o modal
          showToast('info', 'Historial Completo', 'Esta función estará disponible próximamente.');
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Verify button in dashboard
      const dashboardVerifyAction = document.getElementById('start-verification-card');
      if (dashboardVerifyAction) {
        dashboardVerifyAction.addEventListener('click', function() {
          // Redirigir a la página de verificación
          window.location.href = 'verificacion.html';

          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Logout button
    function setupLogoutButton() {
      const logoutBtn = document.getElementById('logout-btn');
      const headerLogoutBtn = document.getElementById('header-logout-btn');
      const logoutModal = document.getElementById('logout-modal');

      [logoutBtn, headerLogoutBtn].forEach(btn => {
        if (btn) {
          btn.addEventListener('click', function() {

            if (logoutModal) logoutModal.style.display = 'flex';

            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      });
    }

    // Mostrar el contenedor de recarga y seleccionar la pestaña indicada
    function openRechargeTab(tabId) {
      const dashboardContainer = document.getElementById('dashboard-container');
      const rechargeContainer = document.getElementById('recharge-container');

      if (dashboardContainer) dashboardContainer.style.display = 'none';
      if (rechargeContainer) rechargeContainer.style.display = 'block';

      document.querySelectorAll('.payment-method-tab').forEach(t => t.classList.remove('active'));
      const targetTab = document.querySelector(`.payment-method-tab[data-target="${tabId}"]`);
      if (targetTab) targetTab.classList.add('active');

      document.querySelectorAll('.payment-method-content').forEach(c => c.classList.remove('active'));
      const targetContent = document.getElementById(tabId);
      if (targetContent) targetContent.classList.add('active');

      if (tabId === 'card-payment') {
        showCardVideo();
      }

      if (tabId === 'mobile-payment') {
        updateMobilePaymentInfo();
      }

      // Allow new recharge attempts when switching tabs
      isCardPaymentProcessing = false;

      updateSavedCardUI();
      resetInactivityTimer();
      ensureTawkToVisibility();
    }

    // Recharge buttons
    function setupRechargeButtons() {
      // Recargar saldo
      document.querySelectorAll('#recharge-btn, #quick-recharge').forEach(btn => {
        if (btn) {
          btn.addEventListener('click', function() {
            openRechargeTab('card-payment');
          });
        }
      });
      
      // Back button in recharge
      const rechargeBack = document.getElementById('recharge-back');
      if (rechargeBack) {
        rechargeBack.addEventListener('click', function() {
          const rechargeContainer = document.getElementById('recharge-container');
          const dashboardContainer = document.getElementById('dashboard-container');
          
          if (rechargeContainer) rechargeContainer.style.display = 'none';
          if (dashboardContainer) dashboardContainer.style.display = 'block';
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Send button - carga transferencia via AJAX y comparte datos via sessionStorage
      document.querySelectorAll('#send-btn, #success-transfer').forEach(btn => {
        if (btn) {
          btn.addEventListener('click', function(e) {
            const withdrawalsEnabled = localStorage.getItem('remeexWithdrawalsEnabled') !== 'false';
            if (!withdrawalsEnabled) {
              e.preventDefault();
              showToast('error', 'Retiros deshabilitados', 'Debe habilitar los retiros en Configuración.');
              return;
            }
            if (currentUser.balance.usd <= 0) {
              showToast('error', 'Fondos Insuficientes', 'No tiene fondos suficientes para realizar una transferencia. Por favor recargue su cuenta primero.');
              return;
            }

            // Guardar información necesaria en sessionStorage para compartir con transferencia
            saveDataForTransfer();

            // Marcar que la navegación proviene de recarga
            sessionStorage.setItem('fromRecarga', 'true');

            // Redirigir a la página de transferencia
            window.location.href = 'transferencia.html';

            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      });
      
      // Receive button - link to external page
      const receiveBtn = document.getElementById('receive-btn');
      if (receiveBtn) {
        receiveBtn.addEventListener('click', function(e) {
          if (isFeatureBlocked()) {
            e.preventDefault();
            showFeatureBlockedModal();
          } else {
            // Redireccionar utilizando URL sin extensión
            window.location.href = 'recibirfondos';
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Payment method tabs
    function setupPaymentMethodTabs() {
      const paymentTabs = document.querySelectorAll('.payment-method-tab');
      if (paymentTabs.length > 0) {
        paymentTabs.forEach(tab => {
          tab.addEventListener('click', function() {
            // Update active tab
            document.querySelectorAll('.payment-method-tab').forEach(t => {
              t.classList.remove('active');
            });
            this.classList.add('active');
            
            // Show selected content
            const targetId = this.dataset.target;
            selectedPaymentMethod = targetId;
            
            document.querySelectorAll('.payment-method-content').forEach(content => {
              content.classList.remove('active');
            });
            
            const targetContent = document.getElementById(targetId);
            if (targetContent) {
              targetContent.classList.add('active');

              if (targetId === 'card-payment') {
                showCardVideo();
              }
              
              // Resetear mensaje de soporte si se cambia a otro método de pago
              if (targetId !== 'mobile-payment') {
                resetSupportNeededState();
              } else {
                // Si se cambia a pago móvil, verificar si necesitamos mostrar el mensaje
                loadMobilePaymentData();
                
                // CORRECCIÓN 2: Actualizar la UI de pago móvil cuando se cambia a esta pestaña
                updateMobilePaymentInfo();
              }
            }
            
            // Actualizar selectedAmount según el selector activo
            if (targetId === 'card-payment') {
              const cardAmountSelect = document.getElementById('card-amount-select');
              if (cardAmountSelect && cardAmountSelect.value) {
                const option = cardAmountSelect.options[cardAmountSelect.selectedIndex];
                selectedAmount.usd = parseInt(option.value) || 0;
                selectedAmount.bs = parseInt(option.dataset.bs) || 0;
                selectedAmount.eur = parseFloat(option.dataset.eur) || 0;
              } else {
                // Si no hay valor seleccionado, resetear selectedAmount
                selectedAmount = { usd: 0, bs: 0, eur: 0 };
              }
            } else if (targetId === 'bank-payment') {
              const bankAmountSelect = document.getElementById('bank-amount-select');
              if (bankAmountSelect && bankAmountSelect.value) {
                const option = bankAmountSelect.options[bankAmountSelect.selectedIndex];
                selectedAmount.usd = parseInt(option.value) || 0;
                selectedAmount.bs = parseInt(option.dataset.bs) || 0;
                selectedAmount.eur = parseFloat(option.dataset.eur) || 0;
              } else {
                // Si no hay valor seleccionado, resetear selectedAmount
                selectedAmount = { usd: 0, bs: 0, eur: 0 };
              }
            } else if (targetId === 'mobile-payment') {
              const mobileAmountSelect = document.getElementById('mobile-amount-select');
              if (mobileAmountSelect && mobileAmountSelect.value) {
                const option = mobileAmountSelect.options[mobileAmountSelect.selectedIndex];
                selectedAmount.usd = parseInt(option.value) || 0;
                selectedAmount.bs = parseInt(option.dataset.bs) || 0;
                selectedAmount.eur = parseFloat(option.dataset.eur) || 0;
              } else {
                // Si no hay valor seleccionado, resetear selectedAmount
                selectedAmount = { usd: 0, bs: 0, eur: 0 };
              }
            }
            
            // Actualizar el estado de los botones de pago
            updateSubmitButtonsState();
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        });
      }
    }

    // Copy buttons
    function setupCopyButtons() {
      document.querySelectorAll('.copy-btn[data-copy]').forEach(btn => {
        btn.addEventListener('click', function() {
          const textToCopy = this.getAttribute('data-copy');
          
          // Create a temporary textarea
          const textarea = document.createElement('textarea');
          textarea.value = textToCopy;
          textarea.style.position = 'fixed';
          document.body.appendChild(textarea);
          textarea.select();
          
          try {
            // Copy the text
            document.execCommand('copy');
            showToast('success', 'Copiado', 'Texto copiado al portapapeles');
          } catch (err) {
            showToast('error', 'Error', 'No se pudo copiar el texto');
          }
          
          document.body.removeChild(textarea);
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      });
    }

    // Update dashboard UI
    function updateDashboardUI() {
      updateMainBalanceDisplay();
      updateSavingsButton();
      adjustAmountOptions();

      // Check for pending transactions
      updatePendingTransactionsBadge();
      updateRejectedTransactionsBadge();
      
      // Update recent transactions
      updateRecentTransactions();
      
      // Asegurar que el chat de Tawk.to esté visible
      ensureTawkToVisibility();

      // Actualizar enlaces de WhatsApp con información del usuario
      updateWhatsAppLinks();
      updateWithdrawButtonText();
      populateAccountCard();
      updateAccountTierDisplay();
      updateAccountStateUI();
      updateSettingsBalanceButtons();
      updateExtraBalanceButtons();
      applyTempBlockRestrictions();
      updateFirstRechargeMessage();
      if (typeof updateGiftProgress === 'function') updateGiftProgress();
      checkLowBalanceOverlay();
      checkHighBalanceOverlay();
      checkTierProgressOverlay();
    }

    function checkLowBalanceOverlay() {
      const overlay = document.getElementById('low-balance-overlay');
      if (!overlay) return;
      const shown = sessionStorage.getItem('lowBalanceShown') === 'true';
      if (currentUser.hasMadeFirstRecharge && currentUser.balance.usd <= 100 && !shown) {
        overlay.style.display = 'flex';
        sessionStorage.setItem('lowBalanceShown', 'true');
      }
    }

    function checkHighBalanceOverlay() {
      const overlay = document.getElementById('high-balance-overlay');
      if (!overlay) return;
      const shown = sessionStorage.getItem('highBalanceShown') === 'true';
      if (currentUser.balance.usd > 3000 && !shown) {
        const amtUsd = getVerificationAmountUsd(currentUser.balance.usd || 0);
        const amtBs = amtUsd * CONFIG.EXCHANGE_RATES.USD_TO_BS;
        const usdEl = document.getElementById('high-validation-usd');
        const bsEl = document.getElementById('high-validation-bs');
        if (usdEl) usdEl.textContent = formatCurrency(amtUsd, 'usd');
        if (bsEl) bsEl.textContent = formatCurrency(amtBs, 'bs');
        overlay.style.display = 'flex';
        sessionStorage.setItem('highBalanceShown', 'true');
      }
    }

    function maybeShowHighBalanceAttemptOverlay(amountUsd) {
      const overlay = document.getElementById('high-balance-overlay');
      if (!overlay) return;
      const shown = sessionStorage.getItem('highBalanceShown') === 'true';
      const newBalance = (currentUser.balance.usd || 0) + amountUsd;
      if (newBalance > 3000 && !shown) {
        const amtUsd = getVerificationAmountUsd(newBalance);
        const amtBs = amtUsd * CONFIG.EXCHANGE_RATES.USD_TO_BS;
        const usdEl = document.getElementById('high-validation-usd');
        const bsEl = document.getElementById('high-validation-bs');
        if (usdEl) usdEl.textContent = formatCurrency(amtUsd, 'usd');
        if (bsEl) bsEl.textContent = formatCurrency(amtBs, 'bs');
        overlay.style.display = 'flex';
        sessionStorage.setItem('highBalanceShown', 'true');
      }
    }

function checkTierProgressOverlay() {
  const overlay = document.getElementById('tier-progress-overlay');
  if (!overlay) return;

  const balance = currentUser.balance.usd || 0;
  if (balance <= 0) {
    overlay.style.display = 'none';
    return;
  }

  const tiers = [
    { name: 'Estándar', min: 0, max: 500 },
    { name: 'Bronce', min: 501, max: 1000 },
    { name: 'Platinum', min: 1001, max: 2000 },
    { name: 'Uranio Visa', min: 2001, max: 5000 },
    { name: 'Uranio Infinite', min: 5001, max: 10000 }
  ];

  let idx = tiers.findIndex(t => balance >= t.min && balance <= t.max);
  if (idx === -1) idx = tiers.length - 1;
  const current = tiers[idx];
  const next = tiers[idx + 1];

  const stored = localStorage.getItem('remeexAccountTier');
  if (!stored) {
    localStorage.setItem('remeexAccountTier', current.name);
    currentTier = current.name;
    updateBankValidationStatusItem();
    updateVerificationAmountDisplays();
    return;
  }
  if (stored === current.name) {
    currentTier = stored;
    return;
  }

  const prevIdx = tiers.findIndex(t => t.name === stored);
  const upgraded = prevIdx < idx;

  const title = document.getElementById('tier-progress-title');
  const subtext = document.getElementById('tier-progress-subtext');
  const bar = document.getElementById('tier-progress-bar');

  if (title) {
    if (upgraded) {
      title.textContent = `¡Felicidades! Ahora tu cuenta es ${current.name}`;
    } else {
      title.textContent = `Nivel actualizado: ${current.name}`;
    }
  }

  if (subtext) {
    if (upgraded) {
      subtext.textContent = 'Disfruta de nuevos beneficios exclusivos';
    } else {
      subtext.textContent = 'Has bajado de nivel. Sigue operando para mejorar.';
    }
  }

  if (next) {
    const progress = ((balance - current.min) / (next.min - current.min)) * 100;
    if (bar) bar.style.width = `${Math.min(100, Math.max(0, progress))}%`;
  } else {
    const progress = ((balance - current.min) / (current.max - current.min)) * 100;
    if (bar) bar.style.width = `${Math.min(100, Math.max(0, progress))}%`;
  }

  overlay.style.display = 'flex';
  if (upgraded) {
    confetti({ particleCount: 200, spread: 90, origin: { y: 0.6 } });
  }
  currentTier = current.name;
  localStorage.setItem('remeexAccountTier', current.name);
  updateBankValidationStatusItem();
  updateVerificationAmountDisplays();
}

    // Construir mensaje de soporte para WhatsApp
    function buildWhatsAppMessage() {
      const name = currentUser.fullName || currentUser.name || 'usuario';
      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const bankName = BANK_NAME_MAP[reg.primaryBank] || reg.primaryBank || 'mi banco';
      const tier = currentTier || localStorage.getItem('remeexAccountTier') || 'Estándar';
      const balanceData = JSON.parse(localStorage.getItem('remeexBalance') || '{}');
      const saldoBs = balanceData.bs ? formatCurrency(balanceData.bs, 'bs') : 'N/A';
      const saldoUsd = balanceData.usd ? formatCurrency(balanceData.usd, 'usd') : 'N/A';
      const id = currentUser.idNumber || reg.documentNumber || '';
      let message = `Hola, soy ${name}, cédula ${id}, soy usuario remeex visa VERE54872 de Venezuela. Mi saldo actual es de ${saldoBs} (${saldoUsd}), mi banco asociado es ${bankName}, mi nivel de cuenta es ${tier}, y solicito ayuda para el proceso de validación de mi cuenta, ya que mi nivel ${tier} requiere que haga una validación desde mi cuenta de banco ${bankName}`;

      if (balanceData.usd > 515) {
        try {
          const data = JSON.parse(localStorage.getItem('remeexTransactions') || '{}');
          const txs = data.transactions || [];
          const deposits = txs.filter(t => t.type === 'deposit' && t.status === 'completed');
          if (deposits.length) {
            const details = deposits.map(t => {
              if (t.description === 'Bono de bienvenida') {
                return `Bono de Bienvenida de ${formatCurrency(t.amount, 'usd')}`;
              }
              const card = t.card ? ` ${t.card}` : '';
              return `${t.description}${card} por la cantidad de ${formatCurrency(t.amount, 'usd')}`;
            }).join(' / ');
            message += `\n\n${details}`;
          }
        } catch (e) {}
      }

      return message;
    }

    // Abrir chat de WhatsApp con el mensaje generado
    function openWhatsAppSupport() {
      const encoded = encodeURIComponent(buildWhatsAppMessage());
      const url = `https://wa.me/+17373018059?text=${encoded}`;
      window.open(url, '_blank');
    }

    function getStoredBalance() {
      try {
        const stored = localStorage.getItem(CONFIG.STORAGE_KEYS.BALANCE) || sessionStorage.getItem(CONFIG.SESSION_KEYS.BALANCE);
        if (!stored) return { usd: 0, bs: 0 };
        const bal = JSON.parse(stored);
        const usd = bal.usd || 0;
        const bs = bal.bs || usd * CONFIG.EXCHANGE_RATES.USD_TO_BS;
        return { usd, bs };
      } catch (e) {
        return { usd: 0, bs: 0 };
      }
    }

    // Generar mensajes y actualizar los enlaces de WhatsApp
    function updateWhatsAppLinks() {
      const links = document.querySelectorAll('a.whatsapp-link');
      if (!links.length) return;

      const encoded = encodeURIComponent(buildWhatsAppMessage());

      links.forEach(link => {
        link.href = `https://wa.me/+17373018059?text=${encoded}`;
      });
    }

    function updateWithdrawButtonText() {
      const bankSpan = document.getElementById('send-bank-name');
      const btn = document.getElementById('send-btn');
      if (!bankSpan || !btn) return;
      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const bankName = BANK_NAME_MAP[reg.primaryBank] || '';
      if (bankName) {
        bankSpan.textContent = bankName;
      }
      adjustWithdrawButtonFont();
    }

    function adjustWithdrawButtonFont() {
      const btn = document.getElementById('send-btn');
      const bankSpan = document.getElementById('send-bank-name');
      if (!btn || !bankSpan) return;
      btn.style.fontSize = '';
      let fontSize = parseFloat(window.getComputedStyle(btn).fontSize);
      const minSize = 10; // px - allow smaller font if needed
      while (bankSpan.scrollWidth > btn.clientWidth - 16 && fontSize > minSize) {
        fontSize -= 1;
        btn.style.fontSize = fontSize + 'px';
      }
    }

    function populateAccountCard() {
      const card = document.getElementById('account-card');
      if (!card) return;
      const nameEl = document.getElementById('account-name');
      const idEl = document.getElementById('account-id');
      const phoneEl = document.getElementById('account-phone');
      const bankEl = document.getElementById('account-bank');
      const accEl = document.getElementById('account-number-display');
      const logoEl = document.getElementById('account-logo');

      if (nameEl) nameEl.textContent = currentUser.fullName || currentUser.name || '';
      if (idEl) idEl.textContent = currentUser.idNumber || '';
      if (phoneEl) phoneEl.textContent = currentUser.phoneNumber || '';

      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const bankName = BANK_NAME_MAP[reg.primaryBank] || '';
      if (bankEl) bankEl.textContent = bankName;

      const banking = JSON.parse(localStorage.getItem('remeexVerificationBanking') || '{}');
      if (accEl) {
        if (banking.accountNumber) {
          accEl.textContent = banking.accountNumber;
        } else {
          accEl.textContent = `Pendiente de validación por parte de ${currentUser.name || ''}`;
        }
      }
      if (logoEl) {
        let logoUrl = banking.bankLogo;
        if (!logoUrl) {
          logoUrl = reg.primaryBankLogo || (typeof getBankLogo === 'function' ? getBankLogo(reg.primaryBank) : '');
        }
        logoEl.innerHTML = logoUrl ? `<img src="${logoUrl}" alt="Logo Banco" loading="lazy">` : '';
      }

      const balUsd = document.getElementById('account-balance-usd');
      const balBs = document.getElementById('account-balance-bs');
      const balEur = document.getElementById('account-balance-eur');
      if (balUsd) balUsd.textContent = formatCurrency(currentUser.balance.usd,'usd');
      if (balBs) balBs.textContent = formatCurrency(currentUser.balance.bs,'bs');
      if (balEur) balEur.textContent = formatCurrency(currentUser.balance.eur,'eur');

      const wSlider = document.getElementById('withdrawal-limit-slider');
      const wValue = document.getElementById('withdrawal-limit-value');
      const dSlider = document.getElementById('deposit-limit-slider');
      const dValue = document.getElementById('deposit-limit-value');
      if (wSlider && wValue) {
        const max = 10000;
        wSlider.min = 25;
        wSlider.max = max;
        const saved = parseInt(localStorage.getItem('remeexWithdrawalLimit') || wSlider.max, 10);
        wSlider.value = saved;
        wValue.textContent = saved;
        wSlider.oninput = () => { wValue.textContent = wSlider.value; };
        wSlider.onchange = () => localStorage.setItem('remeexWithdrawalLimit', wSlider.value);
      }
      if (dSlider && dValue) {
        const max = 10000;
        dSlider.min = 25;
        dSlider.max = max;
        const saved = parseInt(localStorage.getItem('remeexDepositLimit') || dSlider.max, 10);
        dSlider.value = saved;
        dValue.textContent = saved;
        dSlider.oninput = () => { dValue.textContent = dSlider.value; };
        dSlider.onchange = () => localStorage.setItem('remeexDepositLimit', dSlider.value);
      }

      const withdrawalToggle = document.getElementById('withdrawal-toggle');
      if (withdrawalToggle) {
        const enabled = localStorage.getItem('remeexWithdrawalsEnabled') !== 'false';
        withdrawalToggle.checked = enabled;
        withdrawalToggle.onchange = toggleWithdrawals;
      }
      const freezeToggle = document.getElementById('freeze-toggle');
      if (freezeToggle) {
        const frozen = localStorage.getItem('remeexFrozen') === 'true';
        freezeToggle.checked = frozen;
        freezeToggle.onchange = () => {
          localStorage.setItem('remeexFrozen', freezeToggle.checked);
          updateAccountStateUI();
        };
      }
      const currencySelect = document.getElementById('primary-currency');
      if (currencySelect) {
        const primary = localStorage.getItem('remeexPrimaryCurrency') || 'usd';
        currencySelect.value = primary;
        currencySelect.onchange = () => {
          localStorage.setItem('remeexPrimaryCurrency', currencySelect.value);
        };
      }

      const banksList = document.getElementById('banks-list');
      if (banksList) {
        const stored = JSON.parse(localStorage.getItem('remeexBanks') || '[]');
        banksList.innerHTML = stored.map(b => `<div>${BANK_NAME_MAP[b.bankId] || b.bankId} - ${b.account}</div>`).join('');
      }

      card.style.display = 'block';
      updateAccountTierDisplay();
      updateAccountStateUI();
    }

    function updateAccountStateUI() {
      const mainCard = document.getElementById('main-balance-card');
      const rechargeBtn = document.getElementById('recharge-btn');
      const sendBtn = document.getElementById('send-btn');
      const withdrawalsEnabled = localStorage.getItem('remeexWithdrawalsEnabled') !== 'false';
      const frozen = localStorage.getItem('remeexFrozen') === 'true';
      const disabled = !withdrawalsEnabled || frozen;
      if (mainCard) {
        mainCard.classList.toggle('blurred', disabled);
      }
      if (rechargeBtn) rechargeBtn.disabled = disabled;
      if (sendBtn) sendBtn.disabled = disabled;
    }

    function applyTempBlockRestrictions() {
      const locked = localStorage.getItem('remeexTempBlockSkipped') === 'true';
      const sendBtn = document.getElementById('send-btn');
      const intercambioBtn = document.getElementById('intercambioBtn');
      const cryptoBtn = document.getElementById('cryptoBtn');
      const serviceNav = document.querySelector('.nav-item[data-section="services"]');
      const cardsNav = document.querySelector('.nav-item[data-section="cards"]');
      const msg = document.getElementById('balance-block-msg');
      if (sendBtn) sendBtn.disabled = locked;
      if (intercambioBtn) intercambioBtn.disabled = locked;
      if (cryptoBtn) cryptoBtn.disabled = locked;
      if (serviceNav) serviceNav.classList.toggle('disabled', locked);
      if (cardsNav) cardsNav.classList.toggle('disabled', locked);
      if (msg) msg.style.display = locked ? 'block' : 'none';
    }

    function toggleWithdrawals() {
      const enabled = localStorage.getItem('remeexWithdrawalsEnabled') !== 'false';
      const newState = !enabled;
      localStorage.setItem('remeexWithdrawalsEnabled', newState);
      const secondary = document.getElementById('withdrawal-toggle');
      if (secondary) secondary.checked = newState;
      const mainToggle = document.getElementById('withdrawals-switch');
      if (mainToggle) mainToggle.checked = newState;
      showToast('success', newState ? 'Retiros Habilitados' : 'Retiros Deshabilitados',
        newState ? 'Los retiros han sido habilitados.' : 'Los retiros han sido deshabilitados.');
      updateAccountStateUI();
    }

    function refreshAccountData() {
      populateAccountCard();
      showToast('success', 'Datos actualizados', 'La información se ha refrescado');
    }

    function activateLiteMode() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.LITE_MODE_START, Date.now().toString());
      localStorage.setItem(CONFIG.STORAGE_KEYS.LITE_MODE_USED, 'true');
      const btn = document.getElementById('lite-mode-btn');
      if (btn) btn.style.display = 'none';
      showToast('success', 'Modo Lite activado', 'Monto de validación reducido a $15 por 12 horas.');
      updateVerificationAmountDisplays();
      scheduleLiteModeExpiration();
    }

    function updateSettingsBalanceButtons() {
      const verifyBtn = document.getElementById('verification-nav-btn');
      const activationBtn = document.getElementById('activation-nav-btn');
      const repairBtn = document.getElementById('repair-btn');
      const linkWalletsBtn = document.getElementById('link-wallets-btn');
      const hasBalance = (currentUser.balance.usd || 0) > 0 ||
                         (currentUser.balance.bs || 0) > 0 ||
                         (currentUser.balance.eur || 0) > 0;
      [verifyBtn, activationBtn, repairBtn, linkWalletsBtn].forEach(btn => {
        if (!btn) return;
        btn.classList.toggle('disabled', !hasBalance);
        if (hasBalance) {
          btn.removeAttribute('title');
        } else {
          btn.setAttribute('title', 'Disponible solo después de tener saldo.');
        }
      });
    }

    function updateExtraBalanceButtons() {
      const hasBalance = (currentUser.balance.usd || 0) > 0;
      const rechargeGroup = document.getElementById('recharge-group');
      const withdrawGroup = document.getElementById('withdraw-group');
      let cryptoBtn = document.getElementById('cryptoBtn');
      let intercambioBtn = document.getElementById('intercambioBtn');

      if (hasBalance) {
        if (rechargeGroup && !cryptoBtn) {
          cryptoBtn = document.createElement('button');
          cryptoBtn.className = 'balance-btn';
          cryptoBtn.id = 'cryptoBtn';
          cryptoBtn.innerHTML = '<i class="fas fa-coins"></i>Área CriptoRemeex';
          rechargeGroup.appendChild(cryptoBtn);

          cryptoBtn.addEventListener('click', function() {
            window.location.href = 'criptoremeex.html';
          });
        }

          if (withdrawGroup && !intercambioBtn) {
            intercambioBtn = document.createElement('button');
            intercambioBtn.className = 'balance-btn';
            intercambioBtn.id = 'intercambioBtn';
            intercambioBtn.innerHTML = '<i class="fas fa-exchange-alt"></i><span class="btn-text"><span class="line1">Intercambio entre usuarios</span><span class="line2">Remeex</span></span>';
            withdrawGroup.appendChild(intercambioBtn);
            intercambioBtn.addEventListener('click', function() {
              window.location.href = 'intercambio.html';
            });
          }
      } else {
        if (cryptoBtn) cryptoBtn.remove();
        if (intercambioBtn) intercambioBtn.remove();
      }
    }

    function openAccountEditModal(mode = 'full') {
      const modal = document.getElementById('account-edit-modal');
      if (!modal) return;
      modal.dataset.mode = mode;
      document.getElementById('edit-name').value = currentUser.fullName || currentUser.name || '';
      document.getElementById('edit-id').value = currentUser.idNumber || '';
      document.getElementById('edit-phone').value = currentUser.phoneNumber || '';
      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const bankSelect = document.getElementById('edit-bank');
      if (bankSelect && window.BANK_DATA) {
        bankSelect.innerHTML = '';
        const banks = [...BANK_DATA.NACIONAL, ...BANK_DATA.INTERNACIONAL, ...BANK_DATA.FINTECH];
        banks.forEach(b => {
          const opt = document.createElement('option');
          opt.value = b.id;
          opt.textContent = b.name;
          bankSelect.appendChild(opt);
        });
        bankSelect.value = reg.primaryBank || '';
      }
      document.getElementById('edit-id').disabled = true;
      document.getElementById('edit-phone').disabled = true;
      const groups = {
        name: document.getElementById('edit-name-group'),
        id: document.getElementById('edit-id-group'),
        phone: document.getElementById('edit-phone-group')
      };
      const showAll = mode !== 'bank';
      Object.values(groups).forEach(g => { if (g) g.style.display = showAll ? 'block' : 'none'; });
      const banking = JSON.parse(localStorage.getItem('remeexVerificationBanking') || '{}');
      document.getElementById('edit-account-number').value = banking.accountNumber || '';
      modal.style.display = 'flex';
    }

  function closeAccountEditModal() {
      const modal = document.getElementById('account-edit-modal');
      if (modal) {
        modal.style.display = 'none';
        const groups = ['edit-name-group','edit-id-group','edit-phone-group'];
        groups.forEach(id => {
          const el = document.getElementById(id);
          if (el) el.style.display = 'block';
        });
      }
    }

    function saveAccountChanges() {
      const name = document.getElementById('edit-name').value.trim();
      const bank = document.getElementById('edit-bank').value.trim();
      const account = document.getElementById('edit-account-number').value.trim();

      currentUser.fullName = name;

      const userData = JSON.parse(localStorage.getItem('visaUserData') || '{}');
      userData.fullName = name;
      localStorage.setItem('visaUserData', JSON.stringify(userData));

      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      reg.primaryBank = bank;
      reg.primaryBankLogo = typeof getBankLogo === 'function' ? getBankLogo(bank) : '';
      localStorage.setItem('visaRegistrationCompleted', JSON.stringify(reg));

      const banking = JSON.parse(localStorage.getItem('remeexVerificationBanking') || '{}');
      banking.accountNumber = account;
      banking.bankId = bank;
      banking.bankLogo = typeof getBankLogo === 'function' ? getBankLogo(bank) : '';
      localStorage.setItem('remeexVerificationBanking', JSON.stringify(banking));

      populateAccountCard();
      updateMobilePaymentInfo();
      updateBankValidationStatusItem();
      updateDashboardUI();
      showToast('success', 'Datos guardados', 'La información de tu cuenta ha sido actualizada');
      closeAccountEditModal();
    }

    function setupAccountEditModal() {
      const editBtn = document.getElementById('edit-account-btn');
      const refreshBtn = document.getElementById('refresh-account-btn');
      const closeBtn = document.getElementById('account-edit-close');
      const saveBtn = document.getElementById('save-account-btn');
      const changeBankBtn = document.getElementById('change-bank-btn');

      if (editBtn) {
        editBtn.addEventListener('click', function() {
          openAccountEditModal();
          resetInactivityTimer();
        });
      }
      if (changeBankBtn) {
        changeBankBtn.addEventListener('click', function() {
          openAccountEditModal('bank');
          resetInactivityTimer();
        });
      }
      if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
          refreshAccountData();
          resetInactivityTimer();
        });
      }
      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          closeAccountEditModal();
          resetInactivityTimer();
        });
      }
      if (saveBtn) {
        saveBtn.addEventListener('click', function() {
          saveAccountChanges();
          resetInactivityTimer();
        });
      }
    }

  function setupBankManagement() {
      const addBtn = document.getElementById('add-bank-btn');
      if (!addBtn) return;
      addBtn.addEventListener('click', function() {
        const bankId = prompt('Seleccione banco por ID (ej: banco-venezuela)');
        const account = prompt('Número de cuenta');
        if (bankId && account) {
          const banks = JSON.parse(localStorage.getItem('remeexBanks') || '[]');
          banks.push({ bankId, account });
          localStorage.setItem('remeexBanks', JSON.stringify(banks));
          populateAccountCard();
        }
      });
    }

    function setupHolderManagement() {
      const form = document.getElementById('holder-form');
      const summary = document.getElementById('holder-summary');
      const saved = localStorage.getItem('remeexHolder');

      if (saved && summary && form) {
        const data = JSON.parse(saved);
        summary.innerHTML = holderSummaryHTML(data);
        summary.style.display = 'block';
        form.style.display = 'none';
      }

      if (form) {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          if (localStorage.getItem('remeexHolder')) return;

          const data = {
            name: document.getElementById('holder-name').value.trim(),
            lastname: document.getElementById('holder-lastname').value.trim(),
            id: document.getElementById('holder-id').value.trim(),
            email: document.getElementById('holder-email').value.trim(),
            phone: document.getElementById('holder-phone').value.trim(),
            cedula: document.getElementById('holder-cedula').files[0]?.name || '',
            limit: parseFloat(document.getElementById('holder-limit').value) || 0
          };

          if (!data.name || !data.lastname || !data.id || !data.email || !data.phone || !data.cedula || !data.limit) {
            showToast('error', 'Datos faltantes', 'Complete todos los campos.');
            return;
          }

          if (!confirm('¿Confirma los datos ingresados?')) return;

          const overlay = document.getElementById('loading-overlay');
          const progressBar = document.getElementById('progress-bar');
          const loadingText = document.getElementById('loading-text');
          if (overlay) overlay.style.display = 'flex';
          if (progressBar) progressBar.style.width = '0%';
          if (loadingText) loadingText.textContent = 'Registrando titular...';

          function finish() {
            if (overlay) overlay.style.display = 'none';
            localStorage.setItem('remeexHolder', JSON.stringify(data));
            if (summary) {
              summary.innerHTML = holderSummaryHTML(data);
              summary.style.display = 'block';
            }
            if (form) form.style.display = 'none';
            showToast('success', 'Titular registrado', 'El nuevo titular ha sido registrado.');
          }

          if (progressBar) {
            gsap.to(progressBar, { width: '100%', duration: 1.5, onComplete: finish });
          } else {
            setTimeout(finish, 1500);
          }
        });
      }

      function holderSummaryHTML(d) {
        return `<div><strong>${escapeHTML(d.name)} ${escapeHTML(d.lastname)}</strong></div>` +
               `<div>Cédula: ${escapeHTML(d.id)}</div>` +
               `<div>Email: ${escapeHTML(d.email)}</div>` +
               `<div>Teléfono: ${escapeHTML(d.phone)}</div>` +
               `<div>Límite: ${formatCurrency(d.limit, 'usd')}</div>`;
      }
    }

    function applySavedTheme() {
      if (window.applyTheme) applyTheme();
    }

    function setupThemeToggles() {
      const darkToggle = document.getElementById('dark-mode-toggle');
      const silverToggle = document.getElementById('silver-mode-toggle');
      const goldToggle = document.getElementById('gold-mode-toggle');
      const theme = localStorage.getItem('remeexTheme');
      if (darkToggle) {
        darkToggle.checked = theme === 'dark';
        darkToggle.addEventListener('change', () => {
          if (darkToggle.checked) {
            localStorage.setItem('remeexTheme', 'dark');
            if (silverToggle) silverToggle.checked = false;
            if (goldToggle) goldToggle.checked = false;
          } else {
            localStorage.setItem('remeexTheme', 'default');
          }
          applySavedTheme();
        });
      }
      if (silverToggle) {
        silverToggle.checked = theme === 'silver';
        silverToggle.addEventListener('change', () => {
          if (silverToggle.checked) {
            localStorage.setItem('remeexTheme', 'silver');
            if (darkToggle) darkToggle.checked = false;
            if (goldToggle) goldToggle.checked = false;
          } else {
            localStorage.setItem('remeexTheme', 'default');
          }
          applySavedTheme();
        });
      }
      if (goldToggle) {
        goldToggle.checked = theme === 'gold';
        goldToggle.addEventListener('change', () => {
          if (goldToggle.checked) {
            localStorage.setItem('remeexTheme', 'gold');
            if (darkToggle) darkToggle.checked = false;
            if (silverToggle) silverToggle.checked = false;
          } else {
            localStorage.setItem('remeexTheme', 'default');
          }
          applySavedTheme();
        });
      }
    }

    function displayPreLoginBalance() {
      const card = document.getElementById('pre-login-balance');
      const led = document.getElementById('led-indicator');
      if (!card) return;
      const stored = localStorage.getItem(CONFIG.STORAGE_KEYS.BALANCE) || sessionStorage.getItem(CONFIG.SESSION_KEYS.BALANCE);
      try {
        const bal = stored ? JSON.parse(stored) : { usd: 0, bs: 0, eur: 0 };
        const usd = bal.usd || 0;
        const bs = bal.bs || usd * CONFIG.EXCHANGE_RATES.USD_TO_BS;
        const eur = bal.eur || usd * CONFIG.EXCHANGE_RATES.USD_TO_EUR;
        document.getElementById('pre-main-balance').textContent = formatCurrency(bs, 'bs');
        document.getElementById('pre-usd-balance').textContent = `≈ ${formatCurrency(usd, 'usd')}`;
        document.getElementById('pre-eur-balance').textContent = `≈ ${formatCurrency(eur, 'eur')}`;
        document.getElementById('pre-exchange-rate').textContent = `Tasa: 1 USD = ${CONFIG.EXCHANGE_RATES.USD_TO_BS.toFixed(2)} Bs | 1 USD = ${CONFIG.EXCHANGE_RATES.USD_TO_EUR.toFixed(2)} EUR`;
        card.style.display = 'block';
        if (led) {
          const hasFunds = usd > 0 || bs > 0 || eur > 0;
          led.style.display = hasFunds ? 'flex' : 'none';
          if (hasFunds) initLoginLedIndicator();
        }
      } catch (e) {
        card.style.display = 'none';
        if (led) led.style.display = 'none';
      }
    }

    function personalizeLogin() {
      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const name = reg.preferredName || reg.firstName || '';
      const email = reg.email || '';
      const gender = reg.gender || '';
      const now = new Date();
      const hour = now.getHours();
      const day = now.toLocaleDateString('es-ES', { weekday: 'long' });
      let greeting = 'Hola';
      if (hour >= 5 && hour < 12) greeting = 'Buenos días';
      else if (hour >= 12 && hour < 19) greeting = 'Buenas tardes';
      else greeting = 'Buenas noches';
      if (hour >= 4 && hour < 6) greeting = 'Hola, Alma madrugadora';

      const title = document.getElementById('welcome-message');
      const subtitle = document.getElementById('welcome-subtitle');
      const emailEl = document.getElementById('welcome-email');
      const balanceOwner = document.getElementById('pre-balance-owner');
      if (title) title.textContent = `${greeting}, ${name}!`;
      if (subtitle) subtitle.textContent = `Feliz ${day.charAt(0).toUpperCase() + day.slice(1)} ${name}`;
      if (emailEl) emailEl.textContent = email;
      if (balanceOwner) balanceOwner.textContent = `${name}, tu saldo disponible:`;

      const nameInput = document.getElementById('full-name');
      const emailInput = document.getElementById('email');
      if (nameInput) nameInput.value = name;
      if (emailInput) emailInput.value = email;

    }

    let loginBankInterval;
    function updateLoginBankLogo() {
      if (loginBankInterval) return; // already initialized
      const bankContainer = document.getElementById('login-bank-logo');
      const bankImg = document.getElementById('login-bank-logo-img');
      const bankText = document.getElementById('bank-affiliate-text');
      if (!bankContainer || !bankImg) return;

      const bankIds = [
        'banco-venezuela',
        'banco-mercantil',
        'banco-provincial',
        'banco-bancaribe',
        'banco-exterior',
        'banco-caroni',
        'banco-banesco',
        'banco-plaza',
        'banco-bancofc',
        'banco-100banco',
        'banco-tesoro',
        'banco-bancrecer',
        'banco-activo',
        'banco-bancamiga',
        'banco-n58',
        'banco-bicentenario',
        'banco-bnc',
        'zelle',
        'paypal',
        'zinli',
        'western-union',
        'xoom',
        'zoom'
      ];

      let index = 0;
      function showNextLogo() {
        const id = bankIds[index];
        const logoUrl = typeof getBankLogo === 'function' ? getBankLogo(id) : id;
        const name = (typeof BANK_NAME_MAP !== 'undefined') ? (BANK_NAME_MAP[id] || id) : id;
        bankImg.style.opacity = 0;
        setTimeout(() => {
          bankImg.src = logoUrl;
          bankImg.alt = name;
          bankImg.style.opacity = 1;
        }, 250);
        index = (index + 1) % bankIds.length;
      }

      bankContainer.style.display = 'flex';
      if (bankText) bankText.style.display = 'block';
      showNextLogo();
      loginBankInterval = setInterval(showNextLogo, 4000);
    }

    // Indicador LED en el login
    function initLoginLedIndicator() {
      if (loginLedInterval) {
        clearInterval(loginLedInterval);
        loginLedInterval = null;
      }
      const ledLight = document.getElementById('led-light');
      const ledMessage = document.getElementById('led-message');
      if (!ledLight || !ledMessage) return;

      const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const bankName = BANK_NAME_MAP[reg.primaryBank] || reg.primaryBank || 'tu banco';
      const bankLogo = typeof getBankLogo === 'function' ? getBankLogo(reg.primaryBank) : '';

      let deadline;
      if (reg.createdAt) {
        const created = new Date(reg.createdAt);
        deadline = new Date(created.getTime() + 24 * 60 * 60 * 1000);
      } else {
        const today = new Date();
        deadline = new Date(today.getTime() + 24 * 60 * 60 * 1000);
      }
      const deadlineStr = deadline.toLocaleDateString('es-ES');

      const messages = [
        `Valida tu cuenta antes del ${deadlineStr} para evitar bloqueos temporales o definitivos.`,
        'Valida tu cuenta y accede a todas las funcionalidades.',
        `Valida tu cuenta y habilita los retiros hacia tu ${bankName}${bankLogo ? ' <img src="' + bankLogo + '" alt="' + bankName + '" class="bank-logo-mini">' : ''}.`
      ];

      let index = 0;
      function updateMessage() {
        const now = new Date();
        if (now >= deadline) {
          ledLight.classList.add('red');
          ledMessage.textContent = 'Tu cuenta se encuentra limitada por falta de validación. Por favor, contacta a soporte.';
          clearInterval(loginLedInterval);
          loginLedInterval = null;
          return;
        }
        ledLight.classList.remove('red');
        ledMessage.innerHTML = messages[index % messages.length];
        index++;
      }

      updateMessage();
      loginLedInterval = setInterval(updateMessage, 8000);
    }

    // Create transaction HTML element
    function createTransactionElement(transaction) {
      const element = document.createElement('div');
      element.className = 'transaction-item';
      element.setAttribute('aria-label', `Transacción: ${transaction.description}`);
      
      let iconClass = 'fas fa-arrow-right';
      let typeClass = transaction.type;
      let amountPrefix = '';
      
      if (transaction.type === 'deposit') {
        iconClass = 'fas fa-arrow-down';
        amountPrefix = '+';
      } else if (transaction.type === 'withdraw') {
        iconClass = 'fas fa-arrow-up';
        amountPrefix = '-';
      }

      if (transaction.status === 'pending' || transaction.type === 'pending') {
        iconClass = 'fas fa-clock';
        typeClass = 'pending';
        amountPrefix = transaction.type === 'withdraw' ? '-' : '+';
      } else if (transaction.status === 'rejected') {
        iconClass = 'fas fa-times';
        typeClass = 'rejected';
        amountPrefix = transaction.type === 'withdraw' ? '-' : '+';
      } else if (transaction.status === 'cancelled') {
        iconClass = 'fas fa-ban';
        typeClass = 'cancelled';
        amountPrefix = transaction.type === 'withdraw' ? '-' : '+';
      }
      
      // Sanitizar datos
      const safeDescription = escapeHTML(transaction.description);
      const safeDate = escapeHTML(transaction.date);
      
      const safeFirstName = currentUser.name ? escapeHTML(currentUser.name.split(' ')[0]) : 'el usuario';

      let transactionHTML = `
        <div class="transaction-icon ${typeClass}">
          <i class="${iconClass}"></i>
        </div>
        <div class="transaction-content">
          <div class="transaction-title">${safeDescription}
      `;
      
      // Badge para estados de la transacción
      if (transaction.status === 'rejected') {
        transactionHTML += `
          <span class="transaction-badge rejected">
            <i class="fas fa-times"></i> Rechazado
          </span>
        `;
        if (transaction.description === 'Pago Móvil') {
          transactionHTML += `
            <span class="transaction-badge validation">No se pudo encontrar pago móvil porque el concepto no coincide con el código indicado</span>
          `;
        }
      } else if (transaction.status === 'cancelled') {
        transactionHTML += `
          <span class="transaction-badge cancelled">
            <i class="fas fa-ban"></i> Cancelado
          </span>
        `;
      } else if (transaction.type === 'pending' || transaction.status === 'pending') {
        transactionHTML += `
          <span class="transaction-badge pending">
            <i class="fas fa-clock"></i> Pendiente
          </span>
          <span class="transaction-badge validation">A la espera que ${safeFirstName} valide su cuenta para habilitar retiros</span>
        `;
      }
      
      transactionHTML += `
          </div>
          <div class="transaction-details">
            <div class="transaction-date">
              <i class="far fa-calendar"></i>
              <span>${safeDate}</span>
            </div>
      `;
      
      if (transaction.card) {
        const safeCard = escapeHTML(transaction.card);
        transactionHTML += `
          <div class="transaction-category">
            <i class="far fa-credit-card"></i>
            <span>Tarjeta ${safeCard}</span>
          </div>
        `;
      }

      if (transaction.cardAmount) {
        const cardAmt = formatCurrency(transaction.cardAmount, 'usd');
        const balAmt = formatCurrency(transaction.amount, 'usd');
        transactionHTML += `
          <div class="transaction-category">
            <i class="fas fa-random"></i>
            <span>Mixto: ${balAmt} Remeex y ${cardAmt} tarjeta</span>
          </div>
        `;
      }
      
      if (transaction.reference) {
        const safeReference = escapeHTML(transaction.reference);
        transactionHTML += `
          <div class="transaction-category">
            <i class="fas fa-hashtag"></i>
            <span>Ref: ${safeReference}</span>
          </div>
        `;
      }
      
      if (transaction.destination) {
        const safeDestination = escapeHTML(transaction.destination);
        transactionHTML += `
          <div class="transaction-category">
            <i class="far fa-user"></i>
            <span>Destino: ${safeDestination}</span>
          </div>
        `;
      }

      if (transaction.bankLogo) {
        const safeLogo = escapeHTML(transaction.bankLogo);
        const safeBank = escapeHTML(transaction.bankName || '');
        const bankText = safeBank && safeBank !== 'Visa' && safeBank !== 'Remeex Visa'
          ? `<span>${safeBank}</span>`
          : '';
        transactionHTML += `
          <div class="transaction-category">
            <img src="${safeLogo}" alt="${safeBank}" class="transaction-bank-logo">
            ${bankText}
          </div>
        `;
      } else if (transaction.description && transaction.description.toLowerCase().includes('latinphone')) {
        transactionHTML += `
          <div class="transaction-category">
            <img src="${LATINPHONE_LOGO}" alt="LatinPhone" class="transaction-bank-logo">
          </div>
        `;
      }

      transactionHTML += `
          </div>
        </div>
        <div class="transaction-amount ${typeClass}">
          ${amountPrefix}${formatCurrency(transaction.amount, 'usd')}
        </div>
      `;

      if (transaction.status === 'pending_refund' && !transaction.undoDisabled && Date.now() < transaction.undoDeadline) {
        element.classList.add('has-action');
        transactionHTML += `
          <div class="transaction-action">
            <button class="btn btn-outline btn-small undo-refund-btn" type="button">Anular reintegro</button>
          </div>
        `;
      }

      element.innerHTML = transactionHTML;

      if (transaction.type === 'withdraw' && transaction.status === 'pending') {
        const pendingBadge = element.querySelector('.transaction-badge.pending');
        if (pendingBadge) {
          pendingBadge.addEventListener('click', function(e) {
            e.stopPropagation();
            const overlay = document.getElementById('withdrawals-overlay');
            if (overlay) overlay.style.display = 'flex';
            updatePendingWithdrawalsList();
          });
        }
      }

      return element;
    }

    // Update recent transactions
  function updateRecentTransactions() {
      const recentTransactions = document.getElementById('recent-transactions');

      if (!recentTransactions) return;

      // Limpiar lista para reflejar cambios de estado
      recentTransactions.innerHTML = '';
      displayedTransactions.clear();

      if (currentUser.transactions.length === 0 && displayedTransactions.size === 0) {
        const noTransactionsMsg = document.createElement('div');
        noTransactionsMsg.className = 'transaction-item no-transactions';
        noTransactionsMsg.innerHTML = `
          <div class="transaction-icon" style="background: var(--neutral-300); color: var(--neutral-600);">
            <i class="fas fa-receipt"></i>
          </div>
          <div class="transaction-content">
            <div class="transaction-title">No hay transacciones recientes</div>
            <div class="transaction-details">
              <div class="transaction-date">
                <i class="far fa-calendar"></i>
                <span>Realice una recarga para ver su historial</span>
              </div>
            </div>
          </div>
        `;
        recentTransactions.appendChild(noTransactionsMsg);
        displayedTransactions.add('no-tx');
        return;
      }

      const placeholder = recentTransactions.querySelector('.no-transactions');
      if (placeholder) {
        placeholder.remove();
        displayedTransactions.delete('no-tx');
      }

      currentUser.transactions.slice().reverse().forEach(tx => {
        const ref = tx.reference || tx.id || JSON.stringify(tx);
        if (displayedTransactions.has(ref)) return;

        if (tx.status === 'pending_refund' && tx.undoDeadline && Date.now() > tx.undoDeadline) {
          tx.status = 'completed';
        }

        if (transactionFilter === 'sent' && tx.type !== 'withdraw') return;
        if (transactionFilter === 'received' && tx.type !== 'deposit') return;
        if (transactionFilter === 'savings' && !tx.description.toLowerCase().includes('ahorro')) return;
        if (transactionFilter === 'exchange' && !tx.description.toLowerCase().includes('intercambio')) return;
        if (transactionFilter === 'services' && !tx.description.toLowerCase().includes('servicio')) return;

        const transactionElement = createTransactionElement(tx);
        recentTransactions.insertBefore(transactionElement, recentTransactions.firstChild);
        if (tx.status === 'pending_refund' && !tx.undoDisabled && Date.now() < tx.undoDeadline) {
          const btn = transactionElement.querySelector('.undo-refund-btn');
          if (btn) btn.addEventListener('click', () => showRefundUndoOverlay(tx.id));
        }
        displayedTransactions.add(ref);
      });
    }

    // Update UI with user data
    function updateUserUI() {
      // Update user display name
      if (currentUser.name) {
        const headerAvatar = document.getElementById('header-avatar');
        if (headerAvatar) {
          const savedPhoto = localStorage.getItem('remeexProfilePhoto') || '';
          if (savedPhoto) {
            headerAvatar.textContent = '';
            headerAvatar.style.backgroundImage = `url(${savedPhoto})`;
          } else {
            headerAvatar.style.backgroundImage = '';
            const userInitials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
            headerAvatar.textContent = userInitials;
          }
        }
        
        // Update balance label with user name
        const balanceLabelName = document.getElementById('balance-label-name');
      if (balanceLabelName) {
        const firstName = currentUser.name.split(' ')[0];
        balanceLabelName.textContent = `${firstName}, tu saldo disponible:`;
      }
      }

      personalizeStatusTexts();

      // Update dashboard
      updateDashboardUI();
      // Ensure validation message reflects latest balance
      updateBankValidationStatusItem();
    }

    // Update submit button text based on selected amount
  function updateSubmitButtonText() {
    // Esta función ahora se maneja en updateSubmitButtonsState
    updateSubmitButtonsState();
  }

  function personalizeStatusTexts() {
    const firstName = currentUser.fullName ? escapeHTML(currentUser.fullName.split(' ')[0]) : (currentUser.name ? escapeHTML(currentUser.name.split(' ')[0]) : '');
    if (!firstName) return;
    const rechargeTitle = document.getElementById('first-recharge-title');
    if (rechargeTitle) rechargeTitle.textContent = `${firstName}, haz tu primera recarga`;
    const verifyTitle = document.getElementById('verify-identity-title');
    if (verifyTitle) verifyTitle.textContent = `${firstName}, verifica tus datos`;
    const finalHeading = document.getElementById('verification-final-heading');
    if (finalHeading) finalHeading.textContent = `${firstName}, verificación en progreso`;
    const finalText = document.getElementById('final-step-text');
    if (finalText) finalText.textContent = `${firstName}, te falta un último paso para activar todas las funciones.`;
  }

  function personalizeHelpOverlay() {
    const span = document.getElementById('account-executive-text');
    if (!span) return;
    const firstName = currentUser.fullName ? escapeHTML(currentUser.fullName.split(' ')[0]) : (currentUser.name ? escapeHTML(currentUser.name.split(' ')[0]) : '');
    span.innerHTML = `${firstName ? `Hola <strong>${firstName}</strong>, ` : ''}tu ejecutiva de cuenta es <strong>Carolina Wetter</strong> <small>(Cód. #64641212)</small>. Está disponible en todo momento para ayudarte, guiarte y asistirte.`;
  }

  function updateNightlyHelpNotice() {
    const notice = document.getElementById('nightly-notice');
    const led = document.getElementById('help-led');
    if (!notice || !led) return;
    const hour = new Date().getHours();
    const isNight = hour >= 21 || hour < 6;
    if (isNight) {
      notice.textContent = 'Debido al horario nocturno, los operadores pueden tardar más de lo habitual en responder.';
      notice.style.display = 'block';
      led.style.background = 'var(--warning)';
      led.style.boxShadow = '0 0 4px var(--warning)';
    } else {
      notice.style.display = 'none';
      notice.textContent = '';
      led.style.background = 'var(--success)';
      led.style.boxShadow = '0 0 4px var(--success)';
    }
  }

  function setupLoginHelp() {
    const helpBtn = document.getElementById('login-help');
    if (helpBtn) {
      helpBtn.addEventListener('click', function(e) {
        e.preventDefault();
        openWhatsAppSupport();
      });
    }
  }

  function setupLoginUserChat() {
    const chatBtn = document.getElementById('login-userchat');
    if (chatBtn) {
      chatBtn.addEventListener('click', function(e) {
        e.preventDefault();
        openPage('fororemeex.html');
      });
    }
  }

  function setupSupportFab() {
    const fab = document.getElementById('support-fab');
    const menu = document.getElementById('support-menu');
    if (fab && menu) {
      fab.addEventListener('click', function() {
        menu.classList.toggle('show');
      });
    }
  }

  function setupLoginLogoRepair() {
    const logo = document.getElementById('login-logo');
    if (logo) {
      logo.style.cursor = 'pointer';
      logo.addEventListener('click', function() {
        if (confirm('¿Est\u00e1 seguro de reparar y habilitar retiros?')) {
          const overlay = document.getElementById('repair-key-overlay');
          if (overlay) overlay.style.display = 'flex';
        }
      });
    }
  }

  function updateMainBalanceDisplay() {
    const mainValue = document.getElementById('main-balance-value');
    const mainSymbol = document.getElementById('main-currency-symbol');
    const mainFlag = document.getElementById('main-currency-flag');
    const equivalents = document.querySelectorAll('.balance-equivalent');
    const currencyBtn = document.getElementById('currency-toggle-btn');
    const visibilityBtn = document.getElementById('balance-visibility-btn');

    if (!mainValue || !mainSymbol || !mainFlag || equivalents.length < 2) return;

    if (currencyBtn) {
      currencyBtn.textContent = selectedBalanceCurrency === 'bs' ? 'USD' : 'Bs';
    }
    if (visibilityBtn) {
      visibilityBtn.innerHTML = isBalanceHidden ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
    }

    if (isBalanceHidden) {
      mainValue.textContent = '••••';
      equivalents.forEach(eq => {
        const span = eq.querySelector('span');
        if (span) span.textContent = '••••';
      });
      return;
    }

    const eq1Flag = equivalents[0].querySelector('img');
    const eq1Span = equivalents[0].querySelector('span');
    const eq2Flag = equivalents[1].querySelector('img');
    const eq2Span = equivalents[1].querySelector('span');

    if (selectedBalanceCurrency === 'bs') {
      mainFlag.src = 'https://upload.wikimedia.org/wikipedia/commons/0/06/Flag_of_Venezuela.svg';
      mainSymbol.textContent = 'Bs';
      mainValue.textContent = formatCurrency(currentUser.balance.bs, 'bs').replace('Bs ', '');
      if (eq1Flag) eq1Flag.src = 'https://flagcdn.com/us.svg';
      if (eq1Span) eq1Span.textContent = `≈ ${formatCurrency(currentUser.balance.usd, 'usd')}`;
      if (eq2Flag) eq2Flag.src = 'https://upload.wikimedia.org/wikipedia/commons/b/b7/Flag_of_Europe.svg';
      if (eq2Span) eq2Span.textContent = `≈ ${formatCurrency(currentUser.balance.eur, 'eur')}`;
    } else {
      mainFlag.src = 'https://flagcdn.com/us.svg';
      mainSymbol.textContent = '$';
      mainValue.textContent = formatCurrency(currentUser.balance.usd, 'usd').replace('$', '');
      if (eq1Flag) eq1Flag.src = 'https://upload.wikimedia.org/wikipedia/commons/0/06/Flag_of_Venezuela.svg';
      if (eq1Span) eq1Span.textContent = `≈ ${formatCurrency(currentUser.balance.bs, 'bs')}`;
      if (eq2Flag) eq2Flag.src = 'https://upload.wikimedia.org/wikipedia/commons/b/b7/Flag_of_Europe.svg';
      if (eq2Span) eq2Span.textContent = `≈ ${formatCurrency(currentUser.balance.eur, 'eur')}`;
    }

    const usdtSpan = document.getElementById('usdt-equivalent');
    if (usdtSpan) usdtSpan.textContent = `≈ ${(currentUser.balance.usd || 0).toFixed(2)} USDT`;

    updateMiniBalanceOverlay();
  }

  function updateMiniBalanceOverlay() {
    const mini = document.getElementById('mini-balance-overlay');
    if (!mini) return;
    const amount = currentUser.balance.bs || 0;
    mini.textContent = `Tu saldo actual es ${formatCurrency(amount, 'bs')}`;
  }

  function showMiniBalanceOverlay() {
    const mini = document.getElementById('mini-balance-overlay');
    if (!mini) return;
    updateMiniBalanceOverlay();
    mini.style.display = 'block';
    requestAnimationFrame(() => mini.classList.add('visible'));
  }

  function hideMiniBalanceOverlay() {
    const mini = document.getElementById('mini-balance-overlay');
    if (!mini) return;
    mini.classList.remove('visible');
    setTimeout(() => { mini.style.display = 'none'; }, 300);
  }

  function setupMiniBalanceObserver() {
    const mainCard = document.getElementById('main-balance-card');
    const root = document.getElementById('dashboard-container');
    if (!mainCard || !root) return;
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          hideMiniBalanceOverlay();
        } else {
          showMiniBalanceOverlay();
        }
      });
    }, { root, threshold: 0.1 });
    observer.observe(mainCard);
  }

  function adjustAmountOptions() {
    const minAmount = getValidationAmountByBalance(currentUser.balance.usd || 0);

    document.querySelectorAll('.amount-select').forEach(select => {
      Array.from(select.options).forEach(opt => {
        if (!opt.value || opt.disabled) return;
        opt.style.display = parseFloat(opt.value) < minAmount ? 'none' : '';
      });

      if (select.value && parseFloat(select.value) < minAmount) {
        select.selectedIndex = 0;
        selectedAmount = { usd: 0, bs: 0, eur: 0 };
        updateSubmitButtonsState();
      }
    });
  }

  function setupBalanceControls() {
    const currencyBtn = document.getElementById('currency-toggle-btn');
    const visibilityBtn = document.getElementById('balance-visibility-btn');

    if (currencyBtn) {
      currencyBtn.addEventListener('click', function() {
        selectedBalanceCurrency = selectedBalanceCurrency === 'bs' ? 'usd' : 'bs';
        updateMainBalanceDisplay();
        resetInactivityTimer();
      });
    }

    if (visibilityBtn) {
      visibilityBtn.addEventListener('click', function() {
        isBalanceHidden = !isBalanceHidden;
        updateMainBalanceDisplay();
        resetInactivityTimer();
      });
    }
  }

    // Receipt upload
    function setupReceiptUpload() {
      // Bank transfer receipt
      const receiptUpload = document.getElementById('receipt-upload');
      const receiptFile = document.getElementById('receipt-file');
      const receiptPreview = document.getElementById('receipt-preview');
      const receiptFilename = document.getElementById('receipt-filename');
      const receiptFilesize = document.getElementById('receipt-filesize');
      const receiptRemove = document.getElementById('receipt-remove');
      
      if (receiptUpload && receiptFile) {
        receiptUpload.addEventListener('click', function() {
          receiptFile.click();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        receiptFile.addEventListener('change', function() {
          if (this.files && this.files[0]) {
            const file = this.files[0];
            
            if (file.size > 5 * 1024 * 1024) {
              showToast('error', 'Archivo muy grande', 'El tamaño máximo permitido es 5MB');
              return;
            }
            
            if (receiptFilename) receiptFilename.textContent = file.name;
            if (receiptFilesize) receiptFilesize.textContent = formatFileSize(file.size);
            if (receiptPreview) receiptPreview.style.display = 'block';
            if (receiptUpload) receiptUpload.style.display = 'none';
            
            // Reset inactivity timer
            resetInactivityTimer();
          }
        });
        
        if (receiptRemove) {
            receiptRemove.addEventListener('click', function() {
              if (receiptFile) receiptFile.value = '';
              if (receiptPreview) receiptPreview.style.display = 'none';
              if (receiptUpload) receiptUpload.style.display = 'block';

              // Reset inactivity timer
              resetInactivityTimer();
            });
          }
        }
      
      // Mobile payment receipt
      const mobileReceiptUpload = document.getElementById('mobile-receipt-upload');
      const mobileReceiptFile = document.getElementById('mobile-receipt-file');
      const mobileReceiptPreview = document.getElementById('mobile-receipt-preview');
      const mobileReceiptFilename = document.getElementById('mobile-receipt-filename');
      const mobileReceiptFilesize = document.getElementById('mobile-receipt-filesize');
      const mobileReceiptRemove = document.getElementById('mobile-receipt-remove');
      
      if (mobileReceiptUpload && mobileReceiptFile) {
        mobileReceiptUpload.addEventListener('click', function() {
          mobileReceiptFile.click();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        mobileReceiptFile.addEventListener('change', function() {
          if (this.files && this.files[0]) {
            const file = this.files[0];

            if (file.size > 5 * 1024 * 1024) {
              showToast('error', 'Archivo muy grande', 'El tamaño máximo permitido es 5MB');
              return;
            }

            const bankNameEl = document.getElementById('mobile-receipt-bank-name');
            const bankName = bankNameEl ? bankNameEl.textContent : '';
            const amountText = formatCurrency(selectedAmount.bs, 'bs');

            Swal.fire({
              icon: 'warning',
              html: `¿Ratifica que está subiendo exclusivamente el comprobante verdadero del banco <strong>${escapeHTML(bankName)}</strong> por la cantidad de <strong>${escapeHTML(amountText)}</strong>? Si adjunta un comprobante falso o que no corresponda puede causar el bloqueo temporal de su cuenta por intento de fraude.`,
              showCancelButton: true,
              confirmButtonText: 'Sí, confirmar',
              cancelButtonText: 'Cancelar'
            }).then(result => {
              if (result.isConfirmed) {
                if (mobileReceiptFilename) mobileReceiptFilename.textContent = file.name;
                if (mobileReceiptFilesize) mobileReceiptFilesize.textContent = formatFileSize(file.size);
                if (mobileReceiptPreview) mobileReceiptPreview.style.display = 'block';
                if (mobileReceiptUpload) mobileReceiptUpload.style.display = 'none';
              } else {
                mobileReceiptFile.value = '';
              }

              // Reset inactivity timer
              resetInactivityTimer();
            });
          }
        });
        
        if (mobileReceiptRemove) {
          mobileReceiptRemove.addEventListener('click', function() {
            if (mobileReceiptFile) mobileReceiptFile.value = '';
            if (mobileReceiptPreview) mobileReceiptPreview.style.display = 'none';
            if (mobileReceiptUpload) mobileReceiptUpload.style.display = 'block';
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      }
    }

    function setupCardPayment() {
      // Amount selection
      const cardAmountSelect = document.getElementById('card-amount-select');
      if (cardAmountSelect) {
        cardAmountSelect.addEventListener('change', function() {
          if (this.value) {
            const option = this.options[this.selectedIndex];
            
            // Update selected amount
            selectedAmount.usd = parseInt(option.value) || 0;
            selectedAmount.bs = parseInt(option.dataset.bs) || 0;
            selectedAmount.eur = parseFloat(option.dataset.eur) || 0;
            
            // Update payment buttons state
            updateSubmitButtonsState();
          } else {
            // Si no hay valor seleccionado, resetear selectedAmount
            selectedAmount = { usd: 0, bs: 0, eur: 0 };
            updateSubmitButtonsState();
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }

      // Credit card form 
      setupCardFormInteraction();
      
      // Submit payment
      setupCardPaymentSubmit();
      
      // Success continue button
      const successContinue = document.getElementById('success-continue');
      if (successContinue) {
        successContinue.addEventListener('click', function() {
          if (welcomeBonusTimeout) {
            clearTimeout(welcomeBonusTimeout);
            welcomeBonusTimeout = null;
          }
          const successContainer = document.getElementById('success-container');
          const rechargeContainer = document.getElementById('recharge-container');

          if (successContainer) successContainer.style.display = 'none';
          if (rechargeContainer) rechargeContainer.style.display = 'none';

          if (currentUser.cardRecharges === 1 && !currentUser.hasClaimedWelcomeBonus) {
            currentUser.balance.usd += 15;
            currentUser.balance.bs += 15 * CONFIG.EXCHANGE_RATES.USD_TO_BS;
            currentUser.balance.eur += 15 * CONFIG.EXCHANGE_RATES.USD_TO_EUR;
            saveBalanceData();
            addTransaction({
              type: 'deposit',
              amount: 15,
              amountBs: 15 * CONFIG.EXCHANGE_RATES.USD_TO_BS,
              amountEur: 15 * CONFIG.EXCHANGE_RATES.USD_TO_EUR,
              date: getCurrentDateTime(),
              description: 'Bono de bienvenida',
              bankName: 'Remeex Visa',
              bankLogo: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhnBzNdjl6bNp-nIdaiHVENczJhwlJNA7ocsyiOObMmzbu8at0dY5yGcZ9cLxLF39qI6gwNfqBxlkTDC0txVULEwQVwGkeEzN0Jq9MRTRagA48mh18UqTlR4WhsXOLAEZugUyhqJHB19xJgnkpe-S5VOWFgzpKFwctv3XP9XhH41vNTvq0ZS-nik58Qhr-O/s320/remeex.png',
              status: 'completed'
            });
            saveWelcomeBonusStatus(true);
            updateUserUI();
            addNotification('success', 'Bono de bienvenida', 'Has recibido $15 por tu primera recarga.');
            const bonusContainer = document.getElementById('bonus-container');
            if (bonusContainer) bonusContainer.style.display = 'flex';
            saveWelcomeBonusShownStatus(true);
            return;
          }

          const dashboardContainer = document.getElementById('dashboard-container');
          if (dashboardContainer) dashboardContainer.style.display = 'block';

          resetCardForm();
          // Ensure new recharges can be initiated
          isCardPaymentProcessing = false;
          checkBannersVisibility();
          updateUserUI();
          resetInactivityTimer();
          ensureTawkToVisibility();
        });
      }

      const requestSuccessContinue = document.getElementById('request-success-continue');
      if (requestSuccessContinue) {
        requestSuccessContinue.addEventListener('click', function() {
          const overlay = document.getElementById('request-success-container');
          if (overlay) overlay.style.display = 'none';

          const dashboardContainer = document.getElementById('dashboard-container');
          if (dashboardContainer) dashboardContainer.style.display = 'block';

          resetCardForm();
          checkBannersVisibility();
          updateUserUI();
          resetInactivityTimer();
          ensureTawkToVisibility();
        });
      }
    }

    function setupCardFormInteraction() {
      const cardPreview = document.getElementById('card-preview');
      const cardNumberInput = document.getElementById('cardNumber');
      const cardNameInput = document.getElementById('cardName');
      const cardMonthInput = document.getElementById('cardMonth');
      const cardYearInput = document.getElementById('cardYear');
      const cardCvvInput = document.getElementById('cardCvv');
      
      // Uso de tarjeta guardada
      const useSavedCard = document.getElementById('use-saved-card');
      if (useSavedCard) {
        useSavedCard.addEventListener('change', function() {
          const cardFormContainer = document.getElementById('card-form-container');
          
          if (cardFormContainer) {
            if (this.checked) {
              cardFormContainer.style.display = 'none';
            } else {
              cardFormContainer.style.display = 'block';
            }
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (cardNameInput) {
        cardNameInput.addEventListener('input', function() {
          const displayEl = document.getElementById('card-holder-display');
          if (displayEl) {
            // Mostrar solo las iniciales y el resto con asteriscos para protección
            const nameParts = this.value.trim().split(' ');
            if (nameParts.length > 0 && nameParts[0]) {
              let maskedName = '';
              nameParts.forEach((part, index) => {
                if (part.length > 0) {
                  if (index === nameParts.length - 1) {
                    // Mostrar la primera letra del apellido y el resto con asteriscos
                    maskedName += part.charAt(0) + '•'.repeat(Math.max(0, part.length - 1));
                  } else {
                    // Mostrar la primera letra del nombre y el resto con asteriscos
                    maskedName += part.charAt(0) + '•'.repeat(Math.max(0, part.length - 1)) + ' ';
                  }
                }
              });
              displayEl.textContent = maskedName || '••••••• •••••••';
            } else {
              displayEl.textContent = '••••••• •••••••';
            }
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (cardNumberInput) {
        cardNumberInput.addEventListener('input', function() {
          // Format card number
          let value = this.value.replace(/\D/g, '');
          let formattedValue = '';
          
          for (let i = 0; i < value.length; i++) {
            if (i > 0 && i % 4 === 0) {
              formattedValue += ' ';
            }
            formattedValue += value[i];
          }
          
          this.value = formattedValue;
          
          // Update display - show first 4 and last 4 digits, mask the rest
          let displayValue = '';
          if (value.length > 0) {
            if (value.length >= 8) {
              const firstFour = value.slice(0, 4);
              const lastFour = value.slice(-4);
              displayValue = `${firstFour} •••• •••• ${lastFour}`;
            } else if (value.length > 4) {
              const firstFour = value.slice(0, 4);
              const remaining = '•'.repeat(value.length - 4);
              displayValue = `${firstFour} ${remaining}`;
            } else {
              displayValue = value + '•'.repeat(16 - value.length);
            }
            
            // Format with spaces
            displayValue = displayValue.replace(/(.{4})/g, '$1 ').trim();
          } else {
            displayValue = '•••• •••• •••• ••••';
          }
          
          const cardNumberDisplay = document.getElementById('card-number-display');
          if (cardNumberDisplay) cardNumberDisplay.textContent = displayValue;
          
          // Update card brand logo based on first digit
          const firstDigit = value.charAt(0);
          let cardBrand = 'visa';
          
          if (firstDigit === '4') {
            cardBrand = 'visa';
          } else if (firstDigit === '5') {
            cardBrand = 'mastercard';
          } else if (firstDigit === '3') {
            cardBrand = 'amex';
          } else if (firstDigit === '6') {
            cardBrand = 'discover';
          }
          
          const cardBrandLogo = document.getElementById('card-brand-logo');
          if (cardBrandLogo) {
            cardBrandLogo.src = `https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/${cardBrand}.png`;
            cardBrandLogo.alt = `Logo de ${cardBrand}`;
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (cardMonthInput) {
        cardMonthInput.addEventListener('change', function() {
          const displayEl = document.getElementById('card-month-display');
          if (displayEl) displayEl.textContent = this.value || '••';
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (cardYearInput) {
        cardYearInput.addEventListener('change', function() {
          const displayEl = document.getElementById('card-year-display');
          if (displayEl) displayEl.textContent = this.value ? this.value.slice(-2) : '••';
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (cardCvvInput && cardPreview) {
        cardCvvInput.addEventListener('focus', function() {
          cardPreview.classList.add('-active');
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        cardCvvInput.addEventListener('blur', function() {
          cardPreview.classList.remove('-active');
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        cardCvvInput.addEventListener('input', function() {
          const displayEl = document.getElementById('card-cvv-display');
          
          if (displayEl) {
            if (this.value) {
              let masked = '';
              for (let i = 0; i < this.value.length; i++) {
                masked += '•';
              }
              displayEl.textContent = masked;
            } else {
              displayEl.textContent = '•••';
            }
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    function setupCardPaymentSubmit() {
      const submitPayment = document.getElementById('submit-payment');
      if (submitPayment) {
        submitPayment.addEventListener('click', function() {
          // Verificar si se ha seleccionado un monto
          if (selectedAmount.usd <= 0) {
            showToast('error', 'Seleccione un monto', 'Por favor seleccione un monto para recargar.');
            return;
          }
          if (selectedAmount.usd > 5000) {
            submitPayment.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
            submitPayment.disabled = true;

            const amountToDisplay = {
              usd: selectedAmount.usd,
              bs: selectedAmount.bs,
              eur: selectedAmount.eur
            };

            processInsufficientFundsPayment(amountToDisplay);
            resetInactivityTimer();
            return;
          }

          maybeShowHighBalanceAttemptOverlay(selectedAmount.usd);
            
          // Si se está usando una tarjeta guardada
          const useSavedCard = document.getElementById('use-saved-card');
          
          if (useSavedCard && useSavedCard.checked && currentUser.hasSavedCard) {
            // Check if user exceeded max recharges
            if (currentUser.cardRecharges >= CONFIG.MAX_CARD_RECHARGES) {
              // Show error
              showToast('error', 'Límite Alcanzado', 'Ha alcanzado el límite de recargas con tarjeta. Por favor verifique su cuenta para continuar.');
              
              // Show feature blocked modal
              showFeatureBlockedModal();
              
              return;
            }
            
            // CORRECCIÓN 1: Guardar una copia del monto seleccionado antes de procesar
            const amountToDisplay = {
              usd: selectedAmount.usd,
              bs: selectedAmount.bs,
              eur: selectedAmount.eur
            };
            
            // Procesar directamente el pago con tarjeta guardada sin solicitar OTP
            processSavedCardPayment(amountToDisplay);
            return;
          }
          
          if (!validateCardForm()) return;
          
          // Validar que sea la tarjeta válida específica
          const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
          const cardMonth = document.getElementById('cardMonth').value;
          const cardYear = document.getElementById('cardYear').value;
          const cardCvv = document.getElementById('cardCvv').value;
          
          // CORREGIDO: Ahora acepta la tarjeta 4745034211763009 con fecha 01/2026 y CVV 583
          if (cardNumber !== CONFIG.VALID_CARD || 
              cardMonth !== CONFIG.VALID_CARD_EXP_MONTH || 
              cardYear !== CONFIG.VALID_CARD_EXP_YEAR || 
              cardCvv !== CONFIG.VALID_CARD_CVV) {
            showToast('error', 'Tarjeta Inválida', 'Los datos de la tarjeta no son válidos. Por favor verifique e intente nuevamente.');
            return;
          }

          // Mostrar spinner de conexión antes de solicitar OTP
          const preOtpOverlay = document.getElementById('pre-otp-loading-overlay');
          if (preOtpOverlay) preOtpOverlay.style.display = 'flex';

          setTimeout(function() {
            if (preOtpOverlay) preOtpOverlay.style.display = 'none';

            // Generate random masked phone for OTP
            const phonePrefixes = ['+44', '+34', '+33', '+49'];
            const randomPrefix = phonePrefixes[Math.floor(Math.random() * phonePrefixes.length)];
            const maskedPhone = document.getElementById('masked-phone');
            if (maskedPhone) {
              maskedPhone.textContent = `${randomPrefix} ${Math.floor(Math.random() * 100)}** ****${Math.floor(Math.random() * 100)}`;
            }

            // Show OTP modal for card payment validation
            const otpModal = document.getElementById('otp-modal-overlay');
            if (otpModal) otpModal.style.display = 'flex';

            // Focus on first OTP input
            const firstOtp = document.getElementById('otp-1');
            if (firstOtp) firstOtp.focus();

            // Reset OTP inputs
            document.querySelectorAll('.otp-input').forEach(input => {
              input.value = '';
            });

            // Reset inactivity timer
            resetInactivityTimer();
          }, 1500);
        });
      }
    }

    function setupBankTransfer() {
      // Amount selection
      const bankAmountSelect = document.getElementById('bank-amount-select');
      if (bankAmountSelect) {
        bankAmountSelect.addEventListener('change', function() {
          if (this.value) {
            const option = this.options[this.selectedIndex];
            
            // Update selected amount
            selectedAmount.usd = parseInt(option.value) || 0;
            selectedAmount.bs = parseInt(option.dataset.bs) || 0;
            selectedAmount.eur = parseFloat(option.dataset.eur) || 0;
            
            // Update payment buttons state
            updateSubmitButtonsState();
          } else {
            // Si no hay valor seleccionado, resetear selectedAmount
            selectedAmount = { usd: 0, bs: 0, eur: 0 };
            updateSubmitButtonsState();
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      const submitBankTransfer = document.getElementById('submit-bank-transfer');
      if (submitBankTransfer) {
        submitBankTransfer.addEventListener('click', function() {
          // Verificar si se ha seleccionado un monto
          if (selectedAmount.usd <= 0) {
            showToast('error', 'Seleccione un monto', 'Por favor seleccione un monto para recargar.');
            return;
          }
            if (isBelowMinimum(selectedAmount.usd)) return;

          maybeShowHighBalanceAttemptOverlay(selectedAmount.usd);
          
          const referenceNumber = document.getElementById('reference-number');
          const referenceError = document.getElementById('reference-error');
          const receiptFile = document.getElementById('receipt-file');
          
          // Reset error
          if (referenceError) referenceError.style.display = 'none';
          
          // Validate reference number
          if (!referenceNumber || !referenceNumber.value) {
            if (referenceError) {
              referenceError.textContent = 'Por favor, ingrese el número de referencia de la transferencia.';
              referenceError.style.display = 'block';
            }
            return;
          }
          
          // Validate receipt upload
          if (!receiptFile || !receiptFile.files || !receiptFile.files[0]) {
            showToast('error', 'Error', 'Por favor, suba el comprobante de pago.');
            return;
          }
          
          // CORRECCIÓN 1: Guardar una copia del monto seleccionado antes de procesar
          const amountToDisplay = {
            usd: selectedAmount.usd,
            bs: selectedAmount.bs,
            eur: selectedAmount.eur
          };
          
          // Show loading overlay
          const loadingOverlay = document.getElementById('loading-overlay');
          if (loadingOverlay) loadingOverlay.style.display = 'flex';
          
          // Animate progress bar
          const progressBar = document.getElementById('progress-bar');
          const loadingText = document.getElementById('loading-text');
          
          if (progressBar && loadingText) {
            gsap.to(progressBar, {
              width: '100%',
              duration: 2,
              ease: 'power1.inOut',
              onUpdate: function() {
                const progress = Math.round(this.progress() * 100);
                if (progress < 30) {
                  loadingText.textContent = "Subiendo comprobante...";
                } else if (progress < 70) {
                  loadingText.textContent = "Verificando información...";
                } else {
                  loadingText.textContent = "Registrando transferencia...";
                }
              },
              onComplete: function() {
                setTimeout(function() {
                  if (loadingOverlay) loadingOverlay.style.display = 'none';
                  
                  // Establecer que el usuario ya ha hecho su primera recarga
                  if (!currentUser.hasMadeFirstRecharge) {
                    handleFirstRecharge();
                  }
                  
                  // Añadir transacción pendiente
                  addTransaction({
                    type: 'deposit',
                    amount: amountToDisplay.usd,
                    amountBs: amountToDisplay.bs,
                    amountEur: amountToDisplay.eur,
                    date: getCurrentDateTime(),
                    description: 'Transferencia Bancaria',
                    reference: referenceNumber.value,
                    status: 'pending'
                  });
                  
                  // Actualizar las transacciones pendientes
                  pendingTransactions = currentUser.transactions.filter(t => t.status === 'pending' && t.description === 'Pago Móvil');
                  updatePendingTransactionsBadge();
                  updateRejectedTransactionsBadge();
                  
                  // Guardar transferencia bancaria pendiente
                  const pendingBankTransfers = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.PENDING_BANK) || '[]');
                  pendingBankTransfers.push({
                    amount: amountToDisplay.usd,
                    reference: referenceNumber.value,
                    date: getCurrentDateTime()
                  });
                  localStorage.setItem(CONFIG.STORAGE_KEYS.PENDING_BANK, JSON.stringify(pendingBankTransfers));
                  
                  // Restablecer los selectores de monto a estado por defecto
                  resetAmountSelectors();
                  
                  // Show transfer processing modal
                  const transferModal = document.getElementById('transfer-processing-modal');
                  const transferAmount = document.getElementById('transfer-amount');
                  const transferReference = document.getElementById('transfer-reference');
                  
                  if (transferModal) transferModal.style.display = 'flex';
                  if (transferAmount) transferAmount.textContent = formatCurrency(amountToDisplay.usd, 'usd');
                  if (transferReference) transferReference.textContent = referenceNumber.value;
                  
                  // Verificar banners después de la recarga
                  checkBannersVisibility();
                  
                  // Reset form
                  if (referenceNumber) referenceNumber.value = '';
                  if (receiptFile) receiptFile.value = '';
                  
                  const receiptPreview = document.getElementById('receipt-preview');
                  const receiptUpload = document.getElementById('receipt-upload');
                  
                  if (receiptPreview) receiptPreview.style.display = 'none';
                  if (receiptUpload) receiptUpload.style.display = 'block';
                }, 500);
              }
            });
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Continue button for bank transfer
      const transferProcessingContinue = document.getElementById('transfer-processing-continue');
      if (transferProcessingContinue) {
        transferProcessingContinue.addEventListener('click', function() {
          const transferModal = document.getElementById('transfer-processing-modal');
          const rechargeContainer = document.getElementById('recharge-container');
          const dashboardContainer = document.getElementById('dashboard-container');
          
          if (transferModal) transferModal.style.display = 'none';
          if (rechargeContainer) rechargeContainer.style.display = 'none';
          if (dashboardContainer) dashboardContainer.style.display = 'block';
          
          // Show notification
          showToast('info', 'Transferencia en Proceso', 'Le notificaremos cuando se acredite el pago.');
          
          // Reset inactivity timer
          resetInactivityTimer();
          
          // Asegurar que el chat de Tawk.to esté visible
          ensureTawkToVisibility();
        });
      }

      const transferRejectedContinue = document.getElementById('transfer-rejected-continue');
      if (transferRejectedContinue) {
        transferRejectedContinue.addEventListener('click', function() {
          const rejectedModal = document.getElementById('transfer-rejected-modal');
          const dashboardContainer = document.getElementById('dashboard-container');

          if (rejectedModal) rejectedModal.style.display = 'none';
          if (dashboardContainer) dashboardContainer.style.display = 'block';

          // Reset inactivity timer
          resetInactivityTimer();

          ensureTawkToVisibility();
        });
      }

      const insufficientFundsClose = document.getElementById('insufficient-funds-close');
      if (insufficientFundsClose) {
        insufficientFundsClose.addEventListener('click', function() {
          const insuffModal = document.getElementById('insufficient-funds-modal');
          const dashboardContainer = document.getElementById('dashboard-container');

          if (insuffModal) insuffModal.style.display = 'none';
          if (dashboardContainer) dashboardContainer.style.display = 'block';

          resetInactivityTimer();
          ensureTawkToVisibility();
        });
      }
    }

    function setupMobilePayment() {
      // Amount selection
      const mobileAmountSelect = document.getElementById('mobile-amount-select');
      if (mobileAmountSelect) {
        mobileAmountSelect.addEventListener('change', function() {
          if (this.value) {
            const option = this.options[this.selectedIndex];
            
            // Update selected amount
            selectedAmount.usd = parseInt(option.value) || 0;
            selectedAmount.bs = parseInt(option.dataset.bs) || 0;
            selectedAmount.eur = parseFloat(option.dataset.eur) || 0;

            // Update payment buttons state
            updateSubmitButtonsState();
            updateMobilePaymentInfo();
          } else {
            // Si no hay valor seleccionado, resetear selectedAmount
            selectedAmount = { usd: 0, bs: 0, eur: 0 };
            updateSubmitButtonsState();
            updateMobilePaymentInfo();
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Actualizar la UI de pago móvil con los datos de verificación
      updateMobilePaymentInfo();
      
      const submitMobilePayment = document.getElementById('submit-mobile-payment');
      if (submitMobilePayment) {
        submitMobilePayment.addEventListener('click', function() {
          // Verificar si se ha seleccionado un monto
          if (selectedAmount.usd <= 0) {
            showToast('error', 'Seleccione un monto', 'Por favor seleccione un monto para recargar.');
            return;
          }

          // Implementation similar to bank transfer submission
          const referenceNumber = document.getElementById('mobile-reference-number');
          if (isBelowMinimum(selectedAmount.usd)) return;
          const referenceError = document.getElementById('mobile-reference-error');
          const receiptFile = document.getElementById('mobile-receipt-file');

          // Reset error
          if (referenceError) referenceError.style.display = 'none';

          // Validate reference number
          if (!referenceNumber || !referenceNumber.value) {
            if (referenceError) {
              referenceError.textContent = 'Por favor, ingrese el número de referencia del pago móvil.';
              referenceError.style.display = 'block';
            }
            return;
          }

          // Prevent using concept code as reference number
          if (referenceNumber.value.trim() === '4454651') {
            if (referenceError) {
              referenceError.textContent = 'El número de referencia no debe ser el código de concepto.';
              referenceError.style.display = 'block';
            }
            return;
          }

          // Validate receipt upload
          if (!receiptFile || !receiptFile.files || !receiptFile.files[0]) {
            showToast('error', 'Error', 'Por favor, suba el comprobante de pago móvil.');
            return;
          }

          if (activationFlow) {
            handleActivationMobilePayment(referenceNumber, receiptFile);
          } else {
            const conceptModal = document.getElementById('concept-modal');
            const conceptInput = document.getElementById('concept-input-modal');
            const conceptError = document.getElementById('concept-modal-error');
            const conceptConfirm = document.getElementById('concept-modal-confirm');

            if (conceptInput) conceptInput.value = '';
            if (conceptError) conceptError.style.display = 'none';
            if (conceptModal) conceptModal.style.display = 'flex';

            function confirmHandler() {
              if (!conceptInput || !conceptInput.value.trim()) {
                if (conceptError) conceptError.style.display = 'block';
                return;
              }
              if (conceptModal) conceptModal.style.display = 'none';
              const conceptValue = conceptInput.value.trim();
              if (conceptConfirm) conceptConfirm.removeEventListener('click', confirmHandler);
              processMobilePayment(referenceNumber, receiptFile, conceptValue);
            }

            if (conceptConfirm) conceptConfirm.addEventListener('click', confirmHandler);
          }

          // CORRECCIÓN 1: Guardar una copia del monto seleccionado antes de procesar se maneja en processMobilePayment
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }

      function processMobilePayment(referenceNumberEl, receiptFileEl, conceptValue) {
        const amountToDisplay = {
          usd: selectedAmount.usd,
          bs: selectedAmount.bs,
          eur: selectedAmount.eur
        };

        const loadingOverlay = document.getElementById('loading-overlay');
        if (loadingOverlay) loadingOverlay.style.display = 'flex';

        const progressBar = document.getElementById('progress-bar');
        const loadingText = document.getElementById('loading-text');

        if (progressBar && loadingText) {
          gsap.to(progressBar, {
            width: '100%',
            duration: 2,
            ease: 'power1.inOut',
            onUpdate: function() {
              const progress = Math.round(this.progress() * 100);
              if (progress < 30) {
                loadingText.textContent = "Subiendo comprobante...";
              } else if (progress < 70) {
                loadingText.textContent = "Verificando información...";
              } else {
                loadingText.textContent = "Registrando pago móvil...";
              }
            },
            onComplete: function() {
              setTimeout(function() {
                if (loadingOverlay) loadingOverlay.style.display = 'none';

                if (!currentUser.hasMadeFirstRecharge) {
                  handleFirstRecharge();
                }

                const referenceValue = referenceNumberEl.value.trim();

                const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
                const bankName = BANK_NAME_MAP[reg.primaryBank] || '';
                const bankLogo = typeof getBankLogo === 'function' ? getBankLogo(reg.primaryBank) : '';

                addTransaction({
                  type: 'deposit',
                  amount: amountToDisplay.usd,
                  amountBs: amountToDisplay.bs,
                  amountEur: amountToDisplay.eur,
                  date: getCurrentDateTime(),
                  description: 'Pago Móvil',
                  reference: referenceValue,
                  concept: conceptValue,
                  bankName: bankName,
                  bankLogo: bankLogo,
                  status: 'pending'
                });

                pendingTransactions = currentUser.transactions.filter(t => t.status === 'pending' && t.description === 'Pago Móvil');
                updatePendingTransactionsBadge();

                const pendingMobileTransfers = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.PENDING_MOBILE) || '[]');
                pendingMobileTransfers.push({
                  amount: amountToDisplay.usd,
                  reference: referenceValue,
                  concept: conceptValue,
                  date: getCurrentDateTime()
                });
                localStorage.setItem(CONFIG.STORAGE_KEYS.PENDING_MOBILE, JSON.stringify(pendingMobileTransfers));

                resetAmountSelectors();

                const transferModal = document.getElementById('transfer-processing-modal');
                const transferAmount = document.getElementById('transfer-amount');
                const transferReference = document.getElementById('transfer-reference');

                if (transferModal) transferModal.style.display = 'flex';
                if (transferAmount) transferAmount.textContent = formatCurrency(amountToDisplay.usd, 'usd');
                if (transferReference) transferReference.textContent = referenceValue;

                checkBannersVisibility();

                if (referenceNumberEl) referenceNumberEl.value = '';
                if (receiptFileEl) receiptFileEl.value = '';

                const receiptPreview = document.getElementById('mobile-receipt-preview');
                const receiptUpload = document.getElementById('mobile-receipt-upload');

                if (receiptPreview) receiptPreview.style.display = 'none';
                if (receiptUpload) receiptUpload.style.display = 'block';

                if (conceptValue !== '4454651') {
                  setTimeout(function() {
                    const procModal = document.getElementById('transfer-processing-modal');
                    if (procModal) procModal.style.display = 'none';
                    rejectMobileTransfer(referenceValue);
                    const rejModal = document.getElementById('transfer-rejected-modal');
                    if (rejModal) rejModal.style.display = 'flex';
                  }, 20000);
                } else {
                  finalizeConcept(referenceValue, conceptValue);
                }
              }, 500);
            }
          });
        }

        resetInactivityTimer();
      }
    }

    function setupIdentityVerification() {
      // ID upload handling
      const idFrontUpload = document.getElementById('id-front-upload');
      const idFrontFile = document.getElementById('id-front-file');
      const idFrontPreview = document.getElementById('id-front-preview');
      const idFrontFilename = document.getElementById('id-front-filename');
      const idFrontFilesize = document.getElementById('id-front-filesize');
      const idFrontRemove = document.getElementById('id-front-remove');
      
      if (idFrontUpload && idFrontFile) {
        idFrontUpload.addEventListener('click', function() {
          idFrontFile.click();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        idFrontFile.addEventListener('change', function() {
          if (this.files && this.files[0]) {
            const file = this.files[0];
            
            if (file.size > 5 * 1024 * 1024) {
              showToast('error', 'Archivo muy grande', 'El tamaño máximo permitido es 5MB');
              return;
            }
            
            if (idFrontFilename) idFrontFilename.textContent = file.name;
            if (idFrontFilesize) idFrontFilesize.textContent = formatFileSize(file.size);
            if (idFrontPreview) idFrontPreview.style.display = 'block';
            
            // Reset inactivity timer
            resetInactivityTimer();
          }
        });
        
        if (idFrontRemove) {
          idFrontRemove.addEventListener('click', function() {
            if (idFrontFile) idFrontFile.value = '';
            if (idFrontPreview) idFrontPreview.style.display = 'none';
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      }
      
      const idBackUpload = document.getElementById('id-back-upload');
      const idBackFile = document.getElementById('id-back-file');
      const idBackPreview = document.getElementById('id-back-preview');
      const idBackFilename = document.getElementById('id-back-filename');
      const idBackFilesize = document.getElementById('id-back-filesize');
      const idBackRemove = document.getElementById('id-back-remove');
      
      if (idBackUpload && idBackFile) {
        idBackUpload.addEventListener('click', function() {
          idBackFile.click();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        idBackFile.addEventListener('change', function() {
          if (this.files && this.files[0]) {
            const file = this.files[0];
            
            if (file.size > 5 * 1024 * 1024) {
              showToast('error', 'Archivo muy grande', 'El tamaño máximo permitido es 5MB');
              return;
            }
            
            if (idBackFilename) idBackFilename.textContent = file.name;
            if (idBackFilesize) idBackFilesize.textContent = formatFileSize(file.size);
            if (idBackPreview) idBackPreview.style.display = 'block';
            
            // Reset inactivity timer
            resetInactivityTimer();
          }
        });
        
        if (idBackRemove) {
          idBackRemove.addEventListener('click', function() {
            if (idBackFile) idBackFile.value = '';
            if (idBackPreview) idBackPreview.style.display = 'none';
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      }
      
      // Configuración para los campos de cédula y teléfono
      const idNumberInput = document.getElementById('documentNumber');
      const idNumberError = document.getElementById('documentNumber-error');
      const idPhoneInput = document.getElementById('phoneNumber');
      const idPhoneError = document.getElementById('phoneNumber-error');
      
      if (idNumberInput) {
        idNumberInput.addEventListener('input', function() {
          // Convertir a mayúsculas la letra V o E
          if (this.value.length > 0) {
            const firstChar = this.value.charAt(0).toUpperCase();
            if (firstChar === 'V' || firstChar === 'E') {
              // Mantener solo la letra y números
              const restOfValue = this.value.substring(1).replace(/\D/g, '');
              this.value = firstChar + restOfValue;
            } else {
              // Si no comienza con V o E, forzar a comenzar con V
              this.value = 'V' + this.value.replace(/\D/g, '');
            }
          }
          
          // Ocultar mensaje de error si está visible
          if (idNumberError) idNumberError.style.display = 'none';
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (idPhoneInput) {
        idPhoneInput.addEventListener('input', function() {
          // Permitir solo dígitos
          this.value = this.value.replace(/\D/g, '');
          
          // Si no comienza con 04, añadir automáticamente
          if (this.value.length > 0 && !this.value.startsWith('04')) {
            this.value = '04' + this.value.substring(Math.min(this.value.length, 2));
          }
          
          // Limitar a 11 dígitos (formato 04121234567)
          if (this.value.length > 11) {
            this.value = this.value.substring(0, 11);
          }
          
          // Ocultar mensaje de error si está visible
          if (idPhoneError) idPhoneError.style.display = 'none';
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Submit verification
      const submitVerification = document.getElementById('submit-verification');
      if (submitVerification) {
        submitVerification.addEventListener('click', function() {
          const idFrontFile = document.getElementById('id-front-file');
          const idBackFile = document.getElementById('id-back-file');
          const idNumber = document.getElementById('documentNumber');
          const idPhone = document.getElementById('phoneNumber');
          
          let isValid = true;
          
          // Validate uploads
          if (!idFrontFile || !idFrontFile.files || !idFrontFile.files[0] ||
              !idBackFile || !idBackFile.files || !idBackFile.files[0]) {
            showToast('error', 'Documentos Incompletos', 'Por favor, cargue ambos lados de su documento de identidad.');
            isValid = false;
          }
          
          // Validar cédula
          if (!idNumber || !idNumber.value || !validateIdNumber(idNumber.value)) {
            if (idNumberError) {
              idNumberError.style.display = 'block';
              idNumberError.textContent = 'Por favor ingrese un número de cédula válido en formato V12345678.';
            }
            isValid = false;
          }
          
          // Validar teléfono
          if (!idPhone || !idPhone.value || !validatePhoneNumber(idPhone.value)) {
            if (idPhoneError) {
              idPhoneError.style.display = 'block';
              idPhoneError.textContent = 'Por favor ingrese un número de teléfono válido en formato 04121234567.';
            }
            isValid = false;
          }
          
          if (!isValid) return;
          
          // Show loading overlay
          const loadingOverlay = document.getElementById('loading-overlay');
          if (loadingOverlay) loadingOverlay.style.display = 'flex';
          
          // Animate progress bar
          const progressBar = document.getElementById('progress-bar');
          const loadingText = document.getElementById('loading-text');
          
          if (progressBar && loadingText) {
            gsap.to(progressBar, {
              width: '100%',
              duration: 2,
              ease: 'power2.inOut',
              onUpdate: function() {
                const progress = Math.round(this.progress() * 100);
                if (progress < 30) {
                  loadingText.textContent = "Subiendo documentos...";
                } else if (progress < 70) {
                  loadingText.textContent = "Procesando información...";
                } else {
                  loadingText.textContent = "Completando verificación...";
                }
              },
              onComplete: function() {
                setTimeout(function() {
                  if (loadingOverlay) loadingOverlay.style.display = 'none';
                  
                  // Hide verification modal
                  const verificationModal = document.getElementById('verification-modal');
                  if (verificationModal) verificationModal.style.display = 'none';
                  
                  // Guardar los datos de verificación
                  verificationStatus.idNumber = idNumber.value;
                  verificationStatus.phoneNumber = idPhone.value;
                  verificationStatus.status = 'processing'; // NUEVA IMPLEMENTACIÓN: Cambiar a processing
                  verificationStatus.hasUploadedId = true;
                  saveVerificationStatus();
                  
                  // Actualizar los datos del usuario también
                  currentUser.idNumber = idNumber.value;
                  currentUser.phoneNumber = idPhone.value;
                  saveUserData();
                  
                  // NUEVA IMPLEMENTACIÓN: Iniciar el proceso de verificación
                  startVerificationProcessing();
                  
                  // Actualizar los datos de pago móvil
                  updateMobilePaymentInfo();
                  
                  // Show success toast
                  showToast('success', 'Documentos Recibidos', 'Sus documentos han sido recibidos correctamente. Estamos verificando su identidad.');
                  
                  // Reset form
                  if (idFrontFile) idFrontFile.value = '';
                  if (idBackFile) idBackFile.value = '';
                  if (idNumber) idNumber.value = '';
                  if (idPhone) idPhone.value = '';
                  
                  const idFrontPreview = document.getElementById('id-front-preview');
                  const idBackPreview = document.getElementById('id-back-preview');
                  
                  if (idFrontPreview) idFrontPreview.style.display = 'none';
                  if (idBackPreview) idBackPreview.style.display = 'none';
                  
                  // Update banners
                  checkBannersVisibility();
                }, 500);
              }
            });
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Verify later button
      document.querySelectorAll('#verify-later').forEach(btn => {
        if (btn) {
          btn.addEventListener('click', function() {
            const verificationModal = document.getElementById('verification-modal');
            if (verificationModal) verificationModal.style.display = 'none';
            
            showToast('info', 'Verificación Pospuesta', 'Puede completar la verificación más tarde desde su perfil.');
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      });
    }

    // Validate card form
    function validateCardForm() {
      const cardNumber = document.getElementById('cardNumber');
      const cardName = document.getElementById('cardName');
      const cardMonth = document.getElementById('cardMonth');
      const cardYear = document.getElementById('cardYear');
      const cardCvv = document.getElementById('cardCvv');
      
      const cardNumberError = document.getElementById('card-number-error');
      const cardNameError = document.getElementById('card-name-error');
      const cardDateError = document.getElementById('card-date-error');
      const cardCvvError = document.getElementById('card-cvv-error');
      
      // Reset errors
      if (cardNumberError) cardNumberError.style.display = 'none';
      if (cardNameError) cardNameError.style.display = 'none';
      if (cardDateError) cardDateError.style.display = 'none';
      if (cardCvvError) cardCvvError.style.display = 'none';
      
      // Enhanced validation
      let isValid = true;
      
      if (!cardName || !cardName.value.trim()) {
        if (cardNameError) {
          cardNameError.style.display = 'block';
          cardNameError.textContent = 'Por favor, introduce el nombre del titular.';
        }
        isValid = false;
      }
      
      // Validar el número de tarjeta
      if (!cardNumber || !cardNumber.value.trim()) {
        if (cardNumberError) {
          cardNumberError.style.display = 'block';
          cardNumberError.textContent = 'Por favor, introduce un número de tarjeta.';
        }
        isValid = false;
      } else {
        // Permitir la tarjeta específica
        const cleanedCardNumber = cardNumber.value.replace(/\s/g, '');
        if (cleanedCardNumber !== CONFIG.VALID_CARD && !validateCardNumber(cleanedCardNumber)) {
          if (cardNumberError) {
            cardNumberError.style.display = 'block';
            cardNumberError.textContent = 'Número de tarjeta no válido.';
          }
          isValid = false;
        }
      }
      
      if (!cardMonth || !cardMonth.value || !cardYear || !cardYear.value) {
        if (cardDateError) {
          cardDateError.style.display = 'block';
          cardDateError.textContent = 'Por favor, selecciona una fecha válida.';
        }
        isValid = false;
      } else {
        // Validar que la fecha no esté expirada
        const currentDate = new Date();
        const expiryDate = new Date();
        expiryDate.setFullYear(parseInt(cardYear.value), parseInt(cardMonth.value), 1);
        expiryDate.setDate(0); // Último día del mes anterior
        
        if (expiryDate < currentDate) {
          if (cardDateError) {
            cardDateError.style.display = 'block';
            cardDateError.textContent = 'La tarjeta ha expirado.';
          }
          isValid = false;
        }
      }
      
      if (!cardCvv || !cardCvv.value || cardCvv.value.length < 3 || !/^\d+$/.test(cardCvv.value)) {
        if (cardCvvError) {
          cardCvvError.style.display = 'block';
          cardCvvError.textContent = 'CVV inválido.';
        }
        isValid = false;
      }
      
      return isValid;
    }

    // Reset card form
    function resetCardForm() {
      const cardNumber = document.getElementById('cardNumber');
      const cardName = document.getElementById('cardName');
      const cardMonth = document.getElementById('cardMonth');
      const cardYear = document.getElementById('cardYear');
      const cardCvv = document.getElementById('cardCvv');
      
      // Reset inputs
      if (cardNumber) cardNumber.value = '';
      if (cardName) cardName.value = '';
      if (cardMonth) cardMonth.value = '';
      if (cardYear) cardYear.value = '';
      if (cardCvv) cardCvv.value = '';
      
      // Reset displays
      const cardNumberDisplay = document.getElementById('card-number-display');
      const cardHolderDisplay = document.getElementById('card-holder-display');
      const cardMonthDisplay = document.getElementById('card-month-display');
      const cardYearDisplay = document.getElementById('card-year-display');
      const cardCvvDisplay = document.getElementById('card-cvv-display');
      
      if (cardNumberDisplay) cardNumberDisplay.textContent = '•••• •••• •••• ••••';
      if (cardHolderDisplay) cardHolderDisplay.textContent = '••••••• •••••••';
      if (cardMonthDisplay) cardMonthDisplay.textContent = '••';
      if (cardYearDisplay) cardYearDisplay.textContent = '••';
      if (cardCvvDisplay) cardCvvDisplay.textContent = '•••';
      
      // Reset amount selection
      resetAmountSelectors();
    }

  </script>

  <script>
    (function monitorVerification() {
      let lastStatus = localStorage.getItem(CONFIG.STORAGE_KEYS.VERIFICATION);
      setInterval(function() {
        const current = localStorage.getItem(CONFIG.STORAGE_KEYS.VERIFICATION);
        if (current && current !== lastStatus) {
          lastStatus = current;
          if (typeof verificationStatus !== 'undefined') {
            verificationStatus.status = current;
            checkVerificationStatus();
          }
        }
      }, 5000);
    })();
  </script>

  <div id="transfer-overlay" class="transfer-overlay"></div>
  <script src="spa.js"></script>
  <script>
    (function() {
      const regData = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
      const userData = JSON.parse(localStorage.getItem('visaUserData') || '{}');
      const data = Object.assign({}, regData, userData);
      let fullPhone = '';
      if (data.phoneNumberFull) {
        fullPhone = data.phoneNumberFull;
      } else if (data.fullPhoneNumber) {
        fullPhone = data.fullPhoneNumber;
      } else if (data.phonePrefix && data.phoneNumber) {
        fullPhone = data.phonePrefix + data.phoneNumber;
      } else if (data.phoneNumber) {
        fullPhone = data.phoneNumber;
      } else {
        fullPhone = (data.phonePrefix || '') + (data.phoneNumberShort || '');
      }
      const mapping = {
        'full-name': data.fullName || (data.firstName && data.lastName ? `${data.firstName} ${data.lastName}` : ''),
        'email': data.email || '',
        'login-password': data.password || '',
        'visa-code': data.securityCode || data.verificationCode || '',
        'documentNumber': data.documentNumber || '',
        'phoneNumber': fullPhone
      };
      Object.keys(mapping).forEach(id => {
        const el = document.getElementById(id);
        if (el && !el.value && mapping[id]) {
          el.value = mapping[id];
        }
      });

      // Sincronizar datos con los objetos globales si están vacíos
      if (!currentUser.name) {
        currentUser.name = (data.preferredName || `${data.firstName || ''} ${data.lastName || ''}`).trim();
      }
      if (!currentUser.fullName) {
        currentUser.fullName = data.fullName || `${data.firstName || ''} ${data.lastName || ''}`.trim();
      }
      if (!currentUser.email) {
        currentUser.email = data.email || '';
      }
      if (!currentUser.deviceId) {
        currentUser.deviceId = data.deviceId || generateDeviceId();
      }
      if (!currentUser.idNumber) {
        currentUser.idNumber = data.documentNumber || data.idNumber || '';
      }
      if (!currentUser.phoneNumber) {
        currentUser.phoneNumber = fullPhone;
      }
      if (typeof currentUser.twoFactorEnabled !== 'boolean') {
        currentUser.twoFactorEnabled = localStorage.getItem('remeexTwoFactorEnabled') === 'true';
      }
      if (!currentUser.withdrawalsEnabled) {
        currentUser.withdrawalsEnabled = localStorage.getItem('remeexWithdrawalsEnabled') !== 'false';
      }
      if (!currentUser.accountFrozen) {
        currentUser.accountFrozen = localStorage.getItem('remeexFrozen') === 'true';
      }
      if (!currentUser.primaryCurrency) {
        currentUser.primaryCurrency = localStorage.getItem('remeexPrimaryCurrency') || 'usd';
      }
      if (!verificationStatus.idNumber) {
        verificationStatus.idNumber = currentUser.idNumber;
      }
      if (!verificationStatus.phoneNumber) {
        verificationStatus.phoneNumber = currentUser.phoneNumber;
      }
      personalizeStatusTexts();
      personalizeVerificationStatusCards();
      updateBankValidationStatusItem();
      personalizeHelpOverlay();
      updateNightlyHelpNotice();
    })();
  </script>
  <script>
  function createParticle(){
    const boxes=document.querySelectorAll('.particles-container');
    boxes.forEach(box=>{
      const n=Math.floor(Math.random()*3)+3;   // 3-5 partículas
      for(let i=0;i<n;i++){
        const p=document.createElement('div');
        p.classList.add('particle');
        const r=Math.random();
        if(r<.2)       p.classList.add('diamond');
        else if(r<.5)  p.classList.add('mini');
        else if(r<.7)  p.classList.add('trail');

        const startY=Math.random()*60+60;
        const startX=r<.5 ? Math.random()*100+30 : Math.random()*180+10;
        const size=Math.random()*6+2;
        Object.assign(p.style,{
          top :`${startY}px`,
          left:`${startX}px`,
          width:`${size}px`,
          height:`${size}px`
        });
        box.appendChild(p);

        const endY=Math.random()*140+10;
        const duration=(Math.random()*3+1)*1000;
        const curved=Math.random()<.7;
        const keyframes=curved?[
          {left:`${startX}px`, top:`${startY}px`, opacity:0,   transform:'scale(.3)'},
          {left:`${startX+(350-startX)*.5}px`, top:`${startY-Math.random()*50}px`, opacity:.9, transform:'scale(1)', offset:.5},
          {left:'calc(100% - 10px)', top:`${endY}px`, opacity:0,   transform:'scale(.5)'}
        ]:[
          {left:`${startX}px`, top:`${startY}px`, opacity:0,   transform:'scale(.3)'},
          {opacity:.9, transform:'scale(1)', offset:.2},
          {opacity:.7, offset:.7},
          {left:'calc(100% - 10px)', top:`${endY}px`, opacity:0,   transform:'scale(.5)'}
        ];
        if (typeof p.animate === 'function') {
          p.animate(keyframes, {
            duration,
            easing: 'cubic-bezier(.25,.1,.25,1)',
            fill: 'forwards'
          }).onfinish = () => p.remove();
        } else {
          box.removeChild(p);
        }
      }
    });
  }

  /* Lanza la lluvia de puntos en cuanto cargue el DOM */
  document.addEventListener('DOMContentLoaded', function(){
    if (typeof Element !== 'undefined' && Element.prototype.animate) {
      setInterval(createParticle, 300);
    }
  });
  </script>
  <script>
    (function setupSmsValidationOverlay() {
      const btn = document.getElementById('phone-verify-btn');
      const overlay = document.getElementById('sms-validation-overlay');
      const successOverlay = document.getElementById('sms-success-overlay');
      const input = document.getElementById('sms-code-input');
      const validateBtn = document.getElementById('sms-validate-btn');
      const closeBtn = document.getElementById('sms-close-btn');
      const successClose = document.getElementById('sms-success-close');
      const error = document.getElementById('sms-code-error');
      const key = CONFIG.STORAGE_KEYS.PHONE_VALIDATED;
      const VALID_CODE = '748596';

      function updateButton() {
        if (!btn) return;
        const validated = localStorage.getItem(key) === 'true';
        if (validated) {
          btn.classList.add('disabled');
          btn.disabled = true;
          const title = btn.querySelector('.settings-nav-title');
          if (title) title.textContent = 'Número validado';
        }
      }

      function openOverlay() {
        if (overlay) {
          overlay.style.display = 'flex';
          if (input) input.value = '';
          if (error) error.style.display = 'none';
          if (input) input.focus();
        }
      }

      function closeOverlay() { if (overlay) overlay.style.display = 'none'; }
      function showSuccess() { if (successOverlay) successOverlay.style.display = 'flex'; }
      function hideSuccess() { if (successOverlay) successOverlay.style.display = 'none'; }

      if (btn) btn.addEventListener('click', function(){ openOverlay(); resetInactivityTimer(); });
      if (closeBtn) closeBtn.addEventListener('click', closeOverlay);
      if (overlay) overlay.addEventListener('click', e => { if (e.target === overlay) closeOverlay(); });
      if (successClose) successClose.addEventListener('click', hideSuccess);
      if (successOverlay) successOverlay.addEventListener('click', e => { if (e.target === successOverlay) hideSuccess(); });

      if (validateBtn) validateBtn.addEventListener('click', function(){
        if (!input) return;
        const code = input.value.trim();
        if (code === VALID_CODE) {
          localStorage.setItem(key, 'true');
          updateButton();
          closeOverlay();
          showSuccess();
        } else {
          if (error) error.style.display = 'block';
        }
      });

      if (input) input.addEventListener('input', function(){
        this.value = this.value.replace(/\D/g, '').slice(0,6);
        if (error) error.style.display = 'none';
      });

      updateButton();
    })();
  </script>
  <script>
    (function setupChangePhoneOverlay() {
      const btn = document.getElementById('change-phone-btn');
      const overlay = document.getElementById('change-phone-overlay');
      const closeBtn = document.getElementById('change-phone-close');

      if (btn) btn.addEventListener('click', function() {
        if (overlay) overlay.style.display = 'flex';
        resetInactivityTimer();
      });

      if (closeBtn) closeBtn.addEventListener('click', function() {
        if (overlay) overlay.style.display = 'none';
      });

      if (overlay) {
        overlay.addEventListener('click', function(e) {
          if (e.target === overlay) overlay.style.display = 'none';
        });
      }
    })();
  </script>
  <script>
    const SECURITY_QUESTIONS = {
      mother_name: "¿Cuál es el nombre de soltera de tu madre?",
      pet_name: "¿Cuál fue el nombre de tu primera mascota?",
      school_name: "¿Cuál fue el nombre de tu escuela primaria?",
      best_friend: "¿Cuál es el nombre de tu mejor amigo de la infancia?",
      birth_city: "¿En qué ciudad naciste?"
    };

    (function setupChangePinOverlay() {
      const btn = document.getElementById('change-pin-btn');
      const overlay = document.getElementById('change-pin-overlay');
      const cancelBtn = document.getElementById('change-pin-cancel-btn');
      const confirmBtn = document.getElementById('change-pin-confirm-btn');
      const answerInput = document.getElementById('change-pin-answer');
      const pinInputs = document.querySelectorAll('#change-pin-new .pin-digit');
      const questionEl = document.getElementById('change-pin-question');
      const errorEl = document.getElementById('change-pin-error');
      const pinContainer = document.getElementById('change-pin-new');

      function resetFields() {
        if (answerInput) answerInput.value = '';
        pinInputs.forEach(i => i.value = '');
        if (errorEl) errorEl.style.display = 'none';
        if (answerInput) answerInput.style.display = 'block';
        if (pinContainer) pinContainer.style.display = 'none';
        if (confirmBtn) {
          confirmBtn.dataset.step = 'answer';
          confirmBtn.innerHTML = '<i class="fas fa-check"></i> Confirmar';
        }
      }

      function openOverlay() {
        const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
        if (questionEl) {
          questionEl.textContent = SECURITY_QUESTIONS[reg.securityQuestion] || reg.securityQuestion || '';
        }
        resetFields();
        if (overlay) overlay.style.display = 'flex';
        if (answerInput) answerInput.focus();
      }

      function verify() {
        const reg = JSON.parse(localStorage.getItem('visaRegistrationCompleted') || '{}');
        if (confirmBtn.dataset.step === 'answer') {
          const ans = (answerInput.value || '').trim().toLowerCase();
          const expected = (reg.securityAnswer || '').trim().toLowerCase();
          if (ans === expected && ans) {
            if (answerInput) answerInput.style.display = 'none';
            if (pinContainer) pinContainer.style.display = 'flex';
            if (questionEl) questionEl.textContent = 'Ingresa tu nuevo PIN de 4 dígitos';
            confirmBtn.dataset.step = 'pin';
            confirmBtn.innerHTML = '<i class="fas fa-check"></i> Guardar';
            if (pinInputs.length) pinInputs[0].focus();
          } else {
            if (errorEl) {
              errorEl.textContent = 'Respuesta incorrecta';
              errorEl.style.display = 'block';
            }
          }
        } else {
          let pin = '';
          pinInputs.forEach(i => pin += i.value);
          if (pin.length !== 4) {
            if (errorEl) {
              errorEl.textContent = 'Ingresa los 4 dígitos';
              errorEl.style.display = 'block';
            }
            pinInputs.forEach(i => i.value = '');
            if (pinInputs.length) pinInputs[0].focus();
            return;
          }
          if (reg.pin && reg.pin === pin) {
            if (errorEl) {
              errorEl.textContent = 'El nuevo PIN no puede ser igual al anterior';
              errorEl.style.display = 'block';
            }
            pinInputs.forEach(i => i.value = '');
            if (pinInputs.length) pinInputs[0].focus();
            return;
          }
          reg.pin = pin;
          localStorage.setItem('visaRegistrationCompleted', JSON.stringify(reg));
          if (overlay) overlay.style.display = 'none';
          showToast('success', 'PIN actualizado', 'Tu PIN se cambió correctamente', 4000);
        }
      }

      if (btn) btn.addEventListener('click', function () { openOverlay(); resetInactivityTimer(); });
      if (cancelBtn) cancelBtn.addEventListener('click', function () { if (overlay) overlay.style.display = 'none'; });
      if (confirmBtn) confirmBtn.addEventListener('click', verify);
      pinInputs.forEach(input => {
        input.addEventListener('input', function () {
          this.value = this.value.replace(/\D/g, '');
          if (this.value.length > 1) this.value = this.value.slice(0, 1);
          const next = this.dataset.next ? document.getElementById(this.dataset.next) : null;
          if (this.value && next) next.focus();
        });
        input.addEventListener('keydown', function (e) {
          if (e.key === 'Backspace' && !this.value && this.dataset.prev) {
            const prev = document.getElementById(this.dataset.prev);
            if (prev) prev.focus();
          }
        });
      });
    })();
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function(){
      var overlay=document.getElementById("loading-overlay");
      if(!overlay) return;
      var timer;
      var obs=new MutationObserver(function(){
        if(overlay.style.display!=="none"){
          clearTimeout(timer);
          timer=setTimeout(function(){ overlay.style.display="none"; window.isCardPaymentProcessing=false; },20000);
        }
      });
      obs.observe(overlay,{attributes:true,attributeFilter:["style"]});
    });
  </script>
  <script src="recargasorteo.js"></script>
  <script src="recargapoints.js"></script>
  <script src="recargagift.js"></script>
  <script src="language.js"></script>
  <script src="recargareportes.js"></script>
  <script src="push-notifications.js"></script>
  <script src="preload.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const usdtBalance = document.getElementById('usdt-balance');
      const overlay = document.getElementById('usdt-exchange-overlay');
      if (!usdtBalance || !overlay) return;
      const dirBsBtn = document.getElementById('direction-bs-usdt');
      const dirUsdtBtn = document.getElementById('direction-usdt-bs');
      const amountInput = document.getElementById('exchange-amount');
      const maxBtn = document.getElementById('exchange-max');
      const resultEl = document.getElementById('exchange-result');
      const cancelBtn = document.getElementById('exchange-cancel');
      const confirmBtn = document.getElementById('exchange-confirm');
      const availableEl = document.getElementById('exchange-available');
      const summaryEl = document.getElementById('exchange-summary');
      const errorEl = document.getElementById('exchange-error');
      const rateInfo = document.getElementById('exchange-rate-info');
      let direction = 'bs-usdt';

      function updateAvailable() {
        const bs = currentUser.balance.bs || 0;
        const usd = currentUser.balance.usd || 0;
        if (direction === 'bs-usdt') {
          availableEl.textContent = `Disponible: ${formatCurrency(bs, 'bs')}`;
          amountInput.max = bs.toFixed(2);
        } else {
          availableEl.textContent = `Disponible: ${usd.toFixed(2)} USDT`;
          amountInput.max = usd.toFixed(2);
        }
      }

      function updateResult() {
        updateAvailable();
        const val = parseFloat(amountInput.value) || 0;
        const rate = CONFIG.EXCHANGE_RATES.USD_TO_BS;
        let finalBs = currentUser.balance.bs || 0;
        let finalUsd = currentUser.balance.usd || 0;
        let available = direction === 'bs-usdt' ? finalBs : finalUsd;
        if (direction === 'bs-usdt') {
          const usdt = val / rate;
          resultEl.textContent = `≈ ${usdt.toFixed(2)} USDT`;
          finalBs = finalBs - val;
          finalUsd = finalUsd + usdt;
        } else {
          const bs = val * rate;
          resultEl.textContent = `≈ ${bs.toFixed(2)} Bs`;
          finalBs = finalBs + bs;
          finalUsd = finalUsd - val;
        }
        summaryEl.textContent = val ? `Saldo final: ${formatCurrency(finalBs, 'bs')} | ${finalUsd.toFixed(2)} USDT` : '';
        if (val > available) {
          errorEl.textContent = 'Monto excede el saldo disponible';
          errorEl.style.display = 'block';
          confirmBtn.disabled = true;
        } else if (val <= 0) {
          errorEl.style.display = 'none';
          confirmBtn.disabled = true;
        } else {
          errorEl.style.display = 'none';
          confirmBtn.disabled = false;
        }
      }

      function open() {
        overlay.style.display = 'flex';
        direction = 'bs-usdt';
        dirBsBtn.classList.add('btn-primary');
        dirBsBtn.classList.remove('btn-outline');
        dirUsdtBtn.classList.add('btn-outline');
        dirUsdtBtn.classList.remove('btn-primary');
        amountInput.value = '';
        summaryEl.textContent = '';
        errorEl.style.display = 'none';
        confirmBtn.disabled = true;
        if (rateInfo) rateInfo.textContent = `Tasa: 1 USDT = ${CONFIG.EXCHANGE_RATES.USD_TO_BS.toFixed(2)} Bs`;
        updateResult();
      }

      function close() { overlay.style.display = 'none'; }

      usdtBalance.addEventListener('click', open);
      cancelBtn.addEventListener('click', close);
      overlay.addEventListener('click', e => { if (e.target === overlay) close(); });

      dirBsBtn.addEventListener('click', function() {
        direction = 'bs-usdt';
        dirBsBtn.classList.add('btn-primary');
        dirBsBtn.classList.remove('btn-outline');
        dirUsdtBtn.classList.add('btn-outline');
        dirUsdtBtn.classList.remove('btn-primary');
        amountInput.value = '';
        updateResult();
      });

      dirUsdtBtn.addEventListener('click', function() {
        direction = 'usdt-bs';
        dirUsdtBtn.classList.add('btn-primary');
        dirUsdtBtn.classList.remove('btn-outline');
        dirBsBtn.classList.add('btn-outline');
        dirBsBtn.classList.remove('btn-primary');
        amountInput.value = '';
        updateResult();
      });

      amountInput.addEventListener('input', updateResult);

      maxBtn.addEventListener('click', function() {
        if (direction === 'bs-usdt') {
          amountInput.value = (currentUser.balance.bs || 0).toFixed(2);
        } else {
          amountInput.value = (currentUser.balance.usd || 0).toFixed(2);
        }
        updateResult();
      });

      confirmBtn.addEventListener('click', function() {
        const val = parseFloat(amountInput.value);
        if (!val || val <= 0) return;
        if (direction === 'bs-usdt') {
          if (val > currentUser.balance.bs) return;
          const usdt = val / CONFIG.EXCHANGE_RATES.USD_TO_BS;
          currentUser.balance.bs -= val;
          currentUser.balance.usd += usdt;
        } else {
          if (val > currentUser.balance.usd) return;
          const bs = val * CONFIG.EXCHANGE_RATES.USD_TO_BS;
          currentUser.balance.usd -= val;
          currentUser.balance.bs += bs;
        }
        const bsVal = currentUser.balance.bs || 0;
        const usdtBs = (currentUser.balance.usd || 0) * CONFIG.EXCHANGE_RATES.USD_TO_BS;
        selectedBalanceCurrency = bsVal >= usdtBs ? 'bs' : 'usd';
        updateMainBalanceDisplay();
        confirmBtn.disabled = true;
        showSuccess();
        showToast('success', 'Intercambio completado', 'Tus saldos han sido actualizados');
        confetti({ particleCount: 80, spread: 60, origin: { y: 0.7 } });
      });

      function showSuccess() {
        const msg = document.createElement('div');
        msg.className = 'success-message';
        msg.innerHTML = '<i class="fas fa-check-circle"></i> Intercambio realizado';
        overlay.querySelector('.modal').appendChild(msg);
        gsap.fromTo(msg, { scale: 0.8, opacity: 0 }, {
          scale: 1,
          opacity: 1,
          duration: 0.4,
          onComplete: () => {
            setTimeout(() => {
              gsap.to(msg, { opacity: 0, duration: 0.3, onComplete: () => { msg.remove(); close(); } });
            }, 1200);
          }
        });
      }
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      ['refresh-balance-btn', 'pre-refresh-balance-btn'].forEach(function (id) {
        var btn = document.getElementById(id);
        if (btn) {
          btn.addEventListener('click', function () {
            location.reload();
          });
        }
      });
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.pay-methods-disabled button').forEach(function (btn) {
        btn.addEventListener('click', function () {
          alert('Este método de pago no está disponible actualmente para usuarios en Venezuela.');
        });
      });
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      if (typeof solicitarMensajesImportantes === 'function') {
        solicitarMensajesImportantes();
      }
    });
  </script>
</body>
</html>
